<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Eclipse Asciidoctor Editor">
  <title>AsciiDoctor Editor temporary output</title>
<link rel="stylesheet" href="AsciiDoctor%20Editor%20temporary%20output_files/font-awesome.min.css">
<link rel="stylesheet" href="AsciiDoctor%20Editor%20temporary%20output_files/dejavu.css">
<script blocktype="text/javascript" src="AsciiDoctor%20Editor%20temporary%20output_files/MathJax.js"></script><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style>
<link rel="stylesheet" href="AsciiDoctor%20Editor%20temporary%20output_files/default.css">
<link rel="stylesheet" href="AsciiDoctor%20Editor%20temporary%20output_files/coderay.css">
<script blocktype="text/javascript" src="AsciiDoctor%20Editor%20temporary%20output_files/document-autorefresh.js"></script>
<style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style></head>
<body class="article" style="margin-left:10px"><div id="MathJax_Message" style="display: none;"></div><h1>3Worlds user manual</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>by <strong>Jacques Gignoux</strong>, <strong>Ian D. Davies</strong> &amp; <strong>Shayne R. Flint</strong></p>
</div>
<div class="paragraph">
<p>Version: <strong>1.10</strong> (20 June 2022)</p>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="_purpose_and_motivation"><a class="anchor" href="#_purpose_and_motivation"></a>1. Purpose and motivation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_why_another_simulation_environment_for_ecology"><a class="anchor" href="#_why_another_simulation_environment_for_ecology"></a>1.1. Why another simulation environment for ecology?</h3>
<div class="paragraph">
<p><em>“Though the organisms may claim our primary interest, when we are
 trying to think fundamentally we cannot separate them from their 
special environment, with which they form
one physical system”</em> A. G. <a href="#Tansley1935">Tanlsey (1935)</a>.</p>
</div>
<div class="paragraph">
<p>Ecosystems, as first proposed by Arthur <a href="#Tansley1935">Tansley (1935)</a>,
 have both physical and biological aspects. They comprise not only 
energy and chemical stocks and flows but also living things that are 
born, reproduce and die, exhibiting particular behaviours over the 
course of their existence. They are made from and return to the physical
 world, are part of it and at the same time, constitute a domain where 
terms such as reproduction, social interaction, communication and life 
cycle have meaning.</p>
</div>
<div class="paragraph">
<p>To this day, reconciling these two aspects, where the physical is 
articulated in SI units and the biological in descriptive terms (e. g. 
heterotroph, shade-tolerant, obligate seeder), remains a key problem in 
ecosystem studies: How does an energy flux translate into a number of 
living individuals or in a higher biodiversity? How might a particular 
reproduction strategy affect river hydrology and the regional water 
budget (e. g. the beaver)? How do social interactions affect the 
frequency of hurricanes (e. g. climate change)?
<strong>3Worlds</strong> aims at providing <em>a tool for building simulations that couple the physical and biological aspects of ecosystems</em>.</p>
</div>
<div class="paragraph">
<p>It is our view that existing tools focus predominantly on one or 
other of these aspects. For example, dynamic models based on 
differential equations and can only represent reproduction and growth 
using metaphors for continuous physical quantities (e.g. matrix 
population models). Multi-agent systems (MAS), on the other hand, model 
social interactions well but pose difficulties in balancing mass or 
energy budgets.</p>
</div>
<div class="paragraph">
<p>In addition to this physical and biological duality, ecosystems are '<em>multi-scale</em>' (cf. an extensive discussion on
this topic and other questions related to the ecosystem concept in <a href="#Gignoux2011">Gignoux et al. 2011</a>). Tansley’s ecosystem definition
applies equally well to the whole biosphere as to a single bacteria in a drop of water. Currently, there is no
software enabling one to consider ecosystems at such different spatial and temporal scales within the same
conceptual framework. A second aim of <strong>3Worlds</strong> is to fill this gap. If the ecosystem concept is robust enough, and
we believe it is given its success in ecology and its adoption in other scientific fields, then it should be possible
to design a conceptually sound and consistent computing framework to deal with a multiplicity of scales.</p>
</div>
<div class="paragraph">
<p>However, changing the scale of a model is not just a matter of changing spatio-temporal resolution.
It also involves the level of detail of the representations used in the model, something which has been formalized
in <em>abstraction theory</em> (<a href="#Zucker2003">Zucker 2003</a>): 
the more detailed a model, the less abstract it is. The question arises 
then as to what level of detail should we model our system to capture 
its important behaviour? How does changing scale (in this
 broadest sense) effect model outcomes? There can be no general answer 
to this question beyond trial and error. This makes the possibility
 to test and compare different representations of the same system at 
different scales an essential feature of
 any software dealing with ecosystems. <strong>3Worlds</strong> provides <em>great flexibility in ecosystem representation</em>
 enabling one to represent <em>any</em> ecosystem at <em>any</em> spatial and temporal scale with <em>any</em>
 level of detail — all this being determined by
 the researcher in accordance with the purpose of their study. The 
researcher has full control on the detailed biological functions
and variables relevant to their study.</p>
</div>
<div class="paragraph">
<p>How is this flexibility compatible with the strong conceptual backbone? <strong>3Worlds</strong> uses <em>aspect-oriented thinking (AOT)</em> (<a href="#Flint2006">Flint 2006</a>), a method to build complex systems (e.g.
software) from independent areas of knowledge. We have designed an <em>archetype</em> of what we believe constitutes an
ecosystem — a recursive and multi-scale system of interacting entities. We use an implementation of AOT to ensure
that any user-defined representation of an ecosystem complies with the archetype. This guarantees that, despite a
great freedom left to the modeller, their model will always be compatible with the 3Worlds software. The great
benefit of this is that while we believe it’s possible to construct any type of
model within this archetype, imposing specification constraints greatly assists in model comparison: why should
two models, ostensibly constructed for the same purpose, differ in their outputs? How does a change in temporal
or spatial scale affect projections?  How does adding or removing sub-systems change model projections?
<em>Models developed in <strong>3Worlds</strong> are always comparable</em>,
  unlike many large model intercomparison exercises where the models are
 independently developed without reference to any common structuring 
principals.</p>
</div>
<div class="paragraph">
<p>The ecosystem is a recursive concept (<a href="#Gignoux2001">Gignoux et al. 2011</a>): ecosystems can be nested. Parts of an ecosystem can
be studied as ecosystems themselves. We use the concept of a hierarchical system, formalized as a graph (<a href="#Gignoux2017">Gignoux et
al. 2017</a>) to implement this idea. In <strong>3Worlds</strong>, <em>the modelled ecosystem is a graph</em> where nodes represent relevant
entities: individuals, populations, climate, soil, area, …​; and edges represent relations between these entities.
These relations can be of any kind, including a hierarchical relation describing the complex nesting of sub-systems.
This provides an elegant solution to the apparent complexity of ecosystems: it allows for various types of <em>emergence</em>,
enables the comparison of system structures and simulation trajectories, and can represent virtually anything
an ecological modeller can conceive of.</p>
</div>
<div class="paragraph">
<p><strong>3Worlds</strong> builds upon more than thirty years of 
experience of its developers in ecosystem and complex system modelling 
and simulation. Over this time, we have reached the conclusion that: (1)
 robust concepts
are fundamental for building sound software; (2) some problems, that 
appear over and over again in the life of a
simulation modeller, often have well-established solutions, sometimes in
 other scientific fields; and (3) complex
systems are more easily managed and understood when designed within a 
sound framework.</p>
</div>
<div class="paragraph">
<p>Many of the ideas we use are already available, it’s just a matter of making them work together, and <strong>3Worlds</strong> is our best attempt to do so!</p>
</div>
</div>
<div class="sect2">
<h3 id="_design_concepts"><a class="anchor" href="#_design_concepts"></a>1.2. Design Concepts</h3>
<div class="paragraph">
<p>3Worlds is based on a few concepts and techniques that have a very 
broad application and harnesses them to fit the needs of ecosystem 
modelling.</p>
</div>
<div class="sect3">
<h4 id="_individual_based_models"><a class="anchor" href="#_individual_based_models"></a>1.2.1. Individual based models</h4>
<div class="paragraph">
<p>Fundamentally, <strong>3Worlds</strong> is designed as a framework for <em>individual-based models</em> (IBMs: <a href="#Grimm2005">Grimm &amp; Railsback 2005</a>). IBMs, like multi-agent systems (MASs: <a href="#Bousquet2004">Bousquet &amp; Lepage 2004</a>),
 assume that some important properties of complex systems (like 
ecosystems and human societies) cannot be understood without 
representing the detailed behaviour of every individual in the system. 
In an IBM, a list of 'individuals' (called 'agents' in MASs) is kept in 
memory, and their interactions through various functions yield the 
dynamics of the whole system over time. Individuals can come and go, 
which means that their list is constantly changing in size.</p>
</div>
<div class="paragraph">
<p>3Worlds simulates a <em>system</em> made of interacting <em>system components</em>, which are equivalent to the individuals or agents of IBMs and MASs. If required by a simple application, the 3Worlds <em>system</em>
 can be reduced to zero components, just as in any system dynamics 
application; but this is not the use 3Worlds has been designed for, and 
other more specialised software may be more adapted for this use case.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_complex_system_as_a_dynamic_graph"><a class="anchor" href="#_the_complex_system_as_a_dynamic_graph"></a>1.2.2. The complex system as a dynamic graph</h4>
<div class="paragraph">
<p>Ecosystems are commonly considered as <em>complex systems</em>, without much agreement on what this concept means. Complex systems are usually assumed to possess <em>emergent properties</em>; again, with little agreement on what this means. We argued in <a href="#Gignoux2017">Gignoux et al. (2017)</a>
 that the only common feature of all definitions of emergence is that 
emergence can only appear in systems with a 'macro-state' and 
'micro-states'. We called such systems <em>hierarchical systems</em> and assumed that they can be ideally represented with a <em>dynamic graph</em>.</p>
</div>
<div id="fig-what-is-a-graph" class="imageblock left text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/graph.svg" alt="graph">
</div>
<div class="title">Figure 1. A mathematical graph, showing both the usual <br> mathematical terms and the vocabulary used in 3Worlds. <br> The incidence function defines edges between nodes. Edges <br>can be directed (with arrows) or undirected.</div>
</div>
<div class="paragraph">
<p>According to <a href="https://en.wikipedia.org/wiki/Graph_theory">graph theory</a>, a <em>graph</em> is a mathematical construct comprising a set of <em>nodes</em>, a set of <em>edges</em> linking these nodes defined in an <em>incidence function</em> (<a href="#fig-what-is-a-graph">Figure 1</a>). A <em>dynamic</em> graph (<a href="#Harary1997">Harary &amp; Gupta 1997</a>) is a graph where these three components (the sets of nodes, edges, and the incidence function) can change over time.</p>
</div>
<div class="paragraph">
<p>With the addition of <em>descriptors</em> (e.g. numbers with a specific meaning: <a href="#fig-graph-descriptors">Figure 2</a>)
 to nodes and edges, we can use the graph nodes as the individuals of 
our IBM, and the graph edges give a concrete existence to the 
interactions between those nodes. If we define <em>functions</em> that can modify nodes and edges and their descriptors, the graph becomes dynamic. A <strong>3Worlds</strong>
 simulation runs a dynamic graph where nodes, edges, descriptors, 
functions can be adapted to the user’s particular application. Nodes are
 called <em>system components</em>, edges <em>system relations</em>, and descriptors <em>properties</em>.</p>
</div>
<div id="fig-graph-descriptors" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/graph-with-descriptors.svg" alt="graph with descriptors" width="80%">
</div>
<div class="title">Figure 2. An example of graph descriptors (redrawn from <a href="#Gignoux2017">Gignoux et al. 2017</a>).</div>
</div>
</div>
<div class="sect3">
<h4 id="_categories"><a class="anchor" href="#_categories"></a>1.2.3. Categories</h4>
<div class="paragraph">
<p>In an IBM, every individual differs from all others. But it is common
 practice to assume that some groups of individuals share some things in
 common. This is the essence of modelling: finding commonalities within 
an ocean of particular cases. We use the concept of <em>category</em> to
 group system components that 'look like each other' in some way. 
Categories are used to express how alike and how different certain 
groups of components are from each other.</p>
</div>
<div class="paragraph">
<p>In a dynamic graph, categories are used to specify common descriptors
 to groups of components (e.g. a plant species average growth rate, an 
animal cohort survival rate, …​) and functions that operate on a group 
of components of the same category. They are also used to specify which <em>type of relation</em> is possible between components of different categories.</p>
</div>
<div class="paragraph">
<p>This category concept is similar in many ways to the class concept used in the <a href="http://uml.org/what-is-uml.htm">UML</a> language and in  <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">object oriented programming</a>.
 Categories can be nested, and can be exclusive of each other or not, 
that is, something can belong to one category of a set of caterories but
 not others within the same set e.g you can be <em>ephemeral</em> or <em>persistant</em> but not both. They are central to the organisation and execution of a simulation in <strong>3Worlds</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_time_with_simultaneous_events"><a class="anchor" href="#_time_with_simultaneous_events"></a>1.2.4. Time with simultaneous events</h4>
<div id="fig-3w-main-loop" class="imageblock right text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/state-change-loop.svg" alt="state change loop" width="500">
</div>
<div class="title">Figure 3. The time model of 3Worlds. The overall dynamics of a system is <br> computed as X(t+dt) = f(X(t)) where X represents the state of all system <br> components, t is time and f is the function (or rather, the set of functions) <br> used to compute the change over the time interval dt.</div>
</div>
<div class="paragraph">
<p>Because ecosystems have both biological and physical characteristics,
 they not only deal with individuals and populations of living 
organisms, but also with fluxes of matter and energy. To properly 
compute a mass or energy balance typical of physical questions, we need a
 time model that insures that all system components are modified 
synchronously - otherwise, leaks in mass and energy budgets may occur (<a href="#fig-3w-main-loop">Figure 3</a>). This is where IBMs differ somewhat from MASs in their most common current implementations: MASs emphasize the <em>autonomy</em>
 of agents by allowing them to modify their state immediately. In other 
words, MASs assume that no two events occurring in a simulation can be 
simultaneous, while mass/energy balance requires simultaneity of events.
 3Worlds assumes that simultaneous events are the default, but by using 
particular time models it is possible to relax this constraint.</p>
</div>
<div class="paragraph">
<p>Given the diversity of topics subject to ecological modelling, 
ecological processes span many orders of magnitude in their rate of 
action. Demographic models often use a yearly time step, while 
ecophysiological models may use daily time steps and physiological 
models may run with time steps of a second. In <strong>3Worlds</strong>,
 time steps span the whole scale of time units relevant to ecology, i.e.
 from milliseconds to millenia. Standard Gregorian calendar time can 
also be used. <strong>3Worlds</strong> provides three types of <em>time model</em> that can be used in interaction: '<em>clock</em>' models using a constant time step, <em>event-driven </em>time models where time events trigger computations that can generate further events in the future, and <em>scenarios</em> where the list of events determines when computations are to be made.</p>
</div>
</div>
<div class="sect3">
<h4 id="_causality"><a class="anchor" href="#_causality"></a>1.2.5. Causality</h4>
<div class="paragraph">
<p>When designing a model in practice, it appears that some computations
 can or must be made 'in parallel' while others must be made 
sequentially. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>before computing how much carbon a plant allocates to its roots or to
 its stems, one has to know how much carbon was gained from 
photosynthesis: within a time step, photosynthesis must be computed 
before allocation.</p>
</li>
</ul>
</div>
<div id="fig-3w-causal-loop" class="imageblock left">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/causal-loop.svg" alt="causal loop" width="400">
</div>
<div class="title">Figure 4. The causal loop within the time loop of 3Worlds. <br>Within a time step, computations are ordered by causal <br> dependency and processed accordingly. Intermediate state <br>and graph structure changes follow each causal step.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>before computing how much nitrogen an animal gets from its food 
according to its digesting system, one has to know how much food was 
ingested: food intake must be computed before digestion outcome.</p>
</li>
<li>
<p>water runoff in a water catchment is triggered by rainfall.</p>
</li>
<li>
<p>to compute competition for a shared resource, one has first to 
compute how much resource is available, how much demand there is for 
this resource by the organisms having an access to it, and then which 
share they will get based on some rule. Resource availability must be 
computed before demand and demand before uptake.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these examples, 'A must be computed before B' must be understood 
as 'A is the cause of B'. This 'before' does not refer to time scale: no
 matter at what scale we measure, think, or compute, a cause must be 
computed before its effect. It would be nonsense to compute things in 
another way.</p>
</div>
<div class="paragraph">
<p>In other words, the order of computations in a simulator does not 
only depend on time ordering, but also on the logic of causality implied
 by modelling choices.</p>
</div>
<div class="paragraph">
<p>This need for some ordering of computations within a time grain is important and was identified as such in implementations (<a href="#Quesnel2009">Quesnel et al. 2009</a>) of versatile simulation timing tools such as <a href="https://fr.wikipedia.org/wiki/Discrete_Event_System_Specification">DEVS</a> (<a href="#Zeigler2000">Zeigler et al. 2000</a>). In 3Worlds, the elementary time step of <a href="#truetime-with-simultaneous-events">[truetime-with-simultaneous-events]</a> is sub-divided into <em>causal</em> steps, enabling to proceed to computations in a meaningful order, and with intermediate update of state and graph structure (<a href="#fig-3w-causal-loop">Figure 4</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_space_as_a_mediator_for_interactions"><a class="anchor" href="#_space_as_a_mediator_for_interactions"></a>1.2.6. Space as a mediator for interactions</h4>
<div class="paragraph">
<p>IBMs are often 'spatialized', which means they include some 
representation of the physical space in which organisms of an ecosystem 
interact. We argued in <a href="#Gignoux2011">Gignoux et al. (2011)</a> 
that space is not a requirement of the ecosystem definition, but rather 
an optional feature. Besides the usual 3-dimensional space, we called 
the place where organisms interact in an ecosystem the <em>arena</em>, 
i.e. the place where things happen and where a public (of ecological 
modellers) is watching them. This does not mean an Euclidian (or any 
other kind of) space must be associated with the ecosystem 
representation. Using a dynamic graph is sufficient.</p>
</div>
<div class="paragraph">
<p>However, it is often the case that explicitly considering space in a 
model is necessary for computing ecological interactions. In most 
ecological process models, there are actually implicit assumptions about
 space and how it affects organism interactions. For example, seed 
dispersal in plants is easily computed in a 2-dimensional space where 
the location of seeds depends on that of parent plants and some simple 
distance law; water flow in a catchment relies on a 2-dimensional space 
plus an elevation of ground surface to some x and y resolution; 
competition between individual trees in a forest assume a vertical 
distribution of leaves depicted with varying degrees of detail.</p>
</div>
<div class="paragraph">
<p>Following <a href="#Gignoux2011">Gignoux et al. (2011)</a>, we 
optionally provide predefined spatial representations to include in a 
simulator. Different spaces can be used within a single simulator, 
depending on the needs of the process computations. They are associated 
with optimal search algorithms (e.g. Kd-trees) that speed up the search 
of components with which to form dynamic relations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modelling_made_easy"><a class="anchor" href="#_modelling_made_easy"></a>1.2.7. Modelling made easy</h4>
<div class="paragraph">
<p>The community of ecological scientists has been developing an 
impressively large number of models, yet most of them are poorly 
designed in terms of programming, as ecologists are not necessarily 
software engineers. Ecosystem simulators are among the most complex 
programs (<a href="#Coquillard1997">Coquillard &amp; Hill 1997</a>). 
They require high programming skills and constitute a huge investment in
 time, which makes their production slow and hazardous. As a result, 
once built, they tend to be used beyond their initial domain of 
application (e.g. the overuse and abuse of the CENTURY model: <a href="#Parton1988">Parton et al. 1988</a>), issues of provenance and repeatability are rarely addressed, shedding some doubt on the discipline as a whole.</p>
</div>
<div class="paragraph">
<p>With <strong>3Worlds</strong>, we wanted to provide a simulation 
platform for ecosystem modelling using state-of-the-art concepts and 
algorithms, and sound programming techniques (e.g. systematic code 
testing, separated concerns), so that ecological modellers can 
concentrate on the ecological part of the problem and forget about the 
computer science part. We used <em>automatic code generation</em> to ensure that researchers need only edit one code file to build a simulator for their particular model. We used a <em>graph editor</em> to build the configuration and organise the data required for a particular study. In <strong>3Worlds</strong>
 therefore, an ecosystem model only requires two files: a specification 
file organised as a graph, and a computer code file where all relevant 
ecological processes are written. None of this prevents the modeller 
from using software libraries, either their own or from a third party, 
to extend their coding capabilities.</p>
</div>
<div class="paragraph">
<p>When designing a model, it is important to get quick visual feedback 
system behaviour when one changes equations or their implementation. <strong>3Worlds</strong>
 comes with a library of user-interface objects (graphs, maps, time 
series) that can be freely assembled to adapt outputs to the needs of 
the researcher.</p>
</div>
</div>
<div class="sect3">
<h4 id="_model_comparison_graphs_can_be_compared"><a class="anchor" href="#_model_comparison_graphs_can_be_compared"></a>1.2.8. Model comparison: graphs can be compared</h4>
<div class="paragraph">
<p>Climate change modelling relies on 19 major general circulation 
models (GCMs) all based on the same equations. When run with identical 
datasets (initial data plus forcings), they all yield different results.
 This is expected given the size of their code, but what is troubling is
 that nobody is able to trace within the code where the differences come
 from  (<a href="#Lim2009">Lim &amp; Roderick 2009</a>). This problem arises again and again in the modelling literature (e.g. <a href="#Melilo1995">Melilo et al. 1995</a>; <a href="#Roxburgh2004">Roxburgh et al. 2004</a>).
 The ultimate reason for this impossibility is that all the knowledge 
invested into these huge models is represented in computer code, which 
are very difficult to compare for any but the simplest of models.</p>
</div>
<div class="paragraph">
<p><strong>3Worlds</strong> is an attempt to solve this issue <em>for the future</em> (there is nothing we can do for past model code). If models are developed within the standard framework of <strong>3Worlds</strong>,
 the only thing that needs to be compared among models is their 
specification file (a graph) and their code file - hundreds to thousands
 of lines, not more. Everything else is equal. In theory this should 
facilitate model comparison.</p>
</div>
</div>
<div class="sect3">
<h4 id="_problem_upscaling"><a class="anchor" href="#_problem_upscaling"></a>1.2.9. Problem upscaling</h4>
<div class="paragraph">
<p>Developing a simulator is only a small part of the ecological 
modelling exercise: once the simulator is ready, it is used as a real 
ecosystem in <em>simulation experiments</em>. Designing and running such
 experiments is a very important part of the job - if not the most 
important, as it is the one which gives insight and publishable results.</p>
</div>
<div class="paragraph">
<p>IBMs are often stochastic, as population rates translate into 
probabilities at the individual level: e.g., the code has to decide 
which individuals to delete to satisfy a mortality rate of 10%. This is 
usually based on drawing random numbers. As a result, every simulation 
is different even when using identical parameters, and an asymptotic 
behaviour of the system can only be obtained by running multiple 
simulations. Fortunately, this is easily parallelized with modern 
computers.</p>
</div>
<div class="paragraph">
<p>3Worlds is interfaced with <a href="https://openmole.org/">OpenMole</a>
  to provide access to big computing power. Through OpenMole, big 
simulation experiments can be deployed on networks of computers, grids, 
or supercomputers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_portability_and_performance"><a class="anchor" href="#_portability_and_performance"></a>1.2.10. Portability and performance</h4>
<div class="paragraph">
<p><strong>3Worlds</strong> is written in Java to ensure portability 
between all operating systems. Its code has been carefully optimised, 
although generality inevitably comes with some performance cost.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="_getting_started_download_and_installation"><a class="anchor" href="#_getting_started_download_and_installation"></a>2. Getting started - download and installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basics_what_you_must_know_before_starting"><a class="anchor" href="#_basics_what_you_must_know_before_starting"></a>2.1. Basics - what you must know before starting</h3>
<div class="paragraph">
<p>3Worlds is an application designed to develop and launch simulations of ecosystems.
It is highly versatile and can simulate any kind of ecosystem using any kind of mathematical logic.</p>
</div>
<div class="paragraph">
<p>The application and use of 3Worlds to a particular ecosystem for a particular study case is called a <em>model</em> — or, more precisely a <em>simulation</em>
 model.
The model must first be specified and developed (this involves writing 
some code in the java programming language) before it can be executed 
for a particular case study.
This execution is called a <em>simulation experiment</em>.</p>
</div>
<div class="paragraph">
<p>3Worlds comprises two main applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ModelMaker</code>, to configure a model;</p>
</li>
<li>
<p><code>ModelRunner</code>, to run the model.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Creating a model involves creating a configuration with <code>ModelMaker</code> and developing some associated Java code to specify details particular to your model.
To do this, you must use the <a href="https://www.eclipse.org/downloads/">Eclipse</a>
 programming software (freeware). Later versions of 3Worlds may support 
other packages, but at the time of writing, 3Worlds will only work with <a href="https://www.eclipse.org/downloads/">eclipse</a>.</p>
</div>
<div class="paragraph">
<p><code>ModelMaker</code> will generate Java code for data structures specific to a model (based on the configuration file you have developed) and <em>template</em>
 java code for each process you have defined. These process templates 
are where you enter programming code to implement your model. You only 
need to write  code for your processes and for model initialisation. All
 else is managed by 3Worlds.</p>
</div>
<div class="paragraph">
<p>3Worlds is written in <a href="https://en.wikipedia.org/wiki/Java_(programming_language)">java</a>, which makes it OS-independent. It can be run on MacOS, Linux or Windows computers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>2.2. Prerequisites</h3>
<div class="paragraph">
<p>You will need the following software installed on your computer before installing 3Worlds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java JDK (<strong>J</strong>ava <strong>D</strong>evelopment <strong>K</strong>it), version 11 or greater (<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html">Oracle</a> or <a href="http://openjdk.java.net/">open</a> version)</p>
</li>
<li>
<p>Java fx (graphical user interface library for java: <a href="http://www.oracle.com/technetwork/java/javase/overview/javafx-overview-2158620.html">Oracle</a> or <a href="http://openjdk.java.net/projects/openjfx/">open</a> version)</p>
</li>
<li>
<p>an <a href="https://www.eclipse.org/downloads/">Eclipse</a> Java development environment and add the  <a href="https://www.eclipse.org/efxclipse/install.html">e(fx)clipse plugin</a> required for Javafx</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_running_modelmaker"><a class="anchor" href="#_running_modelmaker"></a>2.3. Running ModelMaker</h3>
<div class="paragraph">
<p>This assumes you have downloaded <code>3w.zip</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unzip <code>3w.zip</code> in your user home directory (important), keeping the internal directory tree. This will extract a file <code>modelMaker.jar</code> and a <code>3w</code> directory containing more jar files.</p>
</li>
<li>
<p>Double-click on <code>modelMaker.jar</code>. This should launch the ModelMaker application.</p>
</li>
<li>
<p>If this doesn’t work, open a terminal and type <code>java -jar modelMaker.jar</code>. This should launch the ModelMaker application.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This way of launching 3Worlds is sensitive to the relative location of <code>modelMaker.jar</code> and the other jars that are in the <code>3w</code> directory, ie <code>modelMaker.jar</code> <strong>must</strong> be exactly one directory above <code>3w</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To remove this constraint, you can bypass <code>modelMaker.jar</code> by directly launching it from the jars contained in <code>3w</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -cp 3w/tw.jar au.edu.anu.twuifx.mm.MMmain</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is preferable to run the software from a terminal window. This way, any errors that may arise will be displayed.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
to develop your model-specific code, you will need to setup a Java development environment as shown in  <a href="#truesetting-up-a-java-development-environment-for-the-user-code">[truesetting-up-a-java-development-environment-for-the-user-code]</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_a_java_development_environment_for_the_user_code"><a class="anchor" href="#_setting_up_a_java_development_environment_for_the_user_code"></a>2.4. Setting up a Java development environment for the user code</h3>
<div class="sect3">
<h4 id="_setting_up_the_eclipse_integrated_development_environment_ide_for_3worlds"><a class="anchor" href="#_setting_up_the_eclipse_integrated_development_environment_ide_for_3worlds"></a>2.4.1. Setting up the Eclipse Integrated Development Environment (IDE) for 3Worlds</h4>
<div class="paragraph">
<p>This assumes you have downloaded <code>tw.jar</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If not yet done, install <a href="https://www.eclipse.org/downloads/">Eclipse</a> (don’t forget <a href="https://www.eclipse.org/efxclipse/install.html">e(fx)clipse</a>!)</p>
</li>
<li>
<p>Create at <em>workspace</em> (a working directory for Eclipse - Eclipse will ask for it when launched). e.g., <em>&lt;my_workspace&gt;</em></p>
</li>
<li>
<p>Within Eclipse, create a <em>project</em>:</p>
<div class="ulist">
<ul>
<li>
<p>Select menu <code>File → New → Java project</code>; this opens a dialog box</p>
</li>
<li>
<p>In the dialog box, type a project name (e.g. <em>&lt;my_project&gt;</em>)</p>
</li>
<li>
<p>Click the <code>Finish</code> button</p>
</li>
</ul>
</div>
</li>
<li>
<p>Import 3Worlds dependencies:</p>
<div class="ulist">
<ul>
<li>
<p>Select menu <code>Project → Properties</code>; this opens a dialog box</p>
</li>
<li>
<p>In the dialog box, select <code>Java Build Path</code></p>
</li>
<li>
<p>Select the <code>Libraries</code> tab</p>
</li>
<li>
<p>Select <code>ClassPath</code></p>
</li>
<li>
<p>Click on the <code>Add external JARs…​</code> button; this open a file selection dialog box</p>
</li>
<li>
<p>In the file selection dialog box, browse and select <code>tw.jar</code></p>
</li>
<li>
<p>Click the <code>Apply and Close</code> button</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_running_modelmaker_from_eclipse"><a class="anchor" href="#_running_modelmaker_from_eclipse"></a>2.4.2. Running ModelMaker from Eclipse</h4>
<div class="paragraph">
<p>ModelMaker can be run from Eclipse or as a standalone application since it is included in the <code>tw.jar</code> library required to develop the user code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <code>package explorer</code> window, expand the <code>Referenced libraries</code> entry</p>
</li>
<li>
<p>Right-click on the <code>tw.jar</code> entry, select <code>Run as → Java Application</code>. This opens a dialog box</p>
</li>
<li>
<p>In the dialog box, type <em>Main</em></p>
</li>
<li>
<p>In the list of matching items, select <code>Main - au.edu.anu.twuifx.MMmain</code> and click <code>OK</code></p>
</li>
<li>
<p>If warning errors appear, click <code>Proceed</code>. This launches the ModelMaker application</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_linking_user_code_with_model_configuration"><a class="anchor" href="#_linking_user_code_with_model_configuration"></a>2.4.3. Linking user code with model configuration</h4>
<div class="paragraph">
<p>This requires the following actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In ModelMaker,</p>
<div class="ulist">
<ul>
<li>
<p>create or open a <em>3Worlds</em> project (<code>Projects</code> entry of the main menu)</p>
</li>
<li>
<p>select <code>Preferences → Java Project → Connect…​</code>. This opens a dialog box with a file selector</p>
</li>
<li>
<p>select the root directory of the <em>Eclipse</em> project as created above (e.g. <em>&lt;my_workspace&gt;</em>/<em>&lt;my_project&gt;</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation tells <code>ModelMaker</code> to generate its code into the user java project.
When you want to edit your code in eclipse, you must first <strong>refresh</strong> the eclipse project:</p>
</div>
</li>
<li>
<p>In Eclipse,</p>
<div class="ulist">
<ul>
<li>
<p>select the project name at the very top of the <code>package explorer</code> window</p>
</li>
<li>
<p>right-click on it and select <code>Refresh</code></p>
</li>
<li>
<p>or, alternatively: press the <strong>F5</strong> key</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You don’t <strong>have</strong> to do this. We provide it as a facility 
if you want to run ModelMaker from eclipse rather than directly for some
 reason of your own.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_and_testing_user_code"><a class="anchor" href="#_debugging_and_testing_user_code"></a>2.4.4. Debugging and testing user code</h4>
<div class="paragraph">
<p>The user code, first generated by <code>ModelMaker</code> and further edited by the user, can be run using <code>UserCodeRunner.java</code>. This class can be found in the <code>default</code> src directory and was created when linking this project with the 3Worlds project (cf above).
It requires three command line arguments (we assume that you know how to setup and run a <code>Run Configuration</code> in Eclipse):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance number (more about this later); leave this at '0' for now.</p>
</li>
<li>
<p>the name of the directory of the 3Worlds project as created by <code>ModelMaker</code> (e.g. <em>project_test_model9_2019-09-05-08-50-20-458</em>). This project directory is located under the <code>3w</code> directory automatically created by <code>ModelMaker</code> as its working directory</p>
</li>
<li>
<p>some optional settings to switch on debugging logs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this, the user code should be executed as a test simulation by <code>UserCodeRunner</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Further edits and modifications of the configuration can be made in <code>ModelMaker</code>,
 but don’t forget to keep the Eclipse project content synchronized with 
the ModelMaker project by refreshing the Eclipse project as often as 
necessary.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="_configuration_reference_creating_and_editing_a_model_with_modelmaker"><a class="anchor" href="#_configuration_reference_creating_and_editing_a_model_with_modelmaker"></a>3. Configuration reference: creating and editing a model with ModelMaker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_concepts_structure_of_a_3worlds_configuration"><a class="anchor" href="#_general_concepts_structure_of_a_3worlds_configuration"></a>3.1. General concepts: structure of a 3Worlds configuration</h3>
<div class="sect3">
<h4 id="_a_tree_structure"><a class="anchor" href="#_a_tree_structure"></a>3.1.1. A tree structure…​</h4>
<div class="paragraph">
<p>The configuration of a 3Worlds <em>simulation experiment</em> is organised as a tree (<a href="#fig-configuration-tree">Figure 5</a>). Each tree <em>node</em> specifies a subset of the parameters of the whole configuration. Each <em>node</em> has <em>child nodes</em> linked through a <em>tree edge</em>, so that large pieces of configuration can be broken down into the relevant details. At each level of this hierarchy, <em>properties</em> can be attached to <em>nodes</em>.</p>
</div>
<div class="paragraph">
<p><em>Nodes</em> have a <em>label</em> and a <em>name</em> that are displayed in the <code>ModelMaker</code> interface as <code>label:name</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>label</em> specifies what role this particular <em>node</em> plays in the whole configuration. For example, the <em>node</em> labelled <code>experiment</code> is used to configure a <em>simulation experiment</em>.</p>
</li>
<li>
<p>The <em>name</em> is used to differentiate <em>nodes</em>. It must be unique over the whole configuration tree. By default, <code>ModelMaker</code> generates unique names (by adding a number to the name if replicates are found).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>root node</em> of a configuration is always labelled <code>3worlds</code>.</p>
</div>
<div id="fig-configuration-tree" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/dsl-tree4.svg" alt="dsl tree4">
</div>
<div class="title">Figure 5. Tree structure of a simulation experiment configuration in 3Worlds</div>
</div>
<div class="paragraph">
<p>The configuration tree is stored in a file in a specially designed text format, ending with the extension <code>.ugt</code> or <code>.twg</code>. Such files are produced by <code>ModelMaker</code> and can then be exchanged and imported into <code>ModelMaker</code> via the <code>Projects → Import…​</code> menu entry. Their format is human-readable, but they must <strong>never</strong> be edited with another software than <code>ModelMaker</code> - <strong>the risk is to corrupt all your configuration</strong> and be unable to run it (or even edit it with <code>ModelMaker</code> again).</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>NEVER</strong> edit the 3worlds configuration <code>.ugt</code> file 'by hand'! You may make it unreadable to <code>ModelMaker</code> and lose all your work.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Each node in the configuration has a particular meaning for <code>ModelRunner</code>: the configuration must comply with certain rules and constraints, the first one being the particular set of <em>nodes</em> that have been designed and appear on <a href="#fig-configuration-tree">Figure 5</a>. The detailed meaning of all <em>nodes</em> and their <em>properties</em> is described in <a href="#trueconfiguration-options-reference">[trueconfiguration-options-reference]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_with_cross_links"><a class="anchor" href="#_with_cross_links"></a>3.1.2. …​with cross-links</h4>
<div class="paragraph">
<p>Actually, the 3Worlds configuration is not strictly hierarchical (<a href="#fig-configuration-tree2">Figure 6</a>): according to their role in <code>ModelRunner</code>, some configuration <em>nodes</em> need to gather information from other parts of the configuration tree. This is done by allowing for some cross-reference <em>edges</em>
 to be defined, that overlay with the strict hierarchical structure of 
the tree. As a result of these cross links, the whole configuration is a
 <em>graph</em> rather than a tree.</p>
</div>
<div id="fig-configuration-tree2" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/dsl-tree4links.svg" alt="dsl tree4links">
</div>
<div class="title">Figure 6. Tree structure of a simulation experiment 
configuration in 3Worlds, showing the cross-links between tree nodes 
(NB: not all cross-links are drawn)</div>
</div>
<div class="paragraph">
<p><em>Edges</em> representing cross links have a <em>label</em>, <em>name</em>, and may have <em>properties</em> just as <em>nodes</em> do. The detailed meaning of all cross-reference <em>edges</em> and their <em>properties</em> is described in <a href="#trueconfiguration-options-reference">[trueconfiguration-options-reference]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_modelmaker_does_for_you"><a class="anchor" href="#_what_modelmaker_does_for_you"></a>3.1.3. What ModelMaker does for you</h4>
<div class="paragraph">
<p><code>ModelMaker</code> knows the details of the configuration constraints. It facilitates the design of a configuration by only letting you add the <em>nodes</em>, <em>edges</em> and <em>properties</em>
 that will produce a valid, runnable configuration file. During the 
configuration building process, it constantly checks the validity of the
 graph and reports any errors or missing parts in its <code>log</code> panel. <code>ModelMaker</code> is far more than a nice visual editor producing a graph: a configuration graph produced with <code>ModelMaker</code> is <strong>guaranteed</strong> to run with <code>ModelRunner</code> because of all these internal consistency and validity checks.</p>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="_using_modelmaker_software_interface_and_functioning"><a class="anchor" href="#_using_modelmaker_software_interface_and_functioning"></a>3.2. Using ModelMaker: software interface and functioning</h3>
<div class="paragraph">
<p><em>ModelMaker</em> has the traditional main menu bar, a variety of 
mouse/keyboard operations and three regions for the construction of the 
model specifications graph (<a href="#fig-modelmaker">Figure 7</a>):</p>
</div>
<div id="fig-modelmaker" class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-modelmaker.png" alt="fig modelmaker">
</div>
<div class="title">Figure 7. The appearance of <em>ModelMaker</em> displaying an example project.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-hand side: <strong>Graph display</strong> window and associated tool bar for graph construction.</p>
</li>
<li>
<p>Top left: <strong>Property editors</strong> for node and edge properties.</p>
</li>
<li>
<p>Bottom left: <strong>Message pane</strong> to display actions that are required to ensure the specifications are valid.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The main window title is the currently open project and any linked Java project associated with it (<strong>&lt;3Worlds project name&gt;(&lt;date&gt;) &lt;o-o-o&gt; &lt;Java project name&gt;</strong>). Whenever the specifications are edited, an asterisk is prefixed to the window title and cleared upon saving.</p>
</div>
<div class="sect3">
<h4 id="_main_menu"><a class="anchor" href="#_main_menu"></a>3.2.1. Main menu</h4>
<div class="sect4">
<h5 id="_project"><a class="anchor" href="#_project"></a>Project</h5>
<div class="sect5">
<h6 id="_new"><a class="anchor" href="#_new"></a>New</h6>
<div id="fig-menu-new" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-menu-new.png" alt="fig menu new">
</div>
<div class="title">Figure 8. Options for creating a new project.</div>
</div>
<div class="paragraph">
<p>Creates a new project from either a library of <strong>Templates</strong>, <strong>Tutorials</strong>, <strong>Model library</strong> or <strong>Test cases</strong> (<a href="#fig-menu-new">Figure 8</a>).
 You will be prompted for a unique name for the project. The first 
letter of this name must be upper case as it will eventually be used as 
the name of a Java class when the project successfully compiles.  A 
sub-directory with the name and creation date will be created under <code>3w</code>.
Once created, the project name and its creation date appear in the 
window title and the graph root node name is that entered at the prompt.
 <em>ModelMaker</em> will automatically compile the project and list any actions required in the <strong>message pane</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_open"><a class="anchor" href="#_open"></a>Open</h6>
<div id="fig-menu-open" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-menu-open.png" alt="fig menu open">
</div>
<div class="title">Figure 9. The Open project menu choice.</div>
</div>
<div class="paragraph">
<p>Opens any project currently in the <code>3w</code> directory (<a href="#fig-menu-open">Figure 9</a>). Projects are listed in alphabetical order.</p>
</div>
</div>
<div class="sect5">
<h6 id="_import"><a class="anchor" href="#_import"></a>Import</h6>
<div class="paragraph">
<p>Imports a tree-graph file from disk (*.utg). Imports are only 
possible if the tree-graph has a single root. You will be prompted for a
 unique name for the import.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tree-graphs with more than one root cannot be imported.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_save"><a class="anchor" href="#_save"></a>Save</h6>
<div class="paragraph">
<p>Saves the configuration graph and its associated layout file (<code>.layout.utg</code>) to disk.</p>
</div>
</div>
<div class="sect5">
<h6 id="_save_as"><a class="anchor" href="#_save_as"></a>Save as</h6>
<div class="paragraph">
<p>Saves the project under a new name in a new directory within <code>3w</code>.
 If the project was linked to a Java project, the new project will 
maintain this link and generate a new Java file with this name.</p>
</div>
</div>
<div class="sect5">
<h6 id="_exit"><a class="anchor" href="#_exit"></a>Exit</h6>
<div class="paragraph">
<p>Exits <em>ModelMaker</em> after a prompting to save any unsaved work. On exiting, a project specific preferences file is saved  automatically (<code>MM.xml</code>), recording the current appearance of <em>ModelMaker</em>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_edit"><a class="anchor" href="#_edit"></a>Edit</h5>
<div class="paragraph">
<p>The Edit menu provides the Undo/Redo options (<a href="#fig-menu-edit">Figure 10</a>).
 All graph editor operations are able to be undo or redone except 
property edits. The undo/redo system creates temporary history files 
during a session. These are deleted when the project is closed.</p>
</div>
<div id="fig-menu-edit" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-menu-edit.png" alt="fig menu edit">
</div>
<div class="title">Figure 10. The edit <br> menu choice.</div>
</div>
</div>
<div class="sect4">
<h5 id="_ide"><a class="anchor" href="#_ide"></a>IDE</h5>
<div class="sect5">
<h6 id="_import_snippets"><a class="anchor" href="#_import_snippets"></a>Import snippets</h6>
<div class="paragraph">
<p>Enabled when a project is linked to a Java project. This option imports method code from Java into any <code>snippet</code> properties in the specifications (<code>functionSnippet</code> of the <code>Function</code> and <code>InitFunction</code> nodes and the <code>importSnippet</code> property of the specification root node).</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
currently, importing code containing double quotes is not supported.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_clear_snippets"><a class="anchor" href="#_clear_snippets"></a>Clear snippets</h6>
<div class="paragraph">
<p>Clears the Java code in the configuration’s <code>functionSnippet`and `importSnippet</code> properties. Functions requiring return values will have default return statements inserted.</p>
</div>
</div>
<div class="sect5">
<h6 id="_link_to_ide"><a class="anchor" href="#_link_to_ide"></a>Link to IDE</h6>
<div class="paragraph">
<p>Allows connecting to or disconnecting from an external Java project 
via in an Integrated Development Environment. When connecting to a Java 
project, the java project must have imported <code>3w/tw&lt;os name&gt;.jar</code> as an external jar to its class path (<a href="#truesetting-up-the-eclipse-integrated-development-environment-ide-for-3worlds">[truesetting-up-the-eclipse-integrated-development-environment-ide-for-3worlds]</a>). Upon first connecting to a Java project, a Java class called <code>UserCodeRunner.java</code>
 is added to the default package. Use this as a main class to debug your
 model code. If the specifications are valid, additional Java classes 
are created. One of these has the same name as the 3Worlds project. Edit
 this file in an Integrated Development Environment (IDE) to begin 
developing your model. At the time of writing, only the <em>Eclipse</em> IDE is supported for this purpose (<a href="#truesetting-up-a-java-development-environment-for-the-user-code">[truesetting-up-a-java-development-environment-for-the-user-code]</a>).</p>
</div>
<div class="paragraph">
<p>If the creation times of Java source files and their associated class
 files become inconsistent, a message to this effect will appear in the <strong>message pane</strong>. In such cases, refresh or clean the Java project.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To compile models, the Java Development Kit (JDK)  must be installed on your computer (<a href="#trueprerequisites">[trueprerequisites]</a>).
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use 'Refresh` in the IDE to keep <em>ModelMaker</em> and the Java project synchronized.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_help"><a class="anchor" href="#_help"></a>Help</h5>
<div class="sect5">
<h6 id="_about_modelmaker"><a class="anchor" href="#_about_modelmaker"></a>About ModelMaker</h6>
<div class="paragraph">
<p>A dialog with a succinct description of the purpose of <em>ModelMaker</em>. If you’re using <em>ModelMaker</em> for the first time, it’s a good idea to at least read this overview.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_graph_display"><a class="anchor" href="#_graph_display"></a>3.2.2. Graph display</h4>
<div class="paragraph">
<p>Construction of the model specification graph takes place in the <strong>Graph display</strong> window by adding or removing nodes and edges (<em>cross-links</em>). Above the graph display is a tool bar to enable various display options (<a href="#fig-graph-display-window">Figure 11</a>).</p>
</div>
<div id="fig-graph-display-window" class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-graph-display-window.png" alt="fig graph display window">
</div>
<div class="title">Figure 11. The Graph display window and tool bar. The
 graph is both a Tree graph and a directed network graph. The tree graph
 is shown with green parent-child edges. The directed network graph is 
shown with red, named edges.</div>
</div>
<div class="paragraph">
<p>The graph is both a tree graph (with a single root) and a directed 
network graph. The tree structure is shown with green parent-child edges
 with a thickened end at the child node. The directed network graph is 
shown with red, named edges with a thickened end at the 'end node'.</p>
</div>
<div class="paragraph">
<p>Node colours are based on a schema that, for the most part,  colours 
all nodes within a sub-tree the same. The colours are not editable.</p>
</div>
<div class="sect4">
<h5 id="_tool_bar"><a class="anchor" href="#_tool_bar"></a>Tool bar</h5>
<div id="fig-tool-bar" class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tool-bar.png" alt="fig tool bar">
</div>
<div class="title">Figure 12. Tool bar options for managing the graph display.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Layout selection: The four radio buttons (<strong>L1, L2, L3, L4</strong>) select one of four layout algorithms:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>L1</strong> - ordered tree. The nodes are listed vertically in alphabetical order.</p>
</li>
<li>
<p><strong>L2</strong> - radial tree. The radius decreases as the path distance from the root node increases.</p>
</li>
<li>
<p><strong>L3</strong> - radial tree. The radius remains constant.</p>
</li>
<li>
<p><strong>L4</strong> - spring graph. A force directed layout. Parent-child edges (green) and treated in the same way as <em>cross-links</em> (red).</p>
</li>
</ol>
</div>
</li>
<li>
<p>Layout options</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>L</strong>: Applies the current layout options.</p>
</li>
<li>
<p><strong>X</strong>: Toggles the <em>cross-links</em>.</p>
</li>
<li>
<p><strong>&lt;</strong>: Toggles the parent-child edges.</p>
</li>
<li>
<p><strong>&gt;|</strong>: Moves any isolated nodes to the right-hand side of the window.</p>
</li>
<li>
<p><strong>Current layout root</strong>: The name of the node used for 
the display root of the graph. The default is the black 3worlds root 
node. This can be changed by right-clicking on any node while holding 
down the <code>Ctrl</code> key. The display root node is also indicated by a black circle. This option only applies to tree layouts.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Miscellaneous</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Path len.</strong>: Sets the path length when the <em>show local graph</em> display mode is activated (by moving the mouse over a node while holding down the <code>Shift</code> key).</p>
</li>
<li>
<p><strong>Jitter</strong>: Sets the amount of random displacement of a 
node when applying a layout. This is useful to separate text and/or 
lines drawn over each other.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Text options:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Node text</strong>: Display the node label and name or any combination of the two including no text.</p>
</li>
<li>
<p><strong>Edge text</strong>: Display the edge label and name or any combination of the two including no text.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Element size</strong>: Increases or decreases the size of all nodes, edges and text in the display.</p>
</li>
<li>
<p><strong>Animate</strong>: When checked, changes to the shape of the 
graph by either collapsing/expanding sub-trees or applying a layout 
function are animated. Switch this off for large graphs - the animation 
routine can quickly become over-loaded and the resulting animation 
jumpy.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_keyboard_and_mouse_functions"><a class="anchor" href="#_keyboard_and_mouse_functions"></a>Keyboard and mouse functions</h5>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Pan</strong>: Drag the mouse anywhere other than on a node to
 pan the graph drawing surface. This assumes the display size is larger 
than the window.</p>
</li>
<li>
<p><strong>Drag node</strong>: Left-click on any node to change its position. Nodes are shown in red when the mouse passes over them.</p>
</li>
<li>
<p><strong>Show local graph</strong>: Hold down the <code>Shift</code> key while moving the mouse over a node. The <em>path length</em> for this feature is set in the tool bar.</p>
</li>
<li>
<p><strong>Show node properties</strong>: Right-click on any node to display its properties in the <em>Selected properties</em> property editor.</p>
</li>
<li>
<p><strong>Zoom</strong>: Hold down the <code>Ctrl</code> key while moving the mouse wheel to zoom in and out of the display.</p>
</li>
<li>
<p><strong>Pop-up edit menu</strong>: Right-click on any node to see the edit options available for that node.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_pop_up_edit_options"><a class="anchor" href="#_pop_up_edit_options"></a>Pop-up edit options</h5>
<div class="paragraph">
<p>This menu is the principle way in which the specification graph is constructed (<a href="#fig-popup">Figure 13</a>). Note that the <code>predefined:*catoregories*</code> sub-tree cannot be edited except for any 'in-edges' that may be allowed from outside this sub-tree.</p>
</div>
<div id="fig-popup" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-popup.png" alt="fig popup">
</div>
<div class="title">Figure 13. The pop-up menu. <br> Available options depend <br> on the node selected.</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>New node</strong>: Displays a list of valid node labels that can be children of this node.</p>
</li>
<li>
<p><strong>New edge</strong>: Displays a list of valid edges (<em>cross-links</em>) from this node to another existing node.</p>
</li>
<li>
<p><strong>New child edge</strong>: Displays a list of (parentless) nodes that can be valid children of this node.</p>
</li>
<li>
<p><strong>Expand sub-tree</strong>: Displays a list of sub-trees that 
can be expanded from this node. After expanding, any properties of these
 nodes and edges will appear in the property editor.</p>
</li>
<li>
<p><strong>Collapse sub-tree</strong>: Displays a list of sub-trees that
 can be collapsed from this node. After collapsing, any properties of 
these nodes and edges will be removed from the property editor.</p>
</li>
<li>
<p><strong>Delete node</strong>: Deletes this node. Note that the <code>3Worlds</code> root node cannot be deleted.</p>
</li>
<li>
<p><strong>Delete edge</strong>: Displays a list of 'out-edges' from this node that can be deleted.</p>
</li>
<li>
<p><strong>Delete child edge</strong>: Displays a list of child nodes 
that can be orphaned. Note that the specifications are not valid until 
all child nodes have parents.</p>
</li>
<li>
<p><strong>Optional properties</strong>: Displays a dialog with any optional properties that can be added or removed from this node.</p>
</li>
<li>
<p><strong>Rename node</strong>: Changes the node name to some other unique name. Note that the name of the root node cannot be changed.</p>
</li>
<li>
<p><strong>Rename edge</strong>: Displays a list of 'out-edges' whose name can be changed to some other unique name.</p>
</li>
<li>
<p><strong>Import sub-tree</strong>: Displays a list of valid child node labels that can form the root of a sub-tree read from file.</p>
</li>
<li>
<p><strong>Export sub-tree</strong>: Displays a list of the current child nodes of this node that can be exported to file as a sub-tree.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_property_editors"><a class="anchor" href="#_property_editors"></a>3.2.3. Property editors</h4>
<div id="fig-properties-all" class="imageblock left text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-properties-all.png" alt="fig properties all">
</div>
<div class="title">Figure 14. Property editor showing <br> properties listed by name.</div>
</div>
<div id="fig-properties-selected" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-properties-selected.png" alt="fig properties selected">
</div>
<div class="title">Figure 15. Property editor showing only <br> properties of a selected node (here a <code>TimeLine</code>).</div>
</div>
<div class="paragraph">
<p>There are two property editors available on separate tabs: one (<em>Properties</em>) displays all <em>editable</em> properties of the currently displayed nodes and edges (<a href="#fig-properties-all">Figure 14</a>); and a second (<em>Selected properties</em>) shows <em>all</em> properties of a selected node (left-click on any node: <a href="#fig-properties-selected">Figure 15</a>).</p>
</div>
<div id="fig-properties-category" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-properties-category.png" alt="fig properties category">
</div>
<div class="title">Figure 16. Property editor showing <br> properties listed by category.</div>
</div>
<div class="paragraph">
<p>The <em>Properties</em> editor has two buttons; one to display properties by category (<a href="#fig-properties-category">Figure 16</a>; in this case this means by sub-tree) and the other to display properties by name (<a href="#fig-properties-all">Figure 14</a>). There is also a search field that can be used to show only those properties that match the search text.</p>
</div>
<div class="paragraph">
<p>Properties are only shown for nodes that are currently visible (expanded) in the graph.</p>
</div>
</div>
<div class="sect3">
<h4 id="_message_pane"><a class="anchor" href="#_message_pane"></a>3.2.4. Message pane</h4>
<div class="paragraph">
<p>The <strong>message pane</strong> displays information about what is 
required to make the model specifications valid. It grows and shrinks 
during construction depending on the state of the graph. Information is 
presented in three levels of detail: action, details and debug (<a href="#fig-msg-formats">Figure 17</a>). Generally, the 'action' level is all that is required.</p>
</div>
<div id="fig-msg-formats" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-msg-formats.png" alt="fig msg formats">
</div>
<div class="title">Figure 17. Message pane displaying three different message formats.</div>
</div>
<div class="paragraph">
<p>Messages are displayed in alphabetical order of the Action text no matter what the display level. At the bottom of the <strong>message pane</strong> are two buttons described at the end of this section.</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Action</strong>: This level indicates what action must be 
taken for the specifications to comply with the 3Worlds archetype. Its 
format is: a) the message category (usually <strong>[Node]</strong>, <strong>[Edge]</strong> or <strong>[Property]</strong>); b) the target (the label:name of a node or edge or a property name) and the action message (<a href="#fig-msg-formats">Figure 17</a>).</p>
</li>
<li>
<p><strong>Details</strong>: This level shows the action message and the
 specification constraint that is unsatisfied. The information provided 
varies with the message but in general includes (<a href="#fig-msg-formats">Figure 17</a>):</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>Message number. As noted, the message order remains consistant no matter the display option.</p>
</li>
<li>
<p>The action message: usually in the form of "Do this or that".</p>
</li>
<li>
<p>The specification constraint: usually in the form of "Expected this but found that".</p>
</li>
<li>
<p>The Java class of the query issuing the message.</p>
</li>
<li>
<p>The node in the 3Worlds archetype that defines the application of this query class.</p>
</li>
<li>
<p>The target element (node, edge, property or some other item class)</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Debug</strong>: This level shows all information available 
for this message including a detailed description of the target and 
archetype elements. It is rarely informative unless you are a 
contributor to the development of 3Worlds (<a href="#fig-msg-formats">Figure 17</a>).</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_verify_and_deploy"><a class="anchor" href="#_verify_and_deploy"></a>Verify and Deploy</h5>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Verify</strong>: Verifies that the specification graph 
conforms with the archetype and compiles the Java code. This process 
takes place in the background any time the graph is edited. Therefore, 
there is rarely any need to click the compile button.</p>
</li>
<li>
<p><strong>Deploy</strong>: This button is enabled (traffic light green) whenever the <strong>message pane</strong> is clear. When clicked, <em>ModelRunner</em> is launched to run the model with the specified experiment design.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="_configuration_options_reference"><a class="anchor" href="#_configuration_options_reference"></a>3.3. Configuration options: reference</h3>
<div class="paragraph">
<p>In this section,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>node and edge labels are indicated in <code><strong>bold</strong></code></p>
</li>
<li>
<p>text in triangular brackets (<code>&lt;&gt;</code>) mean a user-defined value is expected; the text usually specifies what kind of value is expected (e.g. <code>&lt;<em>name</em>&gt;</code> for a name, <code>&lt;<em>int</em>&gt;</code> for an integer number, etc.). If the text is required, it will be <span class="underline">underlined</span>, otherwise it is optional</p>
</li>
<li>
<p>a <em>multiplicity</em> in curly braces {} tells how many times the item may appear in a configuration:</p>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
{1}
</td>
<td class="hdlist2">
<p>exactly one item is required</p>
</td>
</tr>
<tr>
<td class="hdlist1">
{0..1}
</td>
<td class="hdlist2">
<p>the item is optional, i.e. one or zero is required</p>
</td>
</tr>
<tr>
<td class="hdlist1">
{1..*}
</td>
<td class="hdlist2">
<p>one to many items are required</p>
</td>
</tr>
<tr>
<td class="hdlist1">
{0..*}
</td>
<td class="hdlist2">
<p>any number of items is possible</p>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>levels in the tree hierarchy are indicated by slashes <code>/</code>.</p>
</li>
<li>
<p>a column <code>:</code> separates a node label from its name.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_the_3worlds_node"><a class="anchor" href="#_the_3worlds_node"></a>3.3.1. The <em>3Worlds</em> node</h4>
<div class="paragraph">
<p><code>/<strong>3worlds</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node is the root of any 3Worlds configuration file (<a href="#fig-root-example">Figure 18</a>). The name will appear in <code>ModelMaker</code>'s main window title, in the <strong>project directory name</strong> and in the <strong>configuration graph file</strong>. The name is requested and set when creating a new project (<code>Projects&gt;New</code> menu entry in <code>ModelMaker</code>).</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>3worlds</code></p>
</div>
<div id="fig-root-example" class="imageblock right text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-root.png" alt="example root" width="400">
</div>
<div class="title">Figure 18. The base tree of any 3Worlds configuration</div>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>authors</code>
</td>
<td class="hdlist2">
<p>The list of this project author names.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>contacts</code>
</td>
<td class="hdlist2">
<p>The list of the author contacts (e.g. e-mail addresses), in the same order as the author names (1-1 match).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precis</code>
</td>
<td class="hdlist2">
<p>A short description of the model contained in this project.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>publication</code>
</td>
<td class="hdlist2">
<p>A list of bibliographic references in relation with the project.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>built-by</code>
</td>
<td class="hdlist2">
<p>The user name under which this project was constructed and saved, 
together with the date of saving. This property is automatically set by 
ModelMaker.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>version</code>
</td>
<td class="hdlist2">
<p>A user-defined version identifier for this project.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>All these properties appear in the about box of <code>ModelRunner</code> and are saved in the ODD file describing the model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_system_node"><a class="anchor" href="#_the_system_node"></a>3.3.2. The <em>system</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>system</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains all the ecological concepts used 
to define a simulation model: what entities are modelled, what 
biological processes apply to them, at what time step they should run. 
The name is used to differentiate models as a simulation experiment may 
involve more than one model.</p>
</div>
<div class="paragraph">
<p>A 3Worlds ecosystem is constructed as a population of 'biological entities', called <em>system components</em>, which establish interactions called <em>system relations</em>. Components and relations have <em>variables</em> that may change value over time, according to various <em>ecological processes</em> attached to components. In other words, an ecosystem is represented as a <em>dynamic graph</em> which changes state and structure over time. To reflect this, <code><strong>system</strong></code> has two sub-trees called <code><strong>structure</strong></code> and <code><strong>dynamics</strong></code>.</p>
</div>
<div class="paragraph">
<p>For very simple models, where the modelled system is not further 
subdivided into components, the structure sub-tree is not required. In 
this case,the system node will be used as a unique 'component' 
describing the system (cf tutorial: <a href="#TODO">logistic</a>).</p>
</div>
<div class="paragraph">
<p><em>Cross-links</em> for <code>system</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>belongsTo → category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells to which categories the system node belongs. The 
categories must not belong to the same category set. If there are nested
 categories, membership is inherited.The categories targets of these 
links must be specific to the system, i.e. no <code>componentType</code>, <code>groupType</code> or <code>lifeCycleType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*arena*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*arena*</code> is required in all models (<a href="#truethe-predefined-sub-tree">[truethe-predefined-sub-tree]</a>).
 The arena is 'the place where things happen', i.e. it describes the 
part of the system where components interact. If no components are 
modelled, then it is the system.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*atomic*|*assemblage*</code> {1}</dt>
<dd>
<p>This link to either the predefined category <code>*atomic*</code> or <code>*assemblage*</code> is required in all models. Only if the system is very simple (no components, no groups, no life cycles) should <code>*atomic*</code>
 be selected. It means the system has no further subdivision. In any 
other case (i.e. as long as there is a structure sub-tree), the system 
should be an <code>*assemblage*</code>. Assemblages have three automatic variables: the group size (number of components) <code>count</code>, the number of new components added during last <a href="#truecausality">causal</a> step <code>nAdded</code>, and the number of components deleted during the causal step <code>nRemoved</code>.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*permanent*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*permanent*</code> is required in all models. It specifies that the system is going to stay forever (permanent) during a simulation.</p>
</dd>
<dt class="hdlist1"><code>loadFrom → dataSource:</code> {0..*}</dt>
<dd>
<p>These optional links refer to <a href="#trueinputs-datasource">data sources</a> from which to read initial values of system-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#trueimport-data-from-external-sources">[trueimport-data-from-external-sources]</a>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Optional child</em> for <code>system</code>:</p>
</div>
<div class="paragraph">
<p><code>/3worlds/system/<strong>initFunction</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>This node declares a <a href="#truefunction">function</a> of type <code>SetInitialState</code> to set or transform the initial values of system-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#truedata-input-methods">[truedata-input-methods]</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_systemstructure_node"><a class="anchor" href="#_the_systemstructure_node"></a>3.3.3. The <em>system/structure</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/system/<strong>structure</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains the description of the system component and relation types. It is based on the concept of <em>category</em>.
 A category is a set of components with an identical description, e.g. 
the same set of state variables or the same growth function.</p>
</div>
<div class="sect4">
<h5 id="_the_category_and_related_concepts_specification_of_groups_of_entities"><a class="anchor" href="#_the_category_and_related_concepts_specification_of_groups_of_entities"></a>The <em>category</em> and related concepts: specification of groups of entities</h5>
<div class="paragraph">
<p>3Worlds uses these concepts to specify and generate the ecological entities manipulated during a simulations.</p>
</div>
<div class="sect5">
<h6 id="_category"><a class="anchor" href="#_category"></a>Category</h6>
<div class="paragraph">
<p><code>…​/categorySet/<strong>category</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>A <code><strong>category</strong></code> is simply a name attached to a set of objects sharing common properties (<a href="#truecategories">[truecategories]</a>). These common properties are descriptors (<a href="#truethe-complex-system-as-a-dynamic-graph">[truethe-complex-system-as-a-dynamic-graph]</a>), and dynamic behaviours (or <em>processes</em>). Categories, grouped into <code><strong>categorySet</strong></code>s, constitute a user-defined <em>classification</em> of <em>system component types</em> relevant for a particular model.</p>
</div>
<div class="paragraph">
<p>Descriptors consist in <em>drivers</em>, <em>decorators</em>, <em>constants</em> and <em>automatic variables</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>drivers</em></dt>
<dd>
<p>are <em>independent</em> variables (numbers, text, logical values) that characterize the state of a system component at an instant in time (<em>e.g.</em>
 biomass, age, sex, social status…​). They will vary during a 
simulation. 'Independent' means that these variables cannot be computed 
from each other within a simulation step, they also depend on their 
previous <a href="#truecausality"><em>causal</em></a> step values. For example, if some category is described by drivers <em>age</em> and <em>biomass</em>, neither of them can be computed from the other: <em>age</em> is computed from its previous value by adding the time step duration; <em>biomass</em>
 is computed in some other way probably involving its previous value. 
The values of drivers are carried over from a simulation step to the 
next, i.e. they <em>drive</em> the dynamics of the system.</p>
</dd>
<dt class="hdlist1"><em>decorators</em></dt>
<dd>
<p>are <em>dependent</em> variables that are computed from drivers and other decorators within a simulation step. For example, <em>leaf area</em> could be computed as some constant times <em>biomass</em>: its value is completely determined by the value of <em>biomass</em>.
 As such, decorators are not independent from the drivers and are used 
only for convenience in computations or output display. They are not 
carried over from a simulation step to the next, they are always 
automatically reset to zero at the end of each <a href="#truecausality"><em>time</em></a> step.</p>
</dd>
<dt class="hdlist1"><em>constants</em></dt>
<dd>
<p>are values (numbers, text, logical values) that do not change during a simulation. For example, <em>sex</em> or <em>number of legs</em> are not going to change during the lifetime of an animal. They are set at birth and never changed after.</p>
</dd>
<dt class="hdlist1"><em>automatic variables</em></dt>
<dd>
<p>are values internally managed by 3Worlds and available <em>read-only</em> for computation. For components representing individuals, these are <em>age</em> and <em>birth date</em>. For components representing populations, these are <em>number of individuals</em>, <em>number of newly created individuals</em>, <em>number of deleted individuals</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The exact data structures for descriptors are specified under the <code>dataDefinition</code> node (<a href="#truethe-datadefinition-node">[truethe-datadefinition-node]</a>) and linked to the category through the following:</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>category</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>drivers → record:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dt class="hdlist1"><code>decorators → record:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dt class="hdlist1"><code>constants → record:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>These links tell which data structure in the <code>dataDefinition</code> node (<a href="#truethe-datadefinition-node">[truethe-datadefinition-node]</a>) is used to store  <em>drivers</em>, <em>decorators</em>  and <em>constants</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Automatic variables</em> do not need to be specified - because they are automatic.</p>
</div>
<div class="paragraph">
<p>A category may be defined with no drivers, decorators or constants.</p>
</div>
<div class="paragraph">
<p>There are <em>predefined categories</em> in 3Worlds under the node <code>/3worlds/<strong>predefined</strong></code> (<a href="#truethe-predefined-sub-tree">[truethe-predefined-sub-tree]</a>), used to specify particular components of the system. They will be explained in time.</p>
</div>
</div>
<div class="sect5">
<h6 id="_categoryset"><a class="anchor" href="#_categoryset"></a>CategorySet</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>categorySet</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>Some categories must be exclusive of each other: for example, an 
ecological entity is either a plant or an animal, but can’t be both. For
 this reason, <em>exclusive</em> categories are grouped into <code><strong>categorySets</strong></code>. A <code>categorySet</code> is <em>a set of <strong>mutually exclusive</strong> categories</em> (mathematically, a <a href="https://en.wikipedia.org/wiki/Partition_of_a_set"><em>partition</em></a>). Categories can be nested, by simply defining a <code>categorySet</code> as a child of a <code>category</code>:</p>
</div>
<div class="paragraph">
<p><code>…​/category/<strong>categorySet</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
</div>
<div class="sect5">
<h6 id="_relationtype"><a class="anchor" href="#_relationtype"></a>RelationType</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>relationType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <code><strong>relationType</strong></code> is just a name 
representing a meaningful link between two kinds of categories. It is 
specified by giving it a name and cross-linking it to the relevant 
categories with <code>fromCategory</code> and <code>toCategory</code> cross-links. Note that a <code>relationType</code> can link more than one 'from' categories to more than one 'to' categories if required. <code>RelationType</code>s
 are used to implement specific processes acting on ecological entities 
(for example, a predation process). Notice that relations are <em>directed</em> (i.e., they have a <em>start</em> and an <em>end</em> with potentially different roles).</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>relationType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fromCategory → category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells which categories are at the start of the relation.</p>
</dd>
<dt class="hdlist1"><code>toCategory → category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells which categories are at the end of the relation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>relationType</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>lifespan</code>
</td>
<td class="hdlist2">
<p>This property specifies if this type of relation will stay attached to its <code>systemComponents</code> during all their life, or may get created and deleted during their lifespan.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>permanent</code>
</td>
<td class="hdlist2">
<p>relation stays as long as both its ends stay (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ephemeral</code>
</td>
<td class="hdlist2">
<p>relations are created during a simulation by the means of a  <code>relateTo</code> function, and kept or deleted by means of a <code>maintainRelation</code> decision function. If no <code>maintainRelation</code> function is provided, then the relation only lasts for one simulation step.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_example_a_category_tree"><a class="anchor" href="#_example_a_category_tree"></a>Example: a category tree</h6>
<div class="paragraph">
<p>On this diagram (generated with <code>ModelMaker</code>), hierarchical links are in green and cross-links are in red.</p>
</div>
<div id="fig-category-example" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-category.png" alt="example category">
</div>
<div class="title">Figure 19. Example of a configuration with category sets, categories and relations</div>
</div>
<div class="paragraph">
<p>In this example, a <em>plant</em> can be a <em>C3 tree</em> but cannot be simultaneously a <em>grass</em> and a <em>forb</em>. Similarly, an <em>animal</em> cannot be both <em>herbivore</em> and <em>carnivore</em>. The <em>predation</em> relation links an <em>animal</em> of any kind (the prey) to a <em>carnivore</em> (its predator). A member of category <em>plant</em> will have two driver variables, <em>height</em> and <em>leaf area</em>. A member of category <em>tree</em> will have three driver variables, <em>height</em>, <em>leaf area</em> and <em>DBH</em>, as it inherits all the properties of the <em>plant</em> category in which it is nested.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_specification_of_ecological_entities_system_components"><a class="anchor" href="#_the_specification_of_ecological_entities_system_components"></a>The specification of ecological entities: <em>system components</em></h5>
<div class="sect5">
<h6 id="_system_component"><a class="anchor" href="#_system_component"></a>System component</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>componentType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>3Worlds simulates a <em>system</em> made of <em>system components</em>. These are the things which are instantiated at run time, hold <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a>, and are dynamically changed over the time course of a simulation. When setting up a simulation, one must attach <em>categories</em> to <em>system components</em>.
 The rules prevailing to build up category hierarchies mean that a 
system can belong to a number of non-exclusive categories, as long as 
the exclusion and nesting rules are respected. For example (<a href="#fig-category-example">Figure 19</a>), we could define a system as belonging to the <em>plant</em> and <em>tree</em> categories, but not to the <em>animal</em> and <em>tree</em> categories.</p>
</div>
<div class="paragraph">
<p><em>Cross-links</em> for <code>componentType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>belongsTo → category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells to which categories a system component type belongs. 
The categories must not belong to the same category set. If there are 
nested categories, membership is inherited (e.g. in the previous 
example, belonging to the <em>C3</em> category automatically implies the system component is also a <em>plant</em>). The categories targets of these links must be specific to component types, i.e. no <code>groupType</code> or <code>lifeCycleType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*component*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*component*</code> is required in all models.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*atomic*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*atomic*</code> is required in all models. It means that a component has no further subdivisions.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*ephemeral*|*permanent*</code> {1}</dt>
<dd>
<p>This link to either of the predefined category <code>*ephemeral*</code> or <code>*permanent*</code> is required in all models. It specifies if components of this <code>componentType</code>
 are going to stay forever (permanent) or can be created and deleted 
(ephemeral) during a simulation. Ephemeral components have two automatic
 variables, <code>birthDate</code> and <code>age</code>.</p>
</dd>
<dt class="hdlist1"><code>loadFrom → dataSource:</code> {0..*}</dt>
<dd>
<p>These optional links refer to <a href="#trueinputs-datasource">data sources</a> from which to read initial values of component-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#trueimport-data-from-external-sources">[trueimport-data-from-external-sources]</a>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Optional child</em> for <code>componentType</code>:</p>
</div>
<div class="paragraph">
<p><code>/3worlds/…​/componentType/<strong>initFunction</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>This node declares a <a href="#truefunction">function</a> of type <code>SetInitialState</code> to set or transform the initial values of component-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#truedata-input-methods">[truedata-input-methods]</a>).</p>
</div>
</div>
<div class="sect5">
<h6 id="_component_group"><a class="anchor" href="#_component_group"></a>Component group</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>groupType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Sometimes it makes sense to group components of a given <code>componentType</code> into <em>groups</em>;
 the best example of this in ecology is the species. Animals of 
different species may be described by the same descriptors, but 
nevertheless they will only reproduce within their species. Typically, 
animals of a species would share some constants, like plumage 
coloration, average body size, main diet etc. The <code><strong>groupType</strong></code> node is meant to fullfil this use case.</p>
</div>
<div class="paragraph">
<p>To make a <code>componentType</code> belong to a <code>groupType</code>, you just need to declare it as a child of the <code>groupType</code>:</p>
</div>
<div class="paragraph">
<p><code>…​/groupType/<strong>componentType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><em>Cross-links</em> for <code>groupType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>belongsTo → category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells to which categories a system component type belongs. 
The categories must not belong to the same category set. If there are 
nested categories, membership is inherited. The categories targets of 
these links must be specific to groups, i.e. no <code>componentType</code> or <code>lifeCycleType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*group*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*group*</code> is required in all models.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*assemblage*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*assemblage*</code> is 
required in all models. It means that a group is a population of 
components. Assemblages have three automatic variables: the group size 
(number of components) <code>count</code>, the number of new components added during last <a href="#truecausality">causal</a> step <code>nAdded</code>, and the number of components deleted during the causal step <code>nRemoved</code>.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*permanent*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*permanent*</code> is 
required in all models. It means that groups will stay forever in the 
system, even if all components of this groups are gone.</p>
</dd>
<dt class="hdlist1"><code>loadFrom → dataSource:</code> {0..*}</dt>
<dd>
<p>These optional links refer to <a href="#trueinputs-datasource">data sources</a> from which to read initial values of group-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#trueimport-data-from-external-sources">[trueimport-data-from-external-sources]</a>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Optional child</em> for <code>groupType</code>:</p>
</div>
<div class="paragraph">
<p><code>/3worlds/…​/groupType/<strong>initFunction</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>This node declares a <a href="#truefunction">function</a> of type <code>SetInitialState</code> to set or transform the initial values of group-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#truedata-input-methods">[truedata-input-methods]</a>).</p>
</div>
</div>
<div class="sect5">
<h6 id="_life_cycle"><a class="anchor" href="#_life_cycle"></a>Life cycle</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>lifeCycleType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>As <em>system component</em>s are designed to represent — among other
 things — individual organisms, they are able to create other system 
components at runtime, or to transform themselves into a system 
component of another category assemblage. These abilities are captured 
in a <code><strong>lifeCycle</strong></code>, which describes the possible creations and transitions of system components of a given category set into another.</p>
</div>
<div class="paragraph">
<p>Since <code>components</code> belong to <code>categories</code>, 
different types of system components represented by different state 
variables, subject to different ecological processes, can coexist in a 
simulation. It may occur in a particular model that one wishes to 
represent a transition between, e.g. development stages: think for 
example of a caterpillar turning into a butterfly. There are chances 
that you don’t want to describe the caterpillar with the same variables 
and behaviours as the adult butterfly. The operation of transforming a 
system component from a selection of categories to another is called <em>recruitment</em>.
 Computationally, it means that the simulator must keep track of the 
system component’s identity and age in the first stage and carry these 
properties on to the new system component of the second stage, and call 
an appropriate function to transform state variables of the first stage 
into the new one.</p>
</div>
<div class="paragraph">
<p><em>Reproduction</em> is the second process by which system 
components of a given group of categories may produce other system 
components belonging to possibly different categories.</p>
</div>
<div class="paragraph">
<p>A specification of a life cycle requires:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a <code>categorySet</code> in which the categories represent the various stages of the life cycle;</p>
</li>
<li>
<p>at least one <code>groupType</code> definition per <code>category</code> of the above <code>categorySet</code>;</p>
</li>
<li>
<p><code>recruit</code> and <code>produce</code> nodes linking categories within the above <code>categorySet</code> to describe possible recruitment and reproduction transitions;</p>
</li>
<li>
<p>optionnally, <code>categories</code> can be linked to a <code>lifeCycleType</code> if one wants to attach <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> to the life cycle.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To define a <code>groupType</code> within the context of a <code>lifeCycleType</code>, simply make it a child node of the lifeCycleType:</p>
</div>
<div class="paragraph">
<p><code>…​/lifeCycleType/<strong>groupType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>lifeCycleType</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>appliesTo → categorySet:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This links indicates which categories define the stages of the life cycle. <code>recruit</code> or <code>produce</code> nodes can only link categories of this set.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>These links enable to attach descriptors to a <code>lifeCycle</code>, if needed by some ecological processes. The categories targets of these links must be specific to life cycles, i.e. no <code>componentType</code> or <code>groupType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*life cycle*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*life cycle*</code> is required in all models.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*assemblage*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*assemblage*</code> is 
required in all models. It means that a life cycle is a population of 
components. Assemblages have three automatic variables: the group size 
(number of components) <code>count</code>, the number of new components added during last <a href="#truecausality">causal</a> step <code>nAdded</code>, and the number of components deleted during the causal step <code>nRemoved</code>.</p>
</dd>
<dt class="hdlist1"><code>belongsTo → category:*permanent*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*permanent*</code> is required in all models. It means that life cycles will stay forever in the system.</p>
</dd>
<dt class="hdlist1"><code>loadFrom → dataSource:</code> {0..*}</dt>
<dd>
<p>These optional links refer to <a href="#trueinputs-datasource">data sources</a> from which to read initial values of life cycle-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#trueimport-data-from-external-sources">[trueimport-data-from-external-sources]</a>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Optional child</em> for <code>lifeCycleType</code>:</p>
</div>
<div class="paragraph">
<p><code>/3worlds/structure/lifeCycleType/<strong>initFunction</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>This node declares a <a href="#truefunction">function</a> of type <code>SetInitialState</code> to set or transform the initial values of life cycle-level <a href="#truethe-complex-system-as-a-dynamic-graph">descriptors</a> (<a href="#truedata-input-methods">[truedata-input-methods]</a>).</p>
</div>
</div>
<div class="sect5">
<h6 id="_recruitment"><a class="anchor" href="#_recruitment"></a>Recruitment</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/lifeCycle/<strong>recruit</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node specifies that two categories of the life cycle <code>categorySet</code> are linked by a <em>recruitment</em> process.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>recruit</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fromCategory → category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is getting changed by the recruitment.</p>
</dd>
<dt class="hdlist1"><code>toCategory → category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is the result of the recruitment.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
multiple targets are possible from the same category, i.e. a component 
of a category may recruit to different categories. E.g., a bee larva can
 recruit to a worker or a queen.
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>effectedBy → process:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which ecological process is used to compute the recruitment. This process must implement exactly one  <a href="#truefunction"><code>ChangeCategoryDecision</code></a> function.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_reproduction"><a class="anchor" href="#_reproduction"></a>Reproduction</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/lifeCycle/<strong>produce</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node specifies that two categories of the life cycle <code>categorySet</code> are linked by a <em>reproduction</em> process.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>produce</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fromCategory → category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is producing new system components.</p>
</dd>
<dt class="hdlist1"><code>toCategory → category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is the result of the reproduction.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
multiple targets are possible from the same category, i.e. a component 
of a category may produce components of different categories. E.g., a 
tree can produce seedlings through sexual reproduction and root suckers 
through vegetative reproduction.
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>effectedBy → process:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which ecological process is used to compute the 
production of new system components. This process must implement exactly
 one  <a href="#truefunction"><code>CreateOtherDecision</code></a> function.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_example_of_a_life_cycle_specification"><a class="anchor" href="#_example_of_a_life_cycle_specification"></a>Example of a life cycle specification</h6>
<div class="paragraph">
<p>This life cycle:</p>
</div>
<div id="fig-life-cycle-example" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-life-cycle.svg" alt="example life cycle" width="400">
</div>
<div class="title">Figure 20. Example of a life cycle</div>
</div>
<div class="paragraph">
<p>is specified with this graph:</p>
</div>
<div id="fig-life-cycle-config-example" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-life-cycle.png" alt="example life cycle" width="800">
</div>
<div class="title">Figure 21. Example of a life cycle configuration</div>
</div>
<div class="paragraph">
<p>The life cycle has two categories, <em>seedling</em> and <em>adult</em>, and three transitions: a <em>recruit</em> transition called <em>recruitment</em>, effected by the function <em>Recruit</em>, and two <em>produce</em> transitions, effected by the functions <em>Seed</em> and <em>Sprout</em>.</p>
</div>
<div id="system-howto" class="sidebarblock">
<div class="content">
<div class="title">How is the simulated system implemented?</div>
<div class="paragraph">
<p>Internally, system <em>component</em>s (= ecological entities) are instances of the same class, <code>SystemComponent</code>. They are stored in a hierarchy of nested <em>container</em>s
 that represent logical groupings of components based on categories: all
 components of a container belong to the same categories, in order to 
facilitate their processing by the user-defined function (remember that a
 <code>Process</code> also applies to some categories).</p>
</div>
<div class="paragraph">
<p>The nesting of containers is based on the <code>System</code> &gt; <code>LifeCycle</code> &gt; <code>Group</code> &gt; <code>Component</code> <code>-Type</code>
 hierarchy decided by the user. To each container is associated a single
 particular component instance that represents this container…​ as one 
more <em>component</em> of the system. It is called the container’s <em>avatar</em>.
 Since containers are, by construct, populations of components, they 
have natural descriptors such as the number of components they contain, 
and the number of additions and deletions of components during the last 
simulator iteration. These are stored in the avatar as <em>automatic variables</em> (<a href="#truecategory">[truecategory]</a>), as specified by the predefined <code>*assemblage*</code> category (<a href="#truethe-predefined-sub-tree">[truethe-predefined-sub-tree]</a>) which must be associated to all containers.</p>
</div>
<div class="paragraph">
<p>At the top of the container hierarchy is the <em>arena</em>, which contains everything else and matches the <code>System</code> node. The arena is always present and unique. In a full complexity 3Worlds system, the <em>arena</em> container has <em>life cycle</em> sub-containers, each of which can have <em>group</em> sub-containers wich ultimately contain the <em>components</em>.
 Of course this can be simplified: if there are no life cycles or groups
 defined in a model, these containers will not exist in the simulator 
and the container hierarchy will be simplified. Possibly to the simplest
 simulated system in 3Worlds, made of only the arena.</p>
</div>
<div class="paragraph">
<p>A <code>LifeCycleType</code>, <code>GroupType</code>, or <code>ComponentType</code> does not represent just one life cycle / group / component, but a <em>class</em>
 of those defined by their categories. As all classes, there can be many
 instances of these at runtime. When initialising a simulation with data
 (<a href="#truethe-setup-of-an-initial-state-for-a-simulation">[truethe-setup-of-an-initial-state-for-a-simulation]</a>),
 it is possible, and important, to define names that will be used to 
uniquely identify e.g., various groups as instances of the same <code>GroupType</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_representation_of_space"><a class="anchor" href="#_the_representation_of_space"></a>The representation of space</h5>
<div class="paragraph">
<p>Sometimes modellers want an explicit representation of space for their model. 3Worlds provides a <a href="#true3worlds-library-of-spaces">library</a>
 of different spaces for this need.
Technically, space could just be treated as a component related to other
 components through particular relations. But since many optimal 
algorithms have been coded to handle particular aspects of space in 
relation to other entities, we use space as a kind of container for 
system components optimized for various operations such as searches for 
partners for establishing relations (see <a href="#trueprocess">process</a>).</p>
</div>
<div class="sect5">
<h6 id="_space_and_spatial_indexing"><a class="anchor" href="#_space_and_spatial_indexing"></a>Space and spatial indexing</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>space</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This defines a space, i.e. a container where system components can be located by their <em>spatial coordinates</em>
 and where distances can be computed. More than one space can coexist in
 3Worlds, applying to possibly different types of components and 
processes. Spaces can be of 1 to 3 dimensions (this is set by choosing a
 space type).</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>space</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>The type of spatial representation</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>continuousFlatSurface</code>
</td>
<td class="hdlist2">
<p>a flat plan with continuous coordinates (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>squareGrid</code>
</td>
<td class="hdlist2">
<p>a flat square 2D grid for e.g. cellular automata</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>topographicSurface</code>
</td>
<td class="hdlist2">
<p>a topographic plan with elevations <strong>(not yet implemented)</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>linearNetwork</code>
</td>
<td class="hdlist2">
<p>a graph of connected segments for e.g., hydrologic networks  <strong>(not yet implemented)</strong></p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>borderType</code>
</td>
<td class="hdlist2">
<p>The space border behaviour</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>wrap</code>
</td>
<td class="hdlist2">
<p>a soft teletransporting border which sends objects crossing it to the other side of the space (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>reflection</code>
</td>
<td class="hdlist2">
<p>a hard border on which objects bounce back if they try to escape</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sticky</code>
</td>
<td class="hdlist2">
<p>a hard border on which objects stick if they try to escape</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>oblivion</code>
</td>
<td class="hdlist2">
<p>a soft border into oblivion – objects that cross it disappear into nothingness</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>infinite</code>
</td>
<td class="hdlist2">
<p>no border – space extends following object movements</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>edgeEffects</code>
</td>
<td class="hdlist2">
<p>The most common edge effect corrections</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>periodic</code>
</td>
<td class="hdlist2">
<p>wrap-around in all dimensions, i.e. leaving objects enter through the other end (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>reflective</code>
</td>
<td class="hdlist2">
<p>all borders are reflective, i.e. objects bounce on borders as on rubber walls</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>island</code>
</td>
<td class="hdlist2">
<p>a space with oblivious borders in all directions, i.e. leaving objects are lost forever</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>unbounded</code>
</td>
<td class="hdlist2">
<p>an infinite space adapting to location of items</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bounded</code>
</td>
<td class="hdlist2">
<p>a space with sticky borders in all directions, i.e. objects that bump into the border stay there</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>tubular</code>
</td>
<td class="hdlist2">
<p>wrap around borders in the first dimension, sticky borders in all other dimensions</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>custom</code>
</td>
<td class="hdlist2">
<p>user-specified border properties – provide a borderType property</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>Spatial resolution (in space units). Two locations are considered identical if their distance is below this value.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>units</code>
</td>
<td class="hdlist2">
<p>The measurement unit for distances and coordinates in this space</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>guardAreaWidth</code>
</td>
<td class="hdlist2">
<p>The width of a guard area around the space used to define an observation window</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>observationWindow</code>
</td>
<td class="hdlist2">
<p>A rectangle defining which part of the space is visible</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>space</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>coordinate → space:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells which descriptors are used as coordinates to locate 
system components in this space. This link has a required property <code>rank</code> which tells to which dimension of space a coordinate refers to. For example, you may set to 1 the rank of the <em>x</em> field and to 2 the rank of the <em>y</em> field if you want your 2D space coordinates to be <em>x</em> and <em>y</em>, in this order.</p>
</dd>
<dt class="hdlist1"><code>useRNG → rng:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>Points to the <a href="#truerandom-number-channels">random number generator channel</a> to use with this space (e.g., to generate random locations). If unset, the default random number channel is used.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_3worlds_library_of_spaces"><a class="anchor" href="#_3worlds_library_of_spaces"></a>3Worlds library of spaces</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>FlatSurface</code>: This is a 2 dimensional, continuous space 
with rectangular limits. Internally, it is coupled to a Quadtree (ref) 
to optimise the search of nearby points when establishing relations (<code>relateToDecision</code> function).</p>
<div class="paragraph">
<p><em>Additional properties for space type</em> <code>FlatSurface</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>x-limits</code>
</td>
<td class="hdlist2">
<p>An <code>Interval</code> representing the minimum and maximum values of the x (first) dimension.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>y-limits</code>
</td>
<td class="hdlist2">
<p>An <code>Interval</code> representing the minimum and maximum values of the y (second) dimension.</p>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><code>SquareGrid</code>: This is a 2 dimensional, discrete space with
 rectangular limits and square cells. The locations are only known at 
the cell level, which helps optimize searches for nearby locations.</p>
<div class="paragraph">
<p><em>Additional properties for space type</em> <code>SquareGrid</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>cellSize</code>
</td>
<td class="hdlist2">
<p>The length of the side of the (square) cells in space units</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>x-nCells</code>
</td>
<td class="hdlist2">
<p>The number of cells in the x (first) dimension.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>y-nCells</code>
</td>
<td class="hdlist2">
<p>The number of cells in the y (second) dimension.</p>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_shapes_and_topology"><a class="anchor" href="#_shapes_and_topology"></a>Shapes and topology</h6>
<div class="paragraph">
<p><strong>This part is still under construction.</strong></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_setup_of_an_initial_state_for_a_simulation"><a class="anchor" href="#_the_setup_of_an_initial_state_for_a_simulation"></a>The setup of an initial state for a simulation</h5>
<div class="paragraph">
<p>To run a simulation, an initial population of system component, group, life cycle, and system <em>instances</em> must be constructed from their respective <em>types</em> (e.g. <code>groupType</code>, <code>componentType</code>, etc.). They constitute the <em>initial state</em>
 of a simulation. The initial state is kept in memory by the simulator, 
and is re-loaded at every simulator reset prior to a new simulation run.
 To set descriptor values in initial instances, two methods are 
possible: through the use of a specific <a href="#truefunction"><em>function</em></a> (<code>setInitialState</code>), or through external data files listed as <a href="#trueinputs-datasource"><em>data sources</em></a>.</p>
</div>
<div class="sect5">
<h6 id="_component"><a class="anchor" href="#_component"></a>Component</h6>
<div class="paragraph">
<p><code>/3worlds/…​/componentType/<strong>component</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Use this node to instantiate components of a given <code>componentType</code>.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>component</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>nInstances</code>
</td>
<td class="hdlist2">
<p>Number of instances to create. If not set, the default behaviour is to create only one instance of this component. Otherwise, <code>nInstances</code> components are created, all with identical descriptors - unless a <code>setInitialState</code> function is used that can use random numbers to differentiate instances.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>component</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>instanceOf → group:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>This link tells to which <code>group</code> these component instances belong. It is required if <code>groupTypes</code> have been defined in the model, optional otherwise. This property is ignored if a <code>loadFrom</code> link (see below) is present.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_group"><a class="anchor" href="#_group"></a>Group</h6>
<div class="paragraph">
<p><code>/3worlds/…​/groupType/<strong>group</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Use this node to instantiate a group of components. Use groups to set
 properties that are shared by a set of component instances, e.g. a 
species name or group-level constants.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>group</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>groupOf → componentType:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>If no <code>component</code> node is defined for this group, this link is required to specify which <code>componentType</code>
 should be used for instantiation of components of this group. In any 
other case it is not required. You can view this as a replacement for 
the <code>instanceOf</code> link above: either must be present for a group, but not both.</p>
</dd>
<dt class="hdlist1"><code>cycle → lifeCycle:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>This link tells in which <code>lifeCycle</code> instance this group is involved. The <code>groupType</code> of this <code>group</code> must be compatible with the <code>lifeCycleType</code> category requirements.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_life_cycle_2"><a class="anchor" href="#_life_cycle_2"></a>Life cycle</h6>
<div class="paragraph">
<p><code>/3worlds/…​/lifeCycleType/<strong>lifeCycle</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p>Use this node to instantiate a life cycle applying to a set of groups.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_systemdynamics_node"><a class="anchor" href="#_the_systemdynamics_node"></a>3.3.4. The <em>system/dynamics</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/system/<strong>dynamics</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains the description of the processes 
that will change the state of the system and create its dynamics. It is 
based on the concepts of <em>time model</em>, <em>ecological process</em>, and <em>life cycle</em>. Internally, the <code><strong>dynamics</strong></code> node is the <em>simulator</em>, i.e. the object which, when kicked to do so, will make all the computations necessary to run a simulation.</p>
</div>
<div class="sect4">
<h5 id="_the_representation_of_time"><a class="anchor" href="#_the_representation_of_time"></a>The representation of time</h5>
<div class="paragraph">
<p>Simulation is about mimicking the dynamics of a real system. Here, 
dynamics is specified by attaching particular behaviours (called <a href="#trueprocess">processes</a>) to either  <a href="#truecategory">categories</a> or <a href="#truerelationtype">relation types</a>.
 Processes may act at a different rhythm or rate in nature, so we need 
to have a great flexibility in the way time is represented.</p>
</div>
<div class="sect5">
<h6 id="_time_line"><a class="anchor" href="#_time_line"></a>Time line</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/<strong>timeLine</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>Every simulator has a reference <em>time line</em>. Since different 
ecological processes may run according to different time models, they 
must refer to a common time frame for interaction to be possible among 
them. A <code><strong>timeLine</strong></code> defines what kind of time
 scale and time units can be used in a simulation. In 3Worlds, time is 
always discrete in the end, so that the selected values of time scale 
and time unit define the time <em>grain</em> of the simulation, i.e. the duration below which events are considered simultaneous. Internally, the <code>ModelRunner</code> uses integers to represent time, with 1 = one time grain.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>timeLine</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>scale</code>
</td>
<td class="hdlist2">
<p>This property specifies the type of time scale to use. The usual time
 units pose many problems, because years, months, weeks and days are not
 integer multiples of each other. The option is either to use a real 
calendar time scale – but this is not needed in most simulation studies –
 or to use approximations which enable year, months, weeks and days to 
be integer multiples of each other (e.g. an easy approximation is to 
assume 30-day months, but this means years must be only 360-day long). 
This property proposes a set of such simplified, compatible sets of 
units, denoted as time scales.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>ARBITRARY</code>
</td>
<td class="hdlist2">
<p>arbitrary time units with no predefined name (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>GREGORIAN</code>
</td>
<td class="hdlist2">
<p>real calendar time</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_365D</code>
</td>
<td class="hdlist2">
<p>365-days years, no weeks, no months</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_13M</code>
</td>
<td class="hdlist2">
<p>28-days months, 13-months/52-weeks years</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>WMY</code>
</td>
<td class="hdlist2">
<p>28-days months, 12-months/48-weeks years</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH_30D</code>
</td>
<td class="hdlist2">
<p>30-days months, weeks replaced by 15-days fortnights</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_366D</code>
</td>
<td class="hdlist2">
<p>366-days year, months replaced by 61-days bi-months</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>LONG_TIMES</code>
</td>
<td class="hdlist2">
<p>long time units only (month or longer), calendar-compatible</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SHORT_TIMES</code>
</td>
<td class="hdlist2">
<p>short time units only (week or shorter), calendar-compatible</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONO_UNIT</code>
</td>
<td class="hdlist2">
<p>single time unit, calendar-compatible</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>shortestTimeUnit</code>
</td>
<td class="hdlist2">
<p>The shortest time unit used in this model. Note that the time scale 
constraints the time units compatible with each other for this property.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>UNSPECIFIED</code>
</td>
<td class="hdlist2">
<p>an arbitrary time unit (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MICROSECOND</code>
</td>
<td class="hdlist2">
<p>microsecond</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MILLISECOND</code>
</td>
<td class="hdlist2">
<p>millisecond = 1000 microseconds</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SECOND</code>
</td>
<td class="hdlist2">
<p>second = 1000 milliseconds</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MINUTE</code>
</td>
<td class="hdlist2">
<p>minute = 60 seconds</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HOUR</code>
</td>
<td class="hdlist2">
<p>hour = 60 minutes</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>DAY</code>
</td>
<td class="hdlist2">
<p>day = 24 hours</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>WEEK</code>
</td>
<td class="hdlist2">
<p>week = 7 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>FORTNIGHT_15</code>
</td>
<td class="hdlist2">
<p>French-style fortnight = 15 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH_28</code>
</td>
<td class="hdlist2">
<p>month = 4 weeks of 7 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH_30</code>
</td>
<td class="hdlist2">
<p>month = 30 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH</code>
</td>
<td class="hdlist2">
<p>calendar month (= 1/12 of a calendar year), <em>i.e.</em> approx. 30,44 days, but with irregular durations (28,29, 30 or 31 days)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>BIMONTH_61</code>
</td>
<td class="hdlist2">
<p>2 months = 61 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_336</code>
</td>
<td class="hdlist2">
<p>year = 12 months of 4 weeks of 7 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_360</code>
</td>
<td class="hdlist2">
<p>year = 12 months of 30 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_364</code>
</td>
<td class="hdlist2">
<p>year = 52 weeks of 7 days = 13 months of 28 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_365</code>
</td>
<td class="hdlist2">
<p>year = 365 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR</code>
</td>
<td class="hdlist2">
<p>calendar year, <em>i.e.</em> approx. 365.25 days, but with irregular durations (365 or 366 days)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_366</code>
</td>
<td class="hdlist2">
<p>year = 6 bimonths of 61 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>DECADE</code>
</td>
<td class="hdlist2">
<p>decade = 10 years</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>CENTURY</code>
</td>
<td class="hdlist2">
<p>century = 10 decades</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MILLENNIUM</code>
</td>
<td class="hdlist2">
<p>millennium = 10 centuries</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>longestTimeUnit</code>
</td>
<td class="hdlist2">
<p>The longest time unit used in this model. <em>cf.</em> <code>shortestTimeUnit</code> for valid values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>timeOrigin</code>
</td>
<td class="hdlist2">
<p>The value of time at simulation start, either as a long (number of <code>shortestTimeUnit</code>) or as a date; 0 by default.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_timers"><a class="anchor" href="#_timers"></a>Timers</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/timeLine/<strong>timer</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>Ecological processes may be run following different times. A timer is
 a particular way of representing time in the simulator. Timers may 
differ in parameters, like e.g. two timers using different time steps; 
but they can also be radically different in their logic: e.g. clock-like
 ticking vs. event-driven simulation.</p>
</div>
<div id="timer-howto" class="sidebarblock">
<div class="content">
<div class="title">How do timers work?</div>
<div class="paragraph">
<p>Internally, each timer is an instance of the class <code>Timer</code>,
 which is able to return the next time where computation must be made 
according to its own logic. Every iteration of 3Worlds starts with the 
simulator asking all timers for their next time, then keeping all of 
those with the next time closest to last time, and executing them <em>in unpredictable order</em>.
 3Worlds uses long integers to measure time internally, which means that
 simultaneous events are possible (times may be strictly equal). The 
finest time interval is given by <code>TimeLine.shortestTimeUnit</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>timer</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>the type of <code>timer</code> to use.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>ClockTimer</code>
</td>
<td class="hdlist2">
<p>Time is incremented by a constant amount <em>dt</em>. This is commonly used to simulate regular processes like growth.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>EventTimer</code>
</td>
<td class="hdlist2">
<p>Model dynamics generates <em>events</em> and computes the date in the
 future at which they are going to occur. This is commonly used to 
generate irregular processes like fire occurrence.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ScenarioTimer</code>
</td>
<td class="hdlist2">
<p><strong>Not yet implemented</strong>.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = ClockTimer</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>timeUnit</code>
</td>
<td class="hdlist2">
<p>the base time unit used by this timer. <em>cf.</em> <code>timeLine.shortestTimeUnit</code> for the valid values of this property</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>nTimeUnits</code>
</td>
<td class="hdlist2">
<p>the number of base time units in the time unit of this model (<em>e.g.</em>, a model may have a 2 year time unit)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dt</code>
</td>
<td class="hdlist2">
<p>The constant time increment used in this <code>ClockTimer</code>, expressed as an integer number of <code>timer</code> base unit (=<code>timer.nTimeUnits</code> × <code>timer.timeUnit</code>). For example, if the <code>timer</code> has <code>timeUnit</code> = <code>DAY</code> and <code>nTimeUnits</code> = 3, <code>dt</code> is expressed in units of 3 days (e.g. <code>dt</code> = 2 means the time increment is 6 days).</p>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
if calendar time is used (<code>timeLine.scale</code> = <code>GREGORIAN</code>), then <code>dt</code> will sometimes not be constant (e.g. if <code>dt</code> = 2 <code>MONTH</code>, <code>dt</code> will vary in duration between 59 and 62 days according to the exact date).
</td>
</tr>
</tbody></table>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>offset</code>
</td>
<td class="hdlist2">
<p>In some cases it is desirable to offset a <code>ClockTimer</code> 
relative to another one running at the same time step, for example to be
 certain of their order of execution or to simulate cyclic phenomena 
(e.g. seasons). The timer will start after <code>offset</code> × <code>timeUnit</code> units, where <code>offset</code> is a fraction between 0.0 and 1.0.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional cross-links when</em> <code>class = EventTimer</code></p>
</div>
<div class="paragraph">
<p>An <code>EventTimer</code> maintains a queue of time events that gets populated by user-defined ecological <a href="#truefunction">functions</a>. This way, future events depend on the dynamics of the system. Functions that can populate an event queue will have an <code>EventQueue</code>
 argument in their heading, usable to create future time events. Events 
must set a time in the future, i.e. their time must be larger than 
current time. Event times are always expressed in <code>Timeline.shortestTimeUnit</code>s in an <code>EventTimer</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fedBy → initFunction:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link is used to set the first event of an <code>EventTimer</code> at simulation start, hence from an <a href="#truesetting-decriptor-values"><code>initFunction</code></a>. Without this initial event, the timer will never start. More than one event can be created here.</p>
</dd>
<dt class="hdlist1"><code>fedBy → function:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>These links indicate which functions can populate the event queue with time events. Multiple events can be created here.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_simulation_stopping_condition"><a class="anchor" href="#_simulation_stopping_condition"></a>Simulation stopping condition</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/<strong>stoppingCondition</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A simulation may be run indefinitely (interactively), but in big 
simulation experiment it is useful to automatically stop the simulations
 according to some criterion. Besides the simplest stopping condition, 
reaching a maximal time value, 3Worlds provides many other possibilities
 to stop a simulation (e.g. based on a population size, on a variable 
passing a threshold value, etc.).</p>
</div>
<div class="paragraph">
<p>When no stopping condition is defined, the simulation will run indefinitely.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>stoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>The type of stopping condition to use</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>SimpleStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a maximal time value is reached.</p>
</dd>
<dt class="hdlist1"><code>ValueStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a variable in a reference system component reaches a given value.</p>
</dd>
<dt class="hdlist1"><code>InRangeStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a variable in a reference system gets within the given range.</p>
</dd>
<dt class="hdlist1"><code>OutRangeStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a variable in a reference system gets out of the given range.</p>
</dd>
<dt class="hdlist1"><code>MultipleOrStoppingCondition</code></dt>
<dd>
<p>Compound stopping condition: simulation stops when <em>any</em> of the elementary stopping conditions within this multiple condition’s list is true.</p>
</dd>
<dt class="hdlist1"><code>MultipleAndStoppingCondition</code></dt>
<dd>
<p>Compound stopping condition: simulation stops when <em>all</em> of the elementary stopping conditions within this multiple condition’s list are true.</p>
</dd>
</dl>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = SimpleStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>duration</code>
</td>
<td class="hdlist2">
<p>The duration of the simulation beyond time line <code>timeOrigin</code>, in time line <code>shortestTimeUnits</code>.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional cross-links when</em> <code>class = ValueStoppingCondition</code>, <code>InRangeStoppingCondition</code>,  <code>OutRangeStoppingCondition</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>stopSystem → component:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>The system component in which some variable will be checked to stop the simulation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = ValueStoppingCondition</code>, <code>InRangeStoppingCondition</code>,  <code>OutRangeStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>stopVariable</code>
</td>
<td class="hdlist2">
<p>The name of the variable in <code>stopSystem</code> which values are used to decide to stop the simulation.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = ValueStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>stopValue</code>
</td>
<td class="hdlist2">
<p>The value of <code>stopVariable</code> at which to stop the simulation.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = InRangeStoppingCondition</code>, <code>OutRangeStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>upper</code>
</td>
<td class="hdlist2">
<p>The upper value of the <code>stopVariable</code> range. Only <code>double</code> values are accepted.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>lower</code>
</td>
<td class="hdlist2">
<p>The lower value of the <code>stopVariable</code> range. Only <code>double</code> values are accepted.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional cross-links when</em> <code>class = MultipleOrStoppingCondition</code>, <code>MultipleAndStoppingCondition</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>condition → stoppingCondition:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>These links point to the stopping conditions that will be used as 
elementary stopping conditions by the multiple and/or stopping 
condition. Use these links to construct complex stopping conditions.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_transformations_of_a_system_component"><a class="anchor" href="#_the_transformations_of_a_system_component"></a>The transformations of a system component</h5>
<div class="paragraph">
<p>Changes in a <em>system component</em> through time may be of different kinds: changes in <em>state</em>, i.e. in its driver and decorator variables; or more radical changes where the component actually changes <em>category</em>,
 so becomes represented by a different set of variables. Plus, a 
component may have an ephemeral life (lifespan property), which means 
component objects are dynamically created or deleted during a 
simulation.</p>
</div>
<div class="sect5">
<h6 id="_process"><a class="anchor" href="#_process"></a>Process</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/timeLine/timer/<strong>process</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p><em>Processes</em> are used in 3Worlds to compute change in <a href="#truesystem-component"><em>system components</em></a>. Each process acts on system components of a particular group of <a href="#truecategories">categories</a> and is scheduled by a particular <a href="#truetimers">timer</a>.
 Processes contain user-defined code that represents ecological 
processes. This gives 3Worlds its versatility: one can mix in a single 
model completely different ecological entities (system components of 
different categories), implement any ecological process depending on 
user needs, and put them to work on different time scales (times). A <code>process</code> is run according to its parent <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>process</code></p>
</div>
<div class="paragraph">
<p>A process can act on a single system component at a time (called the <em>focal</em> system component), or on a pair of components linked by a relation (called the <em>focal</em> and the <em>other</em> system components). This is specified using the <code>appliesTo</code> cross-link (one at least must be present):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>appliesTo → category:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>These links indicate the categories of system components that will be acted on by the process.</p>
</dd>
<dt class="hdlist1"><code>appliesTo → relation:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>This link indicates to which relation type between system component the process applies.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A process <strong>must</strong> apply either to categories (<em>category process</em>) or to a single relation type (<em>relation process</em>), but cannot apply to both.
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>dependsOn → process:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>This link tells that the process must be activated <em>after</em> the processes targeted by the links. Use this link to organize computations when there are dependencies between them.</p>
</dd>
<dt class="hdlist1"><code>inSpace → space:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>This link indicates that this process will make use of this  <a href="#truethe-representation-of-space">space</a>
 for its optimisation of neighbour searches. Use this link when you want
 fast search for candidates to establish a relation, i.e. in association
 with the <code>relateToDecision</code> function. The required property <code>searchRadius</code> in the <code>inSpace</code> link tells to which <em>maximal</em>
 distance candidates for establishing a relation must be searched. 
3Worlds will only present components at a shorter distance than <code>searchRadius</code> (possibly none) to the <code>relateToDecision</code>
 function. A value of zero means the algorithm searches for the closest 
neighbour only (possibly more than one if all exactly at the same 
distance), whatever its distance to the focal component.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Forgetting to set the value of <code>searchRadius</code> is a common source of unexpected behaviour in spatial models.
</td>
</tr>
</tbody></table>
</div>
<div id="process-howto" class="sidebarblock">
<div class="content">
<div class="title">How do processes work?</div>
<div class="paragraph">
<p>Internally, an instance of the <code>Process</code> class implements a '<em>for each</em>' loop on system components during an iteration step, as scheduled by its <code>Timer</code>.
 The order in which the components are processed in a loop is 
unpredictable (not fixed, nor random); the only safe assumption is to 
consider that they are all processed simultaneously.</p>
</div>
<div class="paragraph">
<p>If the process applies to a list of categories, it is a single loop 
on all components belonging to these categories. This is the <code>ComponentProcess</code> sub-class.</p>
</div>
<div class="paragraph">
<p>If it applies to a relation type, it is either (1) a double loop, 
possibly optimized by using a space, on components belonging to the 
'from' list of categories of the relation type, and components belonging
 to the 'to' list of categories of the relation type (<code>SearchProcess</code> sub-class); or (2) a single loop on relations instances of its relation type (<code>RelationProcess</code> sub-class).</p>
</div>
<div class="paragraph">
<p>Processes of a same timer are run in any (= unpredictable) order unless explicitly ordered by the use of the <code>dependsOn</code> cross-link. Ordering processes in such ways defines <em>causal steps</em> (<a href="#truecausality">[truecausality]</a>) within the time steps.</p>
</div>
<div class="paragraph">
<p>In short: process = (parallel) loop on components (within one causal step) within one time step.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_function"><a class="anchor" href="#_function"></a>Function</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/timeLine/timer/<strong>function</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>This node is used to specify the details of the computations made in a <code>process</code>. The <code>process</code> defines which system components are going to be activated and at what time in the simulation course; the <code>function</code>
 defines which computations, in detail, will be applied to the system 
components of that process. This enables to build complex computations 
applying to one component (a series of <code>function</code>s within a <code>process</code>) in the context of a particular subset of components (<code>process</code>).</p>
</div>
<div class="paragraph">
<p>There are different types of functions, differing by the way they 
affect system components and relations. The selection of a function type
 will trigger the generation in the model java source file of a method 
having the name specified in the <code>function</code> node name. This 
method is expected to be edited by the modeller in order to implement 
her/his favourite version of the ecological process modelled by the 
function.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The name of a function must be a valid java class name, starting with an uppercase letter.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>function</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>This property specifies which kind of biological function will be implemented within the linked <code>Process</code> obect.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>ChangeState</code>
</td>
<td class="hdlist2">
<p>change the state, i.e. the values of the descriptors of a system component (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ChangeCategoryDecision</code>
</td>
<td class="hdlist2">
<p>change category of a system component according to life cycle (has no effect if no life cycle is specified)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>CreateOtherDecision</code>
</td>
<td class="hdlist2">
<p>create another system component, of the same categories if no life cycle is present, otherwise as specified by the life cycle</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>DeleteDecision</code>
</td>
<td class="hdlist2">
<p>delete self</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ChangeOtherState</code>
</td>
<td class="hdlist2">
<p><em>focal</em> changes the state of <em>other</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>RelateToDecision</code>
</td>
<td class="hdlist2">
<p><em>focal</em> establishes a new relation to <em>other</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MaintainRelationDecision</code>
</td>
<td class="hdlist2">
<p>decision to maintain or remove an existing relation</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ChangeRelationState</code>
</td>
<td class="hdlist2">
<p>change the state of a relation, i.e. possibly both the state of <em>focal</em> and <em>other</em> at the same time</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SetInitialState</code>
</td>
<td class="hdlist2">
<p>sets the initial state of a newly created SystemComponent</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SetOtherInitialState</code>
</td>
<td class="hdlist2">
<p>sets the initial state of a newly created SystemComponent given a parent component</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>relateToDecision</code> function has a special status among 
relation processes as it is used to establish a relation, whereas all 
other functions for relation processes use an already established 
relation. As a result, a process parent to a <code>relateToDecision</code> function cannot be parent to any other type of function. For computation efficiency, it is recommended to associate a <a href="#truethe-representation-of-space"><em>space</em></a> to the process parent to a <code>relateToDecision</code> function.
</td>
</tr>
</tbody></table>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>functionSnippet</code>
</td>
<td class="hdlist2">
<p>This optional property is used in 3Worlds tutorial and test models  
to store the java code of user-defined function. This code is inserted 
in the body of the generated user-code methods.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Use snippets only for simple models as there no Java compiler checking your code for errors.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>function</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>useRNG → rng:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>Points to the <a href="#truerandom-number-channels">random number generator channel</a> to use in this function. If unset, the default random number channel is used.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>function = createOtherDecision</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>relateToProduct</code>
</td>
<td class="hdlist2">
<p>A logical value (<code>false</code> by default) which tells to establish a permanent <code>parentTo</code> relation (defined in the <code>predefined</code> sub-tree: <a href="#truethe-predefined-sub-tree">[truethe-predefined-sub-tree]</a>) between a parent component and its offspring created by calling <code>createOtherDecision</code>.</p>
</td>
</tr>
</tbody></table>
</div>
<div id="function-howto" class="sidebarblock">
<div class="content">
<div class="title">How do functions work?</div>
<div class="paragraph">
<p>Functions are called within the loop on components of their parent 
process. The processing order of functions within their process is 
constant:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a <code>ComponentProcess</code>:</p>
<div class="ulist">
<ul>
<li>
<p>execute all <code>changeState</code> functions</p>
</li>
<li>
<p>then, all <code>deleteDecision</code> functions,</p>
</li>
<li>
<p>then, all <code>createOtherDecision</code> functions,</p>
</li>
<li>
<p>then, all <code>changeCategoryDecision</code> functions,</p>
</li>
<li>
<p>then send data to all <a href="#truedata-tracking">data trackers</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>In a <code>SearchProcess</code>:</p>
<div class="ulist">
<ul>
<li>
<p>execute all <code>relateToDecision</code> functions</p>
</li>
</ul>
</div>
</li>
<li>
<p>In a <code>RelationProcess</code></p>
<div class="ulist">
<ul>
<li>
<p>execute all <code>changeOtherState</code> functions</p>
</li>
<li>
<p>then, all <code>maintainRelationDecision</code> functions,</p>
</li>
<li>
<p>then, all <code>changeRelationState</code> functions</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The order of these computations does not matter for <em>driver</em> 
descriptors, nor for component creation and deletion, because all the 
changes are postponed until after the process loop is over. For example,
 a component may in the same time step reproduce an die. The order may 
only matter for <em>decorators</em>, which are provided here as a convenience for complex computations.</p>
</div>
<div class="paragraph">
<p>A way to make your model code efficient is to group functions run 
with the same timer in a single process, so that they are called in a 
single pass on components instead of many in case you use different 
processes. This assumes that your functions can be processed in any 
order without consequences on the outcome - which is not always true. If
 you need a precise ordering of function calls because, e.g. one of them
 requires that a decorator variable has been set by another, then you 
must place your functions in different processes linked by a <code>dependsOn</code> cross-link to tell which is computed first.</p>
</div>
<div class="paragraph">
<p>At the end of a process loop (causal step, <a href="#truecausality">[truecausality]</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the values of all <em>drivers</em> are updated (i.e. values computed by functions are stored in a <em>next</em> driver data structure, which now replaces the <em>current</em> driver structure);</p>
</li>
<li>
<p><em>components</em> to be deleted and to be created as decided by <code>-Decision</code> functions, and <em>ephemeral</em> relations to create/delete, are now inserted in the current list of components;</p>
</li>
<li>
<p><em>spaces</em> are updated according to changes in the component community;</p>
</li>
<li>
<p><em>permanent</em> relations between components are updated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the end of all process loops (time step, <a href="#truecausality">[truecausality]</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>all <em>decorators</em> are set to zero;</p>
</li>
<li>
<p><em>automatic</em> descriptors (e.g. component age, population numbers) are updated;</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_function_consequences"><a class="anchor" href="#_function_consequences"></a>Function consequences</h6>
<div class="paragraph">
<p><code>/3worlds/…​/process/function/<strong>consequence</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Some functions may imply consequences: for example, a decision to 
delete another system component may be followed by a change in state 
based on the deleting component’s state at the time it is deleted. Such 
functions that are only activated when certain events take place are 
called <em>consequences</em> and may be specified by a child node to a function. Here also, rules apply:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">function</th>
<th class="tableblock halign-left valign-top">consequence</th>
<th class="tableblock halign-left valign-top">use to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeState</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeRelationState</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeOtherState</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeOtherState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carry over values to another component linked by a <code>returnsTo</code> relation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createOtherDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setOtherInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the initial state of the new component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relateToDecision</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeCategoryDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setOtherInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carry over and compute values from the former component (<em>focal</em>) to the new recruit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maintainRelationDecision</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relateToDecision</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Consequence functions have the same properties and cross-links as functions (cf. above).</p>
</div>
<div id="consequence-howto" class="sidebarblock">
<div class="content">
<div class="title">How do consequence functions work?</div>
<div class="paragraph">
<p>Internally, consequence functions are just functions which are called <em>immediately after</em> their parent function. E.g., in a <code>ComponentProcess</code> loop on <code>deleteDecision</code> functions, each <code>deleteDecision</code> function is immediately followed by a call to its consequence <code>changeOtherState</code> function, if any.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_data_tracking"><a class="anchor" href="#_data_tracking"></a>Data tracking</h5>
<div class="paragraph">
<p><code>/3worlds/…​/process/<strong>dataTracker</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Data trackers are used to get output from a simulation. This output can then be redirected either to graphic windows of <code>ModelRunner</code>
 or to a data file for later processing with other software. Using a 
data tracker is similar to what happens in the real world: you set a 
sensor into the system you want to monitor and wire it to a data logger 
which translates the signal into human-readable data. There are 
different kinds of data trackers according to the output format and the 
sampling method you want to use; and different ways of wiring these 
trackers to the simulated system and its components.</p>
</div>
<div class="paragraph">
<p>A data tracker will record values of descriptors (except constants) 
of a sample of system components or groups, or of the system itself and 
send them to any listener (usually a <a href="#truewidgets">widget</a>) linked to it. The frequency of data sending is determined by the <em>timer</em> of the parent <em>process</em> of the data tracker.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A <code>dataTracker</code> node can only be specified in a <em>category process</em>, not in a <em>relation process</em>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dataTracker</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>samplingMode</code>
</td>
<td class="hdlist2">
<p>This property specifies how to pick system components for data tracking <em>within a group</em>.
 The data will be either (1) selected for one particular system 
component within each group, or (2) taken from that group’s own data, if
 any (e.g. species population size), or (3) aggregated using some 
statistical method&nbsp;; all this, depending on the cross-links of the <code>dataTracker</code>.
 For (1), the default behaviour is that once a system component is 
selected, it will be tracked until its deletion by the simulator. In all
 cases, remember that the maximal number of data tracking channels is 
set by the <code>sampleSize</code> property; this property only tells 
the software how to fit the data coming from possibly many system 
components into the requested number of output channels.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>RANDOM</code>
</td>
<td class="hdlist2">
<p>selects system components randomly to constitute the sample (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>FIRST</code>
</td>
<td class="hdlist2">
<p>selects the first system components of their group (as internally 
stored) to constitute the sample. Notice that components may come in any
 order and that this order may change unpredictably during a simulation.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>LAST</code>
</td>
<td class="hdlist2">
<p>selects the last system components of their group (as internally 
stored) to constitute the sample. Notice that components may come in any
 order and that this order may change unpredictably during a simulation.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sampleSize</code>
</td>
<td class="hdlist2">
<p>How many system components at most will be tracked. Valid values are any positive integer or the keyword <code>ALL</code> to sample all the components of a given group.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>statistics</code>
</td>
<td class="hdlist2">
<p>This property lists transformations of the raw data to compute when a group contains more than one system component.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>mean</code>
</td>
<td class="hdlist2">
<p>mean (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>var</code>
</td>
<td class="hdlist2">
<p>variance</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>se</code>
</td>
<td class="hdlist2">
<p>standard error</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cv</code>
</td>
<td class="hdlist2">
<p>coefficient of variation (%)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sum</code>
</td>
<td class="hdlist2">
<p>sum</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>N</code>
</td>
<td class="hdlist2">
<p>count</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min</code>
</td>
<td class="hdlist2">
<p>minimum</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max</code>
</td>
<td class="hdlist2">
<p>maximum</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>tableStatistics</code>
</td>
<td class="hdlist2">
<p>This property lists transformations of the raw data to compute in 
case of a table variable. The grouping is determined by the index 
specification in the track variable list. cf. property <code>statistics</code> for valid values.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>The type of data tracker to use</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>DataTracker0D</code></dt>
<dd>
<p>time series tracker; returns (<em>t</em>, <em>x<sub>1</sub></em>, …​, <em>x<sub>n</sub></em>) values (where <em>t</em> is time and <em>x<sub>i</sub></em> the descriptors of interest).</p>
</dd>
<dt class="hdlist1"><code>DataTrackerXY</code></dt>
<dd>
<p>raw tracker; returns (<em>x</em>,<em>y</em>) values at each time step.</p>
</dd>
<dt class="hdlist1"><code>DataTracker2D</code></dt>
<dd>
<p><strong>unimplemented yet</strong></p>
</dd>
</dl>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>dataTracker</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>sampleComponent → componentType:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>The <code>dataTracker</code> will track components of the <code>componentType</code> pointed by this link, following the sampling strategy specified by properties <code>samplingMode</code>, <code>sampleSize</code>, <code>statistics</code> and <code>tableStatistics</code>. <em>Permanent</em> components will be tracked until the end of the simulation. <em>Ephemeral</em>
 components are tracked all their life long: a new sampling is done 
every time a formerly tracked component is deleted. Sampling strategy 
can further be refined using two optional properties (see below).</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>componentType</code> categories must match those of the <code>process</code> parent of the <code>dataTracker</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Optional properties for</em> <code>sampleComponent</code> <em>cross-links</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>idLifeCycle</code>
</td>
<td class="hdlist2">
<p>The identifier of the <em>life cycle</em> which components are to be sampled from, as a <code>String</code>; only required if a life cycle has been specified.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>idGroup</code>
</td>
<td class="hdlist2">
<p>The identifier of the <em>group</em> which components are to be sampled from,  as a <code>String</code>; only required if a group has been specified</p>
</td>
</tr>
</tbody></table>
</div>
</dd>
<dt class="hdlist1"><code>sampleGroup → groupType:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>The <code>dataTracker</code> will track groups of the <code>groupType</code> pointed by this link.</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>groupType</code> categories must match those of the <code>process</code> parent of the <code>dataTracker</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Optional property for</em> <code>sampleGroup</code> <em>cross-links</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>idGroup</code>
</td>
<td class="hdlist2">
<p>The list of identifiers of the groups to track, as a <code>StringTable</code>. If not set, all groups of the <code>groupType</code> are tracked.</p>
</td>
</tr>
</tbody></table>
</div>
</dd>
<dt class="hdlist1"><code>sampleLifeCycle → lifeCycleType:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>The <code>dataTracker</code> will track life cycles of the <code>lifeCycleType</code> pointed by this link.</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>lifeCycleType</code> categories must match those of the <code>process</code> parent of the <code>dataTracker</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Optional property for</em> <code>sampleLifeCycle</code> <em>cross-links</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>idLifeCycle</code>
</td>
<td class="hdlist2">
<p>The list of identifiers of the life cycles to track, as a <code>StringTable</code>. If not set, all life cycles of the <code>lifeCycleType</code> are tracked.</p>
</td>
</tr>
</tbody></table>
</div>
</dd>
<dt class="hdlist1"><code>sampleArena → system:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>The <code>dataTracker</code> will only track the <em>system</em> data.</p>
</dd>
<dt class="hdlist1"><code>trackField → field:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>The <code>dataTracker</code> will track all fields pointed by these cross-links in all objects (<em>components</em>, <em>groups</em>, <em>life cycles</em> or <em>system</em>) it is sampling.</p>
</dd>
<dt class="hdlist1"><code>trackTable → table:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>The <code>dataTracker</code> will track all tables pointed by these cross-links in all objects (<em>components</em>, <em>groups</em>, <em>life cycles</em> or <em>system</em>) it is sampling.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the trackField or trackTable cross-links must refer to fields or tables present in the categories of the parent <code>process</code> of the <code>dataTracker</code> (<code>process</code> <code>appliesTo</code> cross-links).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>trackField</code> <em>and</em> <code>trackTable</code> <em>cross-links</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>index</code>
</td>
<td class="hdlist2">
<p>A list of <code>String</code>s giving the range of table indices to track. The following rules are used to specify which cells of the table should be picked:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>an index specification for a table is enclosed in square brackets: <code>[]</code>;</p>
</li>
<li>
<p>vertical bars separate dimensions: e.g. <code>[||]</code> refers to a table with three dimensions;</p>
</li>
<li>
<p>a single number is used to specify a single cell in one dimension: e.g. <code>[1||]</code> refers to the cell 1 in dimension 1 (Note: this is the <em>second</em> cell in this dimension as all dimension indices start at 0 = first cell);</p>
</li>
<li>
<p>a list of cells in one dimension is specified using commas: e.g. <code>[1|0,2,7|]</code> refers to the cells 0, 2 and 7 in the second dimension;</p>
</li>
<li>
<p>a range of cells in one dimension is specified using a column: e.g. <code>[1|0,2,7|2:4]</code> refers to the cells 2,3 and 4 in the third dimension;</p>
</li>
<li>
<p>a negative number means that all cells in a dimension must be tracked <em>except</em> this number: e.g. <code>[-1|0,2,7|2:4]</code> indicates that all cells in the first dimension except cell 1 must be tracked.</p>
</li>
<li>
<p>a minus sign in front of a range means that all cells in a dimension must be tracked <em>except</em> this whole range: e.g. <code>[1|0,2,7|-2:4]</code> indicates that all cells in the third dimension except cells 2, 3 and 4 must be tracked.</p>
</li>
<li>
<p>an empty dimension means all cells in this dimension are to be tracked: e.g. <code>[1||2:4]</code> indicates that all cells in the second dimension will be tracked;</p>
</li>
<li>
<p>an empty index string <code>[]</code>, or no index string, means that the whole table (all cells) is to be tracked.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The descriptors may be elaborate <a href="#truethe-descriptor-tree">hierarchical data structure</a> which include a table at some level. For each table in this hierarchy, an index <code>String</code>
 as described above must be given in the index property, in a 
comma-separated list, e.g.: [0:2|0],[4,6] means that index [0:2|0] 
should be used for the top-level table of the descriptor, and index 
[4,6] for the bottom-level table.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong>[TO DO: a few examples]</strong></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_datadefinition_node"><a class="anchor" href="#_the_datadefinition_node"></a>3.3.5. The <em>dataDefinition</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>dataDefinition</strong></code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains the detailed specifications of 
descriptors used in a model. This information is used by 3Worlds to 
generate java code for the data structures that will be used in 
simulations of this particular model. These data structures are then 
made available to descendants of 3Worlds  <a href="#truefunction">functions</a> that users will edit and modify to describe their particular model.</p>
</div>
<div class="sect4">
<h5 id="_the_descriptor_tree"><a class="anchor" href="#_the_descriptor_tree"></a>The descriptor tree</h5>
<div class="paragraph">
<p>Every <a href="#truethe-specification-of-ecological-entities-system-components"><em>system component</em></a> of 3Worlds potentially holds four kinds of  <a href="#truecategory"><em>descriptors</em></a>. Each of these (<em>drivers</em>, <em>decorators</em>, <em>constants</em> and <em>automatic variables</em>) is a <em>tree</em> of two kinds of data structures: <em>records</em> and <em>tables</em>. Records contain <em>fields</em>,
 i.e. atomic (i.e. not breakable into smaller parts) pieces of data of 
different types (numbers, character strings, logical values), each field
 having a name to access its value (i.e. field = (name,value) pair). 
Tables are multi-dimensional arrays of values of the same atomic type.</p>
</div>
<div class="paragraph">
<p>The data tree is constructed by allowing records to contain tables as
 fields (but not records), and by allowing tables to contain records all
 made of the same fields (but not tables) instead of atomic types. This 
gives end-user modellers great flexibility to organise their data into 
elaborate structures.</p>
</div>
<div class="sect5">
<h6 id="_record"><a class="anchor" href="#_record"></a>Record</h6>
<div class="paragraph">
<p><code>/3worlds/dataDefinition/<strong>record</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/…​/table/<strong>record</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <em>record</em> is a data structure made of <em>fields</em> (=(name,value) pairs) or <em>tables</em> that represent the <em>descriptors</em> of a <em>category</em> of <em>components</em>.
 All descriptor trees must start with a record as their root. The record
 name will be turned into a java class name by the 3Worlds code 
generator for use in end-user code. A record may be nested in a <em>table</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A record cannot be empty, i.e. it <strong>must</strong> have at least one child node (field or table), see below.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_field"><a class="anchor" href="#_field"></a>Field</h5>
<div class="paragraph">
<p><code>/3worlds/…​/record/<strong>field</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <em>field</em> is an atomic piece of data accessed by its name within a record.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>field</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>The data type of this field.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>Double</code>
</td>
<td class="hdlist2">
<p>a double precision floating point number (4.9406564584124654 10^-324 
to 1.7976931348623157 10^308, symmetric for negative numbers) with 16 
significant digits (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Integer</code>
</td>
<td class="hdlist2">
<p>an integer [-2147483648; 2147483647]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Long</code>
</td>
<td class="hdlist2">
<p>a long integer [-9223372036854775808; 9223372036854775807]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Float</code>
</td>
<td class="hdlist2">
<p>a single precision floating point number (1.40239846 10^-45 to 
3.40282347 10^38, symmetric for negative numbers) with 8 significant 
digits</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Boolean</code>
</td>
<td class="hdlist2">
<p>a logical value {true, false}</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>String</code>
</td>
<td class="hdlist2">
<p>a text string</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Short</code>
</td>
<td class="hdlist2">
<p>a short integer [-32768; 32767]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Char</code>
</td>
<td class="hdlist2">
<p>a character value (16-bit Unicode = UTF16, i.e. 65535 different values)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Byte</code>
</td>
<td class="hdlist2">
<p>a very, very short integer [-128&nbsp;; 127]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Object</code>
</td>
<td class="hdlist2">
<p>anything else <strong>TODO: should we keep this? it’s probably useless</strong></p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>description</code>
</td>
<td class="hdlist2">
<p>A long description of the field</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>units</code>
</td>
<td class="hdlist2">
<p>Measurement units of field values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>Precision used for display of field values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>interval</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this field (real number types)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>range</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this field (integer number types)</p>
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_dimensioner"><a class="anchor" href="#_dimensioner"></a>Dimensioner</h6>
<div class="paragraph">
<p><code>/3worlds/dataDefinition/<strong>dimensioner</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <em>dimensioner</em> is used to define the number of entries in a table.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dimensioner</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>size</code>
</td>
<td class="hdlist2">
<p>The number of table cells in this dimension.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_table"><a class="anchor" href="#_table"></a>Table</h6>
<div class="paragraph">
<p><code>/3worlds/…​/record/<strong>table</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A table is a multi-dimensional data structure containing either atomic data types or <em>records</em>, all of the same type.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>table</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>dataElementType</code>
</td>
<td class="hdlist2">
<p>The data type of the elements of the table. cf property <code>field.type</code> for valid values.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>description</code>
</td>
<td class="hdlist2">
<p>A long description of the table</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>units</code>
</td>
<td class="hdlist2">
<p>Measurement units of table values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>Precision used for display of table values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>interval</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this table (real number types)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>range</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this table (integer number types)</p>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
These properties are not needed when the table is a table of records (cf. above).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross links for</em> <code>table</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>sizedBy → dimensioner:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link sets one dimension of a table to be of the length found in the dimensioner <code>size</code> property. The required property <code>rank</code> in the <code>sizedBy</code> edge tells the rank of the dimension. All <code>sizedBy</code> links of a table should have a different rank, in increasing order starting from 0 to the number of dimensions -1.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_random_number_channels"><a class="anchor" href="#_random_number_channels"></a>Random number channels</h5>
<div class="paragraph">
<p><code>/3worlds/dataDefinition/<strong>rng</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Simulation models make extensive use of random numbers to make 
decisions on components (e.g. decision to delete a component or to 
create new ones). 3Worlds defines random number channels, that can be 
attached to specific <a href="#truefunction">functions</a>. These 
channels can be held constant by using the same seed in a series of 
simulations, thus enabling to conduct factorial experiments controlling 
for a source of random numbers or another.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>rng</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>algorithm</code>
</td>
<td class="hdlist2">
<p>Algorithm used to produce random numbers</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>PCG32</code>
</td>
<td class="hdlist2">
<p>Implementation of a permuted congruential generator with 32-bit output (<a href="https://en.wikipedia.org/wiki/Permuted_congruential_generator">PGC32</a>); fast (56% faster than <code>JAVA</code>) and good quality (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>JAVA</code>
</td>
<td class="hdlist2">
<p>The default Java random number generator of <code>java.util.Random</code>; medium speed, poor quality</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>XSRANDOM</code>
</td>
<td class="hdlist2">
<p>Implementation of a Xorshift random number generator as found <a href="http://demesos.blogspot.com/2011/09/replacing-java-random-generator.html">here</a>; very fast (76% faster than <code>JAVA</code>), medium quality</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>seedSource</code>
</td>
<td class="hdlist2">
<p>How to create the seed of the random number generator</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>PSEUDO</code>
</td>
<td class="hdlist2">
<p>The random number seed is produced from a call to a unique instance of <code>java.util.Random.Random()</code>. It uses time to the nanosecond to produce a ‘very likely to be distinct’ seed (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>NATURAL</code>
</td>
<td class="hdlist2">
<p>The random number seed is taken as an element in a table of 1000 
natural random numbers that have been obtained from atmospheric noise. 
Use the property <code>tableIndex</code> to specify which item in this table should be taken for the seed</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>CONSTANT</code>
</td>
<td class="hdlist2">
<p>The random number seed is a constant (either 0 or 1, depending on the algorithm)</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>resetTime</code>
</td>
<td class="hdlist2">
<p>When to reset the random number channel seed</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>NEVER</code>
</td>
<td class="hdlist2">
<p>The random number seed is never reset after initialisation of the random number channel (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ONRUNSTART</code>
</td>
<td class="hdlist2">
<p>The random number seed is reset to its former value for every 
simulation run (producing the same series of random numbers for every 
simulation)</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>tableIndex</code>
</td>
<td class="hdlist2">
<p>Index into an <code>array[0..999]</code> of naturally generated random numbers to act as seeds for resetting</p>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no random number channel is specified, 3Worlds uses a single default channel with algorithm <code>XSRANDOM</code>, seedSource <code>PSEUDO</code> and resetTime <code>NEVER</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_experiment_node"><a class="anchor" href="#_the_experiment_node"></a>3.3.6. The <em>experiment</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>experiment</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree describe the experimental design to run using a given <em>model</em> and external data sets. Typically, il will tell <code>ModelRunner</code>
 how many simulations should be run, possibly varying some parameters of
 the model according to some plan, where data should be read and saved. 
The name is used to differentiate simulation experiments in a meaningful
 way.</p>
</div>
<div class="paragraph">
<p>The default, simplest, simulation experiment is just to run a single simulation of the <em>baseline</em> model.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>experiment</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>nReplicates</code>
</td>
<td class="hdlist2">
<p>The number of times all elementary treatments must be replicated. Use
 this only if there is an internal source of variation in simulations, 
like random numbers.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>experiment</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>baseLine → system:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link points to a model setup (<a href="#truethe-system-node">[truethe-system-node]</a>) that will be used as a <em>base line</em>
 simulation. A base line simulation is the equivalent to a control in a 
real experiment, i.e. a reference case that serves as a basis to which 
other treatments are compared. Often, the base line is the setup for 
which data is available to compare simulation outputs to.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_simulation_duration"><a class="anchor" href="#_simulation_duration"></a>Simulation duration</h5>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>timePeriod</strong></code> {0..*}</p>
</div>
<div class="paragraph">
<p>The duration of a particular simulation is specified using a <code>timePeriod</code> node.</p>
</div>
<div class="paragraph">
<p><strong>[TO DO: sort out the conflict between this and the stopping conditions]</strong></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>timePeriod</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>start</code>
</td>
<td class="hdlist2">
<p>The starting time of a simulation in <code>timeLine</code> shortest time units.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>end</code>
</td>
<td class="hdlist2">
<p>The ending time of a simulation in <code>timeLine</code> shortest time units.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both properties are optional. If none is set, the simulation will start at time 0 and run indefinitely.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>timePeriod</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>stopOn → stoppingCondition:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>This link tells how to stop the simulation in case no <code>end</code> property is given.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The stopping condition has the priority over the <code>end</code> property.
<strong> TO DO: check this</strong>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_experimental_design"><a class="anchor" href="#_experimental_design"></a>Experimental design</h5>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>design</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>An experimental design specifies the method used to perform the 
simulations, e.g. number of replicate simulations, treatments as changes
 in parameter values or initial states, etc. An experimental design can 
be specified by using standard designs, or by passing a design 
description file.</p>
</div>
<div class="paragraph">
<p>For more information on experimental designs for simulation 
experiments, we recommend reading the documentation of the R software <em>planor</em> and <em>mtk</em> packages (e.g. these packages could be used to generate design files for use in 3Worlds).</p>
</div>
<div class="paragraph">
<p><strong>[TO DO: OpenMole integration]</strong></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>design</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>This property specifies an experimental design for the simulation 
experiment. It only provides basic, standard experimental designs. For 
more elaborate or specialized designs, use an ad-hoc file description of
 the design (<code>file</code> property, <em>cf.</em> below)</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>singleRun</code>
</td>
<td class="hdlist2">
<p>an experiment consisting of a single simulation run (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>crossFactorial</code>
</td>
<td class="hdlist2">
<p>a cross-factorial experiment based on a limited set of parameter values (factors)</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>file</code>
</td>
<td class="hdlist2">
<p>This property gives the name of an experimental design file <strong>TODO&nbsp;: expand on this description</strong></p>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_experimental_treatments"><a class="anchor" href="#_experimental_treatments"></a>Experimental treatments</h5>
<div class="sect5">
<h6 id="_treatments"><a class="anchor" href="#_treatments"></a>Treatments</h6>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>treatment</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>An experimental treatment records a particular set of parameter 
values and initial state to run a simulation or a series of replicated 
simulations. It is the basic block of the experiment, just as in 
real-world experimentation.</p>
</div>
<div class="paragraph">
<p>Treatements may be specified</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in full detail: this is done by specifying more than one <code>system</code> node, each <code>system</code> being used for a different treatment;</p>
</li>
<li>
<p>as (minor) changes relative to the experiment <code>baseLine</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NB: not fully implemented yet</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="_treatments_as_changes_relative_to_baseline"><a class="anchor" href="#_treatments_as_changes_relative_to_baseline"></a>Treatments as changes relative to <em>baseLine</em></h6>
<div class="paragraph">
<p><code>/3worlds/experiment/treatment/<strong>modelChange</strong></code> {0..*}</p>
</div>
<div class="paragraph">
<p><strong>NB: not fully implemented yet</strong></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_managing_experiment_data"><a class="anchor" href="#_managing_experiment_data"></a>Managing experiment data</h5>
<div class="sect5">
<h6 id="_inputs_datasource"><a class="anchor" href="#_inputs_datasource"></a>Inputs: <em>dataSource</em></h6>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>dataSource</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node describes a source of data to use to instantiate a model: name of the data source, access method, etc.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dataSource</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>file</code>
</td>
<td class="hdlist2">
<p>A valid data file name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>A data format to use to read that file</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>CsvFileLoader</code>
</td>
<td class="hdlist2">
<p><a href="https://en.wikipedia.org/wiki/Comma-separated_values">comma separated value</a> <code>.csv</code> text file</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>OdfFileLoader</code>
</td>
<td class="hdlist2">
<p><a href="https://en.wikipedia.org/wiki/OpenDocument">OpenDocument</a> <code>.ods</code> spreadsheet</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>read</code>
</td>
<td class="hdlist2">
<p>(optional) A list of the column headers to read. Each column name must match a declared <code>field</code> (<a href="#truefield">[truefield]</a>) or <code>table</code> (<a href="#truetable">[truetable]</a>). If this property is absent or not set, all columns will be read.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>idLifeCycle</code>
</td>
<td class="hdlist2">
<p>(optional) Header of the column containing the <em>life cycle</em> names (instances of <a href="#truelife-cycle"><code>lifeCycleType</code></a>). If only this property is set, each row of the file/spreadsheet will be used to generate a different <em>life cycle</em> instance (with associated component container, constants, drivers and decorators). If it is used in conjunction with <code>idGroup</code> and/or <code>idComponent</code> (see below), it will be used to search for or create the proper <em>life cycle</em> container  in which to place the requested items (<em>groups</em> or <em>components</em>). Values of this property will become the life cycle instance unique identifiers. They must be consistently used across <code>dataSource</code> / <code>initialValues</code> nodes when initial items are constructed from more than one source.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>idGroup</code>
</td>
<td class="hdlist2">
<p>(optional) Header of the column containing the <em>group</em> names (instances of <a href="#truecomponent-group"><code>groupType</code></a>). If only this property is set, each row of the file/spreadsheet will be used to generate a different <em>group</em> instance (with associated component container, constants, drivers and decorators). If it used in conjunction with <code>idComponent</code> (see below), it will be used to search for or create the proper <em>group</em> container in which to place the requested <em>components</em>. Values of this property will become the group instance unique identifiers. They must be consistently used across <code>dataSource</code> / <code>initialValues</code> nodes when initial items are constructed from more than one source. If the <code>groupType</code> is declared as the child of a <code>lifeCycleType</code>, then the <code>idLifeCycle</code> property (cf. above) is also required, either in <code>dataSource</code> or <code>initialValues</code> nodes.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>idComponent</code>
</td>
<td class="hdlist2">
<p>(optional) Header of the column containing system <em>component</em> unique identifiers (instances of <a href="#truesystem-component"><code>componentType</code></a>). Every different value will generate a different <em>component</em>. Contrary to the two previous properties, the value is <em>not</em>
 used to generate the component instance identifier, which is 
specifically generated by 3Worlds. Nevertheless, they must be used 
consistently across <code>dataSource</code> / <code>initialValues</code> nodes when initial items are constructed from more than one source. If the <code>componentType</code> is declared as the child of a <code>groupType</code>, then the <code>idGroup</code> property (cf. above) is also required, either in <code>dataSource</code> or <code>initialValues</code> nodes.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dim</code>
</td>
<td class="hdlist2">
<p>(optional) A list of column headers containing dimension indices. 
This must only be present when other column headers refer to tables. 
When this property is present, every column name must match a declared <code>table</code> <a href="#truetable"><code>table</code></a> with as many dimensions as listed here, and compatible maximal index values.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>subclass = CsvFileLoader</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>separator</code>
</td>
<td class="hdlist2">
<p>the field separator used for this <code>.csv</code> file (default: tabulation <code>"\t"</code>)</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>subclass = OdfFileLoader</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>sheet</code>
</td>
<td class="hdlist2">
<p>the name of the spreadsheet to load from this <code>.ods</code> file (different spreadsheets in the same <code>.ods</code> file must be specified as different <code>dataSource</code> nodes). If this property is absent or not set, the first spreadsheet will be loaded.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>.csv</code> and <code>.ods</code> file formats both assume the 
data come in 2 dimensional tables with cross-references between the 
tables. Table columns must match parameter and driver field or table 
names. Table rows must match species, stage or system component 
instances.</p>
</div>
<div class="paragraph">
<p>The following rules must be respected when preparing the data files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data must not contain any missing value or structural empty cells.</p>
</li>
<li>
<p>Empty lines are permitted (they are skipped).</p>
</li>
<li>
<p>Text data must not be quoted.</p>
</li>
<li>
<p>The first data line of any file or spreadsheet must contain column headers. They must match field names as defined under the <code>dataDefinition</code> node (<a href="#truethe-datadefinition-node">[truethe-datadefinition-node]</a>).</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_outputs_datasink"><a class="anchor" href="#_outputs_datasink"></a>Outputs: <em>dataSink</em></h6>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>dataSink</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node describes a 'sink' where data resulting from simulation output is to be stored for later processing by other software.</p>
</div>
<div class="paragraph">
<p><strong>[Not yet implemented]</strong></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dataSink</code></p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>file</code>
</td>
<td class="hdlist2">
<p>A valid data file name</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>dataSink</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>source → dataTracker:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link the origin of the data to save into the sink. Usually, a  <a href="#truedata-tracking">data tracker</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_userinterface_node"><a class="anchor" href="#_the_userinterface_node"></a>3.3.7. The <em>userInterface</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>userInterface</strong>:&lt;<em>name</em>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree specifies the look of the <code>ModelRunner</code> user interface. <code>ModelRunner</code>
 is highly configurable and can show many graphs during a simulation 
run, as help when debugging a new model; or only show a progress bar to 
improve computing performance when running a big simulation experiment.</p>
</div>
<div id="fig-example-gui" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-gui.svg" alt="example gui" width="1000">
</div>
<div class="title">Figure 22. The ModelRunner graphical user interface.</div>
</div>
<div id="fig-example-gui-tree" class="imageblock right text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-gui-example-tree.png" alt="fig gui example tree" width="700">
</div>
<div class="title">Figure 23. The configuration sub-tree specifying the GUI of <a href="#fig-example-gui">Figure 22</a>.</div>
</div>
<div class="paragraph">
<p>3Worlds provides a series of <em>widgets</em>, i.e. classes that can 
manage output from the simulator and either show it graphically or 
perform some other non-graphic task (e.g. save data to disk). Examples 
of graphic widgets are: time series or scatter plots, simulation control
 buttons, progress bars, maps etc…​ The basic <code>ModelRunner</code> GUI just provides places to place widgets: a <em>top</em>, a <em>bottom</em> and any number of <em>tabs</em>. Any number of widgets can be placed within these (<a href="#fig-example-gui">Figure 22</a>, <a href="#fig-example-gui-tree">Figure 23</a>).</p>
</div>
<div class="paragraph">
<p><br></p>
</div>
<div class="sect4">
<h5 id="_top"><a class="anchor" href="#_top"></a>Top</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>top</strong>:&lt;<em>name</em>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This is a tool bar located at the top just below the menu bar. 
Widgets placed here will appear beside each other in an order specified 
in <code>ModelMaker</code> properties (<em>Order</em>). The top is 
typically a place where small widgets are added that remain accessible 
no matter where other widgets are placed. Typically a controller or 
progress widgets are placed here. Checks are made by <code>ModelMaker</code> to ensure only small widgets can be placed here (<a href="#fig-example-gui">Figure 22</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_bottom"><a class="anchor" href="#_bottom"></a>Bottom</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>bottom</strong>:&lt;<em>name</em>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>The <em>bottom</em> is a status bar located at the bottom of the main window. It has the same constraints as the <em>top</em>. Widgets such as a progress bar can be placed here if desired (<a href="#fig-example-gui">Figure 22</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_tabs_and_containers"><a class="anchor" href="#_tabs_and_containers"></a>Tabs and containers</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>tab</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/tab/<strong>container</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/…​/container/<strong>container</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>There can be any number of <em>Tabs</em> and each <em>Tab</em> can contain any number of widgets through the use of <em>containers</em>. <em>Tabs</em>
 are intended for large widgets such as charts and maps. Since only one 
tab is visible at a time when the model is run, large GUIs can be 
assembled without the limits imposed by window size (<a href="#fig-example-gui">Figure 22</a>).
<em>Tab</em> contents are structured as a binary tree made of a combination of widgets or containers of widgets. A <em>Tab</em> can have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or two widgets;</p>
</li>
<li>
<p>One widget and one container; or,</p>
</li>
<li>
<p>Two containers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Containers have the same constraints as tabs - i.e. each container can have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or two widgets;</p>
</li>
<li>
<p>One widget and one container; or,</p>
</li>
<li>
<p>Two containers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only widgets can be leaf nodes in this binary tree i.e you can’t have a container or tab that contains nothing.</p>
</div>
<div class="paragraph">
<p>The widget/container pairs in this binary tree can be arranged 
vertically or horizontally. This allows all possible arrangements of 
widgets in the GUI.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>tab</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>orientation</code>
</td>
<td class="hdlist2">
<p>This property specifies the way widgets and containers are placed: side by side or on top of each other</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>horizontal</code>
</td>
<td class="hdlist2">
<p>Display panel is split by a vertical spliter into two panels, first on left and second on right (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>vertical</code>
</td>
<td class="hdlist2">
<p>Display panel is split by a horizontal spliter into two panels, first above second</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>container</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>orientation</code>
</td>
<td class="hdlist2">
<p>This property specifies the way widgets and containers are placed: side by side or on top of each other</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>order</code>
</td>
<td class="hdlist2">
<p>Rank of placement in its container (smaller value: to the left/top; larger: to the right/bottom)</p>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_headless_ui"><a class="anchor" href="#_headless_ui"></a>Headless UI</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>headless</strong></code> {0..*}</p>
</div>
<div class="paragraph">
<p>If you want to run a simulation unattended, you may not need a GUI at
 all. Instead, you may want the simulation to begin immediately and use 
widgets to write data to disk. Such widgets are call <code>headless</code>. All headless widgets are children of the <code>gui:headless:</code> node.</p>
</div>
</div>
<div class="sect4">
<h5 id="_widgets"><a class="anchor" href="#_widgets"></a>Widgets</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/top/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/bottom/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/tab/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/…​/container/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/headless/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Widgets are the interesting part of the GUI configuration as they 
provide feedback and control of a simulation. A widget may be added as a
 child of <code>top</code>, <code>bottom</code>, <code>tab</code>, <code>container</code>  or <code>headless</code>  nodes.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>widget</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>order</code>
</td>
<td class="hdlist2">
<p>Rank of placement in its container (smaller value: to the left/top; larger: to the right/bottom)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>A widget class;</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>ControlWidget1</code>
</td>
<td class="hdlist2">
<p>A simple simulator controller with run/pause, step and reset buttons. Add this as a child of a <code>top</code> or <code>bottom</code> node. A GUI definition can only have one controller.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ControlWidget2</code>
</td>
<td class="hdlist2">
<p>As for <code>ControlWidget1</code>, but also displays the time taken 
to complete each simulation step and the total simulation time. These 
timings are only accurate when deploying a single simulation. They are 
not accurate when deploying multiple simulations. Therefore, this widget
 is best used when developing a model to check its performance. Use <code>ControlWidget1</code> otherwise.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ControlWidget3</code>
</td>
<td class="hdlist2">
<p>As for <code>ControlWidget2</code>, but displays a time series plot of simulation execution time. Add this widget as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ProgressWidget1</code>
</td>
<td class="hdlist2">
<p>A simple display of simulation time (average time if deploying 
multiple simulations) and stopping condition. Add this widget as a child
 of a <code>top</code> or <code>bottom</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ProgressWidget2</code>
</td>
<td class="hdlist2">
<p>A bar graph of simulation progress intended for use only when deploying multiple simulations. Add this widget as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ProgressWidget3</code>
</td>
<td class="hdlist2">
<p>As for <code>ProgressWidget2</code> but using a time series chart instead of a bar chart.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>TimeseriesWidget1</code>
</td>
<td class="hdlist2">
<p>A graph of <em>x<sub>i</sub></em> = <em>f</em>(<em>t</em>), where <em>x<sub>i</sub></em> are component descriptors and <em>t</em> is time.  Add as a child of a <code>tab</code> or <code>container</code> node. This widget uses the fast charting library from <a href="https://github.com/GSI-CS-CO/chart-fx">Chartfx</a>.
 The widget has a number of additional facilites accessed by moving the 
mouse to the top of the chart display. Here, data can be viewed as a 
table and exported to file. At the time of writing we have not found 
this feature very reliable (chartfx version 11.2.6). A better option to 
save time series data, is to use <code>HLExperimentWidget</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ScatterplotWidget1</code>
</td>
<td class="hdlist2">
<p>A graph of <em>y</em> = <em>f</em>(<em>x</em>) where <em>x</em> and <em>y</em> are two descriptors of a component.  Add as a child of a <code>tab</code> or <code>container</code> node. This widget also uses the fast charting library from <a href="https://github.com/GSI-CS-CO/chart-fx">Chartfx</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SpaceWidget1</code>
</td>
<td class="hdlist2">
<p>A map of a  <a href="#truethe-representation-of-space">space</a>.  Add as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>TableWidget1</code>
</td>
<td class="hdlist2">
<p>A table of number values <em>x<sub>i</sub></em>(<em>t</em>).  Add as a child of a <code>tab</code> or <code>container</code> node. Add as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MatrixWidget1</code>
</td>
<td class="hdlist2">
<p>A colour display of a 2-dimensional table. Add as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>GraphWidget1</code>
</td>
<td class="hdlist2">
<p>A display of the system graph. Add as a child of a <code>tab</code> or <code>container</code> node.  <strong>not yet implemented</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HLExperimentWidget1</code>
</td>
<td class="hdlist2">
<p>Saves data to file. Add as a child of a <code>headless</code> node. The data written depends on the experiment design. A <code>SingleRun</code> produces a time series of each simulator and an average of replicates. <code>CrossFactorial</code> experiments produce the results of an ANOVA and svg (<strong>TODO</strong>) files of each factor’s sensitivity. All statistical analysis uses <strong>R</strong>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HLSimpleControlWidget</code>
</td>
<td class="hdlist2">
<p>As <code>ControlWidget1</code>, but for unattended simulations. Add as a child of a <code>headless</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HLProgressWidget1</code>
</td>
<td class="hdlist2">
<p>Writes simulator progress to the console.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Many widgets have settings which can be adjusted from the <em>Widget</em> menu of <em>ModelRunner</em>. These settings are automatically saved to a preferences file when <em>ModelRunner</em> is closed thus preserving the look and feel of the interface between uses.</p>
</div>
<div class="sect5">
<h6 id="_additional_properties_for_widget_sub_classes"><a class="anchor" href="#_additional_properties_for_widget_sub_classes"></a>Additional properties for widget sub-classes</h6>
<div class="paragraph">
<p><em>for</em> <code>ProgressWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>refreshRate</code>
</td>
<td class="hdlist2">
<p>(optional) The rate at which this widget updates its display (ms) (<em>default</em>
 250 ms). This property is for the purpose of efficiency. Because this 
widget can display the average progress of a very large number of 
simulations (e.g 1 million parallel simulations), it would be very 
inefficient, not to mention uninformative, if the display was updated 
every time any one of the simulators sent a message.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>for</em> <code>TimeSeriesWidget1</code> <em>and</em> <code>TableWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>nSenders</code>
</td>
<td class="hdlist2">
<p>(optional) The number of parallel simulators to display (<em>default</em>
 1). As noted, there can be far too many simulators to reasonably 
display their output. In such cases, this property limits that number to
 whatever you think you can handle.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>firstSender</code>
</td>
<td class="hdlist2">
<p>(optional) The lowest sender (simulator id) to display (<em>default</em>
 0). Output from simulators is shown for contiguously numbered 
simulators. This property sets the lowest number from which to display <em>n</em> simulator outputs.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>for</em> <code>TimeSeriesWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>maxAxes</code>
</td>
<td class="hdlist2">
<p>Sets the maximum number of <em>y</em> axes to display on the chart. 
As this widget can show time series for any number of variables, it is 
important to assign them to their own axis. However, if you have so too 
many outputs the chart will be all axes and no data. There, the number 
of axes can be constrained with this property.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bufferSize</code>
</td>
<td class="hdlist2">
<p>Number of time intervals to plot on the time axis, e.g. a value of 
100 will display times 900-1000 when reaching time 1000. That is, what 
you see is a rolling buffer of data.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>for</em> <code>SpaceWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>nViews</code>
</td>
<td class="hdlist2">
<p>This widget records data produced from any number of simulators. 
However, its often unreasonable to view every one of what may be a very 
large number. However, being able to visually compare independent 
parallel simulations is useful. This setting allows more than one (at 
the moment this is unlimited) view. A drop-down list for each view 
allows you to select which data set to display.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_additional_cross_links_for_widget_sub_classes"><a class="anchor" href="#_additional_cross_links_for_widget_sub_classes"></a>Additional cross-links for widget sub-classes</h6>
<div class="paragraph">
<p><em>for</em> <code>ControlWidget2</code>, <code>ControlWidget3</code>, <code>ProgressWidget1</code>  <em>and</em> <code>ProgressWidget2</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackTime → dynamics:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <em>dynamics</em> system the widget is listening to.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>for</em> <code>TimeSeriesWidget1</code>, <code>TableWidget1</code> <em>and</em>  <code>HLSimpleTimeSeriesWidget</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackSeries → dataTracker:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <code>dataTracker</code> the widget is listening to.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>for</em> <code>SpaceWidget1</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackSpace → space:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <code>space</code> the widget is listening to.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>for</em> <code>GraphWidget1</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackSystem → system:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <code>system</code> the widget is listening to</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_predefined_sub_tree"><a class="anchor" href="#_the_predefined_sub_tree"></a>3.3.8. The <em>predefined</em> sub-tree</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>predefined:*categories</strong>*</code> {1}</p>
</div>
<div class="paragraph">
<p>This sub-tree is not editable. It specifies predefined categories, 
relation types and automatic variables that are used in any 3Worlds 
model in assocation with particular objects in the simulator. During the
 setup of a configuration, ModelMaker will sometimes request you to link
 some of your nodes to items found in this hierarchy.</p>
</div>
<div class="paragraph">
<p>Predefined categories are grouped in 3 <code>categorySet</code>s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>*systemElements*</code> represent hierarchical levels in the system:</p>
<div class="ulist">
<ul>
<li>
<p><code>*arena*</code> is a category attached to the whole system</p>
</li>
<li>
<p><code>*component*</code> is a category attached to any system component</p>
</li>
<li>
<p><code>*group*</code> is a category attached to any group of system components</p>
</li>
<li>
<p><code>*life cycle*</code> is a category attached to any life cycle</p>
</li>
<li>
<p><code>*relation*</code> is currently not in use</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>*organisation*</code> represent levels of organisation in the system:</p>
<div class="ulist">
<ul>
<li>
<p><code>*atomic*</code>, is a category attached to single, individable (hence <em>atomic</em>), components</p>
</li>
<li>
<p><code>*assemblage*</code> is a category attached to populations of components. Members of this category have the following automatic variables:</p>
<div class="ulist">
<ul>
<li>
<p><code>count</code>, the population size</p>
</li>
<li>
<p><code>nAdded</code>, the number of components added to the population during the last simulation step</p>
</li>
<li>
<p><code>nRemoved</code>, the number of components removed from the population during the last simulation step</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>*atomic*</code> is a category attached to elementary (atomic) components that cannot be further divided</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>*lifespan*</code> represent the lifespan of a component in the system:</p>
<div class="ulist">
<ul>
<li>
<p><code>*permanent*</code>, is a category for components that stay forever</p>
</li>
<li>
<p><code>*ephemeral*</code>, is a category for components that can be 
created or deleted during a simulation.Members of this category have the
 following automatic variables:</p>
<div class="ulist">
<ul>
<li>
<p><code>age</code>, the age of the component</p>
</li>
<li>
<p><code>birthDate</code>, the simulation time when this component was created.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two predefined relation types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>*parentTo*: *component* → *component*</code> may be used to relate a component to its offspring, i.e. it enables to track genealogic links between components (see the <code>CreateOtherDecision</code> <a href="#truefunction">function</a>).</p>
</li>
<li>
<p><code>*returnsTo*: *component* → *component*</code> is not yet in use.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="_developing_and_testing_model_code"><a class="anchor" href="#_developing_and_testing_model_code"></a>3.4. Developing and testing model code</h3>
<div class="paragraph">
<p>A model of an ecological system in 3Worlds consists in a <em>configuration file</em> constructed with the <code>ModelMaker</code> application (<a href="#trueconfiguration-reference-creating-and-editing-a-model-with-modelmaker">[trueconfiguration-reference-creating-and-editing-a-model-with-modelmaker]</a>) and <em>java code files</em> that must be edited by the end-user, here a modeller. Some basic knowledge of <a href="https://en.wikiversity.org/wiki/Java_Programming/Introduction">java</a> is required before going on here.</p>
</div>
<div class="sect3">
<h4 id="_generated_code_the_model_main_class"><a class="anchor" href="#_generated_code_the_model_main_class"></a>3.4.1. Generated code: the <em>model main class</em></h4>
<div class="paragraph">
<p>During the specification of a model, ModelMaker generates java 
classes meant to be further edited in order to implement the specific 
behaviours imagined by the modeller. Among these classes, one is meant 
to be edited; the others are interface code, that you can see as 
'glueing' code between the 3Worlds main code and the user-defined one. 
The file to be edited is named after the 3Worlds root node of the 
specification file (<a href="#truethe-3worlds-node">[truethe-3worlds-node]</a>): e.g., if your 3Worlds node has the name <code>myModel</code>, the java file to edit will be called <code>MyModel.java</code>. In what follows, we call it the <em>model main class</em>.</p>
</div>
<div id="fig-idhClock-functions" class="imageblock left text- thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-functions-IDH.png" alt="fig functions IDH" width="700">
</div>
<div class="title">Figure 24. The functions defined in the model of the IDHClock tutorial.</div>
</div>
<div class="paragraph">
<p>This section gives general rules to follow to successfully edit the generated <em>model main class</em> in order for your model to behave as you wish. <a href="#truesetting-up-a-java-development-environment-for-the-user-code">[truesetting-up-a-java-development-environment-for-the-user-code]</a> describes how to link your <code>ModelMaker</code> session with an eclipse development environment where you can edit the generated <em>model main class</em>. It is important to read about  <a href="#truefunction">functions</a> before starting writing your code, in order to master all the options you can setup in <code>ModelMaker</code> to specify your function.</p>
</div>
<div class="paragraph">
<p>For each <code>function</code> node of the specification, you will find one static method with the same name in the <em>model main class</em>. For example, the <strong>IDHClock</strong> tutorial (<a href="#truetutorial-4-elaborating-the-model-structure-testing-the-intermediate-disturbance-hypothesis">[truetutorial-4-elaborating-the-model-structure-testing-the-intermediate-disturbance-hypothesis]</a>) specifies 3 functions, 2 initFunctions and 2 data trackers (<a href="#fig-idhClock-functions">Figure 24</a>).</p>
</div>
<div class="paragraph">
<p>This generates a <em>model main class</em> with corresponding methods (code stripped of its javadoc comments):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">code.sys1</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.Math</span>.*;
<span class="keyword">import</span> <span class="include">au.edu.anu.rscs.aot.collections.tables.DoubleTable</span>;
<span class="keyword">import</span> <span class="include">au.edu.anu.twcore.ecosystem.runtime.biology.DecisionFunction</span>;
<span class="keyword">import</span> <span class="include">java.util.Random</span>;
<span class="keyword">import</span> <span class="include">code.sys1.generated</span>.*;
<span class="comment">// Hey, model developer! You may add your own imports here as needed</span>

<span class="directive">public</span> <span class="type">interface</span> <span class="class">IdhClock1</span> {

        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> distEffectsComm(
                <span class="type">double</span> t,                             <span class="comment">// current time</span>
                <span class="type">double</span> dt,                            <span class="comment">// current time step</span>
                <span class="type">int</span> count,                            <span class="comment">// whole system autoVar count (#) ϵ[0..*]</span>
                <span class="type">int</span> nAdded,                           <span class="comment">// whole system autoVar nAdded (#) ϵ[0..*]</span>
                <span class="type">int</span> nRemoved,                         <span class="comment">// whole system autoVar nRemoved (#) ϵ[0..*]</span>
                <span class="type">double</span> freq,                          <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
                <span class="type">double</span> inten,                         <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable other_x,                  <span class="comment">// other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                DistEffectsComm.OtherDrv otherDrv,    <span class="comment">// next drivers for other component</span>
                <span class="type">double</span> other_div,                     <span class="comment">// other component decorators  ± 0.0 ϵ]-∞,+∞[</span>
                DistEffectsComm.OtherDec otherDec,    <span class="comment">// new decorators for other component</span>
                DoubleTable other_K,                  <span class="comment">// other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable other_alpha,              <span class="comment">// other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable other_r,                  <span class="comment">// other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                <span class="predefined-type">Random</span> random) {                      <span class="comment">// random number generator</span>
        <span class="comment">// distEffectsComm ---- Code insert Begin--&gt;</span>
        <span class="comment">// distEffectsComm ---- Code insert End----&lt;</span>
        }

        <span class="directive">public</span> <span class="directive">static</span> <span class="type">boolean</span> distOccurrence(
                <span class="type">double</span> t,                             <span class="comment">// current time</span>
                <span class="type">double</span> dt,                            <span class="comment">// current time step</span>
                <span class="type">int</span> count,                            <span class="comment">// whole system autoVar count (#) ϵ[0..*]</span>
                <span class="type">int</span> nAdded,                           <span class="comment">// whole system autoVar nAdded (#) ϵ[0..*]</span>
                <span class="type">int</span> nRemoved,                         <span class="comment">// whole system autoVar nRemoved (#) ϵ[0..*]</span>
                <span class="type">double</span> freq,                          <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
                <span class="type">double</span> inten,                         <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable other_x,                  <span class="comment">// other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                <span class="type">double</span> other_div,                     <span class="comment">// other component decorators  ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable other_K,                  <span class="comment">// other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable other_alpha,              <span class="comment">// other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable other_r,                  <span class="comment">// other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                <span class="predefined-type">Random</span> random,                        <span class="comment">// random number generator</span>
                DecisionFunction decider) {           <span class="comment">// decision function</span>
        <span class="comment">// distOccurrence ---- Code insert Begin--&gt;</span>
        <span class="comment">// distOccurrence ---- Code insert End----&lt;</span>
        }

        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> initDist(
                <span class="type">double</span> freq,                          <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
                <span class="type">double</span> inten,                         <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
                InitDist.FocalCnt focalCnt,           <span class="comment">// new constants for focal component</span>
                <span class="predefined-type">Random</span> random) {                      <span class="comment">// random number generator</span>
        <span class="comment">// initDist ---- Code insert Begin--&gt;</span>
        <span class="comment">// initDist ---- Code insert End----&lt;</span>
        }

        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> commGrowth(
                <span class="type">double</span> t,                             <span class="comment">// current time</span>
                <span class="type">double</span> dt,                            <span class="comment">// current time step</span>
                <span class="type">int</span> count,                            <span class="comment">// whole system autoVar count (#) ϵ[0..*]</span>
                <span class="type">int</span> nAdded,                           <span class="comment">// whole system autoVar nAdded (#) ϵ[0..*]</span>
                <span class="type">int</span> nRemoved,                         <span class="comment">// whole system autoVar nRemoved (#) ϵ[0..*]</span>
                DoubleTable x,                        <span class="comment">// focal component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                CommGrowth.FocalDrv focalDrv,         <span class="comment">// next drivers for focal component</span>
                <span class="type">double</span> div,                           <span class="comment">// focal component decorators  ± 0.0 ϵ]-∞,+∞[</span>
                CommGrowth.FocalDec focalDec,         <span class="comment">// new decorators for focal component</span>
                DoubleTable K,                        <span class="comment">// focal component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable alpha,                    <span class="comment">// focal component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable r,                        <span class="comment">// focal component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                <span class="predefined-type">Random</span> random) {                      <span class="comment">// random number generator</span>
        <span class="comment">// commGrowth ---- Code insert Begin--&gt;</span>
        <span class="comment">// commGrowth ---- Code insert End----&lt;</span>
        }

        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> initComm(
                DoubleTable x,                        <span class="comment">// focal component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                InitComm.FocalDrv focalDrv,           <span class="comment">// next drivers for focal component</span>
                <span class="type">double</span> div,                           <span class="comment">// focal component decorators  ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable K,                        <span class="comment">// focal component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable alpha,                    <span class="comment">// focal component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[</span>
                DoubleTable r,                        <span class="comment">// focal component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
                InitComm.FocalCnt focalCnt,           <span class="comment">// new constants for focal component</span>
                <span class="predefined-type">Random</span> random) {                      <span class="comment">// random number generator</span>
        <span class="comment">// initComm ---- Code insert Begin--&gt;</span>
        <span class="comment">// initComm ---- Code insert End----&lt;</span>
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, you can see that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the package name <code>code.sys1</code> is constructed from the name of the <code>system</code> node (<a href="#fig-idhClock-functions">Figure 24</a>);</p>
</li>
<li>
<p>the interface name <code>IdhClock1</code> is constructed from the name of the <code>3Worlds</code> node (<a href="#fig-idhClock-functions">Figure 24</a>);</p>
</li>
<li>
<p>each method name is constructed from a matching <code>function</code> or <code>initFunction</code> node (<a href="#fig-idhClock-functions">Figure 24</a>).</p>
</li>
<li>
<p>the argument lists are partly constructed from the <code>categories</code> the <code>process</code> declaring the <code>function</code> applies to;</p>
</li>
<li>
<p>the comments documenting the method arguments are constructed from the <code>field</code> or <code>table</code> node properties (<code>description</code>, <code>precision</code>, <code>interval</code>, <code>units</code>, etc.).</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not neglect these metadata: coding errors due to discrepancies in 
measurement units between equations are frequent and yield wrong 
computation results that are difficult to trace. Most publicly available
 model code does not document the units, and hence is not easily 
re-usable.
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When ModelRunner is launched on the IDHClock tutorial model, it will include the generated <code>IdhClock1</code>
 class and call each of its methods for all system components they are 
dealing with as specified in the model configuration file.</p>
</div>
<div class="paragraph">
<p>As you can see in this example, the body of each method is empty, only containing two comments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="comment">// initComm ---- Code insert Begin--&gt;</span>
        <span class="comment">// initComm ---- Code insert End----&lt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the <em>code insertion markers</em>. The user-defined code must be inserted between these two lines.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Never remove the <em>code insertion markers</em> as they are used by 3Worlds when using code <a href="#truefunction">snippets</a> (as in all tutorial and test models).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As <em>model main class</em> is a java <em><strong>interface</strong></em>,
 all data is passed as arguments to its static methods. As you can see 
in the example above, there may be many arguments. If you look closely, 
you will see that these arguments match the <em>descriptors</em> that were attached to the <em>categories</em> to which the <em>processes</em> apply. All this information is provided in the <em>model main class</em> as javadoc comments. For example, the javadoc comment of the <code>commGrowth</code> method above produces this output:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-javadoc-idhclock.png" alt="fig javadoc idhclock">
</div>
</div>
<div class="paragraph">
<p>This comment recalls the categories to which the <code>commGrowth</code>
 method applies, which timer it follows and which time units it uses, 
and any other useful information like precedence between methods as 
specified by <code>dependsOn</code> cross-links between processes.</p>
</div>
<div class="paragraph">
<p>Finally, the <em>model main class</em> itself has a general javadoc description that gives some information about how to insert useful code into its methods:</p>
</div>
<div class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-javadoc-idhclock2.png" alt="fig javadoc idhclock2">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_model_main_class_method_arguments"><a class="anchor" href="#_model_main_class_method_arguments"></a>3.4.2. <em>Model main class</em> method arguments</h4>
<div class="paragraph">
<p>The list of arguments of each method is defined by its <a href="#truefunction">function type</a>,
 the organisation level to which it applies (system, life cycle, group 
or component), the categories or relation types it applies to, and the 
user-defined data structures attached to these. Some arguments are 
read-only, others are writeable so that computation output can be passed
 back to the 3Worlds main code.</p>
</div>
<div class="sect4">
<h5 id="_read_only_arguments"><a class="anchor" href="#_read_only_arguments"></a>Read-only arguments</h5>
<div class="sect5">
<h6 id="_arguments_present_for_all_functions_and_initfunctions"><a class="anchor" href="#_arguments_present_for_all_functions_and_initfunctions"></a>Arguments present for all <em>functions</em> and <em>initFunctions</em></h6>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>random</code>
</td>
<td class="hdlist2">
<p>The <a href="#truerandom-number-channels">random number generator channel</a> associated to this function. For details of how to use an instance of class <code>java.util.Random</code>, see the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Random.html">javadoc</a> for this class. Most of the time, you will be calling <code>random.nextDouble()</code> which returns a random double value between 0.0 and 1.0.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_arguments_present_for_all_functions_but_not_for_initfunctions"><a class="anchor" href="#_arguments_present_for_all_functions_but_not_for_initfunctions"></a>Arguments present for all <em>functions</em> but not for <em>initFunctions</em></h6>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>t</code>
</td>
<td class="hdlist2">
<p>the <em>current time</em> passed by the simulator as a double value in units of the <code>timer</code> of the parent <code>process</code> of the <code>function</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dt</code>
</td>
<td class="hdlist2">
<p>the <em>current time step</em>, passed by the simulator as a double value in units of the <code>timer</code> of the parent <code>process</code> of the <code>function</code>.</p>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
In the case of multiple timers, for <code>ClockTimers</code>, the current time step may be different from the timer’s <code>dt</code> property because it is the time since last simulator iteration, which may have been triggered by a different timer.
</td>
</tr>
</tbody></table>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_arguments_present_for_all_decision_functions"><a class="anchor" href="#_arguments_present_for_all_decision_functions"></a>Arguments present for all <em>'decision' functions</em></h6>
<div class="paragraph">
<p>'Decision' functions are: <code>ChangeCategoryDecision</code>, <code>DeleteDecision</code>, <code>CreateOtherDecision</code>, <code>RelateToDecision</code> and <code>MaintainRelationDecision</code>. They all return a result that is a decision: a number of components to create (<code>CreateOtherDecision</code>), the name of a category (<code>ChangeCategoryDecision</code>), or a boolean (all others).</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>decider</code>
</td>
<td class="hdlist2">
<p>This argument of class <code>DecisionFunction</code> <strong>[TODO: ref to javadoc]</strong> is provided as a helper for transforming probabilities into decisions. This class comprises only one method <code>decide(…​)</code> which given a probability, returns a <code>boolean</code>. More precisely: it returns <code>true</code> with the probability passed as argument, ie <code>decider.decide(0.7)</code> will return <code>true</code> in 7 calls out of 10. It uses the function random number generator (the <code>random</code> argument) to make the decision. Technically, this is the realisation of a <a href="https://en.wikipedia.org/wiki/Bernoulli_distribution">Bernouilli distribution</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>selector</code>
</td>
<td class="hdlist2">
<p>This argument is only present for the <code>ChangeCategoryDecision</code> function type. The <code>SelectionFunction</code> class <strong>[TODO: ref to javadoc]</strong>, of which it is an instance, only has one method <code>select(…​)</code> which, given a list of weights <em>w</em>, returns an integer <em>i</em> with probability <em>w</em>[<em>i</em>]/Σ<em><sub>i</sub></em><em>w</em>[<em>j</em>], i.e. a realisation of a single trial of a <a href="https://en.wikipedia.org/wiki/Multinomial_distribution">multinomial distribution</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>recruit</code>
</td>
<td class="hdlist2">
<p>This argument is only present for the <code>ChangeCategoryDecision</code> function type. The <code>RecruitFunction</code> class <strong>[TODO: ref to javadoc]</strong>, of which it is an instance, has one method <code>transition(…​)</code> which returns a category name (<code>String</code>), or <code>null</code> if the component does not change category. It’s argument is either a <code>boolean</code> or an <code>int</code>, typically the result of a call to <code>selector.select(…​)</code> or <code>decider.decide(…​)</code>. Example of use:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> recruitSeedling(
    <span class="type">double</span> group_recruitRate,
    ...
    Random random,                        <span class="comment">// random number generator</span>
    DecisionFunction decider,             <span class="comment">// decision function</span>
    SelectionFunction selector,           <span class="comment">// selection function</span>
    RecruitFunction recruit) {            <span class="comment">// recruitment function</span>

    <span class="keyword">return</span> recruit.transition(decider.decide(group_recruitRate));
}</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_arguments_that_represent_a_component_in_function_types_which_process_applies_to_categories"><a class="anchor" href="#_arguments_that_represent_a_component_in_function_types_which_process_applies_to_categories"></a>Arguments that represent a component in function types which process applies to categories</h6>
<div class="paragraph">
<p>These function types are <code>ChangeCategoryDecision</code>, <code>ChangeState</code>, <code>DeleteDecision</code>, <code>CreateOtherDecision</code>, and <code>SetInitialState</code>.</p>
</div>
<div class="paragraph">
<p>Internally, the system component which is the target of such functions is called <em>focal</em>.</p>
</div>
<div class="paragraph">
<p>The argument list will contain all the fields and tables declared in 
the root record of the descriptors (drivers, automatic variables, 
constants and decorators) of the <em>focal</em> component. The argument comments will indicate that these arguments are descriptors of the <em>focal</em> component, as in this example from the <strong>IDHClock</strong> tutorial for a function of type <code>SetInitialState</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> initComm(
    DoubleTable x,                        <span class="comment">// focal component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> div,                           <span class="comment">// focal component decorators  ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable K,                        <span class="comment">// focal component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable alpha,                    <span class="comment">// focal component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable r,                        <span class="comment">// focal component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    <span class="predefined-type">Random</span> random) {                      <span class="comment">// random number generator</span>
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_arguments_that_represent_the_two_components_of_a_relation_in_function_types_which_process_applies_to_relation_types"><a class="anchor" href="#_arguments_that_represent_the_two_components_of_a_relation_in_function_types_which_process_applies_to_relation_types"></a>Arguments that represent the two components of a relation in function types which process applies to relation types</h6>
<div class="paragraph">
<p>These function types are <code>ChangeOtherState</code>, <code>ChangeRelationState</code>, <code>MaintainRelationDecision</code>, <code>RelateToDecision</code>, and <code>SetOtherInitialState</code>.</p>
</div>
<div class="paragraph">
<p>These functions apply to a pair of components linked by a relation. 
The first of these components (the one at the 'from' end of the 
relation) is called <em>focal</em>, as before. The second one (the one at the 'to' end of the relation) is called <em>other</em>.</p>
</div>
<div class="paragraph">
<p>To distinguish the descriptors of <em>other</em> from those of <em>focal</em> (since these might belong to the same categories and hence have the same descriptors), all the descriptors of <em>other</em> are prefixed with 'other_', as in this example from the <strong>IDHClock</strong> tutorial for a function of <code>ChangeOtherState</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> distEffectsComm(
    <span class="type">double</span> t,                             <span class="comment">// current time</span>
    <span class="type">double</span> dt,                            <span class="comment">// current time step</span>
    <span class="type">double</span> freq,                          <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> inten,                         <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable other_x,                  <span class="comment">// other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> other_div,                     <span class="comment">// other component decorators  ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable other_K,                  <span class="comment">// other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable other_alpha,              <span class="comment">// other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable other_r,                  <span class="comment">// other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    <span class="predefined-type">Random</span> random) {                      <span class="comment">// random number generator    ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_arguments_that_represent_the_local_context_of_a_component"><a class="anchor" href="#_arguments_that_represent_the_local_context_of_a_component"></a>Arguments that represent the local context of a component</h6>
<div class="paragraph">
<p>The local context of a component is the part of the system it always sees. The dynamic graph of a simulated system in 3Worlds <strong>always</strong> has:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an object representing the whole system,  called the <em>arena</em> ('the place where things happen': <a href="https://doi.org/10.1007%2Fs10021-011-9466-2">Gignoux et al. 2011</a>). As 3Worlds uses a dynamic graph to represent the whole system (<a href="#truethe-complex-system-as-a-dynamic-graph">[truethe-complex-system-as-a-dynamic-graph]</a>), this object actually represents the whole graph. It matches the <a href="#truethe-system-node"><em>system</em></a> node in the configuration graph of the <code>.ugt</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And it <strong>may</strong> (0..* multiplicity) have the following other kinds of nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>objects representing the individual entities of the system, which are nodes in the dynamic graph and are just called <a href="#truesystem-components"><em>components</em></a>.</p>
</li>
<li>
<p>objects that represent the common properties of a group of components, which are called <a href="#truecomponent-groups"><em>groups</em></a>.</p>
</li>
<li>
<p>objects that represent the transitions that can occur during the life of a component, and are therefore called <a href="#true-life-cycle"><em>life cycles</em></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These four types of objects may belong to <em>categories</em> and have <em>descriptors</em>, and as a consequence can be passed to <em>functions</em> of a <em>process</em> referencing their categories.</p>
</div>
<div class="paragraph">
<p>With regard to processes and functions, these objects are treated like components, except they cannot establish <em>relations</em>;
 only true components can. This limits the set of functions compatible 
with them: groups, life cycles and the arena can only be affected by <code>ChangeState</code>,
<code>SetInitialState</code> and <code>CreateOtherDecision</code> (not life cycles) function types. When these functions apply to the categories of a <code>group</code>, <code>lifeCycle</code> or <code>Arena</code> object, they are treated as components above, i.e. they become the <em>focal</em> 'component' of the user-defined methods.</p>
</div>
<div class="paragraph">
<p>The arena, groups and life cycles play a particular role in the 
dynamic graph, as indicated by their names. They also have implicit, 
'ontological' relations with system components: a component always knows
 about its group, life cycle, and arena because they describe part of 
its own behaviour. As such, they are always accessible as arguments in 
the function calls of any component.</p>
</div>
<div class="paragraph">
<p>Just as for the <em>other</em> component above, the descriptors of 
arena, life cycles and groups are prefixed when they appear in a method 
argument list, with a comment giving more information on the argument, 
as in this example from the <strong>Palms</strong> show-case model for a function of <code>CreateOtherDecision</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">double</span> reproduction(
    <span class="type">double</span> t,                             <span class="comment">// current time</span>
    <span class="type">double</span> dt,                            <span class="comment">// current time step</span>
    <span class="type">int</span> count,                            <span class="comment">// whole system autoVar count (#) ϵ[0..*]</span>
    <span class="type">int</span> nAdded,                           <span class="comment">// whole system autoVar nAdded (#) ϵ[0..*]</span>
    <span class="type">int</span> nRemoved,                         <span class="comment">// whole system autoVar nRemoved (#) ϵ[0..*]</span>
    <span class="type">int</span> lifeCycle_count,                  <span class="comment">// focal life cycle autoVar count (#) ϵ[0..*]</span>
    <span class="type">int</span> lifeCycle_nAdded,                 <span class="comment">// focal life cycle autoVar nAdded (#) ϵ[0..*]</span>
    <span class="type">int</span> lifeCycle_nRemoved,               <span class="comment">// focal life cycle autoVar nRemoved (#) ϵ[0..*]</span>
    <span class="type">int</span> group_count,                      <span class="comment">// focal group autoVar count (#) ϵ[0..*]</span>
    <span class="type">int</span> group_nAdded,                     <span class="comment">// focal group autoVar nAdded (#) ϵ[0..*]</span>
    <span class="type">int</span> group_nRemoved,                   <span class="comment">// focal group autoVar nRemoved (#) ϵ[0..*]</span>
    <span class="type">double</span> group_aGinc,                   <span class="comment">// focal group constants adult BudHeight growth coefficient (m yr-1) ± 0.01 ϵ[0.0,+∞[</span>
    <span class="type">double</span> group_aPdead,                  <span class="comment">// focal group constants Mortality : int ± 0.01 ϵ[0.0,1.0]</span>
    <span class="type">double</span> group_deadNbLeaves,            <span class="comment">// focal group constants Mortality : nbf slope ± 0.01 ϵ[0.0,1.0]</span>
    <span class="type">double</span> group_decay,                   <span class="comment">// focal group constants decay ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> group_dis,                     <span class="comment">// focal group constants dispersal parameter ± 0.001 ϵ[0.0,1.0]</span>
    <span class="type">double</span> group_fec,                     <span class="comment">// focal group constants fecundity * # leaves ± 0.1 ϵ[0.0,+∞[</span>
    <span class="type">double</span> group_jPdNNeg,                 <span class="comment">// focal group constants Adult P(dN=-1) ± 0.01 ϵ[0.0,1.0]</span>
    <span class="type">double</span> group_remanence,               <span class="comment">// focal group constants seedling remanenc (y) ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> group_slrec0,                  <span class="comment">// focal group constants rect els to sls alive ± 0.01 ϵ[0.0,1.0]</span>
    <span class="type">double</span> group_slrec1,                  <span class="comment">// focal group constants rect els to sls dead ± 0.01 ϵ[0.0,1.0]</span>
    <span class="type">double</span> budHt,                         <span class="comment">// focal component currentState  ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">int</span> dead,                             <span class="comment">// focal component currentState dead ϵ[MIN_INTEGER..*]</span>
    <span class="type">double</span> nELSeedlings,                  <span class="comment">// focal component currentState Nb. EL seedlings ± 0.0 ϵ[0.0,+∞[</span>
    <span class="type">int</span> nleaves,                          <span class="comment">// focal component currentState nleaves ϵ[0..*]</span>
    <span class="type">double</span> neighbourhoodIndexAdults,      <span class="comment">// focal component decorators neighbourhoodIndexAdults ± 0.01 ϵ]-∞,+∞[</span>
    <span class="type">double</span> neighbourhoodIndexJuveniles,   <span class="comment">// focal component decorators neighbourhoodIndexJuveniles ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> neighbourhoodIndexMounds,      <span class="comment">// focal component decorators neighbourhoodIndexMounds ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> neighbourhoodIndexTrees,       <span class="comment">// focal component decorators neighbourhoodIndexTrees ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">boolean</span> sex,                          <span class="comment">// focal component constants female?</span>
    <span class="type">double</span> x,                             <span class="comment">// focal component constants x spatial coordinate (m) ± 0.1 ϵ[0.0,300.0]</span>
    <span class="type">double</span> y,                             <span class="comment">// focal component constants y spatial coordinate (m) ± 0.1 ϵ[0.0,300.0]</span>
    <span class="predefined-type">Random</span> random,                        <span class="comment">// random number generator</span>
    DecisionFunction decider) {           <span class="comment">// decision function</span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code generator decides which arguments must be made available to a method based on this hierarchy: <strong>arena &gt; life cycle &gt; group &gt; component</strong>.
 When the method applies to a component, then all four hierarchical 
levels are accessible; when it applies to a group, only arena and life 
cycle descriptors are available, and the group arguments are treated as 
the <em>focal</em> 'component'.</p>
</div>
</div>
<div class="sect5">
<h6 id="_space_data"><a class="anchor" href="#_space_data"></a>Space data</h6>
<div class="paragraph">
<p>When a space is attached to a <a href="#trueprocess">process</a> through a <code>inSpace</code> cross-link, the following argument is added to the method list:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>limits</code>
</td>
<td class="hdlist2">
<p>The limits of the space used with this process. This is an immutable object of class <code>Box</code> <strong>[TO DO: link to javadoc]</strong>. It returns the coordinates of the lower and upper ends of the space in all its dimensions through the <code>limits.lowerBound(int i)</code> and <code>limits.upperBounds(int i)</code> methods, where <code>i</code> is the dimension index.</p>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_writeable_arguments_and_method_return_values"><a class="anchor" href="#_writeable_arguments_and_method_return_values"></a>Writeable arguments and method return values</h5>
<div class="paragraph">
<p>User-defined functions are meant to modify the state of the graph, 
which technically means induce changes in descriptor values and 
creation/deletion of graph elements, namely components and relations. 
This cannot be done with read-only arguments.</p>
</div>
<div class="sect5">
<h6 id="_method_return_values"><a class="anchor" href="#_method_return_values"></a>Method return values</h6>
<div class="paragraph">
<p><a href="#truearguments-present-for-all-decision-functions">Decision functions</a> all have return values that are interpreted as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">function type</th>
<th class="tableblock halign-left valign-top">return type</th>
<th class="tableblock halign-left valign-top">return value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ChangeCategoryDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code> or a new <code>Category</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DeleteDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if <em>focal</em> is to be deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CreateOtherDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the number of new components to create; the decimal part is interpreted as a probability to create an extra component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RelateToDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if <em>other</em> is to be related to <em>focal</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MaintainRelationDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the existing relation between <em>focal</em> and <em>other</em> is maintained</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>They all have <a href="#truearguments-present-for-all-decision-functions">read-only helper arguments</a>. Example from the <strong>IDHClock</strong> tutorial for a <code>RelateToDecision</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">boolean</span> distOccurrence(
    <span class="type">double</span> t,                             <span class="comment">// current time</span>
    <span class="type">double</span> dt,                            <span class="comment">// current time step</span>
    ...
    double freq,                          <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
    ...
    Random random,                        <span class="comment">// random number generator</span>
    DecisionFunction decider) {           <span class="comment">// decision function</span>
    <span class="comment">// distOccurrence ---- Code insert Begin--&gt;</span>
    <span class="keyword">return</span> decider.decide(<span class="float">1.0</span>/freq);
    <span class="comment">// distOccurrence ---- Code insert End----&lt;</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_method_writeable_arguments"><a class="anchor" href="#_method_writeable_arguments"></a>Method writeable arguments</h6>
<div class="paragraph">
<p>Change/Set-State functions have the following writeable arguments as output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">function type</th>
<th class="tableblock halign-left valign-top">writeable arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>focal</em> constants &amp; drivers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>changeState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>focal</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decorators of <em>arena</em>, <em>life cycle</em> &amp; <em>group</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setOtherInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>other</em> drivers &amp; constants</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>ChangeOtherState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>other</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decorators of <em>arena</em>, <em>life cycle</em>, <em>group</em>, <em>other life cycle</em> &amp; <em>other group</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>ChangeRelationState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>focal</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>other</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decorators of <em>arena</em>, <em>life cycle</em>, <em>group</em>, <em>other life cycle</em> &amp; <em>other group</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These arguments appear in the argument list as specific inner classes instances with self-explained names: <code>focalDrv</code>, <code>focalCnt</code>, <code>focalDec</code>, <code>groupDec</code>, <code>groupCnt</code>, <code>arenaDrv</code>, <code>otherGroupDrv</code>,
 etc…​ Each of these arguments will contain the same fields as the 
original data structure it comes from. Any value set in these arguments 
will be carried back to the component when the method returns. For 
example, this is the generated code from the <strong>IDHClock</strong> tutorial for a function of type <code>ChangeOtherState</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> distEffectsComm(
    <span class="type">double</span> t,                             <span class="comment">// current time</span>
    <span class="type">double</span> dt,                            <span class="comment">// current time step</span>
    <span class="type">int</span> count,                            <span class="comment">// whole system autoVar count (#) ϵ[0..*]</span>
    <span class="type">int</span> nAdded,                           <span class="comment">// whole system autoVar nAdded (#) ϵ[0..*]</span>
    <span class="type">int</span> nRemoved,                         <span class="comment">// whole system autoVar nRemoved (#) ϵ[0..*]</span>
    <span class="type">double</span> freq,                          <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
    <span class="type">double</span> inten,                         <span class="comment">// focal component constants  ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable other_x,                  <span class="comment">// other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    DistEffectsComm.OtherDrv otherDrv,    <span class="comment">// next drivers for other component</span>
    <span class="type">double</span> other_div,                     <span class="comment">// other component decorators  ± 0.0 ϵ]-∞,+∞[</span>
    DistEffectsComm.OtherDec otherDec,    <span class="comment">// new decorators for other component</span>
    DoubleTable other_K,                  <span class="comment">// other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable other_alpha,              <span class="comment">// other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[</span>
    DoubleTable other_r,                  <span class="comment">// other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[</span>
    <span class="predefined-type">Random</span> random) {                      <span class="comment">// random number generator</span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the writeable arguments are <code>otherDrv</code> and <code>otherDec</code>. Both of them are of ad-hoc inner classes defined in the generated sub-directory of the eclipse project for <strong>IDHClock</strong> (file <code>DistEffectsComm.java</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">OtherDec</span> {
    <span class="directive">public</span> <span class="type">double</span> div;
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">OtherDrv</span> {
    <span class="directive">public</span> DoubleTable x;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, to set the <code>div</code> field of the <em>other</em> decorators to 3.2, simply write <code>otherDec.div=3.2;</code> in your method code.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
As you can see above, the writeable arguments are also present as read-only arguments.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You may also have noticed in the example above that the comment besides <code>otherDec</code> is <code>// <strong>new</strong> decorators for other component</code>, while that besides <code>otherDrv</code> is <code>// <strong>next</strong> drivers for other component</code>.
 What does this mean? Well, this is just a reminder that decorators and 
drivers are not handled in the same way by 3Worlds (cf. <a href="#truecategory">categories</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Decorator values</strong> are only valid within a time step 
and are immediately changed, which means that any method writing a 
decorator value will change it for all other methods called during the 
same time step. Hence the '<strong>new</strong>' adjective.</p>
</li>
<li>
<p><strong>Driver values</strong> are carried over to the next time 
step, and thus are subject to a synchronized modification. To keep all 
component states consistent, the read-only argument for drivers store 
the values that were set at the previous time step, i.e. they represent 
the <em>current</em> state of all components. When a modification of 
their value is computed, it is stored in the proper writeable argument 
that will be copied into a separate driver state representing the <em>next</em> state of the component. <em>This makes sure that all components within a time step are viewed by each other in the same, consistent state.</em> It is only after all methods on all components of the current time step have been called that 3Worlds will replace the <em>current</em> driver state with the <em>next</em> driver state. Hence the '<strong>next</strong>' adjective.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Forgetting about the difference of treatment between <em>decorators</em> and <em>drivers</em> can be the source of <strong>major</strong> but difficult to detect computation errors. Always know what you do!
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_space_in_user_code"><a class="anchor" href="#_using_space_in_user_code"></a>3.4.3. Using <em>space</em> in user code</h4>
<div class="paragraph">
<p>3Worlds assumes that an ecosystem representation can require a detailed description of zero, one or <em>many</em> <a href="#truethe-representation-of-space">spaces</a> (<a href="https://doi.org/10.1007%2Fs10021-011-9466-2">Gignoux et al. 2011</a>)
 - depending on the question addressed. It further assumes that a given 
space is best designed to suit the needs of one particular process, in 
other words, there is a 1..* relation between a space and various 
processes (a space can be used by many processes, but a process only 
uses one space). The relation between a process and a space is specified
 with the <code>inSpace</code> cross-link (see <a href="#trueprocess">processes</a>).</p>
</div>
<div class="paragraph">
<p>Spaces are used:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>to <em>locate</em> system components and help <em>compute geometric quantities</em> within their space. This is done by passing spatial data as arguments to all functions of a process having an <code>inSpace</code> link to a space (ie the <a href="#truespace-data">limits</a> argument). A component location in its space is given by the value of specific driver or constant descriptors (see <a href="#truespace-and-spatial-indexing">cross-links for space</a>). Any change in these coordinates will result in a movement of the component into this space.</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When component coordinates get out of the space limits, the selected <a href="#truespace-and-spatial-indexing"><em>edge effect correction</em></a>
 rules apply and will either result in the return of the component 
within space limits or its exclusion from the model. This is done 
internally by 3Worlds just after the user method call, so that you don’t
 need to bother if your computed coordinates get out of range.
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>to optimise the search of candidate components to establish a relation with a <code>RelateToDecision</code> function. This is an old computing problem: how to find closest neighbours in a geometric space <em>efficiently</em>? It has been solved long ago by using <a href="https://en.wikipedia.org/wiki/K-d_tree">Kd-trees</a>. Kd-trees are the most efficient algorithms to find nearest neighbours (<em>O(log(n)</em> time). In continuous spaces (cf. <a href="#true3worlds-library-of-spaces">space library</a>), 3Worlds uses Kd-trees to search for closest neighbour first to establish relations. Depending on the property defined in the <code>inSpace</code> cross-link (<code>searchRadius</code> or <code>searchNeighbours</code>) 3Worlds will either present:</p>
<div class="ulist">
<ul>
<li>
<p>the list of all components found within <code>searchRadius</code> space units of the <em>focal</em> component; or</p>
</li>
<li>
<p>the list of the <code>searchNeighbours</code> first closest components found around the <em>focal</em> component;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>...to the <code>RelateToDecisionFunction</code>. In other words, the 
use of the space will restrict the number of candidates for establishing
 a relation by looping only on those <em>others</em> which are close enough to <em>focal</em>, using two different search methods.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Whenever you have to search for items to construct relations, associate a
 space to your process, it will make computations far more efficient.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_accessing_complex_data_structure"><a class="anchor" href="#_accessing_complex_data_structure"></a>3.4.4. Accessing complex data structure</h4>
<div class="paragraph">
<p>The code generated by <code>ModelMaker</code> also comprise specific 
data structure classes for component, group, life cycle and arena 
descriptors. These classes are put in the <code>generated</code> sub-directory of the project <code>code/&lt;system-name&gt;/</code>
 directory in the user-defined java project. Have a look at these files 
(but do not edit them!) to understand how to access data in complex 
hierarchical structures.</p>
</div>
<div class="paragraph">
<p>In all cases, those data structures have getters and setters for 
fields and tables that use the name of the field as method name. For 
example, if <code>x</code> is a field in record <code>B</code>, it will be accessed as <code>B.x()</code> and set with <code>B.x(value)</code>.</p>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="_feeding_the_model_with_data"><a class="anchor" href="#_feeding_the_model_with_data"></a>3.5. Feeding the model with data</h3>
<div class="paragraph">
<p>Simulators usually rely on possibly large data sets to initialise and run a simulation.</p>
</div>
<div class="sect3">
<h4 id="_data_uses"><a class="anchor" href="#_data_uses"></a>3.5.1. Data uses</h4>
<div class="paragraph">
<p>According to their use during a simulation, we can classify data into:</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
Parameters
</td>
<td class="hdlist2">
<p>Values usually visible to a large number of system components that 
remain constant over a simulation or over the life time of an ephemeral 
component. These are stored in the <a href="#truethe-systemstructure-node">constants</a> of components, groups, life cycles and the arena.</p>
<div class="paragraph">
<p><em>Examples</em>: the <em>average solar radiation at the top of the canopy</em> for the arena component; the <em>spatial coordinates</em> of a plant; the <em>species name</em> for a group of components.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Initial&nbsp;community
</td>
<td class="hdlist2">
<p>In most cases a simulation must start with a non-empty initial 
system. This implies that components be instantiated with specific 
initial values for their <a href="#truethe-systemstructure-node">drivers</a> and proper connections between them.</p>
<div class="paragraph">
<p><em>Examples</em>: an initial forest reconstructed from LIDAR data; a
 monitored population of marked animals within an area, where each 
animal has a measured age.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Forcing&nbsp;data
</td>
<td class="hdlist2">
<p>Sometimes a simulation requires that data be fed in during its time 
course, at some time step, replacing values of a driver that cannot be 
computed by the model.</p>
<div class="paragraph">
<p><em>Examples</em>: a series of metorological data used to force a fire spread or a vegetation growth model.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Data for <em>parameters</em> and <em>initial community</em> are directly used to instantiate components and fill their descriptors with values. <em>Forcing data</em> must be loaded into some initial data structure (probably most often a <code>DoubleTable</code>, cf. <a href="#truetable">[truetable]</a>, as a constant in the <code>system</code> instance), made accessible to some user-defined function that will read its content as the simulation proceeds.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_input_methods"><a class="anchor" href="#_data_input_methods"></a>3.5.2. Data input methods</h4>
<div class="paragraph">
<p>There are three different ways of feeding <code>ModelRunner</code> with data to start a simulation experiment (cf. <a href="#truethe-setup-of-an-initial-state-for-a-simulation">[truethe-setup-of-an-initial-state-for-a-simulation]</a> for the specification of these):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Entering parameter and initial driver values in the model 
configuration tree. This is useful only for small quantities of data, 
(i) with models requiring only a few parameters, or (ii) during the 
initial building/testing file of a model; typically when one does not 
want to bother with formatting an input file with only two parameter 
values. This is specified using <code>initialValues</code> nodes as children of <code>system</code>, <code>componentType</code>, <code>groupType</code> or <code>lifeCycleType</code>, depending on where the data should go (<a href="#truethe-system-node">[truethe-system-node]</a> and <a href="#truethe-systemstructure-node">[truethe-systemstructure-node]</a>).</p>
</li>
<li>
<p>Loading data from an external source, typically, one or more files. 
This is recommended whenever a large number of initial values and items 
must be used. This is specified using <code>loadFrom</code> cross-links to <code>dataSource</code> nodes (<a href="#trueinputs-datasource">[trueinputs-datasource]</a>).</p>
</li>
<li>
<p>Using a user-defined initialiser function to set or modify initial 
values. This complements both points above and enables to compute 
transformations of initial drivers or constants prior to run the 
simulation. This is specified using <code>initFunction</code> nodes of the <code>SetInitialState</code> type (<a href="#truefunction">[truefunction]</a>) as children of <code>system</code>, <code>componentType</code>, <code>groupType</code> or <code>lifeCycleType</code>, depending on where the data should go (<a href="#truethe-system-node">[truethe-system-node]</a> and <a href="#truethe-systemstructure-node">[truethe-systemstructure-node]</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These three methods can be used together within the same model. 
However, since an initialiser function must be run on an existing 
instance of a component, it can only be used (i) on the <code>system</code>
 node, which is always instantiated and unique, or (ii) as a complement 
to the two other methods which can specify the component instances to 
create.</p>
</div>
<div class="sect4">
<h5 id="_the_loadfrom_cross_link"><a class="anchor" href="#_the_loadfrom_cross_link"></a>The <em>loadFrom</em> cross-link</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>loadFrom → dataSource:&lt;<em>name</em>&gt;</code> {0..*}</dt>
<dd>
<p>A <code>dataSource</code> node specifies the information required to 
access some data source: for example, a file name, a file format, and 
all other requested information that the java code just needs to read 
the file.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A <code>loadFrom</code> cross-link links the <code>system</code>, a <code>componentType</code>, <code>groupType</code> or <code>lifeCycleType</code> a to a data source.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_initialvalues_node"><a class="anchor" href="#_the_initialvalues_node"></a>The <em>initialValues</em> node</h5>
<div class="paragraph">
<p><code>/3worlds/…​/componentType/<strong>initialValues</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/…​/groupType/<strong>initialValues</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/…​/lifeCycleType/<strong>initialValues</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/system/<strong>initialValues</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p>An <code>initialValues</code> node enables one to directly specify 
the number, driver and constant values, belonging to groups and life 
cycle instances, of initial instances of components, groups, life cycle,
 and the arena.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>initialValues</code> :</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>nInstances</code>
</td>
<td class="hdlist2">
<p>The number of instances of <code>componentType</code>, <code>groupType</code> or <code>lifeCycleType</code>
 to create at the start of the simulation. For groups and life cycle, 
the instance name will be the name of the initialValues node, plus a 
number if more than one instance is required. For components, the unique
 identifier is automatically generated. Note that a value of zero will 
not create any instance. Ignored for the arena (always present and 
unique).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>idGroup</code>
</td>
<td class="hdlist2">
<p>(only applies to <code>…​/groupType/componentType/initialValues</code> nodes): The <code>groupType</code> instance name of these <code>ComponentType</code> instances</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>idLifeCycle</code>
</td>
<td class="hdlist2">
<p>(only applies to <code>…​/lifeCycleType/groupType/componentType/initialValues</code> and <code>…​/lifeCycleType/groupType/initialValues</code> nodes): The <code>lifeCycleType</code> instance name of these <code>ComponentType</code> or <code>groupType</code> instances</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&lt;<em>name</em>&gt;</code>
</td>
<td class="hdlist2">
<p>driver and constant (name,value) pairs to populate the instances. The
 property name must match a declared field. Tables are not supported.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The latter property is only partly supported and at the time of writing, <code>ModelMaker</code>
 does not enable one to write such properties. One has to edit the 
configuration file by hand. Only do that if you are an expert.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_the_initfunction_node"><a class="anchor" href="#_the_initfunction_node"></a>The <em>initFunction</em> node</h5>
<div class="paragraph">
<p><code>/3worlds/…​/componentType/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/…​/groupType/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/…​/lifeCycleType/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/system/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>initFunction</code> :</p>
</div>
<div class="hdlist">
<table>
<tbody><tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>The type of function used: only <a href="#truefunction"><code>setInitialState</code></a> is possible.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>functionSnippet</code>
</td>
<td class="hdlist2">
<p>The java code to be inserted into the body of the <code>initFunction</code> method in the generated code.</p>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>initFunction</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>useRNG → rng:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>Points to the <a href="#truerandom-number-channels">random number generator channel</a> to use in this function. If unset, the default random number channel is used.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_consistency_of_data_files_with_the_model_component_hierarchy"><a class="anchor" href="#_consistency_of_data_files_with_the_model_component_hierarchy"></a>3.5.3. Consistency of data files with the model component hierarchy</h4>
<div class="paragraph">
<p>The simulated system is a hierarchy with up to 4 levels: arena &gt; life cycle &gt; group &gt; component (cf. Box <a href="#system-howto">How is the simulated system implemented?</a>). As a consequence, input data files must reflect this hierarchy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_file_formats"><a class="anchor" href="#_data_file_formats"></a>3.5.4. Data file formats</h4>
<div class="paragraph">
<p>The data file formats currently supported as input to 3Worlds are listed in <a href="#trueinputs-datasource">[trueinputs-datasource]</a>. At the moment, <code>.csv</code> text files and <code>.ods</code> spreadsheet files are supported. Their content must comply with constraints listed in <a href="#trueinputs-datasource">[trueinputs-datasource]</a>.</p>
</div>
<div class="paragraph">
<p>For a practical understanding of how this works, we recommend to run the <code>TestDataLoading</code> model (accessible in <strong>ModelMaker</strong> through the <code>Projects &gt; New &gt; Test cases</code> menu).</p>
</div>
<div class="paragraph">
<p>Here are examples extracted  from this test model:</p>
</div>
<div class="sect5">
<h6 id="_example_1_using_a_datasource_only"><a class="anchor" href="#_example_1_using_a_datasource_only"></a>Example 1: using a <em>dataSource</em> only</h6>
<div class="paragraph">
<p>This <code>.ods</code> spreadsheet:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-spreadsheet-climate.png" alt="example spreadsheet climate" width="550">
</div>
</div>
<div class="paragraph">
<p>with the following specifications:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-climate2.png" alt="example climate2">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-climate1.png" alt="example climate1" width="700">
</div>
</div>
<div class="paragraph">
<p>will result in the instantiation of a single system component with id <strong>49</strong>, belonging to category <strong>climate</strong>, with an elaborate data structure as shown on the graph, containing a table <strong>otherVar</strong> of dimensions <strong>[12,8]</strong> with values read from the <strong>climat.ods</strong> file (from debugger):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>container:sys1[
  categories:[[category:*arena*], ...]
  local_items:{
    49=[SystemComponent:49
      otherVar={[12,8],(8 3.1 C),(0 2.9 C),(2 5.3 C),(0 3.1 C),
                       (16 3.9 C),(17 3.9 C),(5 2.0 C),(17 2.6 C),
                       (0 1.2 C ,(0 0.4 C)...}
      temperature={[12,8],21.8,21.4,23.0,24.0,19.4,20.5,22.0,
                          18.0,21.3,22.5...}
    ]
  }
  ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>How?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>property  <code>subclass</code> in <code>dataSource:climateData</code> tells <strong>ModelMaker</strong> that the file to be read is in <code>.odf</code> format. Since there is no <code>sheet</code> property, only the first (actually, only) sheet is read;</p>
</li>
<li>
<p>property <code>file</code> gives the name of the file to read, here <strong>climat.ods</strong>.</p>
</li>
<li>
<p>since <code>componentType:compTyp1</code> is child of the <code>structure</code> node and has no <code>initialValues</code> child node, the number of components to instantiate must come from the data source;</p>
</li>
<li>
<p>since the <code>dataSource</code> node does not have a <code>componentId</code>
 property, only one component can be instantiated (there is no way to 
uniquely identify it in the spreadsheet). As a result, all data in <em>climat.ods</em> will be used to instantiate a single instance of <code>componentType:compTyp1</code>;</p>
</li>
<li>
<p>property <code>dim</code> tells ModelMaker that indices for the first table dimensions are to be read in column <em>lat</em>, and for the second dimension in column <em>long</em>;</p>
</li>
<li>
<p>column headings prefixed with "<em>otherVar:</em>" indicate that these columns are sub-fields of the <strong>otherVar</strong> <code>table</code> (cf. graph);</p>
</li>
<li>
<p>finally, the 96 (=12×8) different lines with different indices 
(CAUTION: the indices start at 0 for 3Worlds table data structures) will
 all go into the same constants table as specified by the <strong>climate</strong> <code>category</code> of the <code>componentType:compTyp1</code>, of which only one instance automatically identified as <strong>#49</strong> by <strong>ModelRunner</strong> has been created.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_example_2_using_multiple_datasource_nodes"><a class="anchor" href="#_example_2_using_multiple_datasource_nodes"></a>Example 2: using multiple <em>dataSource</em> nodes</h6>
<div class="paragraph">
<p>These <code>.ods</code> spreadsheets:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-spreadsheet-termites.png" alt="example spreadsheet termites" width="550">
</div>
</div>
<div class="paragraph">
<p>with the following specifications:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-termites2.png" alt="example termites2">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-termites1.png" alt="example termites1" width="650">
</div>
</div>
<div class="paragraph">
<p>will result in the instantiation of <em>four</em> system components with ids <strong>77</strong> to <strong>80</strong>, belonging to category <strong>waterBody</strong>, with an elaborate data structure as shown on the graph, containing a table <strong>turbidity</strong> of dimensions <strong>3</strong> with values read from the <strong>termites.ods</strong> file, sheets <strong>ponds1</strong> and <strong>ponds2</strong> (from debugger):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>container:sys1[
  categories:[[category:*arena*], ...]
  local_items:{...}
  sub_containers:[
    container:pond[
      local_items:{
        77=[SystemComponent:77 (xx=36.0 yy=53.0 turbidity={[3],0.91,0.61,0.18} depth=-0.578 level=0.0)],
        78=[SystemComponent:78 (xx=12.0 yy=27.0 turbidity={[3],0.21,0.74,0.0}  depth=-3.5   level=0.0)],
        79=[SystemComponent:79 (xx=0.0  yy=0.0  turbidity={[3],0.0,0.37,0.14}  depth=0.0    level=0.0)],
        80=[SystemComponent:80 (xx=24.0 yy=87.2 turbidity={[3],0.0,0.0,0.0}    depth=-1.02  level=0.0)]
      }
    ]
    ...
  ]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>How?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>property  <code>subclass</code> in <code>dataSource:pondData1</code> and <code>dataSource:pondData2</code> (not shown) tell <strong>ModelMaker</strong> that the file to be read is in <code>.odf</code> format.</p>
</li>
<li>
<p>property <code>file</code> gives the name of the file to read, here <strong>termites.ods</strong>.</p>
</li>
<li>
<p>property <code>sheet</code> in <code>dataSource:pondData1</code> and <code>dataSource:pondData2</code> tell <strong>ModelMaker</strong> that the data are contained in, respectively, sheets <strong>ponds1</strong> and <strong>ponds2</strong> of this file.</p>
</li>
<li>
<p>since <code>componentType:compTyp3</code> is child of a <code>groupType</code>, an <code>idGroup</code> property must be provided in the <code>dataSource</code> nodes to identify into which group container components instances will be stored; and an <code>idComponent</code> property to identify how many components must be instantiated;</p>
</li>
<li>
<p>four different components identifiers <strong>P1</strong>, <strong>P2</strong>, <strong>P3</strong>, <strong>P4</strong> (columns <strong>id</strong> and <strong>pid</strong> according to <code>idComponent</code> properties of the two <code>dataSource</code> nodes) and only one group identifier <strong>pond</strong> (column <strong>type</strong> according to <code>idGroup</code> properties of the two <code>dataSource</code> nodes) are found in the data sources. They trigger the instantiation of one group container with four components;</p>
</li>
<li>
<p>as <code>dataSource:pondData2</code> contains tabular data, a <code>dim</code> property tells which column contains the table indices (<strong>d</strong>);</p>
</li>
<li>
<p>as <code>dataSource:pondData1</code> contains no data for component <strong>P3</strong> (instantiated with identifier <strong>79</strong>), its <code>xx</code>, <code>yy</code> and <code>depth</code> fields are empty (= 0.0);</p>
</li>
<li>
<p>as <code>dataSource:pondData2</code> contains no data for component <strong>P2</strong> (instantiated with identifier <strong>80</strong>), for <code>turbidity[<strong>2</strong>]</code> in <strong>P1</strong> (instantiated with identifier <strong>78</strong>), and for <code>turbidity[<strong>0</strong>]</code> in <strong>P3</strong> (instantiated with identifier <strong>79</strong>), all these table celles are empty (= 0.0).</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
If two different data sources contain data for the same field / table 
cell in the same component, only the last value read will be kept. Since
 the order of <code>dataSource</code> nodes processing is unpredictable, this should be avoided. Take care!
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_example_3_using_a_mixture_of_datasource_and_initialvalues_nodes"><a class="anchor" href="#_example_3_using_a_mixture_of_datasource_and_initialvalues_nodes"></a>Example 3: using a mixture of <em>dataSource</em> and <em>initialValues</em> nodes</h6>
<div class="paragraph">
<p>This <code>.csv</code> text file:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-animal-csv.png" alt="example animal csv">
</div>
</div>
<div class="paragraph">
<p>with the following specifications:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-animal3.png" alt="example animal3">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-animal2.png" alt="example animal2">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/example-animal1.png" alt="example animal1" width="750">
</div>
</div>
<div class="paragraph">
<p>will result in the instantiation of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>six</em> system components with ids <strong>50</strong> to <strong>55</strong>, belonging to category <strong>adult</strong>, with their <code>age</code> automatic variable read from the <code>dataSource:animalData</code> node;</p>
</li>
<li>
<p><em>six</em> group containers with ids <strong>e_adult</strong>, <strong>e_offspring</strong>, <strong>e_young</strong>, <strong>r_adult</strong>, <strong>r_offspring</strong> and <strong>r_young</strong>. Components <strong>50</strong> to <strong>53</strong> belong to group <strong>e_adult</strong> while components <strong>54</strong> to <strong>55</strong> belong to group <strong>r_adult</strong>
of life cycle <strong>rat</strong>.</p>
</li>
<li>
<p><em>two</em> life cycles with ids <strong>elephant</strong> (containing the three former groups) and <strong>rat</strong> (containing the three latter groups).
with the hierarchy of containers is described by all the <code>initialValues</code> nodes visible on the graph (from debugger):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>container:sys1[
  categories:[[category:*arena*], ...]
  local_items:{...}
  sub_containers:[

    elephant=container:elephant[
      categories:[[category:*life cycle*], ...]
      sub_containers:[
        eoffspring=container:eoffspring[
          categories:[[category:*group*], ...]
          local_items:{}
        ],
        eyoung=container:eyoung[
          categories:[[category:*group*], ...]
          local_items:{}
        ],
        e_adult=container:e_adult[
          categories:[[category:*group*], ...]
          local_items:{
            50=[SystemComponent:50 (birthDate=0 age=28)],
            51=[SystemComponent:51 (birthDate=0 age=65)],
            52=[SystemComponent:52 (birthDate=0 age=12)],
            53=[SystemComponent:53 (birthDate=0 age=8)]
          }
        ]
      ]
    ]

    rat=container:rat[
      categories:[[category:*life cycle*], ...]
      sub_containers:[
        roffspring=container:roffspring[
          categories:[[category:*group*], ...]
          local_items:{}
        ],
        ryoung=container:ryoung[
          categories:[[category:*group*], ...]
          local_items:{}
        ],
        r_adult=container:r_adult[
          categories:[[category:*group*], ...]
          local_items:{
            54=[SystemComponent:54 (birthDate=0 age=1)],
            55=[SystemComponent:55 (birthDate=0 age=1)]
          }
        ]
      ]
    ]

    ...
  ]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>How?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>property  <code>subclass</code> in <code>dataSource:animalData</code> tells <strong>ModelMaker</strong> that the file to be read is in <code>.csv</code> format.</p>
</li>
<li>
<p>property <code>file</code> gives the name of the file to read, here <strong>species.csv</strong>.</p>
</li>
<li>
<p>property <code>separator</code> in <code>dataSource:animalData</code> tells <strong>ModelMaker</strong> that the fields are separated with <strong>";"</strong>.</p>
</li>
<li>
<p>since <code>componentType</code> nodes in this graph are all children of a <code>groupType</code> node, themselves children of a <code>lifeCycleType</code> node, properties <code>idLifeCycle</code>, <code>idGroup</code> and <code>idComponent</code> are required in data files to properly identify the components to instantiate;</p>
</li>
<li>
<p>six different components identifiers <strong>robert</strong>, <strong>jasmine</strong>, <strong>pepe</strong>, <strong>groumpf</strong>, <strong>squick</strong> and <strong>squack</strong> (column <strong>id</strong> according to the <code>idComponent</code> property of <code>dataSource:animalData</code>); two group identifiers <strong>e_adult</strong> and <strong>r_adult</strong> (column <strong>stage</strong> according to the <code>idGroup</code> property of <code>dataSource:animalData</code>); and two life cycle identifiers <strong>elephant</strong> and <strong>rat</strong> (column <strong>species</strong> according to the <code>idLifeCycle</code> property of <code>dataSource:animalData</code>);
 are found in the data source. They trigger the instantiation of two 
life cycle containers, each containing a single group container (from 
the data structure in the file), the former containing the first 4 
components and the latter the last 2 components;</p>
</li>
<li>
<p>four <code>initialValues</code> nodes are also defined in this graph. They are all children of <code>groupType</code> nodes, meaning that they apply to groups and not to components. Since the groups in this model do not declare any data, the <code>initialValues</code> nodes only tell <strong>ModelRunner</strong> to instantiate one container for each of them (<code>nInstances</code> property set to 1). Without these declarations, <strong>ModelRunner</strong> would not instantiate thee containers and would not know where to store instances of components of categories <code>young</code> and <code>offspring</code> (as no instance of these is required in the data source);</p>
</li>
<li>
<p>as <code>dataSource:animalData</code> only contains data for the <code>age</code> automatic variable, all the instances of adult rats and elephants have their <code>birthDate</code> value set to 0; you can also verify that elephants have a much longer life span than rats.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
if <code>dataSource</code> and <code>initialValues</code> nodes are used to instantiate the same components, groups, life cycles, or the arena, all <code>dataSource</code> nodes are processed first (in unpredictable order), followed by all <code>initialValues</code> nodes (in unpredictable order too).
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_import_data_from_external_sources"><a class="anchor" href="#_import_data_from_external_sources"></a>3.5.5. Import data from external sources</h4>
<div class="paragraph">
<p>Not yet implemented.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="_simulation_reference_running_a_simulation_experiment_with_modelrunner"><a class="anchor" href="#_simulation_reference_running_a_simulation_experiment_with_modelrunner"></a>4. Simulation reference: running a simulation experiment with ModelRunner</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_concepts"><a class="anchor" href="#_general_concepts"></a>4.1. General concepts</h3>
<div class="paragraph">
<p><em>ModelRunner</em> can be used with or without a GUI. If using without a GUI, all <code>widget</code> nodes must be specified as children of a <code>headless</code> node. Alternatively, <em>ModelRunner</em> will have a GUI if any <code>widget</code> nodes are children of <code>top</code>, <code>bottom', `tab</code> or <code>container</code> nodes. You can freely mix these two types of widgets.</p>
</div>
<div class="paragraph">
<p>At the time of writing, two major aspects of <em>ModelRunner’s</em> 
functionality have not been developed: the ability to change constants 
during a simulation (i.e to play around with a model while it’s running)
 and to save and restart simulations from particular states (e.g create a
 save a spin-up state from which to start an experiment).</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_modelrunner_software_interface_and_functioning"><a class="anchor" href="#_using_modelrunner_software_interface_and_functioning"></a>4.2. Using ModelRunner: software interface and functioning</h3>
<div class="paragraph">
<p>The layout of widgets in <em>ModelRunner</em> is determined by the structure and properties of the <code>userInterface</code> sub-tree constructed with <em>ModelMaker</em> (ref to UI sub-tree).</p>
</div>
<div class="paragraph">
<p>The two functioning menu items are <strong>widgets</strong> and <strong>about</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>widgets:: Edit properties of widgets (ref to UI sub-tree). These settings are saved automatically when <em>ModelRunner</em> quits.</p>
</li>
<li>
<p>about:: Information about the experiment design, <em>ModelRunner</em> and provision to create model documentation (ODD).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following widgets have run-time properties, saved automatically by <em>ModelRunner</em> so that its appearance remains as selected between each deployment of the model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TimeseriesWidget</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Legend visible: Toggles the legend display on or off.</p>
</li>
<li>
<p>Legend position: The placement of the legend relative to the chart.</p>
</li>
<li>
<p>Max legend items: The maximum number of items in the legend. This 
limits the number of items to display when running experiments with a 
large number of simulators running in parallel.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_getting_output_from_a_simulation_experiment"><a class="anchor" href="#_getting_output_from_a_simulation_experiment"></a>4.3. Getting output from a simulation experiment</h3>
<div class="paragraph">
<p>Outputs from a simulation are detailed in the section on widget properties (ref to UI sub-tree).</p>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="_sample_models_and_tutorials"><a class="anchor" href="#_sample_models_and_tutorials"></a>5. Sample models and tutorials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_tutorial_1_construct_and_run_a_simulation_for_the_first_time"><a class="anchor" href="#_tutorial_1_construct_and_run_a_simulation_for_the_first_time"></a>5.1. Tutorial 1: Construct and run a simulation for the first time</h3>
<div class="sect3">
<h4 id="_introduction"><a class="anchor" href="#_introduction"></a>5.1.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial explains the procedure for developing and running a simulation with <em>ModelMaker</em>.
We start by using a simple <a href="https://en.wikipedia.org/wiki/Logistic_map">logistic growth model</a> as a test case and
gradually introduce more capabilities in the tutorials that follow.</p>
</div>
<div class="paragraph">
<p>In <em>3Worlds</em>, the specification of a simulator is developed by constructing a graph of nodes and edges and
setting their respective properties. The nodes represent elements of interest in the model while the edges show the
relationships between them: the entire graph then constituting the simulator specification.
The simulation can be run as soon as the specification is complete and Java code has been written to define the
behaviour of the functions you have specified.</p>
</div>
<div class="paragraph">
<p>As you construct the graph, <em>ModelMaker</em> is constantly checking and providing feedback on how the specification complies
with the <em>specification archetype</em>. <em>ModelMaker</em> guides you through this process by managing the available options at each
stage in the graph construction and by providing an updated list of tasks requiring attention.</p>
</div>
<div class="paragraph">
<p>While this process greatly accelerates model development, a more important aim is to provide a firm basis for model
comparison. As all models developed with <em>ModelMaker</em> must comply with the <em>specification archetype</em>,
structural differences reduce to a comparision of graphs. That is, while you can construct any model, the design,
being constrained by the <em>specification archetype</em>, will not be arbitrary. Of course, this is not the only difference
between models. The code for each function defined in the specifications will be particular but at least these differences
are encapsulated at specific places in the model implementation.</p>
</div>
<div class="paragraph">
<p>The specification graph is both a tree and a directed graph
(<a href="#truegeneral-concepts-structure-of-a-3worlds-configuration">[truegeneral-concepts-structure-of-a-3worlds-configuration]</a>). Aside from the root, each node has a parent and may have
additional edges between nodes to define particular relationships. We refer to these edges as <em>cross-links</em> to distinguish
them from edges that represent <em>parent-child</em> relationships.</p>
</div>
</div>
<div class="sect3">
<h4 id="_installation"><a class="anchor" href="#_installation"></a>5.1.2. Installation</h4>
<div class="paragraph">
<p>Installing <em>ModelMaker</em> is very simple: create a directory called <code>3w</code> in your home directory and copy <code>tw&lt;os name&gt;.jar</code> to it where <code>os name`is one of `linux</code>, <code>mac</code> or <code>win</code>.</p>
</div>
<div class="paragraph">
<p>To start, open a terminal window, navigate to <code>3w</code> and enter:</p>
</div>
<div class="paragraph">
<p><code>java -jar tw&lt;os name&gt;.jar</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To compile your own models, the Java Development Kit (JDK)  must be installed on your computer (<a href="#trueprerequisites">[trueprerequisites]</a>).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_new_3worlds_project"><a class="anchor" href="#_creating_a_new_3worlds_project"></a>5.1.3. Creating a new 3Worlds project</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> as above. If you haven’t read any other <em>3Worlds</em> documentation, reading "About ModelMaker" from the main menu (<code>Help → About</code>) will provide some preliminary context.</p>
</li>
<li>
<p>Create a new project (<code>Main menu: Projects → New → Templates → Blank</code>)</p>
</li>
<li>
<p>When prompted enter 'Tut1' (first letter upper case). A small graph of ten nodes appears in the graph window.</p>
</li>
</ol>
</div>
<div id="fig-blank-template" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-blank-mm.png" alt="fig blank mm">
</div>
<div class="title">Figure 25. The appearance of <em>ModelMaker</em> after creating a new project from the 'Blank' template.</div>
</div>
<div class="paragraph">
<p>The black node (<code>3worlds:Tut1</code>) is the <em>root</em> of a graph that forms the simulator’s specification. The other nodes are,
for the most part, colour-coded roots of sub-trees of the graph wherein various aspects of the specification are defined
(<a href="#fig-blank-template">Figure 25</a>, <a href="#trueconfiguration-options-reference">[trueconfiguration-options-reference]</a>).</p>
</div>
<div class="paragraph">
<p>All nodes are identified by a <em>label:name</em> pair. The <em>label</em> is the type of node, representing its role, while the <em>name</em>
is a unique identifier. A few node types, of which the root node is one, must have names beginning with an upper case
letter. These nodes are used to generate Java classes when the simulation compiles.</p>
</div>
<div class="paragraph">
<p>At this stage you can try out a few basic edit operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Move a node around the graph display by dragging it with the left mouse button;</p>
</li>
<li>
<p>Zoom in and out in the graph display using the mouse wheel while holding down the <code>ctrl</code> key (or equivalent on your
operating system). Zooming is centered on the mouse position;</p>
</li>
<li>
<p>Pan the drawing surface by dragging with the left-mouse button anywhere outside a node (assuming the drawing area is
larger than the display);</p>
</li>
<li>
<p>Change the node and text size with the <em>element size</em> slider in the tool bar;</p>
</li>
<li>
<p>Right-click on a node to display a pop-up menu of edit options for that particular node. It is via these pop-up menus
that the graph is constructed; and,</p>
</li>
<li>
<p>While holding down the <code>shift</code> key, left-click on a node to see just this node and its nearest neighbours. What
constitutes 'nearest' is set by the 'path len.' control in the tool bar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A list of tasks remaining to be completed appears at the bottom-left of the main window (<a href="#fig-blank-template">Figure 25</a>).
This list grows and shrinks as the developing graph is checked against the specification archetype.  A check takes place
in the background every time the graph structure or its properties change.</p>
</div>
<div class="paragraph">
<p>At the top-left of the main window are the two property editors - <em>Properties</em> and <em>Selected Properties</em>
(<a href="#fig-blank-template">Figure 25</a>).  These show properties for the entire graph or for a single selected node
(selected by clicking on the node with the left button) respectively. It’s here that values are entered for node and
edge properties created in the following steps.</p>
</div>
<div class="paragraph">
<p>At this stage, there are five properties under the section <code>Tut1</code>.  These are properties of the root
node (<code>3worlds:Tut1</code>) intended to provide a limited amount of documentation for this project.
If you click on the root node and then select the <em>Selected Properties</em> editor tab, an additional
non-editable property is shown called ‘built-by’. This property is filled out automatically with your
computer login name and the creation date of the project. Viewing non-editable properties can be useful
at times. These are always shown in the <em>Selected Properties</em> editor but for brevity, not in the
<em>Properties</em> editor. Two icons at the top left of the <em>Properties</em> editor allow you to display properties
by category (by sub-tree) or by name. When this last option is selected, all editable properties are
display in one list.</p>
</div>
<div class="sect4">
<h5 id="_directory_structure"><a class="anchor" href="#_directory_structure"></a>Directory structure</h5>
<div class="paragraph">
<p>All projects are located within the 3Worlds root directory called <code>3w</code>.</p>
</div>
<div class="paragraph">
<p>(<a href="#fig-tut1-dir">Figure 26</a>).</p>
</div>
<div id="fig-tut1-dir" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut1-dir.png" alt="fig tut1 dir">
</div>
<div class="title">Figure 26. The initial directory structure <br> after creating a new project from the 'Blank' <br> template. Later, after all tasks have been <br> completed and the model is deployed, another <br> sub-directory is added for run-time files.</div>
</div>
<div class="paragraph">
<p>The <code>3w</code> directory contains a Jar file called <code>tw&lt;os name&gt;.jar</code> (<a href="#fig-tut1-dir">Figure 26</a>). This file contains all dependent libraries for <em>3Worlds</em>. It’s a good idea to keep a backup of this file.</p>
</div>
<div class="paragraph">
<p>Within <code>3w</code> there is now a sub-directory called something like <code>project_Tut1_2020-06-07-01-47-44-708</code>. Every project
directory begins with the key word <code>project</code>, followed by the name of the project you entered (<code>Tut1</code> in this case)
and the creation date and time. The purpose of naming project directories in this way is to make it almost impossible
to inadvertently overwrite a project.</p>
</div>
<div class="paragraph">
<p>Inside this directory are a number of text files:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>Tut1.utg</code> is the model configuration graph we’re constructing;</p>
</li>
<li>
<p><code>.layout.utg</code> contains information used to display the graph;</p>
</li>
<li>
<p><code>MM.xml</code> contains the session’s preference settings.</p>
</li>
<li>
<p><code>__StateA1</code> and sequences of similarly named files are temporary files to support the program’s undo/redo of editing
operations. These files are created during a session and deleted when the session ends.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All these files are text files and you can open and inspect them with a simple text editor.
However, as they are written by <em>ModelMaker</em> you should <em>avoid editing them directly as this will
likely cause problems for your project</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Editing any project graph files (*.utg) with a text editor is likely to corrupt the project.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>On the other hand, you can delete project directories at any time you wish. If you accidentally
delete the project of a currently open session, it will be recreated automatically by
<em>ModelMaker</em> (apart from the <em>undo-redo</em> history). However, if you delete the entire <code>3w</code> directory
you will have to restore <code>tw&lt;os name&gt;.jar</code> from backup.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_specifications"><a class="anchor" href="#_creating_the_specifications"></a>5.1.4. Creating the specifications</h4>
<div class="paragraph">
<p>Having created <code>Tut1</code>, the task list shows two actions are required (<a href="#fig-blank-template">Figure 25</a>).
 These tasks can be dealt with in any order but in general, a logical approach is to build
 the specification as follows:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>data definition</strong>: the data structures required (cf. <a href="#truethe-datadefinition-node">[truethe-datadefinition-node]</a> for full reference);</p>
</li>
<li>
<p><strong>structure</strong>: define the organisation of components - their roles and relationships (cf. <a href="#truethe-systemstructure-node">[truethe-systemstructure-node]</a> for full reference).</p>
</li>
<li>
<p><strong>dynamics</strong>: define how the modelled system evolves over time and the parts of the <strong>structure</strong> that dynamic processes apply to (cf. <a href="#truethe-systemdynamics-node">[truethe-systemdynamics-node]</a> for full reference).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For the most part, these tutorials will proceed in this order and leave defining the
simulation’s <strong>user interface</strong> (<a href="#truethe-userinterface-node">[truethe-userinterface-node]</a>) and <strong>experiment</strong> design (<a href="#truethe-experiment-node">[truethe-experiment-node]</a>)
until last. In fact, the Blank template has provided a minimum specification for the <strong>experiment</strong> sub-tree
(a single run of the model) and  the <strong>user interface</strong> (a simulation controller).</p>
</div>
<div class="sect4">
<h5 id="_data_definition"><a class="anchor" href="#_data_definition"></a>Data definition</h5>
<div class="paragraph">
<p>The logistic equation we will implement is: <em>x(t+1) = rx(t)(1-x(t))</em>. Though simple, it has interesting chaotic
behaviour for values of <em>r</em> between 3.7 and 4.0. All we need do for the data definition section is to define the
parameter <em>r</em> and the state variable <em>x</em>.</p>
</div>
<div class="paragraph">
<p>From here on and throughout these tutorials, parameters are called <em>constants</em> (data that does not change over the
course of a simulation) and state variables are called <em>drivers</em> (data that drives the simulation from one time to
the next).</p>
</div>
<div class="paragraph">
<p>Note that at this stage, the task list says nothing about adding anything to the <strong>data definition</strong> sub-tree. This is
because it is possible to define a model without data. Nevertheless, once data is defined, various actions will be
required and displayed in the task list to correctly define its use.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on the data definition node (<code>dataDefinition:dDef</code>) (pale red) and select <code>New node → record</code> from the popup menu. You’re then prompted for a name. The default name is <code>rec1</code>. Change this to 'cnsts' (constants) and click <code>ok</code>. The mouse pointer immediately becomes a cross-hair: <em>ModelMaker</em> is asking where to place this node. Move to some place within the graph display and left-click the mouse.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can name nodes and edges anything you like but accepting the recommended names and edges will make these tutorials
easier to follow. Note that <em>ModelMaker</em> will prevent naming nodes or edges with duplicate names.</p>
</div>
<div class="paragraph">
<p>All nodes in the configuration graph are children of some parent (apart from the root node). You can only create nodes
by right-clicking on a parent and selecting a child to create from the available options provided by the pop-up menu.
The items in this menu vary according to the possibilities allowed by the <em>specification archetype</em>. This is one way
<em>ModelMaker</em> ensures the developing configuration conforms with the <em>archetype</em>, greatly simplifying an otherwise
complex workflow.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>field</code> node as child of <code>record:cnsts</code>, name it 'r' and when prompted, set its type as <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All <code>fields</code> (and later <code>tables</code>) must be children of some <code>record</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create another <code>record</code> as child of <code>dataDefinition:dDef</code> and name it 'drvs' (drivers).</p>
</li>
<li>
<p>Create a <code>field</code> node as child of <code>record:drvs</code>, name it 'x' and again set the type to <code>Double</code> (<a href="#fig-ddef-subtree">Figure 27</a>).</p>
</li>
</ol>
</div>
<div id="fig-ddef-subtree" class="imageblock left text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-ddef-subtree.png" alt="fig ddef subtree" width="300">
</div>
<div class="title">Figure 27. Defining constant <code>r</code> and driver <code>x</code> <br> within the data definition sub-tree.</div>
</div>
<div class="paragraph">
<p>Note that the names 'drvs' and 'cnsts' don’t imply any meaning to the simulation specification - they’re just names.
Their <em>roles</em> as drivers and constants will be defined later.</p>
</div>
<div class="paragraph">
<p>This is all the data required for this tutorial.  The task list has now grown to four because the roles of this data
remains undefined.</p>
</div>
<div class="paragraph">
<p>You can tidy up the graph display by clicking the <code>L</code> button (re-apply layout) in the tool bar.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure"><a class="anchor" href="#_structure"></a>Structure</h5>
<div class="paragraph">
<p>At this time, the task list displays four actions. Three of these actions relate to the structure of the model. The <code>structure</code> sub-tree
describes how the modelled system is organised into separate <code>components</code> playing particular roles. In an elaborate model, there can be
many <code>components</code> but in the present case, we need only one, and for convenience, the <code>system</code> node can act as this single <code>component</code>
without the necessity of actually creating a <code>component</code> within a <code>structure</code> sub-tree.</p>
</div>
<div class="paragraph">
<p>Here, the component’s <em>role</em> will be defined as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lifetime: <em>permanent</em>;</p>
</li>
<li>
<p>organisation: <em>atomic</em>;</p>
</li>
<li>
<p>systemElements: <em>arena</em>;</p>
</li>
<li>
<p>Using <em>r</em> as a constant and <em>x</em> as a driver.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The component has a <em>permanent</em> lifespan because it persists throughout the simulation; it’s  <em>atomic</em> simply because it is a single indivisible component and not an assemblage of sub-components; and, it belongs
to something called the <em>arena</em>. The <em>arena</em> is  a unique top level component - it’s more or less a global component accessible to all
other components. No matter how many components a model has, exactly one of them must belong to the <em>arena</em> category,</p>
</div>
<div class="paragraph">
<p>While this is complicated for such a simple model, later tutorials will show how this arrangement can be a powerful approach to
structuring any complex hierarchical dynamic system composed of interacting physical and biological components.</p>
</div>
<div class="paragraph">
<p>To create this role, we use nodes of the type <code>categorySet</code> and <code>category</code>. A <code>categorySet</code> is a set of mutually exclusive categories.
By that we mean a <code>component</code> can only be associated with one category of a given categorySet. So for example <em>permanent</em> and <em>ephemeral</em>
are two categories within a set called <em>lifespan</em> and clearly, a component can only be one or the other. Categories and CategorySets are
recursive: a CategorySet contains Categories and Categories can contain CategorySets without limit.</p>
</div>
<div class="paragraph">
<p>Apart from the <code>system</code> node doubling as a <code>component</code>, an additional convenience is provided: a sub-tree of predefined category sets and
categories. We use these nodes to define the role described above. To see this sub-tree:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on the root node and select <code>Collapse → All</code>.</p>
</li>
<li>
<p>Right-click again on the root node and select <code>Expand → predefined:*categories*</code>.</p>
</li>
<li>
<p>Re-apply the layout ('<strong>L</strong>' [Alt+L])</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>predefined:*categories*</code> sub-tree is created with every new project (collapsed by default) and is <em>immutable</em> apart from allowing
edges to be added between it and other sub-tree nodes.</p>
</div>
<div class="paragraph">
<p>There are two <code>record</code> nodes within this sub-tree for default handling of average population and ephemeral data. Since the single
component used here will be neither of these we can ignore this section:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Right-click on <code>predefined:*categories*</code> and collapse both the <code>AVPopulation</code> and <code>AVEphemeral</code> sub-trees.</p>
</li>
<li>
<p>Right-click on the root node, expand the <code>system</code> and re-apply the layout.</p>
</li>
</ol>
</div>
<div id="fig-system-role" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-system-role.png" alt="fig system role" width="500">
</div>
<div class="title">Figure 28. The specification of the system component in belonging <br> to the three categories; <em>permanent</em>, <em>atomic</em> and <em>arena</em>.</div>
</div>
<div class="paragraph">
<p>We are now in a position to define the <em>role</em> of the <code>system</code> node (a.k.a. <code>component</code> in this case). The <code>system</code> node always belongs to
the <code>arena</code> and <code>permanent</code> categories. This has already been done by the 'Blank' template. It just remains to make the system <code>atomic</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Right-click on <code>system:sys1</code> and select <code>New edge → belongsTo → category:*atomic*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The system’s role of belonging to the <em>atomic</em>, <em>permanent</em> and <em>arena</em> categories is indicated by three <em>cross-link</em> edges
(<a href="#fig-system-role">Figure 28</a>). All <em>cross-links</em> are red - thin at the <em>start node</em> and thick at the <em>end node</em>. Unlike parent-child links,
they have names. Generally, the names of <em>cross links</em> are not much use. They can be hidden by selecting the drop-down list <code>E text</code> in
the tool bar, and selecting <code>Role</code>. The relationship can be read as, for example: <code>system:sys1 belongsTo category:*arena*</code>.</p>
</div>
<div id="fig-arena" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-arena.png" alt="fig arena" width="500">
</div>
<div class="title">Figure 29. The specification of the constants and drivers for the <em>arena</em>, <br> a category to which the only component (aka <code>system:sys1</code>) <br>in this tutorial belongs.</div>
</div>
<div class="paragraph">
<p>We have yet to relate <code>system:sys1</code> to the driver '<em>x</em>' and the constant '<em>r</em>'.  These are global data and therefore are defined as part
of the <code>arena</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Right-click on <code>category:*arena*</code> and select <code>New edge → constants → record:cnsts</code>.</p>
</li>
<li>
<p>Right-click again on <code>category:*arena*</code> and select <code>New edge → drivers → record:drvs</code> (<a href="#fig-arena">Figure 29</a>).</p>
<div class="literalblock">
<div class="content">
<pre>There is now one message remaining which refers to the dynamics of the model.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_dynamics"><a class="anchor" href="#_dynamics"></a>Dynamics</h5>
<div class="paragraph">
<p>The <code>dynamics</code> sub-tree specifies how the modelled system 
will evolve over time. It determines the temporal order of
function calls, their type, the categories they apply to (cf above), the
 conditions under which the simulation will stop (if any) and what and 
when data will be tracked
for output.</p>
</div>
<div class="paragraph">
<p>In the present case, the main task is to call the logistic equation a set number of times and present the result from
each iteration to the equation at the next time step.</p>
</div>
<div class="paragraph">
<p>The <code>dynamics</code> sub-tree (lime green) is a child of the <code>system</code> node - the root of the modelled system that defines
both its dynamics and structure. These nodes are already present in the "Blank" template we started with.
The <code>dynamics</code> node is the specification of a type of simulator. There can be many simulators (instances) of this
specification running in parallel depending on the experimental design.</p>
</div>
<div class="paragraph">
<p>A dynamic system must have a single definition of the <a href="#truetime-line">time scale</a>. There are ten different types of
time scale available: all of them define exact sub-divisions of time except for the <code>GREGORIAN</code> scale type which
implements the standard Gregorian calendar. The 'Blank' template has already defined a <code>timeline</code> with an <code>ARBITRARY</code>
time scale which is sufficient for this tutorial.</p>
</div>
<div class="paragraph">
<p>In the task list is an action asking that a <code>timer</code> be added to <code>timeline:tmLn1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <a href="#truetimers"><code>timer</code></a> as a child of <code>timeline</code>. Here an extra prompt appears asking for the class of the timer: {<code>ClockTimer</code>, <code>EventTimer</code>, <code>ScenarioTimer</code>}. Select <code>ClockTimer</code>.
 This timer class increments time by a constant step during simulation, 
unless the timeline uses a Gregorian scale in which case irregularities 
such as leap years are managed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Two new tasks have been added to the task list indicating that <code>dt</code> and <code>nTimeunits</code> must be greater than 1.0.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>In the property editor, locate these two properties (properties of <code>timer:tmr1</code>) and set them to 1.0.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Clock timers use their own time units to count time. The time unit is specified by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>timeUnit</code> property, which defines in which measurement unit time is to be expressed. There are 22 time unit types
available ranging from microseconds to millennia, constrained by the choice of the time scale. The current default
value of <code>UNSPECIFIED</code> is fine for this tutorial, as here, time is just a sequence of steps;</p>
</li>
<li>
<p><code>nTimeUnits</code>, i.e. the number of measurement units per timer unit - for example, a timer could use '2 days' as its
basic time unit. It means that an elementary time tick in this timer represents 2 days, so (time = 11) means 22 days,
etc. It is the finest <em>grain</em> at which time can be measured with this timer. In this tutorial, 1 is fine as we simply
use a sequence of steps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, <code>dt</code> is the number of time <em>grains</em> per time step. Here, 1 will do. This tutorial runs with time steps of 1
unspecified unit, i.e just simple ticks.</p>
</div>
<div class="paragraph">
<p>Note that a model can have any number of <code>timers</code> using any of the available time steps and time units as long as the
time units selected are compatible with the parent <code>timeline</code>. The task messages will indicate if this is not the case.
Because the specification archetype allows for more than one system, it follows there can be many dynamics sub-trees,
each with their own time system.</p>
</div>
<div class="paragraph">
<p>There is currently a task asking that a <code>process</code> be added to <code>timer:tmr1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create a <a href="#trueprocess"><code>process</code></a> node as child of <code>timer:tmr1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This process will opereate on <em>r</em> and <em>x</em> that we defined in the Data definition section. These data are associated with the <em>arena</em> as constants (<em>r</em>) and drivers (<em>x</em>). Therefore <code>process:p1</code> will <code>applyTo</code> the arena.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Right-click on <code>process:p1</code> and select 'New edge &gt; appliesTo → category:*arena*'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A <code>process</code> defines a set of computations acting on model components driven at the rate of the parent <code>timer</code>.
A component is some unit of simulation. It can be any physical or biological entity represented in the model
that has dynamic behaviour (plants, animals, nutrient pools, lakes, the atmosphere or the rhizosphere etc).</p>
</div>
<div class="paragraph">
<p>Processes can be composed of any number of functions of various types (much more on this later). We need just one
function to implement the logistic equation - a <code>ChangeState</code> function that takes the current state of a component and
calculates the next state.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create a <a href="#truefunction"><code>function</code></a> as a child of <code>process:p1</code>, name it <code>Chaos</code> and select <code>ChangeState</code> as its type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The function type can’t be changed after creating node, so if you make a mistake, delete and recreate it (<code>Delete</code>
from the pop-up menu or <code>Undo</code> from the main menu).</p>
</div>
<div class="paragraph">
<p><em>ModelMaker</em> can link to an Integrated Development Environment (IDE) such as <em>Eclipse</em>, to write code for these
functions. However, in this tutorial the funcion is only one line of code and we can just associate a code snippet
with the function without the need to link to an IDE. The snippet will be inserted in the function when the simulation
is compiled.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Edit the <code>functionSnippet</code> property of <code>function:Chaos</code>, and enter the following text:
<code>focalDrv.x = r*x*(1-x);</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This line sets the next value of <em>x</em> (<code>focalDrv.x</code>) in terms of the current value of <em>x</em>.</p>
</div>
<div class="paragraph">
<p>Save your work (<code>Ctrl+s</code>) and the task list will be empty indicating the simulation is ready to deploy.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deployment_launching_modelrunner"><a class="anchor" href="#_deployment_launching_modelrunner"></a>Deployment: launching <em>ModelRunner</em></h5>
<div class="paragraph">
<p>Before deploying the simulation, it’s useful to display the overall 
specifications by hiding the predefined sub-tree and showing the
experiment and user interface sub-trees.</p>
</div>
<div id="fig-deploy1" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-deploy1.png" alt="fig deploy1">
</div>
<div class="title">Figure 30. A view of the specification graph showing principal nodes of interest.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click the root node and select 'Collapse → predefined:*categories*'.</p>
</li>
<li>
<p>Again, right-click the root node and select 'Expand → experiment:expt' and 'UserInterface:gui'.</p>
</li>
<li>
<p>Re-apply the layout (<strong>L</strong>) (<a href="#fig-deploy1">Figure 30</a>).</p>
</li>
<li>
<p>Click the <code>Deploy</code> button. <em>ModelMaker</em> now launches <em>ModelRunner</em> to start the run-time application: <em>ModelRunner</em> (cf. <a href="#truesimulation-reference-running-a-simulation-experiment-with-modelrunner">[truesimulation-reference-running-a-simulation-experiment-with-modelrunner]</a> for a full reference).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At the top of <em>ModelRunner</em> are some control buttons to start, step and stop the simulation. This is the <code>ControlWidget1</code> shown in the
figure above that was included by default in the 'Blank' template. The <em>run</em> button becomes a <em>pause</em> button while running and the <em>stop</em>
button resets the simulator to it’s starting state.</p>
</div>
<div class="paragraph">
<p>However, as expected, there’s nothing to see so the next step is to 
add a time series widget. This is an optional requirement so the
task list didn’t complain about this.</p>
</div>
<div class="paragraph">
<p>You can move easily between design and execution of the specifications simply by deploying <em>ModelRunner</em>, checking the simulation and
quitting to return to <em>ModelMaker</em>.</p>
</div>
<div class="paragraph">
<p>To add a time series for <em>x</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Quit <em>ModelRunner</em> and return to <em>ModelMaker</em>.</p>
</li>
<li>
<p>Create a <code>tab</code> node from the  <code>userInterface:gui</code> node.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A <code>tab</code> is a container that can contain either widgets or 
other containers. The task list indicates this now asking that one of 
these be
added.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Create a <code>widget</code> node from <code>tab:tab1</code>, name it 'srsx' and select <code>TimeSeriesWidget1</code> from the drop-down list.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A new task has been added to the list requiring an edge from this widget to a dataTracker.</p>
</div>
<div class="paragraph">
<p>For this widget to receive values of <em>x</em>, something must post values of <em>x</em> to the widget at the same rate as the <code>Chaos</code> function is
executed. This is the job of a <code>dataTracker</code> and it properly belongs in the <code>dynamics</code> sub-tree.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p1</code> and choose <code>DataTracker0D</code> as it class. This class of data tracker is suitable for scalar data such as <em>x</em>.</p>
</li>
<li>
<p>Create an edge from the <code>dataTracker</code> to <em>x</em> by selecting <code>New edge → trackField - &gt; field:x</code>.</p>
</li>
<li>
<p>Create an edge from <code>widget:srsx</code> to the new data tracker.</p>
</li>
<li>
<p>Create an edge from <code>dataTracker:trk1</code> to a <code>component</code> i.e in this case <code>system.sys1</code>. A data tracker must not only track some data but also the <code>component</code> that uses this data.</p>
</li>
<li>
<p>Save the graph (<code>Ctrl+s</code>) and click the 'Deploy' button again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The display is still uninteresting because we haven’t set an initial value for <em>x</em> or parameterised <em>r</em>. This can be done in a number of
ways but for this tutorial we will add an initialisation function and a code snippet.</p>
</div>
<div id="fig-javaCode" class="imageblock left text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-javaCode.png" alt="fig javaCode">
</div>
<div class="title">Figure 31. Entering Java code snippet for the <code>initFunction</code> (for the <br> <code>system:sys1</code> component) in the property editor.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Create an <code>initFunction</code> as a child of <code>system:sys1</code>. As <code>system:sys1</code> is the only component in the specifications, it is the node requiring initialisation of <em>x</em> and <em>r</em>.</p>
</li>
<li>
<p>Enter the following two lines in the <code>Init1#javaCode</code> property (<a href="#fig-javaCode">Figure 31</a>):</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>focalDrv.x = 0.001;</code></p>
</li>
<li>
<p><code>focalCnt.r = 3.7;</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you make a typo, the task list will show the details of the compile error.</p>
</div>
</div>
<div class="sect4">
<h5 id="_stopping_conditions"><a class="anchor" href="#_stopping_conditions"></a>Stopping conditions</h5>
<div class="paragraph">
<p>If you examine the graph and all its properties, you may notice that 
there is no indication as to how long the simulation should run.
This means that when we run it we should expect it to continue 
indefinitely. You may or may not want this. If your model contains an
unconstrained exponential function, it may eventually crash unless your 
code takes measures to handle this. You can add a variety of
simple or complicated stopping conditions to the <code>dynamics</code> node. These will be discussed in later tutorials.</p>
</div>
<div class="paragraph">
<p>When we first ran this model it had no output. Now that we have a 
time series chart, displaying data of unlimited length will make the
<em>ModelRunner</em> fairly unresponsive because the simulator has little to do but the UI must update the graph continuously. Note: the
<code>TimeSeriesWidget1</code> displays data in a rolling buffer. The default buffer size is 1,000 data points.</p>
</div>
<div class="paragraph">
<p>If you press the run button and then the stop or pause button of the 
controller, it may take a while for the simulator to respond.
So for now, it’s best to test the simulation with the <code>Step</code> button.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Deploy <em>ModelRunner</em> (saving first if prompted)</p>
</li>
<li>
<p>Click the <code>step</code> button a few times. A time series of zeros is shown.</p>
</li>
<li>
<p>Click the <code>run</code> button twice in rapid succession. The time
 (x axis) now reads approximately 30,000 or so depending on the speed of
 your computer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To complete this tutorial, add a simple stopping condition:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Close <em>ModelRunner</em> and return to <em>ModelMaker</em>.</p>
</li>
<li>
<p>Create a <code>stoppingCondition</code> as a child of <code>dynamics:sim1</code>. When prompted, select <code>SimpleStoppingCondition</code> from the drop-down list.</p>
</li>
<li>
<p>Select this new node and in the properties editor, set the value of <code>stCd1#endTime</code> to 100 (<a href="#fig-final-specification">Figure 32</a>).</p>
</li>
<li>
<p>Save, re-deploy and run the simulation. You’ll now see a time series of the chaos function of 100 time steps (<a href="#fig-tut1-MR">Figure 33</a>).</p>
</li>
</ol>
</div>
<div id="fig-final-specification" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-final-specification.png" alt="fig final specification">
</div>
<div class="title">Figure 32. The specification graph for Tutorial 1.</div>
</div>
<div id="fig-tut1-MR" class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut1-MR.png" alt="fig tut1 MR">
</div>
<div class="title">Figure 33. The appearence of <em>ModelRunner</em> while running Tutorial 1.</div>
</div>
<div class="paragraph">
<p>You can now generate documentation for this model from <em>ModelRunner</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>From <em>ModelRunner</em> select 'About → Create documentation' from the main menu.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates  an ODD template (Overview, Design concepts and Details) (<code>Tut1.odt</code>, <a href="#fig-ODD1">Figure 34</a>), an established standard for documenting simulation
models. This file can be generated any time from <em>ModelRunner</em>. When you’re satisfied with the specification, edit this file as
a basis for the complete documenting of the model.  The file can be found in the Tut1 project directory <a href="#fig-dir-post-run">Figure 35</a>:</p>
</div>
<div class="paragraph">
<p><code>~/3w/project_Tut1_2021-05-07-01-36-13-257/local/runTime/documentation1/Tut1.odt</code>.</p>
</div>
<div class="paragraph">
<p>Most word processors can read this standard format, native to LibreOffice, including Microsoft Word.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every time documentation is created, it is placed in a incrementally numbered directory to prevent overwrites.
</td>
</tr>
</tbody></table>
</div>
<div id="fig-ODD1" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-ODD1.png" alt="fig ODD1" width="850">
</div>
<div class="title">Figure 34. A section of the automatically generated documentation for Tutorial 1. The text in italics is a quote from <a href="#Grimm2010">Grimm et al. (2010)</a>
 supplementary material ODD template file with suggestions as to how to 
write this section of the documentation. This quote is replaced by the <code>precis</code> property of the root node for convenience.</div>
</div>
<div id="fig-dir-post-run" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-dir-post-run.png" alt="fig dir post run" width="313">
</div>
<div class="title">Figure 35. The directory structure after deploying <br><em>ModelRunner</em> and creating the ODD <br> documentation.</div>
</div>
<div class="paragraph">
<p>Once the specification has been compiled without errors and deployed 
and the documentation generated, a number of files will have been 
created <a href="#fig-dir-post-run">Figure 35</a>:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>local/java/code/</code>: This directory contains the generated Java code. The entire model is contained within the <code>Tut1.java</code> class.</p>
</li>
<li>
<p><code>Tut1.jar</code>: A stand-alone jar of the model that can be run independently of <em>ModelMaker</em> (<a href="#truesimulation-reference-running-a-simulation-experiment-with-modelrunner">[truesimulation-reference-running-a-simulation-experiment-with-modelrunner]</a>).</p>
</li>
<li>
<p><code>runTime/MR.xml</code>: A preferences file for <em>ModelRunner</em>. These settings are saved whenever <em>ModelRunner</em> quits so it will have the same appearance between successive uses.</p>
</li>
<li>
<p><code>runTime/documentation1/Tut1.odt</code>: This is the documentation file generated in the previous steps.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_graph_layouts"><a class="anchor" href="#_graph_layouts"></a>5.1.5. Graph layouts</h4>
<div class="paragraph">
<p>An aspect of <em>ModelMaker</em> we have only touched on so far, is the graph layout system.</p>
</div>
<div class="paragraph">
<p>While using a graph to construct model specifications has many 
advantages, you can quickly become lost in a confusion of nodes and 
edges.
The advantage in presenting the specification as a graph is that the 
huge number of options possible can be constrained by context.
For example, to have a dynamic <code>process</code>, it makes sense that it’s associated with a particular <code>timer</code>, that other processes working at
the same rate are associated with the same <code>timer</code> and that all timers are coordinated by the one <code>timeline</code>. The user interface for
problems such as this would be very error-prone if presented say, as a series of dialog boxes.</p>
</div>
<div class="paragraph">
<p><em>ModelMaker</em> has a number of features to help arrange the graph display. Please refer to <a href="#truegraph-display">[truegraph-display]</a>.</p>
</div>
<div class="paragraph">
<p>As an exercise if you wish, try displaying just the nodes with <em>cross-links</em> using the SpringGraph layout (<strong>L4</strong>) (<a href="#fig-links-only">Figure 36</a>). This is a common way to
look at just the <em>cross-link</em> relationships between nodes. Generally, adding a screen capture of this and a second screen capture of
just the relevant <em>parent-child</em> relationships make useful additions to the ODD appendix.</p>
</div>
<div id="fig-links-only" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-links-only.png" alt="fig links only">
</div>
<div class="title">Figure 36. A view of the specification graph for Tutorial 1 showing only relevant <em>cross-links</em> using the Spring layout (<strong>L4</strong>).</div>
</div>
<div class="paragraph">
<p>That’s the end of this tutorial. Recreate this project at any time from the main menu (<code>Project → New → Tutorials → 1 Logistic</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_next"><a class="anchor" href="#_next"></a>5.1.6. Next</h4>
<div class="paragraph">
<p>The next tutorial (Tutorial 2) will demonstrate linking this project to an IDE and adding some Java program code.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tutorial_2_linking_a_3worlds_project_to_a_integrated_development_environment_ide"><a class="anchor" href="#_tutorial_2_linking_a_3worlds_project_to_a_integrated_development_environment_ide"></a>5.2. Tutorial 2: Linking a <em>3Worlds</em> project to a Integrated Development Environment (IDE)</h3>
<div class="sect3">
<h4 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>5.2.1. Introduction</h4>
<div class="paragraph">
<p>The previous tutorial used code snippets to insert Java code into the
 model specifications. In this tutorial we show how to use an Integrated
 Development Environment (IDE) to achieve the same end. Generally, the 
only way to develop any but the simplest of models is to code in a 
professional IDE such as <a href="https://www.eclipse.org/downloads/"><em>Eclipse</em></a>, <a href="https://www.jetbrains.com/idea/"><em>Intellij</em></a> or <a href="https://netbeans.apache.org/"><em>NetBeans</em></a>. At the time of writing, linking specifications to a Java project has only be tested with the <em>Eclipse</em> IDE.</p>
</div>
</div>
<div class="sect3">
<h4 id="_new_java_project"><a class="anchor" href="#_new_java_project"></a>5.2.2. New Java project</h4>
<div class="paragraph">
<p>First create a Java project in <em>Eclipse</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <em>Eclipse</em>, create an new Java project and name it <code>tut2</code> (first letter lower case).</p>
</li>
<li>
<p>Right-click on the new project and select  <code>properties → Java Build Path</code>.</p>
</li>
<li>
<p>Under the <code>Libraries</code> tab, highlight <code>Classpath</code> and  click the <code>Add External JARs…​</code> button to the right.</p>
</li>
<li>
<p>Navigate to the <code>3w</code> directory and select <code>tw&lt;os name&gt;.jar</code>.</p>
</li>
<li>
<p>Click <code>Apply and close</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This installs the <em>3Worlds</em> dependencies for this java project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_specifications"><a class="anchor" href="#_specifications"></a>5.2.3. Specifications</h4>
<div class="paragraph">
<p>Now create a <em>3Worlds</em> project using tutorial 1 as a starting point.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From <em>ModelMaker</em> main menu select <code>New → Tutorials → 1 Logistic</code> name it <code>Tut2</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next link this project to the Java project created above.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>From the <em>ModelMaker</em> main menu, select <code>Edit → Java project → Connect…​</code>.</p>
</li>
<li>
<p>Navigate to your <em>Eclipse</em> workspace and select <code>tut2</code>.</p>
</li>
<li>
<p>In the <em>Eclipse</em> Project Explorer view, right-click on <code>tut2</code> and select <code>Refresh</code>.</p>
</li>
<li>
<p>In the <em>Eclipse</em> main menu, select <code>Project - &gt; clean</code>, flag <code>tut2</code> and click <code>OK</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While editing in <em>Eclipse</em>, a task message may appear in <em>ModelMaker</em>
 from time to time complaining about file dates. If so, make sure your 
Java files are saved, refreshed and the project clean. The message will 
disappear when the project is re-complied in <em>ModelMaker</em> using the <em>Verify</em> button in the bottom left-hand corner.</p>
</div>
</div>
<div class="sect3">
<h4 id="_writing_java_code"><a class="anchor" href="#_writing_java_code"></a>5.2.4. Writing Java code</h4>
<div id="fig-tut2-java-project" class="imageblock right text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut2-java-project.png" alt="fig tut2 java project">
</div>
<div class="title">Figure 37. The package structure in Eclipse after <br> linking Tutorial 2 to a Java project.</div>
</div>
<div class="paragraph">
<p>In the <code>src</code> folder of <code>tut2</code>, you’ll now find a new package called <code>code.sys1</code> and <code>code.sys1.generated</code> (<a href="#fig-tut2-java-project">Figure 37</a>). These have been generated by <em>ModelMaker</em> upon linking. In the <code>code.sys1</code> package is a Java file with the same name as the 3Worlds project: <code>Tut2.java</code>. This single class is where you add all your code. The other classes in the <code>generated</code>
 package are not intended to be edited. If you do edit these, your edits
 will be overwritten whenever the specifications are edited in <em>ModelMaker</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open <code>Tut2.java</code> in the <em>Eclipse</em> editor.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Near the bottom of the file are two methods (<a href="#fig-tut2-src">Figure 38</a>): <code>chaos</code> and <code>init1</code>, mapped from the names of the function and initFunction nodes we created in <code>Tut2</code> with <em>ModelMaker</em>. Within the body of these methods are a pair of insertion markers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Code insert Begin-- &gt;</code>; and</p>
</li>
<li>
<p><code>Code insert End---- &lt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code snippet property that was present in the original <code>Logistic</code> model this tutorial derives from has already been add for both the <code>chaos</code> and <code>init</code> methods.</p>
</div>
<div class="paragraph">
<p><code>chaos</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java">         focalDrv.x = r*x*(<span class="integer">1</span>-x);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>init1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java">        focalDrv.x = <span class="float">0.001</span>;
        focalCnt.r = <span class="float">3.7</span>;</code></pre>
</div>
</div>
<div id="fig-tut2-src" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut2-src.png" alt="fig tut2 src">
</div>
<div class="title">Figure 38. The main source code file ('Tut2.java').</div>
</div>
<div class="paragraph">
<p>You can also create other Java classes or import third-party 
libraries to extend you model code. This will be discussed in later 
tutorials.
There are two "import" markers at the top of the main source code file. 
Add any dependencies to third-party or other java classes you use.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When editing the main java source code file, any imports your IDE might 
insert automatically will not necessarily appear between the import 
markers.
Take care to edit these statements so they do appear between the import 
statements. These imports are in fact a code snippet property found in 
the specification root node.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Because these two methods are mapped to this generated file from the specifications created in <em>ModelMaker</em>, it follows that changes to the specifications may result in changes to these methods. So the question arises, how does <em>ModelMaker</em> manage this without losing the Java code you write?</p>
</div>
<div class="paragraph">
<p>If there have been changes to the number, name or type of <code>function</code> used in the specification, changes to anything in the <code>dataDefinition</code> sub-tree, or changes to the <em>roles</em> of <code>components</code>, <em>ModelMaker</em> will back up your old file as a text file with a unique name (e.g <code>_Tut2_1.txt</code>,<code>_Tut2_2.txt</code> etc…​) within the current java package. This way you can copy and paste you code back to the proper place. Otherwise <em>ModelMaker</em> will never overwrite this file.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When working simultaneously with an IDE and  <em>ModelMaker</em>, it is useful to keep the code snippets in <em>ModelMaker</em> up-to-date by re-importing them from time to time [ctrl+I]. If changes made in the specifications by <em>ModelMaker</em> result in a new file being created, code snippets will be carried over to the new file.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When <em>ModelMaker</em> searches for differences between previous 
and current versions of this Java file, it will ignore any comments and 
the code you have added between the insertion markers. Therefore, 
although you can do as you please with the generated comments, you 
should take care not to alter the text of the markers themselves.</p>
</div>
<div class="paragraph">
<p>If the task list is empty, you can now execute the specification by deploying them from <em>ModelMaker</em>.</p>
</div>
<div class="paragraph">
<p>Running the simulation directly from <em>ModelMaker</em> is a 
convenient way to speed up the turn-around time in developing and 
testing specifications. Once the specifications are stable, you can run 
your model from a jar: the jar file that is created in your project 
directory in this case <code>Tut2.jar</code>. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Open a terminal, change to your project directory and enter the following text: <code>java -jar Tut2.jar</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally we discuss how to debug your equations by running your model from the IDE.</p>
</div>
<div class="sect4">
<h5 id="_debugging_your_code"><a class="anchor" href="#_debugging_your_code"></a>Debugging your code</h5>
<div class="paragraph">
<p>Once the simulator specification is valid (i.e no tasks in the task list) you can quit <em>ModelMaker</em> and debug your code from the IDE.</p>
</div>
<div class="paragraph">
<p>In the default package of the linked java project (<code>tut2</code>) is a java file called <code>UserCodeRunner.java</code>. This was created the first time you linked the project made with <em>ModelMaker</em> to the Java project. By placing breakpoints in the methods you added to <code>Tut2.java</code> above, you can debug by running from this <code>main</code> class. The correct command-line arguments have already been provided.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_next_2"><a class="anchor" href="#_next_2"></a>5.2.5. Next</h4>
<div class="paragraph">
<p>The next tutorial will introduce the use of tables and some additional output <code>widgets</code> to add to the simulator’s user interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tutorial_3_using_tables"><a class="anchor" href="#_tutorial_3_using_tables"></a>5.3. Tutorial 3: Using tables</h3>
<div class="sect3">
<h4 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a>5.3.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial introduces the use of tables in <em>ModelMaker</em> by implementing a multi-species <a href="https://en.wikipedia.org/wiki/Competitive_Lotka%E2%80%93Volterra_equations">competitive Lotka-Volterra equation</a> (CLV).</p>
</div>
<div class="paragraph">
<p>The equation has three <em>constants</em> and one <em>driver</em>; all of which are tables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>constants:</p>
<div class="ulist">
<ul>
<li>
<p><em>K</em>: carrying capacity;</p>
</li>
<li>
<p><em>r</em>: growth rate;</p>
</li>
<li>
<p><em>alpha</em>: inter-specific competition coefficient;</p>
</li>
</ul>
</div>
</li>
<li>
<p>driver:</p>
<div class="ulist">
<ul>
<li>
<p><em>x</em>: population size.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_specifications_2"><a class="anchor" href="#_specifications_2"></a>5.3.2. Specifications</h4>
<div class="paragraph">
<p>Apart from the use of tables and a more elaborate model equation, these specifications are very similar to those of Tutorial 1. <em>ModelMaker</em> provides a library of model templates for common model patterns such this. One of these, the <code>SimpleClock</code> template, has already defined a basic structure, dynamics and a minimal user interface (<a href="#fig-simple-clock-template">[fig-simple-clock-template]</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> and create a new: <code>Projects → New → Templates → 2 SimpleClock</code> and name the project 'Tut3'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_data_definition_2"><a class="anchor" href="#_data_definition_2"></a>Data definition</h5>
<div id="fig-records-tables" class="imageblock right text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-records-tables.svg" alt="fig records tables" width="400">
</div>
<div class="title">Figure 39. Data is defined through the recursive use of <br> records and tables. A definition begins with a record. <br> Leaf nodes of the resulting graph must be either Fields <br> or Tables that define a standard Java type (element) <br> such as Double, Integer etc.</div>
</div>
<div class="paragraph">
<p>Data is defined through the recursive use of records and tables: 
records can contain tables and tables can contain records without limit.
 Records can also contain fields of any primitive Java type. Tables can 
also contain Java primitive types as well as user-defined records (<a href="#fig-records-tables">Figure 39</a>). Tables can have any number of dimensions.</p>
</div>
<div class="paragraph">
<p>There is usually more than one way of defining the data for any model. For the CLV, we will use a 2-dimensional table for <em>alpha</em>, a 1-dimensional table for  <em>r</em> and <em>K</em> and another 1-dimensional table for the population <em>x</em> (<a href="#fig-data-definition">Figure 40</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Collapse all sub-trees from the root node and then expand <code>dataDefinition:dDef</code>.</p>
</li>
<li>
<p>Create a <code>table</code> as a child of <code>record:cnsts</code>, name it 'alpha', choose <code>dataElementType</code> and then set its type to <code>Double</code> (the default).</p>
</li>
<li>
<p>Create a second <code>table</code> as child of <code>record:cnsts</code>, name it 'r' and choose <code>dataElementType</code> and then set its type to <code>Double</code>.</p>
</li>
<li>
<p>Create a third <code>table</code> as child of <code>record:cnsts</code>, name it 'K' and choose <code>dataElementType</code> and then set its type to <code>Double</code>.</p>
</li>
<li>
<p>Create a  <code>table</code> as child of <code>record:drvs</code>, name it 'x', choose <code>dataElementType</code> and set its type to <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To complete the definition, we must set the table dimensions and indexing order for the 2-dim table 'alpha'.</p>
</div>
<div class="paragraph">
<p>Only one dimensioner is needed: the number of species. This is done by creating a single <code>dimensioner</code> node to be associated with all these tables.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Create a <code>dimensioner</code> as a child of <code>dataDefinition:dtDef</code> and name it 'nspp' (number of species).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A new task appears in the task list saying the 'size' property must be greater than zero.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Click on <code>dimensioner:nspp</code> and go to the <code>Selected properties</code> tab. Set a value of <code>npp#size</code> to 4 (four species).</p>
</li>
<li>
<p>Right-click on each table node in turn and select <code>New edge → dimensioner:nspp</code>. Repeat this for <code>table:alpha</code> to get the second dimension.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now set the rank order for the indexing of <code>table:alpha</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Click on <code>table:alpha</code> and examine its properties in the <code>Selected properties</code> editor.</p>
</li>
<li>
<p>Set the value of one of its rank properties to 1 - it doesn’t matter which.</p>
</li>
</ol>
</div>
<div id="fig-data-definition" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-data-definition.png" alt="fig data definition">
</div>
<div class="title">Figure 40. The <code>dataDefinition</code> 
specifications for Tutorial 3: three tables of one dimension and one of 
two dimensions ('alpha'). This size of each table is the same so only 
one <code>dimensioner</code> is required.</div>
</div>
<div class="paragraph">
<p>Finally, add some meta-data to each table by adding suitable text to the <code>description</code> property of each table or field.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure_2"><a class="anchor" href="#_structure_2"></a>Structure</h5>
<div class="paragraph">
<p>The <em>SimpleClock1</em> template has already defined the role of <code>system.sys</code> as <em>permanent</em>, <em>atomic</em> and belonging to the <em>arena</em> - the definition of a non-hierarachical model. There is nothing additional needed for this section.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dynamics_2"><a class="anchor" href="#_dynamics_2"></a>Dynamics</h5>
<div class="paragraph">
<p>Although the task list is now empty (i.e. the specifications are now 
deployable), we have yet to write the model equation and provide some 
output. We can now rename the function provided by the template to 
something meaningful in the present context and add a data tracker to 
follow <em>x</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand the <code>system.sys1</code> sub-tree from the root node and re-apply the layout [Alt+L].</p>
</li>
<li>
<p>Right-click on <code>Function:F1</code>, select <code>Rename node</code> and name it 'Growth'. If the prompt is unresponsive, remember to begin the name with an upper case letter.</p>
</li>
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p1</code> and select <code>DataTrackerD0</code> as the type (the default).</p>
</li>
<li>
<p>Create an edge from the data tracker to <em>x</em>: <code>trackTable → table:x</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are now two tasks in the list, one about 'indexing' and the 
other asking which 'component' to track. As with the previous tutorials,
 the component to track is the <code>system.sys1</code> node.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create the edge <code>trackComponent → system:sys1</code> from the data tracker node.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As we are using a scalar data tracker (<code>DataTrackerD0</code>) to
 follow a table, we can specify which elements of the table to track. If
 we want to track all elements of the table, we need do nothing as a 
blank entry for the <code>trks#index</code> property assumes this. 
Indexing is a property of the edge between data tracker and the table. 
Edge properties appear in the property list of nodes that are at the 
start of the edge (thin line) - in this case <code>dataTracker:trk1</code>.</p>
</div>
<div class="paragraph">
<p>This indexing will provide four data outputs. Indexing statements can
 select any number of contiguous or discontiguous table elements. The <a href="#data-tracking">syntax</a> is similar to that found in the <a href="https://www.r-project.org/"><strong>R</strong> statisical software</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_user_interface"><a class="anchor" href="#_user_interface"></a>User interface</h5>
<div class="paragraph">
<p>We can now add some additional widgets to the user interface as the template provided only a controller.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hide all nodes and expand the <code>userInterface:gui</code> node.</p>
</li>
<li>
<p>Add a <code>tab</code> as a child of <code>userInterface:gui</code>.</p>
</li>
<li>
<p>Add a <code>widget</code> as a child of <code>tab:tab1</code>, name it 'srsx' and select <code>TimeseriesWidget1</code> as the widget class.</p>
</li>
<li>
<p>Add a second <code>widget</code> as a child of <code>tab:tab1</code>, name it 'tblx' and select <code>TableWidget1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both these widgets are compatible with this data tracker class: the <code>TimeseriesWidget1</code> produces a chart while the <code>TableWidget1</code> displays the data as a continuously updated table. The task list requires these widgets to be connected to a data tracker.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Right-click on each of these widgets in turn and select <code>New edge → trackSeries → dataTracker:trks</code>.</p>
</li>
<li>
<p>Set the property <code>tblx#order</code> to '1' to arrange their positions in <em>ModelRunner</em> as srsx on the left (<code>order</code> = 0) and tblx to the right (<code>order</code>=1).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Save the specifications (<code>Ctrl+s</code>) and they’re now ready to run (<a href="#fig-tree">Figure 41</a>, <a href="#fig-links">Figure 42</a>).
 The next step is to create a Java project to write the 'Growth' and 
'Init1' functions, the latter having been provided by the <code>SimpleClock</code> template we started this tutorial with.</p>
</div>
<div id="fig-tree" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tree.png" alt="fig tree">
</div>
<div class="title">Figure 41. Tree graph of the final specifiation graph for Tutorial 3.</div>
</div>
<div id="fig-links" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-links.png" alt="fig links">
</div>
<div class="title">Figure 42. Cross-links of the final specifiation graph for Tutorial 3.</div>
</div>
</div>
<div class="sect4">
<h5 id="_link_to_a_java_project"><a class="anchor" href="#_link_to_a_java_project"></a>Link to a Java project</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in Tutorial 2 to create a Java project with <em>Eclipse</em> and name it 'tut3'.</p>
</li>
<li>
<p>Link it to this <em>ModelMaker</em> project.</p>
</li>
<li>
<p>Open <code>Tut3.java</code> in the <em>Eclipse</em> editor and enter the following source code between the relevant insertion markers:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; r.size(<span class="integer">0</span>); i++) {
    focalCnt.r.setByInt(random.nextDouble() * <span class="float">2.0</span>, i);
        focalCnt.K.setByInt(<span class="float">0.2</span> + random.nextDouble(), i);
        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="integer">0</span>; j &lt; alpha.size(<span class="integer">1</span>); j++) {
            <span class="keyword">if</span> (i == j)
                    focalCnt.alpha.setByInt(<span class="float">1.0</span>, i, j);
                <span class="keyword">else</span>
                    focalCnt.alpha.setByInt(random.nextDouble(), i, j);
        }
}
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>;i&lt;x.size(<span class="integer">0</span>); i++)
    focalDrv.x.setByInt(<span class="float">0.2</span>, i);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method simply initialises the equation constants: growth rate (<em>r</em>), carrying capacity (<em>K</em>) and the interspecific competition coefficient (<em>alpha</em>) to random values and the population size (<em>x</em>)
 to 0.2. Notice that the generated code includes a detailed javadoc that
 reminds the forgetful user of all the table dimensions, driver and 
constant units, etc. (<a href="#fig-javaDoc">Figure 43</a>).</p>
</div>
<div class="paragraph">
<p>There is a default random number generator (RNG) available to all 
functions. In later tutorials we will show how the specifications can 
factor any number of RNGs into groups. For example, one RNG can be 
assigned to functions of a particular type such as those effecting 
reproduction or mortality.</p>
</div>
<div class="paragraph">
<p><em>ModelMaker</em> has two types of RNG classes in addition to the 
standard Java RNG. These two are faster and produce streams of higher 
quality than the standard Java RNG. There are also various ways of 
seeding RNGs to ensure their uniqueness and to help with debugging.</p>
</div>
<div class="paragraph">
<p><code>growth</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="type">double</span> integrationStep = <span class="float">0.01</span>;
<span class="type">double</span><span class="type">[]</span> dxdt = <span class="keyword">new</span> <span class="type">double</span>[x.size(<span class="integer">0</span>)];
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; x.size(<span class="integer">0</span>); i++) {
    <span class="type">double</span> sum = <span class="integer">0</span>;
        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="integer">0</span>; j &lt; alpha.size(<span class="integer">1</span>); j++)
            sum += alpha.getByInt(i, j) * x.getByInt(j);
        dxdt[i] = r.getByInt(i) * x.getByInt(i) * (<span class="integer">1</span> - sum / K.getByInt(i));
        }
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; dxdt.length; i++)
    focalDrv.x.setByInt(x.getByInt(i) + dxdt[i] * dt * integrationStep, i);</code></pre>
</div>
</div>
<div id="fig-javaDoc" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-javaDoc.png" alt="fig javaDoc">
</div>
<div class="title">Figure 43. Example of the generated javaDoc for the <code>growth</code> function of Tutorial 3. The figure assumes correct meta-data has been added to the definitions of <code>K, r, alpha</code> and <code>x</code>.</div>
</div>
<div class="paragraph">
<p>Following a note from 'Tutorial 1', it is a good idea to keep the code snippets in <em>ModelMaker</em> up-to-date with changes in the source code.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>In <em>ModelMaker</em> select <code>Edit → Import snippets from IDE</code> and save (<code>Ctrl-s</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The model is now ready to run (<a href="#fig-tut3-MR">Figure 44</a>). However, you may want to change the time duration of the simulation from the template default of 100 to 1,000 steps.</p>
</div>
<div id="fig-tut3-MR" class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut3-MR.png" alt="fig tut3 MR">
</div>
<div class="title">Figure 44. <em>ModelRunner</em> executing Tutorial 3. Note that the property <code>tab1#orientation</code> has be set to <code>vertical</code> is this figure. This displays the time series graph above the table.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_next_3"><a class="anchor" href="#_next_3"></a>5.3.3. Next</h4>
<div class="paragraph">
<p>The next tutorial elaborates the Lotka-Volterra model by developing the <code>structure</code> sub-tree through the addition of a disturbance component.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tutorial_4_elaborating_the_model_structure_testing_the_intermediate_disturbance_hypothesis"><a class="anchor" href="#_tutorial_4_elaborating_the_model_structure_testing_the_intermediate_disturbance_hypothesis"></a>5.4. Tutorial 4: Elaborating the model structure: Testing the Intermediate Disturbance Hypothesis</h3>
<div class="sect3">
<h4 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a>5.4.1. Introduction</h4>
<div class="paragraph">
<p>In this tutorial we add a disturbance to effect a community of 
species modelled with the competitive Lotka-Volterra equation (CLV) from
 Tutorial 3. This model could then be used to examine the Intermediate 
Disturbance Hypothesis (IDH: <a href="#Connell1978">Connell, 1978</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_specifications_3"><a class="anchor" href="#_specifications_3"></a>5.4.2. Specifications</h4>
<div class="paragraph">
<p>Begin this tutorial using the Lotka-Volterra specifications from the <code>Tutorials</code> menu as a starting point.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project from <code>Tutorials → 2 LotkaVolterra</code> and name it 'Tut4'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As the tutorial title suggests, we will be <em>elaborating</em> the model structure. The Lotka-Volterra model has the simplest of structures: so simple that its <code>System</code> node can be named <code>community</code>.
 In the model we are developing here, this name would be misleading 
since we will have not only a 'community' but also a 'disturbance' (i.e.
 the system node will no longer be 'atomic' but an 'assemblage'). 
Therefore it will be clearer if we change the name of the system node 
back to its nondescript default name of <code>sys1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Right-click on <code>system:community</code> and rename 'community' to the default name 'sys1'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_data_definition_3"><a class="anchor" href="#_data_definition_3"></a>Data definition</h5>
<div class="paragraph">
<p>Data can play one of three <em>roles</em> in the <em>3Worlds archetype</em>; as:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><em>constants</em>,</p>
</li>
<li>
<p><em>drivers</em>, or</p>
</li>
<li>
<p><em>decorators</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Thus far we have only made use of data as <em>drivers</em> and <em>constants</em>. The third role, <em>decorators</em>,
 are values derived in some way from the other two. Importantly, they 
are re-initialised at the beginning of each time step. We need a species
 diversity index and this is a good example of a <em>decorator</em> being derived from relative abundance of each species ('x[n]').</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Decorators</em> are re-initialised (zero, false, null etc.) at the start of each time step.
</td>
</tr>
</tbody></table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse all nodes except for the <code>dataDefinition</code> sub-tree, hide the <em>cross-links</em> ('<strong>X</strong>'), and re-apply the layout ('<strong>L</strong>').</p>
</li>
<li>
<p>Add a new <code>record</code> as a child of <code>dataDefinition:dDef</code> and name it 'decs'.</p>
</li>
<li>
<p>Add a <code>field</code> as a child of <code>record:decs</code>, name it 'di' (diversity index) of type <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As noted previously, these names are just for clarity: they don’t impose roles as <em>drivers</em>, <em>constants</em> or <em>decorators</em>.
 Here, the records are named to indicate their intended roles just for 
clarity. Their role will later be formally defined by a relationship 
with a <code>category</code> which we create when building the <code>structure</code> specifications.</p>
</div>
<div class="paragraph">
<p>While building the data definition (<a href="#fig-tut4-data-definition">Figure 45</a>), expect task messages to accumulate until these roles have been defined.</p>
</div>
<div class="paragraph">
<p>We now define some data for the simple disturbance model: frequency and intensity.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Add a new <code>record</code> to <code>dataDefinition:dDef</code> and name it 'distCnsts' (disturbance constants).</p>
</li>
<li>
<p>Add two fields to this record, both of type <code>Double</code> called 'freq' and 'inten' respectively.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The records carried over from the previous tutorial should now be 
given better names. A trick with the Tree layout functions is that they 
order children alphabetically. To arrange nodes so that related nodes of
 a particular role are close together, prefix the name with the same 
characters - in this case 'dist'. We should also prefix all the data 
associated with the CLV with 'comm' (community).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tree layout algorithms sort child nodes in alphabetical order. Consider this behaviour when choosing node names.
</td>
</tr>
</tbody></table>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Rename <code>record:cnsts</code> to <code>record:commCnsts</code>, <code>record:drvs</code> to <code>record:commDrvs</code> and <code>record:decs</code> to <code>record:commDecs</code>.</p>
</li>
<li>
<p>Re-apply the layout and the nodes should now be arranged in a more sensible order.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To display an xy plot of diversity by time since disturbance, we can add a driver to the commDrvs record to record this.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>field</code> of type <code>Double</code> as a child of <code>record:commDrvs</code> and name it 'tsd'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Fill out the meta-data properties with at least the description, 
range and units if relevant. This information will be incorporated in 
the comments of the generated Java code.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Add the following descriptions to the new data definitions properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>freq#description</code>: 'average return time'</p>
</li>
<li>
<p><code>inten#description</code>: '% population decrease'</p>
</li>
<li>
<p><code>di#description</code>: 'Shannon’s diversity index'</p>
</li>
<li>
<p><code>tsd#description</code>: 'Time since disturbance'</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, change the number of species in the model to a larger value.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Set the value of <code>nspp#size</code> to 40.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For simplicity, we have defined <code>inten</code> as a constant rather than a driver.</p>
</div>
<div id="fig-tut4-data-definition" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut4-data-definition.png" alt="fig tut4 data definition">
</div>
<div class="title">Figure 45. The data definition sub-tree for Tutorial 
4. Tree layout algorithms sort nodes in alphabetical order. Keeping this
 in mind when naming nodes can help keep your specifications in useful 
order.</div>
</div>
<div class="paragraph">
<p>That’s all the data needed for this model. We can now specify the system structure.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure_3"><a class="anchor" href="#_structure_3"></a>Structure</h5>
<div class="paragraph">
<p>Recall from the previous tutorial, that <code>system:sys1</code> is acting as a single component. It’s <em>role</em> was defined as a permanent, indivisible global component:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><em>permanent</em>;</p>
</li>
<li>
<p><em>atomic</em>;</p>
</li>
<li>
<p>belonging to the <em>arena</em>;</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <em>arena</em> is a special category. One and only one component must belong to this category. Any data associated with it (<em>constants</em>, <em>drivers</em> and <em>decorators</em>) is available to all <code>functions</code>: the data is global. The system (<code>system:sys1</code>) was also being tracked by the data tracker. This relationship was removed above because <em>x</em>,
 the population being tracked, will now be part of a category related to
 the community component of the model i.e 'x' will no longer be global 
data.</p>
</div>
<div class="paragraph">
<p>The <em>role</em> of a <code>component</code> is defined by its <code>componentType</code>. We’ll need two <code>ComponentTypes</code>; one for the community (the CLV equation) and one for the disturbance. We also need a <code>relationType</code> to define the relationship between the disturbance and the effected community.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on <code>system.sys1</code> and collapse the <code>dynamics:sim</code> sub-tree.</p>
</li>
<li>
<p>Create a <code>structure</code> as child of <code>system:sys1</code>.</p>
</li>
<li>
<p>Create a <code>componentType</code> as a child of <code>structure:struc1</code> and name it 'distType'.</p>
</li>
<li>
<p>Create a <code>component</code> as child of <code>componentType:distType</code> and name it 'dist'.</p>
</li>
<li>
<p>Create a second <code>componentType</code> as child of <code>structure:struc1</code> and name it 'commType'.</p>
</li>
<li>
<p>Create a <code>component</code> as child of <code>componentType:commType</code> and name it 'comm'.</p>
</li>
<li>
<p>Create a <code>relationType</code> as child of <code>structure:struc1</code> and name it 'distEffectComm'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before proceeding to the definition of the <em>roles</em> of these component types, we should redefine the <em>role</em> of <code>system:sys1</code> that we inherited from Tutorial 3 when starting this project.</p>
</div>
<div class="paragraph">
<p>The node <code>system:sys1</code>, in aliasing as a <code>componentType</code>, must now be redefined as an <code>assemblage</code> with no functions or data associated with it - that is, it is no longer <code>atomic</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Right-click on <code>system:sys1</code> and select <code>Delete edge → belongsTo → category:*atomic*</code>.</p>
</li>
<li>
<p>Right-click again on <code>system:sys1</code> and select <code>New edge → belongsTo → category:*assemblage*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remove the data associated with the <em>arena</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Right-click on the root node (<code>3worlds:Tut4</code>), expand the <code>predefined:*categories*</code> and re-apply the layout.</p>
</li>
<li>
<p>Right-click on <code>category:*arena*</code> and select <code>Delete edge → drivers → record:commDrvs</code>.</p>
</li>
<li>
<p>Right-click again on  <code>category:*arena*</code> and select <code>Delete edge → constants → record:commCnsts</code>.</p>
</li>
<li>
<p>Right-click on the root node and collapse <code>predefined:*categories*</code> and re-apply the layout [Alt+L].</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The node <code>system:sys</code> is now defined as simply a <em>permanent assemblage</em> belonging to the <em>arena</em>.</p>
</div>
<div class="paragraph">
<p>Now define a <code>categorySet</code> to partition data between the 
disturbance and community. Category Sets contain mutually exclusive 
categories: something can belong to one or the other but not both. Since
 disturbance and community is all there is in this model, this is the 
'world' of the model so this seems a reasonable name for this set of 
categories i.e the 'world' comprises a community and a disturbance 
category: something can belong to one or other of these but not both.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Create a <code>categorySet</code> as child of <code>structure:struc1</code> and name it 'world'.</p>
</li>
<li>
<p>Create a <code>category</code> as child of <code>categorySet:world</code> and name it 'distCat'.</p>
</li>
<li>
<p>Create another <code>category</code> as child of <code>categorySet:world</code> and name it 'commCat'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Define the data for these new categories.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Right-click on <code>category:commCat</code> and create the following edges:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>drivers → record:commDrvs</code>.</p>
</li>
<li>
<p><code>constants → record:commCnsts</code>.</p>
</li>
<li>
<p><code>decorators → record:commDecs</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Right-click on <code>category:commDist</code> and select <code>New edge → constants → record:distCnsts</code>.</p>
</li>
<li>
<p>Expand the <code>dataDefinition:dDef</code> sub-tree, toggle the <em>cross-links</em> to confirm you have done the links as above.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now define the <em>roles</em> of the new component types for the community and disturbance. Both belong to the <em>permanent</em>, <em>atomic</em>, and <em>component</em> categories.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Right-click on <code>componentType:commType</code> and create <code>belongsTo</code> edges to:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>category:*permanent*</code>,</p>
</li>
<li>
<p><code>category:*atomic*</code>,</p>
</li>
<li>
<p><code>category:*component*</code> and</p>
</li>
<li>
<p><code>category:commCat</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Right-click on <code>componentType:distType</code> and create <code>belongsTo</code> edges to:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>category:*permanent*</code>,</p>
</li>
<li>
<p><code>category:*atomic*</code>,</p>
</li>
<li>
<p><code>category:*component*</code> and</p>
</li>
<li>
<p><code>category:distCat</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now define the relation between disturbance and the community.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Right-click on <code>relationType:distEffectComm</code> and create edges:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>fromCategory → distCat</code>.</p>
</li>
<li>
<p><code>toCategory → commCat</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, add initialisation functions for the disturbance and community component types:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>Create an <code>initFunction</code> as child of <code>componentType:commType</code> and name it 'InitComm'.</p>
</li>
<li>
<p>Create an <code>initFunction</code> as child of <code>componentType:distType</code> and name it 'InitDist'.</p>
</li>
</ol>
</div>
<div id="fig-tut4-structure" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut4-structure.png" alt="fig tut4 structure" width="800">
</div>
<div class="title">Figure 46. The structure sub-tree for Tutorial 4. .</div>
</div>
<div class="paragraph">
<p>That’s all that is required in this section. To finish up, we now 
need to connect various sub-trees of the graph to each other. Foremost 
among these is to associate processes with the new structure (<a href="#fig-tut4-structure">Figure 46</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_dynamics_3"><a class="anchor" href="#_dynamics_3"></a>Dynamics</h5>
<div class="paragraph">
<p>In this section we add two additional functions: one to initiate a 
disturbance and a second to apply the disturbance to the community.</p>
</div>
<div class="paragraph">
<p>Before proceeding, some explanations are required to make sense of the following steps. Ignoring <code>dataTrackers</code> for the moment, a <code>process</code> can have one or more <code>functions</code>. However, the relationships (<em>cross_links</em>) between the model’s dynamics, data and structure are defined at the level of <code>processes</code> not <code>functions</code>.
 If we don’t care what order the functions are called in, and they all 
apply to the same data and structural elements, then we need only one 
process to contain all the functions. However, this is not the case 
here. The three functions: community growth, disturbance occurrence, and
 disturbance effects, must have access to different data, components and
 component relationships. Specifically, whether or not a disturbance is 
to occur depends only on disturbance data (in this model). Also order is
 important: it must come before disturbance effects are applied to the 
community. The disturbance effects applies to a relationship: that of 
the disturbance and the community. The growth of the community only 
depends on community data (the Lotka-Volterra equation). In addition, we
 make the decision (in this model) that the disturbance can only occur 
after the growth of the community, mimicking a late growing season 
disturbance.</p>
</div>
<div class="paragraph">
<p>For clarity, we will prefix the names of <code>processes</code> in such a way that the layout algorithm will place them in execution order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse the <code>dataDefinition</code> sub-tree and expand <code>system:sys1</code>.</p>
</li>
<li>
<p>Create a <code>process</code> as child of <code>timer:clock1</code> and name it 'p1DistOcc`.</p>
</li>
<li>
<p>Create a <code>function</code> as child of <code>process:p1DistOcc</code> and name it 'DistOcc' and set its type as <code>RelateToDecision</code>.</p>
</li>
<li>
<p>Create a second <code>process</code> as child of <code>timer:clock1</code> and name it 'p3DistEffectComm'.</p>
</li>
<li>
<p>Create a <code>function</code> as child of <code>process:p3DistEffectComm</code>, name it 'DistEffectComm' and set its type to <code>ChangeOtherState</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The name the growth process and function should now be changed to something more appropriate:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Rename <code>process:p1</code> to <code>process:p2CommGrowth</code>.</p>
</li>
<li>
<p>Rename <code>function:Growth</code> to <code>function:CommGrowth</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The function <code>function:CommGrowth</code> will perform the same task as it did in the previous tutorial: calculate the next state of <em>x</em>
 from its current state. At the same time we can calculate the diversity
 index and increment a counter to record the time since the last 
disturbance.</p>
</div>
<div class="paragraph">
<p>The function <code>function:DistOcc</code>, a <code>RelateToDecision</code> function, will decide if a disturbance is to occur. If it returns <em>true</em>, a relation will be formed between the, yet to be specified, disturbance and community categories.</p>
</div>
<div class="paragraph">
<p>If a disturbance occurs, <code>function:DistEffectComm</code> will implement the consequences of the disturbance on the community <strong>but at the next time step</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All methods read data at the current time step and write data of the next time step. That is, always be mindful that <em>x[t+1] ← f(x[t])</em>. In code, <em>x[t+1]</em> is <code>focalDrv.x</code> and <em>x[t]</em> is just <em>x</em>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As a reminder of this ordering, we have prefixed the process that 
creates the temporary (ephemeral) relation between disturbance and the 
community with 'p1' so that the layout (if using a <em>Tree</em> layout) will display processes in a sensible order.</p>
</div>
<div class="paragraph">
<p>First, show the <em>cross-links</em> and set <code>process:p2DistEffectComm</code> to depend on <code>process:p1DistOcc</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Show the <em>cross-links</em> (<strong>X</strong>).</p>
</li>
<li>
<p>Right-click on <code>process:p2DistEffectComm</code> and select <code>New edge → dependsOn → process:p1DistOcc</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To force the disturbance effects to take place <em>after</em> the community growth (i.e. a late growing season disturbance), make <code>process:p2DistEffectComm</code> depend on <code>p2CommGrowth</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Right-click on <code>process:p3DistEffectComm</code> and select <code>New edge → dependsOn → process:p2CommGrowth</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After re-applying the layout (assuming a Tree layout is in use), it’s
 clear why these process names were prefixed by p1, p2 and p3.</p>
</div>
<div class="paragraph">
<p>At this time, <code>dataTracker:trk1</code> is set to track the component <code>system.sys1</code>. There will be no global data to track in this model as there was in the previous Lotki-Volterra so we should remove this edge.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Right-click on <code>dataTracker:trk</code> and select <code>Delete edge → trackComponent →system.sys1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, because there will be no global data in this model, <code>system:sys</code> will not need an initialisation function. Therefore we can delete this node.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Right-click on <code>initFunction:Init1</code> and select 'Delete node'.</p>
</li>
</ol>
</div>
<div id="fig-tut4-dynamics" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut4-dynamics.png" alt="fig tut4 dynamics">
</div>
<div class="title">Figure 47. The system dynamics sub-tree for Tutorial 4. .</div>
</div>
<div class="paragraph">
<p>That’s all that’s required in this section (<a href="#fig-tut4-dynamics">Figure 47</a>).
 The task list indicates that the new processes must belong to some 
categories. To do that we need to move on to the structure of the 
specifications.</p>
</div>
</div>
<div class="sect4">
<h5 id="_relations_between_sub_trees"><a class="anchor" href="#_relations_between_sub_trees"></a>Relations between sub-trees</h5>
<div class="paragraph">
<p>Currently, <code>process:p3CommGrowth</code> is applied to <code>category:*arena*</code>. We want re-apply this process to <code>category:commCat</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand <code>dynamics:sim1</code> from <code>system:sys1</code>.</p>
</li>
<li>
<p>Expand <code>predefined:*categories*</code> from the root node and re-apply the layout.</p>
</li>
<li>
<p>Show <em>cross-links</em> (<strong>X</strong>).</p>
</li>
<li>
<p>Delete the <code>appliesTo</code> edge between <code>process:p3CommGrowth</code> and <code>category:*arena*</code> and re-apply it by creating an <code>appliesTo</code> edge to <code>category:commCat</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The task list now has two tasks asking to connect both disturbance processes to either a <code>category</code> or a <code>relationType</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create <code>appliesTo</code> edges from both <code>process:p2DistEffects</code> and <code>process:p1DistOccurrence</code> to <code>relationType:distEffectComm</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note here that we expect this relation between the disturbance and 
the community to be reset every time step depending on whether or not <code>DistOccur</code> is true. That is, the relationship is ephemeral. This is achieved by setting the <code>lifespan</code> property of the <code>relationType:distEffectComm</code> to <code>ephemeral</code> (the default is <code>permanent</code>).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Change the property <code>distEffectComm#lifespan</code> to <code>ephemeral</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The simulation can now be run but, of course, we have yet to add code
 to the various functions. Here, we’ll just add code snippets but if you
 prefer, you can create a java project and add the code there instead (<a href="#truetutorial-2-linking-a-3worlds-project-to-a-integrated-development-environment-ide">[truetutorial-2-linking-a-3worlds-project-to-a-integrated-development-environment-ide]</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_java_code"><a class="anchor" href="#_java_code"></a>Java code</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy and paste the code below to all the relevant <code>functionSnippet</code> properties. A convenient way to do this is to enter "func" into the search field in the <em>All properties</em>
 property editor and edit each in turn. Note: click the 'By Name' button
 at the top-left of the editor, otherwise the search function will only 
show properties containing 'func' within a property category. If you 
received compile error messages, check that you have pasted into the 
property of the correct function:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>function:InitComm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="type">double</span> initFreq = <span class="float">1.0</span> / x.size();
focalDrv.x.fillWith(initFreq);
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; r.size(<span class="integer">0</span>); i++) {
        focalCnt.r.setByInt(random.nextDouble(), i);
        focalCnt.K.setByInt(<span class="float">5.0</span> + initFreq + random.nextDouble(), i);
        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="integer">0</span>; j &lt; alpha.size(<span class="integer">1</span>); j++) {
                <span class="keyword">if</span> (i == j)
                        focalCnt.alpha.setByInt(<span class="float">1.0</span>, i, j);
                <span class="keyword">else</span>
                        focalCnt.alpha.setByInt(max(<span class="float">0.0001</span>, random.nextDouble()), i, j);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:InitDist</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java">focalCnt.freq = <span class="integer">5</span> + random.nextInt(<span class="integer">50</span>);
focalCnt.inten = random.nextDouble()*<span class="integer">100</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:CommGrowth</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="comment">// growth</span>
<span class="type">double</span><span class="type">[]</span> dxdt = <span class="keyword">new</span> <span class="type">double</span>[x.size(<span class="integer">0</span>)];
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; x.size(<span class="integer">0</span>); i++) {
        <span class="type">double</span> sum = <span class="integer">0</span>;
        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="integer">0</span>; j &lt; alpha.size(<span class="integer">1</span>); j++)
                sum += alpha.getByInt(i, j) * x.getByInt(j);
        dxdt[i] = r.getByInt(i) * x.getByInt(i) * (<span class="integer">1</span> - sum / K.getByInt(i));
}
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; dxdt.length; i++)
        focalDrv.x.setByInt(<span class="predefined-type">Math</span>.max(x.getByInt(i) + dxdt[i] * dt, <span class="float">0.0</span>), i);

<span class="comment">// compute diversity</span>
<span class="type">double</span> xtot = <span class="float">0.0</span>;
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; focalDrv.x.size(<span class="integer">0</span>); i++)
        xtot += focalDrv.x.getByInt(i);

focalDec.di=<span class="float">0.0</span>;
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; focalDrv.x.size(<span class="integer">0</span>); i++)
        <span class="keyword">if</span> (focalDrv.x.getByInt(i) &gt; <span class="float">0.0</span>)
                focalDec.di -= (focalDrv.x.getByInt(i) / xtot) * log(focalDrv.x.getByInt(i) / xtot);

<span class="comment">// increment 'time since disturbance'</span>
<span class="comment">// use focalDrv.tsd not tsd as the order of calling of this method and DistEffectsComm could be altered</span>
focalDrv.tsd = focalDrv.tsd +<span class="integer">1</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:DistOcc</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="keyword">if</span> (random.nextDouble() &lt; <span class="float">1.0</span> / freq)
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
<span class="keyword">else</span>
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:DistEffectsComm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; other_x.size(); i++)
    <span class="keyword">if</span> (other_x.getByInt(i) &gt; other_K.getByInt(i) * inten / <span class="float">100000.0</span>) {
            otherDrv.x.setByInt(otherDrv.x.getByInt(i) * other_K.getByInt(i) * inten / <span class="float">100000.0</span>, i);
                <span class="comment">// reset time since disturbance</span>
                otherDrv.tsd = <span class="integer">0</span>;
        }
<span class="comment">// compute diversity</span>
<span class="type">double</span> xtot = <span class="float">0.0</span>;
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; other_x.size(<span class="integer">0</span>); i++)
    xtot += other_x.getByInt(i);
otherDec.di = <span class="float">0.0</span>;
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; other_x.size(<span class="integer">0</span>); i++)
                <span class="keyword">if</span> (other_x.getByInt(i) &gt; <span class="float">0.0</span>)
                        otherDec.di -= (otherDrv.x.getByInt(i) / xtot) * log(otherDrv.x.getByInt(i) / xtot);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_interface_2"><a class="anchor" href="#_user_interface_2"></a>5.4.3. User interface</h4>
<div class="paragraph">
<p>We now need to modify the user interface, provided courtesy of the previous model (<a href="#truetutorial-3-using-tables">[truetutorial-3-using-tables]</a>), to display <code>di</code> and <code>tsd</code>.
We are simulating 40 species so their abundance (<code>x[n]</code>) is best placed in a separate time series chart and <code>di</code> in another. In addition, we need an xy plot of <code>di</code> by <code>tsd</code>.
For this we need two additional <code>dataTrackers</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For clarity, rename <code>dataTracker:trk1</code> to <code>dataTracker:trkx</code>.</p>
</li>
<li>
<p>Create another <code>dataTracker</code>, as a child of <code>process:p2CommGrowth</code>, name it 'trkdi' and select <code>DataTrackerD0</code> to follow this scalar value.</p>
</li>
<li>
<p>Right-click on <code>dataTracker:trkdi</code> and select <code>Add edge → trackField → field:di</code>.</p>
</li>
<li>
<p>Right-click again on <code>dataTracker:trkdi</code> and select <code>Add edge → trackComponent → component:comm</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now create a data tracker for <code>di</code> and <code>tsd</code> as an xy pair.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create another <code>dataTracker</code>, as a child of <code>process:p2CommGrowth</code>, name it 'trkditds' and select <code>DataTrackerXY</code>.</p>
</li>
<li>
<p>Right-click on <code>dataTracker:trkditsd</code> and select <code>Add edge → trackField → field:di</code>.</p>
</li>
<li>
<p>Right-click on <code>dataTracker:trkditsd</code> and select <code>Add edge → trackField → field:tsd</code>.</p>
</li>
<li>
<p>Right-click again on <code>dataTracker:trkditsd</code> and select <code>Add edge → trackComponent → component:comm</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now create the widgets to listen to these data trackers. First we 
delete the table widget inherited from the previous tutorial and then 
add time series and scatter plot widgets.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Collapse all sub-trees and expand the <code>userInterface</code> sub-tree.</p>
</li>
<li>
<p>Right-click on <code>widget:population table</code> and select <code>Delete node</code>.</p>
</li>
<li>
<p>Create a new <code>container</code> as a child of <code>tab:tab1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>Containers</code> form a binary tree of <code>widgets</code>. Each <code>container</code> can contain one or two <code>widgets</code> or one or two <code>containers</code> or a combination of both with a limit of two.
These binary trees must end in a <code>widget</code> as a leaf node (i.e. you can’t have empty <code>containers</code>).  The <code>tab</code> node also behaves as a <code>container</code> and the same rules apply.
However, you can have as many <code>tabs</code> but of course only one tab is visible at a time in the <em>ModelRunner</em> interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Add a <code>widget</code> as a child of <code>container:cont1</code>, name it 'srsdi' and select <code>TimeseriesWidget1</code> as its class.</p>
</li>
<li>
<p>Add another <code>widget</code> as a  child of <code>container:cont1</code>, name it 'diversity time since dist'  or something similar, and select <code>ScatterPlotWidget1</code> as its class.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Set these <code>widgets</code> to track the appropriate <code>dataTrackers</code> (<a href="#fig-tut4-user-interface">Figure 48</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>From <code>widget:srsdi</code>, add a <code>trackSeries</code> edge to <code>dataTracker:trkdi</code>.</p>
</li>
<li>
<p>From <code>widget:diversity time since dist</code>, add a <code>trackSeries</code> edge to <code>dataTracker:trktsddi</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All that remains now is to arrange the widgets in the <em>ModelRunner</em> interface. Between each pair of widgets/containers is a divider which can be moved as required (<a href="#fig-tut4-modelrunner">Figure 49</a>). You can specify the pairs to be divided horizontally or vertically and the order of the pairs (left/right or top/bottom).</p>
</div>
<div id="fig-tut4-user-interface" class="imageblock text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut4-user-interface.png" alt="fig tut4 user interface" width="700">
</div>
<div class="title">Figure 48. The user-interface sub-tree for Tutorial 4. .</div>
</div>
<div id="fig-tut4-modelrunner" class="imageblock text-center">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut4-modelrunner.png" alt="fig tut4 modelrunner">
</div>
<div class="title">Figure 49. Running Tutorial 4.</div>
</div>
<div id="fig-tut4-user-interface-properties" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut4-user-interface-properties.png" alt="fig tut4 user interface properties">
</div>
<div class="title">Figure 50. User-interface properties for <br>Tutorial 4.</div>
</div>
<div id="fig-tut4-xyplot-dlg" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut4-xyplot-dlg.png" alt="fig tut4 xyplot dlg">
</div>
<div class="title">Figure 51. Scatter plot properties <br>editor in ModelRunner.</div>
</div>
<div class="paragraph">
<p>The axis order of the xy plot 'diversity time since dist' can be set using the appropriate dialog from the widget menu in <em>ModelRunner</em> (<a href="#fig-tut4-xyplot-dlg">Figure 51</a>).</p>
</div>
<div class="paragraph">
<p>The arrangement of widgets in the <code>tab</code> binary sub-tree is controlled by the <code>order</code> and <code>orientation</code> properties (<a href="#fig-tut4-user-interface-properties">Figure 50</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_next_4"><a class="anchor" href="#_next_4"></a>5.4.4. Next</h4>
<div class="paragraph">
<p>The next tutorial introduces the event timer to simulator episodic 
systems such as pulse germination or irregular disturbance regimes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tutorial_5_event_driven_systems_using_the_event_timer"><a class="anchor" href="#_tutorial_5_event_driven_systems_using_the_event_timer"></a>5.5. Tutorial 5: Event driven systems - Using the Event Timer</h3>
<div class="sect3">
<h4 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a>5.5.1. Introduction</h4>
<div class="paragraph">
<p>Many processes in nature are episodic and can be triggered when some 
other process reaches a particular state. For example, in arid 
environments, organisms may reproduce en masse when a rain event occurs;
 an epidemic may break out when a population reaches a certain density 
or; smouldering fire may spread if weather conditions cross some 
threshold.</p>
</div>
<div class="paragraph">
<p>The previous tutorials have used a clock timer to drive the 
simulation dynamics. In essence, a clock timer simply issues regular 
time events autonomously, at intervals determined by its properties – 
its time step.
An event timer, on the other hand, is not autonomous. It drives its 
child processes through events posted to it by other processes.</p>
</div>
<div class="paragraph">
<p>In this tutorial we mimic the dynamics of an episodic system with an <a href="https://en.wikipedia.org/wiki/Agent-based_model#In_biology">Individual-based Model</a>
 (IBM). We use an event timer to drive pulse creation of entities and a 
clock timer for their deletion. Here, we refer to the 'entities' as 
'items' so as not to be distracted by ecological details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_specifications_4"><a class="anchor" href="#_specifications_4"></a>5.5.2. Specifications</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> and create a new project from the <code>SimpleClock1</code> template and name the project 'Tut5'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_data_definition_4"><a class="anchor" href="#_data_definition_4"></a>Data definition</h5>
<div class="paragraph">
<p>Three fields are required: a deletion rate, pulse rate and a ceiling 
to provide a limit to item creation. These will be global constants (<a href="#fig-tut5-data-definition">Figure 52</a>).</p>
</div>
<div id="fig-tut5-data-definition" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut5-data-definition.png" alt="fig tut5 data definition" width="400">
</div>
<div class="title">Figure 52. Data definition specifications.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Collapse all sub-trees from the root node and then expand <code>dataDefinition:dDef</code>.</p>
</li>
<li>
<p>Delete <code>record:drvs</code>. There are no drivers needed.</p>
</li>
<li>
<p>Rename <code>record:cnsts</code> to 'glbCnsts'.</p>
</li>
<li>
<p>Create three <code>field</code> nodes as children of <code>record:glbCnsts</code>, name them 'ceiling', 'deleteRate' and 'pulseRate' - all of type <code>Double</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_structure_4"><a class="anchor" href="#_structure_4"></a>Structure</h5>
<div class="paragraph">
<p>We need 2 component types for this model: the system (which already exists i.e. <code>system:sys</code>) and the 'item' component type which we’ve yet to define (<a href="#fig-tut5-structure">Figure 53</a>). These have a hierarchical relationship: the system is an assemblage of 'items'. However, <code>system:sys1</code> currently belongs to the <em>atomic</em> category. This must be changed to the <em>assemblage</em> category to signify this hierarchical structure.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse the <code>dataDefinition</code> sub-tree and expand the <code>system</code> sub-tree.</p>
</li>
<li>
<p>From <code>system:sys1</code>, collapse the <code>dynamics</code> sub-tree.</p>
</li>
<li>
<p>Select the <code>system.sys1</code> node and delete the edge to <code>category:*atomic*</code>.</p>
</li>
<li>
<p>From the same node, create a <code>belongsTo</code> edge to <code>category:*assemblage*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An 'itemType' will be a component type with a role defined as belonging to the <em>ephemeral</em>, <em>atomic</em>, <em>component</em> and <em>item</em> categories. It’s <em>ephemeral</em> because it can be created and destroyed; it’s <em>atomic</em> because it has no sub-components; it’s a <em>component</em> because it is a sub-component of a larger system and it’s a <em>item</em> because processes that apply to it must reference a category unique to it. All these categories already exist in the <code>predefined:*categories*</code> sub-tree except for the 'item' category which we must create.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create a <code>structure</code> node as a child of <code>system.sys1</code> to begin building the model structure sub-tree.</p>
</li>
<li>
<p>Create a <code>categorySet</code> node as a child of <code>structure:struc1</code> and name it 'itemSet'.</p>
</li>
<li>
<p>Create a <code>category</code> node as a child of <code>categorySet:itemSet</code> and name it 'itemCat'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We now build the item component.</p>
</div>
<div id="fig-tut5-structure" class="imageblock left text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut5-structure.png" alt="fig tut5 structure" width="500">
</div>
<div class="title">Figure 53. Model structure specifications.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>componentType</code> as a child of <code>structure:struc1</code> and name it 'itemType'.</p>
</li>
<li>
<p>Create a <code>component</code> as a child of <code>componentType:itemType</code> and name it 'item'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We now define the <em>role</em> of <code>itemType</code> by specifying the categories it belongs to.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Create 4 <code>belongsTo</code> edges from <code>componentType:itemType</code> to <code>category:*ephemeral*</code>, <code>category:*atomic*</code>, <code>category:*component*</code> and <code>category:itemCat</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message now appears suggesting two ways we can create an initial number of items: by the addition of an optional property (<code>nInstances</code>) or loading from a file. For this tutorial we will just add the optional property.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Right-click on <code>component:item</code> and select <em>optional properties</em> from the popup menu. Check the <code>nInstances</code> box.</p>
</li>
<li>
<p>In the properties editor, set the value of <code>nInstances</code> to 100.</p>
</li>
<li>
<p>Before ending this section, rename <code>initFunction:init1</code> to 'SysInit'.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_dynamics_4"><a class="anchor" href="#_dynamics_4"></a>Dynamics</h5>
<div class="paragraph">
<p>The <code>SimpleClock1</code> template we started with contains a clock timer (<code>timer:clock1</code>) which we can use to call the delete function to remove items at a regular rate. Later we add <code>eventTimers</code> to implement the episodic dynamics. It will make the following steps clearer if we rename two nodes first (<a href="#fig-tut5-dynamics">Figure 54</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse all sub-trees from the root node and then expand <code>system:sys1</code>.</p>
</li>
<li>
<p>From <code>system:sys1</code>, collapse all sub-trees and then expand <code>dynamics:sim</code> and re-apply the layout [Alt+L].</p>
</li>
<li>
<p>Rename <code>timer:clock1</code> to <code>timer:t3Clock</code>.</p>
</li>
<li>
<p>Rename <code>process:p1</code> to <code>process:p3</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We need a <code>deleteDecision</code> function associated with this process rather than the current <code>ChangeState</code> function.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Delete node <code>function:F1</code>.</p>
</li>
<li>
<p>Create a <code>function</code> node as a child of <code>process:p3</code>, name it 'DeleteItem' and select <code>deleteDecision</code> as its type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>process:p3</code> is currently applied to the <code>arena</code> category. This edge was present from the template we started with. We must reassign this to apply <code>p3</code> to <code>category:itemCat</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Select <code>process:p3</code> and delete the edge to the arena category and create an <code>appliesTo</code> edget to <code>category:itemCat</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We now need an event timer to drive 'item' creation events.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>timer</code> node as a child of <code>timeline:tmLn</code>, name it 't2Event' and select <code>EventTimer</code> as its type.</p>
</li>
<li>
<p>Create a <code>process</code> node as child of <code>timer:t2Event</code> and name it 'p2'.</p>
</li>
<li>
<p>Add an <code>appliesTo</code> edge from <code>process:p2</code> to <code>category:itemCat</code>.</p>
</li>
<li>
<p>Create a <code>function</code> node as child of <code>process:p2</code>, name it 'Nitems' and select <code>CreateOtherDecision</code> as its type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This function returns a floating point number that will be the number of items to create <em>for each existing item</em>. The fractional part is rounded probabilistically to give a discrete value.</p>
</div>
<div class="paragraph">
<p>A new message has now appeared asking that <code>timer:t2Event</code> have an edge to a <code>function</code> or <code>initFunction</code>. Every event timer must have at least one function that feeds events to it (specified by a <code>fedBy</code> edge). Therefore, we need a third function to generate these events.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Create a <code>timer</code> node as a child of <code>timeline:tmLn</code>, name it 't1Event' and select <code>EventTimer</code> as its type.</p>
</li>
<li>
<p>Create a <code>process</code> node as child of <code>timer:t1Event</code> and name it 'p1'.</p>
</li>
<li>
<p>Create a <code>function</code> node as child of <code>process:p1</code>, name it 'Pulse' and select <code>ChangeState</code> as its type.</p>
</li>
<li>
<p>Add an <code>appliesTo</code> edge from <code>process:p1</code> to <code>category:*arena*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This function operates at a global level (the arena) not at the level of individual items as does <code>function:Nitems</code>. It’s job is to send an event to <code>timer:t2Event</code> that will cause <code>function:Nitems</code> to be called in a loop on all existing items. The function <code>function:Pulse</code> will also post a future event to call itself so the system will run indefinitely. However, since <code>function:Pulse</code> is also driven by an <code>eventTimer</code> we will get into an infinite regress unless we somehow feed at least one event to <code>timer:t1Event</code>. To do this we just add a <code>fedBy</code> edge to an <code>initFunction</code>.</p>
</div>
<div class="paragraph">
<p>To do all this, we must add 3 <code>fedBy</code> edges: one from <code>function:Pulse</code> to drive item creation; one from <code>function:Pulse</code> to <code>timer:t1Event</code> to drive pulse creation; and a third from <code>initFunction:SysInit</code> to start the chain of events.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Add an <code>fedBy</code> edge from <code>timer:t1Event</code> to <code>initFunction:SysInit</code>. SysInit will post a first event to begin the process.</p>
</li>
<li>
<p>Add another <code>fedBy</code> edge from <code>timer:t1Event</code> to <code>function:Pulse</code>. Pulse will continue calls to itself at some random time.</p>
</li>
<li>
<p>Add a third <code>fedBy</code> edge this time from <code>timer:t2Event</code> to <code>function:Pulse</code>. Pulse will also generate the item creation events.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There can be any number of event timers in a specification and each 
timer can be driven by any number of functions posting events at any 
time in 'present' or future. This design allows specifying very complex 
causal chains.</p>
</div>
<div class="paragraph">
<p>The template we began with includes a <code>stoppingCondition</code>. This is not needed as we can allow the simulation continue indefinitely for now.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Select <code>stoppingCondition:stCd1</code> (a child of <code>dynamics:sim1</code>) and delete it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next step is to record the number of 'items' at the end of the 
time step for display. A state variable already exists for this purpose 
in the <code>predefined:*categories*</code> sub-tree called <code>count</code>. To make use of this we must add another <code>process</code> with a <code>dataTracker</code> child.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Create a <code>process</code> as a child of <code>timer:t3clock</code> and name it 'p4'.</p>
</li>
<li>
<p>Add an <code>appliesTo</code> edge from <code>process:p4</code> to <code>category:*assemblage*</code>. This category is associated with <code>record:AVPopualation</code> that contains the <code>count</code> field.</p>
</li>
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p4</code>.</p>
</li>
<li>
<p>From the dataTracker, add two edges: one a <code>trackField</code> edge to <code>field:count</code> and the second a <code>trackComponent</code> edge to  <code>system:sys</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now add <code>dependsOn</code> edges between some of the processes to set their order of execution.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Right-click on <code>process:p4</code> and create a <code>dependsOn</code> edge to <code>process:p3</code>. This ensures <code>count</code> is recorded as the last step.</p>
</li>
<li>
<p>Right-click on <code>process:p3</code> and create a <code>dependsOn</code> edge to <code>process:p2</code>. This ensures <code>function:Delete</code> always occurs after <code>function:Nitems</code> should they occur simultaneously.</p>
</li>
</ol>
</div>
<div id="fig-tut5-dynamics" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut5-dynamics.png" alt="fig tut5 dynamics" width="800">
</div>
<div class="title">Figure 54. Model dynamics specification.</div>
</div>
</div>
<div class="sect4">
<h5 id="_coding"><a class="anchor" href="#_coding"></a>Coding</h5>
<div class="paragraph">
<p>We now add the program code to all <code>functionSnippet</code> properties for all the functions we have created.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the <code>system</code> sub-tree is fully expanded. To do this <em>Collapse sub-tree &gt; All</em> from <code>system:sys</code> node and then select <em>Expand sub-tree &gt; All</em> from the same node.</p>
</li>
<li>
<p>In the <code>Properties</code> editor, select the 'By name' button in the top-left corner and type 'func' in the search bar. All 4 <code>functionSnippet</code> properties should now be listed.</p>
</li>
<li>
<p>Edit <code>SysInit#functionSnippet</code>, and enter the following text:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java">        <span class="comment">// Set values of global constants</span>
        focalCnt.deleteRate = <span class="float">0.01</span>;
        focalCnt.pulseRate = <span class="float">0.002</span>;
        focalCnt.ceiling = <span class="float">5000.0</span>;
        <span class="comment">// post event to the pulse time to kick start it. After this it posts events to itself.</span>
        t1Event.postTimeEvent(<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Edit <code>Pulse#functionSnippet</code> and enter:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java">        <span class="comment">// post a 'item' creation event for this time</span>
        t2Event.postTimeEvent(t);
        <span class="comment">// schedule a call to this method at some future time</span>
        t1Event.postTimeEvent(t + random.nextInt((<span class="type">int</span>)(<span class="float">1.0</span>/pulseRate)) + <span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Edit <code>Nitems#functionSnippet</code> and enter:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>        // limit the recuitment rate of items to the ceiling
        double rate = (ceiling-count)/(double)count;
        return rate;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Edit <code>Delete#functionSnippet</code> and enter:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>        // return the deleteRate probabilistically converted to true or false
        return decider.decide(deleteRate);</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_user_interface_3"><a class="anchor" href="#_user_interface_3"></a>User Interface</h5>
<div class="paragraph">
<p>The template we are using has only provided a control widget (<code>widget:ctrl</code>) to run the model.
To see some output we will add a widget to display a time series of <code>count</code> (<a href="#fig-tut5-user-interface">Figure 55</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>tab</code> as a child of <code>userInterface:gui</code>.</p>
</li>
<li>
<p>Create a <code>widget</code> as a child of <code>tab:tab1</code> and name it <code>Number of items</code> and select <code>TimeSeriesWidget1</code> as its type.</p>
</li>
<li>
<p>Add a <code>trackSeries</code> edge from this widget to <code>dataTracker:trk1</code>.</p>
</li>
<li>
<p>Run the simulator (Deploy [Alt+D]).</p>
</li>
</ol>
</div>
<div id="fig-tut5-user-interface" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut5-user-interface.png" alt="fig tut5 user interface" width="600">
</div>
<div class="title">Figure 55. User interface specifications.</div>
</div>
<div class="paragraph">
<p>The simulator runs indefinitely (assuming you have deleted the <code>stoppingCondition</code> node) with exponentially declining numbers and a creation pulses up to 500 time steps apart (<a href="#fig-tut5-modelRunner">Figure 56</a>).</p>
</div>
<div id="fig-tut5-modelRunner" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut5-modelRunner.png" alt="fig tut5 modelRunner">
</div>
<div class="title">Figure 56. Running Tutorial 5.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_next_5"><a class="anchor" href="#_next_5"></a>5.5.3. Next</h4>
<div class="paragraph">
<p>The next tutorial introduces spatial models by modifying this model to display 'items' in a 2-dimensional continuous surface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tutorial_6_event_driven_systems_using_the_event_timer_in_a_spatial_model"><a class="anchor" href="#_tutorial_6_event_driven_systems_using_the_event_timer_in_a_spatial_model"></a>5.6. Tutorial 6: Event driven systems - Using the Event Timer in a spatial model</h3>
<div class="sect3">
<h4 id="_introduction_6"><a class="anchor" href="#_introduction_6"></a>5.6.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial introduces 2-dimensional space by converting Tutorial 5 to a spatial model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_specifications_5"><a class="anchor" href="#_specifications_5"></a>5.6.2. Specifications</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> and create a new project from <code>Tutorials → Event timer 1</code> and name it 'Tut6'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_data_definition_5"><a class="anchor" href="#_data_definition_5"></a>Data definition</h5>
<div id="fig-tut6-data-definition" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut6-data-definition.png" alt="fig tut6 data definition" width="500">
</div>
<div class="title">Figure 57. Data definition specifications.</div>
</div>
<div class="paragraph">
<p>We must first specify x,y coordinates for 'items' - the modelled entity (<a href="#fig-tut6-data-definition">Figure 57</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>record</code> as a child of <code>dataDefinition:dDef</code> and name it 'itemDrvs'.</p>
</li>
<li>
<p>Add 2 fields to this record named 'x' and 'y' of type <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message appears indicating this new record must be associated with a <code>category</code>. This is done in the next section.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure_5"><a class="anchor" href="#_structure_5"></a>Structure</h5>
<div class="paragraph">
<p>In the <strong>structure</strong> sub-tree we specify the type of space to use and associate it, and the <code>category:itemCat</code>, with the <em>xy</em> coordinates specified above (<a href="#fig-tut6-structure">Figure 58</a>). We can also set the initial values of the coordinates at start up time.</p>
</div>
<div id="fig-tut6-structure" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut6-structure.png" alt="fig tut6 structure" width="550">
</div>
<div class="title">Figure 58. Model structure specifications.</div>
</div>
<div class="paragraph">
<p>Associate the item drivers with the item category.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on <code>category:itemCat</code> and create an edge to the <em>xy</em> coordinates by selecting <code>New edge → drivers → record:itemDrvs</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Create the space and set its properties.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>space</code> node as a child of <code>structure:struc1</code> and select <code>ContinuousFlatSurface</code> as its type.</p>
</li>
<li>
<p>Right-click on <code>space:space</code> and create a new edge to <code>coordinate → field:x</code> and name it 'x1'.</p>
</li>
<li>
<p>Repeat the above but select <code>coordinate → field:y</code> and name it 'y1'.</p>
</li>
<li>
<p>In the properties editor for <code>space:space1</code>, set <code>y1#rank</code> to 1 and <code>space1#precision</code> to 0.01.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Set the dimensions of the space to 1,000 by 1,000 meters.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Set the properties of <code>space1#x-limits</code> and <code>space1#y-limits</code> to 0 to 1000 inclusive.</p>
</li>
<li>
<p>Add the optional property <code>units</code> to <code>space:space1</code> and set its value to 'm' (meters). This is just for documentation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Create a function to set initial values (the <em>xy</em> coordinates) for the 100 items (a property of <code>component:item</code>) at start up.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create an <code>initFunction</code> as a child of <code>componentType:itemType</code> and name it 'ItemInit'.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_dynamics_5"><a class="anchor" href="#_dynamics_5"></a>Dynamics</h5>
<div class="paragraph">
<p>When new items are created by <code>process:Nitems</code> we need a function to set <em>xy</em>
 coordinates of the newly created 'items'. This is a 'consequence' 
function. Consequence functions are children of other functions rather 
than a process (<a href="#fig-tut6-dynamics">Figure 59</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>function</code> as a child of <code>function:Nitems</code>, name it 'MakeItem' and select <code>setOtherInitialState</code> as its type.</p>
</li>
</ol>
</div>
<div id="fig-tut6-dynamics" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut6-dynamics.png" alt="fig tut6 dynamics" width="800">
</div>
<div class="title">Figure 59. Model dynamics specifications.</div>
</div>
</div>
<div class="sect4">
<h5 id="_coding_2"><a class="anchor" href="#_coding_2"></a>Coding</h5>
<div class="paragraph">
<p>We now add some Java code to set values for the <em>xy</em> 
coordinates. We will just set random values for the state up items and 
set values in newly created items to be clumped near their parent item.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following code to the <code>ItemInit#functionSnippet</code> property:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java">        <span class="comment">// place dots in random locations (assuming these are the dimensions of the map)</span>
        focalDrv.x = random.nextDouble() * <span class="integer">1000</span>;
        focalDrv.y = random.nextDouble() * <span class="integer">1000</span>;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Add the following code to the <code>MakeItem#functionSnippet</code> property:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java">       <span class="comment">// place dot randomly near 'parent' dot.</span>
       <span class="type">double</span> distance = -<span class="float">50.0</span> * <span class="predefined-type">Math</span>.log(<span class="integer">1</span> - random.nextDouble());
       <span class="type">double</span> direction = random.nextDouble() * (<span class="integer">2</span> * <span class="predefined-type">Math</span>.PI);
       otherDrv.x = x + distance * <span class="predefined-type">Math</span>.cos(direction);
       otherDrv.y = y + distance * <span class="predefined-type">Math</span>.sin(direction);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_user_interface_4"><a class="anchor" href="#_user_interface_4"></a>User Interface</h5>
<div class="paragraph">
<p>Add a widget to view the items in space (<a href="#fig-tut6-user-interface">Figure 60</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>widget</code> as a child to <code>tab:tab</code>, name it 'Item landscape' and select <code>SpaceWidget1</code> as its type.</p>
</li>
<li>
<p>Add a <code>trackSpace</code> edge from <code>widget:Item landscape</code> to <code>space:space</code> (<code>trackSpace → space:space1</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Arrange the two widget horizontally (the default) - time series first.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click on <code>widget:Item landscape</code> and in the <em>Selected properties</em> editor, set <code>Item landscape#order</code> to 1.</p>
</li>
</ol>
</div>
<div id="fig-tut6-user-interface" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut6-User-Interface.png" alt="fig tut6 User Interface" width="600">
</div>
<div class="title">Figure 60. Simulator’s user-interface specifications showing cross-links to nodes in <br> the structure and dynamics sub-trees.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Deploy the simulation [Alt+D] (<a href="#fig-tut6-modelRunner">Figure 61</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Information about <code>SpaceWidget1</code> can be found at <a href="#truewidgets">[truewidgets]</a>.</p>
</div>
<div id="fig-tut6-modelRunner" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut6-ModelRunner.png" alt="fig tut6 ModelRunner">
</div>
<div class="title">Figure 61. Running Tutorial 6.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_next_6"><a class="anchor" href="#_next_6"></a>5.6.3. Next</h4>
<div class="paragraph">
<p>The next tutorial will explain how to implement and use random numbers in models that require stochasticity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tutorial_7_random_number_generators"><a class="anchor" href="#_tutorial_7_random_number_generators"></a>5.7. Tutorial 7: Random number generators</h3>
<div class="sect3">
<h4 id="_introduction_7"><a class="anchor" href="#_introduction_7"></a>5.7.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial introduces the use of <a href="https://en.wikipedia.org/wiki/Random_number_generation">random number generators</a> (RNG).</p>
</div>
<div class="paragraph">
<p>3Worlds provides for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A single default RNG</p>
</li>
<li>
<p>Any number of independent RNGs;</p>
</li>
<li>
<p>Three different RNG algorithms;</p>
</li>
<li>
<p>Management for seeding the RNGs; and,</p>
</li>
<li>
<p>Assignment of RNGs to particular <code>Functions</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_a_single_default_rng"><a class="anchor" href="#_a_single_default_rng"></a>A single default RNG</h5>
<div class="paragraph">
<p>In many cases, management of random number generation is not 
required. For this reason, a single default RNG (PCG32) is available to 
all functions and can be used by the modeller in their code. Which RNG 
is available and how it is managed is defined in the model’s 
specifications using <em>ModelMaker</em>. These choices are transparent to the model so no coding effort is required by the modeller to utilise the various features.</p>
</div>
</div>
<div class="sect4">
<h5 id="_any_number_of_independent_rngs"><a class="anchor" href="#_any_number_of_independent_rngs"></a>Any number of independent RNGs</h5>
<div class="paragraph">
<p>You can create any number of independent RNGs and apply them individually or to groups of <code>Functions</code>.
 For example, you could assign an RNG to all functions that apply to 
reproduction and another to all functions that concern landscape 
dynamics.</p>
</div>
</div>
<div class="sect4">
<h5 id="_three_different_rng_algorithms"><a class="anchor" href="#_three_different_rng_algorithms"></a>Three different RNG algorithms</h5>
<div class="paragraph">
<p>Three RNG algorithms are available: the standard Java RNG, Pcg32 (<a href="https://www.pcg-random.org/pdf/hmc-cs-2014-0905.pdf">Permuted Congruential Generator</a>) and XSRandom (<a href="http://demesos.blogspot.com/2011/09/replacing-java-random-generator.html">XorShift</a>).
 Two important properties of RNGs are their quality (the degree to which
 they cannot be predicted better than by a random chance) and the 
computer resources required to produce them (memory and speed). Both 
Pcg32 and XSRandom are much faster (50% and 75% respectively) and of 
higher quality than the native Java RNG. Pcg32 is of higher quality than
 XSRandom (the default).</p>
</div>
</div>
<div class="sect4">
<h5 id="_management_for_seeding_the_rngs"><a class="anchor" href="#_management_for_seeding_the_rngs"></a>Management for seeding the RNGs</h5>
<div class="paragraph">
<p>For the purpose of debugging and experimental design it is often necessary to manage the RNG seeds.</p>
</div>
<div class="paragraph">
<p>There are two ways to set the source of the RNG seed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>TABLE</strong>: From <a href="https://www.random.org/">a table of 1,000 independently generated random number seeds</a>; and,</p>
</li>
<li>
<p><strong>RANDOM</strong>: From a randomly generated seed using current time to the nano second.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, the seed can be set at the time of model instantiation (<strong>NEVER</strong>) or upon every reset of the simulation (<strong>ONMODELSTART</strong>).
Using the <strong>RANDOM</strong> option means there is a new seed 
created at every instantiation. This option is here just so you don’t 
need to delete all the random number generators from the specifications -
 it effectively switches off reproducible RNG streams.</p>
</div>
<div class="paragraph">
<p>In this tutorial, we build a model with two functions to generate random numbers from two independent streams.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_specifications_6"><a class="anchor" href="#_specifications_6"></a>5.7.2. Specifications</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project starting from the <code>SimpleClock</code> template.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_data_definition_6"><a class="anchor" href="#_data_definition_6"></a>Data definition</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete the node <code>record:cnsts</code></p>
</li>
<li>
<p>Create two <code>field</code> nodes as children of <code>record:drvs</code> accept their default names ('fld1', 'fld2') and use the default type of <code>Double</code>.</p>
</li>
<li>
<p>Create two <code>rng</code> nodes as children of <code>dataDefinition:dDef</code> and accept their default names ('gen1', gen2').</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_structure_6"><a class="anchor" href="#_structure_6"></a>Structure</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete node <code>initFunction:init1</code>: it’s no needed for this tutorial.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_dynamics_6"><a class="anchor" href="#_dynamics_6"></a>Dynamics</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>Function</code> as child of <code>process:p1</code> accept the default name ('F2") and select <code>ChangeState</code> as the type.</p>
</li>
<li>
<p>Add the following code to <code>F1#functionSnippet</code> property: 'focalDrv.fld1 = random.nextDouble();'.</p>
</li>
<li>
<p>Add the following code to <code>F2#functionSnippet</code> property: 'focalDrv.fld2 = random.nextDouble();'.</p>
</li>
<li>
<p>Create a <code>useRNG</code> edge from <code>function:F1</code> to <code>rng:gen1</code>.</p>
</li>
<li>
<p>Create a <code>useRNG</code> edge from <code>function:F2</code> to <code>rng:gen2</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now the value of 'fld1' is set by the random number generator 'gen1' and the value of 'fld2' by 'gen2'.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p1</code> and select <code>DataTrackerD0</code> as its type.</p>
</li>
<li>
<p>Create two <code>trackField</code> edges from <code>dataTracker:trk1</code> to <code>field:fld`</code> and <code>field:fld2</code> respectively.</p>
</li>
<li>
<p>Create a <code>trackComponent</code> edge from <code>dataTracker:trk1</code> to <code>system.sys1</code>.</p>
</li>
</ol>
</div>
<div id="fig-tut7-Config" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut7-Config.png" alt="fig tut7 Config" width="700">
</div>
<div class="title">Figure 62. Essential elements of the configuration for tutorial 7.</div>
</div>
</div>
<div class="sect4">
<h5 id="_user_interface_5"><a class="anchor" href="#_user_interface_5"></a>User interface</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>tab</code> node as a child of <code>userInterface:gui</code>.</p>
</li>
<li>
<p>Create a <code>widget</code> node as a child of <code>tab:tab1</code> and select <code>TimeseriesWidget1</code> as its type.</p>
</li>
<li>
<p>Create a <code>trackSeries</code> edge from <code>widget:wgt1</code> to <code>dataTracker:trk1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the configuration is finished (<a href="#fig-tut7-Config">Figure 62</a>), deploy the simulator.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simulation"><a class="anchor" href="#_simulation"></a>5.7.3. Simulation</h4>
<div class="paragraph">
<p>When the simulator is run, two independent random number series  (<a href="#fig-tut7-ModelRunner">Figure 64</a>) are produced. If this is not the case, check that the code snippets (steps 2 &amp; 3 in <em>Dynamics</em> above) are correct and that <code>function:F1</code> sets the value of <code>fld1</code> and <code>function:F2</code> sets the value of <code>fld2</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Re-run the simulator a few times to ensure a different series is produced each time</p>
</li>
</ol>
</div>
<div id="fig-tut7-rng-properties" class="imageblock right text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut7-rng-properties.png" alt="fig tut7 rng properties">
</div>
<div class="title">Figure 63. Displaying just the properties of <br> the random number generators.</div>
</div>
<div class="paragraph">
<p>We will now hold the random number series constant.
To see all the relevant RNG properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Select the <em>Properties</em> tab in <em>ModelMaker</em> and click the <em>by name</em> button (top left).</p>
</li>
<li>
<p>Enter 'gen' in the search field. Now only properties of nodes <code>gen1</code> and <code>gen2</code> are displayed (<a href="#fig-tut7-rng-properties">Figure 63</a>).</p>
</li>
<li>
<p>Set properties <code>gen1#seedSource</code> and <code>gen2#seedSource</code> to <strong>TABLE</strong> and re-run the simulator.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both series are now identical as they are set by the same seed (index
 0 of the table of seeds). Of course if you change the RNG algorithm to 
one of the other algorithms, different streams will result.</p>
</div>
<div id="fig-tut7-ModelRunner" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut7-ModelRunner.png" alt="fig tut7 ModelRunner" width="600">
</div>
<div class="title">Figure 64. Independent and dependent random number streams.</div>
</div>
</div>
<div class="sect3">
<h4 id="_next_7"><a class="anchor" href="#_next_7"></a>5.7.4. Next</h4>
<div class="paragraph">
<p>This next and last tutorial covers running simulation experiments.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tutorial_8_running_an_experiment"><a class="anchor" href="#_tutorial_8_running_an_experiment"></a>5.8. Tutorial 8: Running an experiment</h3>
<div class="sect3">
<h4 id="_introduction_8"><a class="anchor" href="#_introduction_8"></a>5.8.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial introduces the current experiment design system 
(22/06/2022). This system has a major limitation in that it can only 
work with arena (i.e. global) constants.
We will update this tutorial when OpenMOLE is integrated with 3Worlds, 
something we are currently working on.</p>
</div>
<div class="paragraph">
<p><strong>NB: R</strong> must be installed to run this tutorial.</p>
</div>
<div class="paragraph">
<p>We demonstrate the current system using GDDM (Genetics, Demography 
and Disturbance Model).
GDDM is an individual-based spatial model of a population of animals in 
an environment experiencing recurrent disturbance. The disturbance 
return interval
is short (about every two years) because the study is intended for the 
North Australian savannah. Animals mate, give birth, disperse and die on
 an annual time step. Their longevity is about 12 years.</p>
</div>
<div class="paragraph">
<p>One of the aims of the study is to examine the population and genetic
 consequences of informed dispersal. In the present case, informed 
dispersal means tending to select habitat with the maximum space 
considering the carrying capacity and current population at this 
location.</p>
</div>
<div class="paragraph">
<p>We perform a simple ANOVA experiment to examine the variance 
explained in Fst and total population by just two parameters 
(constants): dispersal distance (long/short) and dispersal method 
(informed/uninformed). Most of the processes in this model depend on 
random number generation. Therefore, we will run five replicates.</p>
</div>
</div>
<div class="sect3">
<h4 id="_specifications_7"><a class="anchor" href="#_specifications_7"></a>5.8.2. Specifications</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project by selecting <code>new → model library → GDDM</code> and name it 'Tut8'.</p>
</li>
<li>
<p>Run (Deploy) the model and adjust the widget settings (widget menu)to suit to get a feel for what’s going on.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The model runs for 100 years and displays many variables such as Fst 
and population size. The habitat pattern changes every year with 
approximately half being 'good' habitat and half 'bad'. 'Good' habitat 
has a carrying capacity of 3 animals per ha. and bad 1.5.</p>
</div>
<div id="fig-tut8-MR" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut8-MR.png" alt="fig tut8 MR" width="700">
</div>
<div class="title">Figure 65. A view of GDDM running in <em>ModelRunner</em>.</div>
</div>
<div class="paragraph">
<p>Return to <em>ModelMaker</em> and arrange the graph as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Collapse <code>system.sys1</code>.</p>
</li>
<li>
<p>Collapse all sub-trees from <code>DataDefintion:dDef</code> and then expand <code>record:glbCnt</code>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_user_interface_6"><a class="anchor" href="#_user_interface_6"></a>User interface</h5>
<div class="paragraph">
<p>To reduce the running time of the experiment, we can replace the graphic displays and just have text output to file.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Select the root node (<code>3worlds:Tut8</code>) and delete the entire <code>UserInterface:gui</code> sub-tree.</p>
</li>
<li>
<p>Add a <code>Headless</code> node as a child of <code>UserInterface:gui</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Widgets that are children of <code>Headless</code> have no visible presence except for console output. Note: you won’t see this output unless you are running <em>ModelMaker</em> from a terminal window.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Add a <code>widget</code> as a child or <code>headless:hl</code>, name it 'ctrl' and select <code>HLControlWidget1</code> as its sub-class.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This control widget can be used even if you have visible widgets. It begins the simulation without user-intervention.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Add another <code>widget</code> as a child of <code>headless:hl</code> name it 'progress' and select <code>HLProgressWidget1</code> as its sub-class.</p>
</li>
<li>
<p>Add a <code>trackTime</code> edge from <code>widget:progress</code> to <code>dynamics:sim1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This progress widget will produce progress information to the console as the experiment proceeds.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Add two more widgets as a children of <code>headless:hl</code>, name them 'fstWriter' and 'popWriter' respectively and select <code>HLTimeSeriesAnalysisWidget1</code> as their type.</p>
</li>
<li>
<p>Add a <code>trackSeries</code> edge from <code>widget:fstWriter</code> to  <code>dataTracker:trkFst</code>.</p>
</li>
<li>
<p>Add another <code>trackSeries</code> edge, this time from <code>widget:popWriter</code> to <code>dataTracker:trkMetaPop</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We can also add headless widgets to save spatial images of various 
matrices to give some visual feedback of these data for each of the 
factor combinations (i.e. dispersal distance and dispersal method). To 
do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Add two more widgets as a children of <code>headless:hl</code>, name them 'HsMapWriter' and 'popMapWriter' respectively and select <code>HLMatrixWidget1</code> as their type.</p>
</li>
<li>
<p>Add a <code>trackSeries</code> edge from <code>widget:HsMapWriter</code> to <code>dataTracker:trkHeterozygosity</code>.</p>
</li>
<li>
<p>Add another <code>trackSeries</code> edge, this time from <code>widget:popMapWriter</code> to <code>dataTracker:trkPopulationLayer</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The newly added <code>HLMatrixWidget1</code> widgets have some properties that should be set.</p>
</div>
<div class="paragraph">
<p>For the <code>HsMapWriter</code> set:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p><code>imageMagnify</code> to 6.</p>
</li>
<li>
<p><code>palette</code> to 'OrangeMauveBlue'.</p>
</li>
<li>
<p><code>sampleTimes</code> to 100 to write an image at the last (100th) time step.</p>
</li>
<li>
<p><code>zRange</code> to ']0.4,0.89[</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For the <code>popMapWriter</code> set:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p><code>imageMagnify</code> to 2.</p>
</li>
<li>
<p><code>palette</code> to 'BrownYellowGreen'.</p>
</li>
<li>
<p><code>sampleTimes</code> to 100.</p>
</li>
<li>
<p><code>zRange</code> to ']1.0,4.0[</p>
</li>
<li>
<p>Now add the optional properties to these two widgets (<code>missingValueColour</code> and <code>missingValueMethod</code>).</p>
</li>
<li>
<p>For both widgets set <code>missingValueColour</code> to 'BLACK' and <code>missingVlaueMethod</code> to 'LT_MIN'.
This means all values in the matrix less than the minimum range will be drawn as black.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_experiment"><a class="anchor" href="#_experiment"></a>Experiment</h5>
<div class="paragraph">
<p>We now define some treatments of <code>fields</code> that are children of <code>record:glbCnt</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a <code>treatment</code> node as a child of <code>experiment:exp</code>.</p>
</li>
<li>
<p>Add a <code>treats</code> edge from <code>treatment:trt</code> to <code>field:isDispersalInformed</code> and name it 'dm' (dispersal method).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This field (<code>isDispersalInformed</code>) is a boolean constant so the only treatments are 'true' and 'false'.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click on the <code>treatment:trt</code> node and, in the selected properties editor, edit the <code>dm#values</code> property by adding 'true' and 'false' on two separate lines.</p>
</li>
<li>
<p>Edit the <code>dm#valueName</code> property and enter 'inf' and 
'uninf', again on two separate line. These are the names by which the 
treatment is described in outputs.</p>
</li>
<li>
<p>Add another <code>treats</code> edge from <code>treatment:trt</code> to <code>field:isDispersalShort</code> and name it 'dd' (dispersal distance).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This field (<code>isDispersalShort</code>) is also a boolean constant.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Click on the <code>treatment:trt</code> node and, in the selected properties editor, edit the <code>dd#values</code> property by adding 'true' and 'false' on two separate lines.</p>
</li>
<li>
<p>Edit the <code>dd#valueName</code> property and enter 'short' and 'long', again, on two separate line.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To run an ANOVA:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Select the <code>design:dsgn</code> node, and in the selected properties editor set <code>design:dsgn</code> to <code>crossFactorial</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message now appears indicating that treatments must have a designated rank order for this experiment design.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Select the <code>treatment:trt</code> node again and in the selected properties editor set <code>dd#rank</code> to 1 and <code>dm#rank</code> to 2.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This model employs random number generation in many of its processes so replicates must be used.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Right-click on the <code>experiment:exp</code> node, select <code>Optional properties…​</code>, check <code>experiment:exp#nReplicates</code> and click 'ok'.</p>
</li>
<li>
<p>Select <code>experiment:exp</code> and in the selected properties editor set <code>exp#nReplicates</code> to 5.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This experiment will create 5 x 2 x 2 simulators (20) running in parallel.</p>
</div>
<div id="fig-tut8-config" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut8-config.png" alt="fig tut8 config" width="800">
</div>
<div class="title">Figure 66. Relevant parts of the configuration graph ready for running.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simulation_2"><a class="anchor" href="#_simulation_2"></a>5.8.3. Simulation</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save changes (Ctrl-S) and click the deploy button (Alt+D).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The date and experiment design type are now written to the console 
followed by a message from each simulator as it is initialised. The 
headless controller then starts the simulators and a running message is 
produced from each. The number of simulators running in parallel depends
 on the number of cores on your machine. The experiment takes about 5 
minutes on a 16 core machine.
The ODD documentation is generated automatically at the end of the 
experiment.</p>
</div>
<div id="fig-tut8-consoleOutput" class="imageblock text-left thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut8-consoleOutput.png" alt="fig tut8 consoleOutput" width="450">
</div>
<div class="title">Figure 67. Console output produced when running Tutorial 8 experiment.</div>
</div>
</div>
<div class="sect3">
<h4 id="_results"><a class="anchor" href="#_results"></a>5.8.4. Results</h4>
<div class="paragraph">
<p>The results of the experiment can be found in 4 directories with the names of the experiment widgets <code>fstWriter</code>, <code>popWriter</code>, <code>HsMapWriter</code> and <code>popMapWriter</code>.</p>
</div>
<div id="fig-tut8-expDirs" class="imageblock right text-center thumb">
<div class="content">
<img src="AsciiDoctor%20Editor%20temporary%20output_files/fig-tut8-expDirs.png" alt="fig tut8 expDirs" width="200">
</div>
<div class="title">Figure 68. Directory structure <br> created by the <code>fstWriter</code> <br> and <code>popWriter</code> widgets.</div>
</div>
<div class="paragraph">
<p>The widgets <code>fstWriter</code> and <code>popWriter</code> have produced the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Design.csv</strong>: Experiment design details.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;.csv</strong>: time series of the data from each simulator</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_avg.csv</strong>: time series of the data averaged over simulators</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_anova.R</strong>: R script for the anova computation.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_boxplots.R</strong>: R script for creating box plots of the output.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_barplots.R</strong>: R script for creating a bar plot of the output.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_RVEplot.svg</strong>: A plot, created by R, of the relative variance explained by each of the terms of the ANOVA.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_boxplots.svg</strong>: A box plot, created by R, response variable to each of the treatments.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_barplots.svg</strong>: A bar chart, 
created by R, of the response variable to each of the factor 
combinations (i.e. each simulation averaged over replicates).</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_AnovaInput.csv</strong>: table of data by treatment value name presented to R.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_anovaResults.csv</strong>: raw results produced by R.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_RelSumSq.csv</strong>: variance explained relative to the total explained.</p>
</li>
<li>
<p><strong>&lt;Field name&gt;_var.csv</strong>: variance in time series over replicates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The widgets <code>HsMapWriter</code> and <code>popMapWriter</code> will also have produced (a duplicate) of the 'Design.csv' file and one *.svg image for each of the simulations.
These files will have the following naming convention:</p>
</div>
<div class="paragraph">
<p><strong>r&lt;replicate number&gt;_s&lt;simulator number&gt;\_t&lt;time step&gt;\_&lt;factor level&gt;</strong></p>
</div>
<div class="paragraph">
<p>The factors with be in the order set by the <code>rank</code> property (step 9 in the Experiment section above).</p>
</div>
<div class="paragraph">
<p>Examining <strong>Fst_RVEplot.svg</strong> and <strong>population_RVEplot.svg</strong>
 we can see that most of the variation in Fst is explained by dispersal 
distance (dd)(63%) and Dispersal method (dm) is the most important 
factor in explaining variation in population size (67%).</p>
</div>
<div class="paragraph">
<p>Fst was increased by short distance dispersal and to a lesser extent by uninformed dispersal (<strong>Fst_boxplots.svg</strong> and <strong>Fst_barplot.svg</strong>).</p>
</div>
<div class="paragraph">
<p>Population was increased by informed dispersal and to a lesser extent by long distance dispersal (<strong>population_boxplots.svg</strong> and <strong>population_barplot.svg</strong>)</p>
</div>
<div class="paragraph">
<p>You can recreate this tutorial by selecting <code>new → tutorials → 12 Running experiments</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="_bibliography"><a class="anchor" href="#_bibliography"></a>Bibliography</h2>
<div class="sectionbody">
<div id="Bousquet2004" class="paragraph">
<p>Bousquet, F., &amp; Le Page, C. (2004). Multi-agent simulations and ecosystem management: a review. <em>Ecological Modelling</em>, 176:313–332. <a href="https://doi.org/10.1016/j.ecolmodel.2004.01.011" class="bare">https://doi.org/10.1016/j.ecolmodel.2004.01.011</a></p>
</div>
<div id="Connell1978" class="paragraph">
<p>Connell, J.H. (1978). Diversity in tropical rain forests and coral 
reefs - high diversity of trees and corals is maintained only in a 
nonequilibrium state. <em>Science</em> 199:1302–1310</p>
</div>
<div id="Coquillard1997" class="paragraph">
<p>Coquillard, P., &amp; Hill, D. (1997). <em>Modélisation et simulation d’écosystèmes. Des modèles déterministes aux simulations à événements discrets</em>. Masson, Paris.</p>
</div>
<div id="Flint2006" class="paragraph">
<p>Flint, S. R. (2006). <em>Aspect-Oriented Thinking - An approach to bridging the disciplinary divides</em>. PhD, Australian National University. <a href="https://openresearch-repository.anu.edu.au/handle/1885/49328" class="bare">https://openresearch-repository.anu.edu.au/handle/1885/49328</a></p>
</div>
<div id="Gignoux2011" class="paragraph">
<p>Gignoux, J., I.D. Davies, S.R. Flint, &amp; J.D. Zucker (2011). The Ecosystem in Practice: Interest and
Problems of an Old Definition for Constructing Ecological Models. <em>Ecosystems</em> 14: 1039‑54. <a href="https://doi.org/10.1007/s10021-011-9466-2" class="bare">https://doi.org/10.1007/s10021-011-9466-2</a>.</p>
</div>
<div id="Gignoux2017" class="paragraph">
<p>Gignoux, J., G. Chérel, I.D. Davies, S.R. Flint, &amp; E. Lateltin (2017). Emergence and Complex Systems: The
Contribution of Dynamic Graph Theory. <em>Ecological Complexity</em> 31: 34‑49. <a href="https://doi.org/10.1016/j.ecocom.2017.02.006" class="bare">https://doi.org/10.1016/j.ecocom.2017.02.006</a>.</p>
</div>
<div id="Grimm2005" class="paragraph">
<p>Grimm, V., &amp; Railsback, S. (2005). <em>Individual-based modelling and ecology</em>. Princeton University Press.</p>
</div>
<div id="Grimm2010" class="paragraph">
<p>Grimm V, Berger U, DeAngelis DL, Polhill JG, Giske J, Railsback SF (2010) The ODD protocol: A review and first update. <em>Ecological Modelling</em> 221:2760–2768.</p>
</div>
<div id="Harary1997" class="paragraph">
<p>Harary, F., &amp; Gupta, G. (1997). Dynamic graph models. <em>Mathematical and Computer Modelling</em>, 25(7), 79–87. <a href="https://doi.org/10.1016/S0895-7177(97)00050-2" class="bare">https://doi.org/10.1016/S0895-7177(97)00050-2</a></p>
</div>
<div id="Lim2009" class="paragraph">
<p>Lim, W. H., &amp; Roderick, M. L. (2009). <em>An atlas of the global water cycle based on the IPCC AR4 climate models.</em> ANU E Press.</p>
</div>
<div id="Melilo1995" class="paragraph">
<p>Melilo, J. M., Borchers, J., Chaney, J., Fisher, H., Fox, S., 
Haxeltine, A., Janetos, A., Kicklighter, D. C., Kittel, T. G. F., 
McGuire, A. D., McKeown, R., Neilson, R., Nemani, R., Ojima, D. S., 
Painter, T., Pan, Y., Parton, W. J., Pierce, L., Pitelka, L., … 
Woodward, F. I. (1995). Vegetation/ecosystem modeling and analysis 
project: comparing biogeography and biogeochemistry models in a 
continental-scale study of terrestrial ecosystem responses to climate 
change and CO<sub>2</sub> doubling. <em>Global Biogeochemical Cycles</em>, 9(4), 407–437.</p>
</div>
<div id="Parton1988" class="paragraph">
<p>Parton, W., Stewart, J., &amp; Cole, C. (1988). Dynamics of C,N, P and S in grassland soils: a model. <em>Biogeochemistry</em>, 5, 109–131.</p>
</div>
<div id="Quesnel2009" class="paragraph">
<p>Quesnel G, Duboz R, Ramat E (2009). The Virtual Laboratory 
Environment - An operational framework for multi-modelling, simulation 
and analysis of complex dynamical systems. <em>Simulation Modelling Practice and Theory</em> 17:641–653.</p>
</div>
<div id="Roxburgh2004" class="paragraph">
<p>Roxburgh, S. H., Barrett, D. J., Berry, S. L., Carter, J. O., Davies,
 I. D., Gifford, R. M., Kirschbaum, M. U. E., McBeth, B. P., Noble, I. 
R., Parton, W. G., Raupach, M. R., &amp; Roderick, M. L. (2004). A 
critical overview of model estimates of net primary productivity for the
 Australian continent. <em>Functional Plant Biology</em>, 31(11), 1043–1059.</p>
</div>
<div id="Tansley1935" class="paragraph">
<p>Tansley, A G. (1935). The use and abuse of vegetational concepts and terms. <em>Ecology</em> 16: 284‑307.</p>
</div>
<div id="Zeigler2000" class="paragraph">
<p>Zeigler B, Kim TG, Praehofer H (2000) <em>Theory of Modeling and Simulation : integrating discrete event and continuous complex dynamic systems</em>. Academic Press</p>
</div>
<div id="Zucker2003" class="paragraph">
<p>Zucker, J.D. (2003). A Grounded Theory of Abstraction in Artificial Intelligence. <em>Philosophical Transactions of
the Royal Society B: Biological Sciences</em> 358: 1293‑1309. <a href="https://doi.org/10.1098/rstb.2003.1308" class="bare">https://doi.org/10.1098/rstb.2003.1308</a>.</p>
</div>
</div>
</div>
<script blocktype="text/javascript">
function doScrollTo(anchorId){
   element = document.getElementById(anchorId);
   if (element !=null) {
        element.scrollIntoView();
   }
}
</script></body></html>