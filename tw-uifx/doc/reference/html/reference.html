<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.8.dev">
<meta name="author" content="Jacques Gignoux, Ian D. Davies, Shayne R. Flint">
<title>3Worlds user manual</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>3Worlds user manual</h1>
<div class="details">
<span id="author" class="author">Jacques Gignoux</span><br>
<span id="email" class="email"><a href="mailto:jacques.gignoux@upmc.fr">jacques.gignoux@upmc.fr</a></span><br>
<span id="author2" class="author">Ian D. Davies</span><br>
<span id="email2" class="email"><a href="mailto:ian.davies@anu.edu.au">ian.davies@anu.edu.au</a></span><br>
<span id="author3" class="author">Shayne R. Flint</span><br>
<span id="email3" class="email"><a href="mailto:shayne.flint@anu.edu.au">shayne.flint@anu.edu.au</a></span><br>
<span id="revnumber">version 1.7,</span>
<span id="revdate">2 June 2021</span>
<br><span id="revremark"></span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#truepurpose-and-motivation">1. Purpose and motivation</a>
<ul class="sectlevel2">
<li><a href="#truewhy-another-simulation-environment-for-ecology">1.1. Why another simulation environment for ecology?</a></li>
<li><a href="#truedesign-concepts">1.2. Design Concepts</a>
<ul class="sectlevel3">
<li><a href="#trueindividual-based-models">1.2.1. Individual based models</a></li>
<li><a href="#truethe-complex-system-as-a-dynamic-graph">1.2.2. The complex system as a dynamic graph</a></li>
<li><a href="#truecategories">1.2.3. Categories</a></li>
<li><a href="#truetime-with-simultaneous-events">1.2.4. Time with simultaneous events</a></li>
<li><a href="#truecausality">1.2.5. Causality</a></li>
<li><a href="#truespace-as-a-mediator-for-interactions">1.2.6. Space as a mediator for interactions</a></li>
<li><a href="#truemodelling-made-easy">1.2.7. Modelling made easy</a></li>
<li><a href="#truemodel-comparison-graphs-can-be-compared">1.2.8. Model comparison: graphs can be compared</a></li>
<li><a href="#trueproblem-upscaling">1.2.9. Problem upscaling</a></li>
<li><a href="#trueportability-and-performance">1.2.10. Portability and performance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#truegetting-started-download-and-installation">2. Getting started - download and installation</a>
<ul class="sectlevel2">
<li><a href="#truebasics-what-you-must-know-before-starting">2.1. Basics - what you must know before starting</a></li>
<li><a href="#trueprerequisites">2.2. Prerequisites</a></li>
<li><a href="#truerunning-modelmaker">2.3. Running ModelMaker</a></li>
<li><a href="#truesetting-up-a-java-development-environment-for-the-user-code">2.4. Setting up a Java development environment for the user code</a>
<ul class="sectlevel3">
<li><a href="#truesetting-up-the-eclipse-integrated-development-environment-ide-for-3worlds">2.4.1. Setting up the Eclipse Integrated Development Environment (IDE) for 3Worlds</a></li>
<li><a href="#truerunning-modelmaker-from-eclipse">2.4.2. Running ModelMaker from Eclipse</a></li>
<li><a href="#truelinking-user-code-with-model-configuration">2.4.3. Linking user code with model configuration</a></li>
<li><a href="#truedebugging-and-testing-user-code">2.4.4. Debugging and testing user code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#trueconfiguration-reference-creating-and-editing-a-model-with-modelmaker">3. Configuration reference: creating and editing a model with ModelMaker</a>
<ul class="sectlevel2">
<li><a href="#truegeneral-concepts-structure-of-a-3worlds-configuration">3.1. General concepts: structure of a 3Worlds configuration</a>
<ul class="sectlevel3">
<li><a href="#truea-tree-structure">3.1.1. A tree structure&#8230;&#8203;</a></li>
<li><a href="#truewith-cross-links">3.1.2. &#8230;&#8203;with cross-links</a></li>
<li><a href="#truewhat-modelmaker-does-for-you">3.1.3. What ModelMaker does for you</a></li>
</ul>
</li>
<li><a href="#trueusing-modelmaker-software-interface-and-functioning">3.2. Using ModelMaker: software interface and functioning</a>
<ul class="sectlevel3">
<li><a href="#truemain-menu">3.2.1. Main menu</a></li>
<li><a href="#truegraph-display">3.2.2. Graph display</a></li>
<li><a href="#trueproperty-editors">3.2.3. Property editors</a></li>
<li><a href="#truemessage-pane">3.2.4. Message pane</a></li>
</ul>
</li>
<li><a href="#trueconfiguration-options-reference">3.3. Configuration options: reference</a>
<ul class="sectlevel3">
<li><a href="#truethe-3worlds-node">3.3.1. The <em>3Worlds</em> node</a></li>
<li><a href="#truethe-system-node">3.3.2. The <em>system</em> node</a></li>
<li><a href="#truethe-systemstructure-node">3.3.3. The <em>system/structure</em> node</a></li>
<li><a href="#truethe-systemdynamics-node">3.3.4. The <em>system/dynamics</em> node</a></li>
<li><a href="#truethe-datadefinition-node">3.3.5. The <em>dataDefinition</em> node</a></li>
<li><a href="#truethe-experiment-node">3.3.6. The <em>experiment</em> node</a></li>
<li><a href="#truethe-userinterface-node">3.3.7. The <em>userInterface</em> node</a></li>
<li><a href="#truethe-predefined-sub-tree">3.3.8. The <em>predefined</em> sub-tree</a></li>
</ul>
</li>
<li><a href="#truedeveloping-and-testing-model-code">3.4. Developing and testing model code</a>
<ul class="sectlevel3">
<li><a href="#truegenerated-code-the-model-main-class">3.4.1. Generated code: the <em>model main class</em></a></li>
<li><a href="#truemodel-main-class-method-arguments">3.4.2. <em>Model main class</em> method arguments</a></li>
<li><a href="#trueusing-space-in-user-code">3.4.3. Using <em>space</em> in user code</a></li>
<li><a href="#trueaccessing-complex-data-structure">3.4.4. Accessing complex data structure</a></li>
</ul>
</li>
<li><a href="#truefeeding-the-model-with-data">3.5. Feeding the model with data</a>
<ul class="sectlevel3">
<li><a href="#truedata-uses">3.5.1. Data uses</a></li>
<li><a href="#truedata-input-methods">3.5.2. Data input methods</a></li>
<li><a href="#trueconsistency-of-data-files-with-the-model-component-hierarchy">3.5.3. Consistency of data files with the model component hierarchy</a></li>
<li><a href="#truedata-file-formats">3.5.4. Data file formats</a></li>
<li><a href="#trueimport-data-from-external-sources">3.5.5. Import data from external sources</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#truesimulation-reference-running-a-simulation-experiment-with-modelrunner">4. Simulation reference: running a simulation experiment with ModelRunner</a>
<ul class="sectlevel2">
<li><a href="#truegeneral-concepts">4.1. General concepts</a></li>
<li><a href="#trueusing-modelrunner-software-interface-and-functioning">4.2. Using ModelRunner: software interface and functioning</a></li>
<li><a href="#truegetting-output-from-a-simulation-experiment">4.3. Getting output from a simulation experiment</a></li>
</ul>
</li>
<li><a href="#truesample-models-and-tutorials">5. Sample models and tutorials</a>
<ul class="sectlevel2">
<li><a href="#truetutorial-1-construct-and-run-a-simulation-for-the-first-time">5.1. Tutorial 1: Construct and run a simulation for the first time</a>
<ul class="sectlevel3">
<li><a href="#trueintroduction">5.1.1. Introduction</a></li>
<li><a href="#trueinstallation">5.1.2. Installation</a></li>
<li><a href="#truecreating-a-new-3worlds-project">5.1.3. Creating a new 3Worlds project</a></li>
<li><a href="#truecreating-the-specifications">5.1.4. Creating the specifications</a></li>
<li><a href="#truegraph-layouts">5.1.5. Graph layouts</a></li>
<li><a href="#truenext">5.1.6. Next</a></li>
</ul>
</li>
<li><a href="#truetutorial-2-linking-a-3worlds-project-to-a-integrated-development-environment-ide">5.2. Tutorial 2: Linking a <em>3Worlds</em> project to a Integrated Development Environment (IDE)</a>
<ul class="sectlevel3">
<li><a href="#trueintroduction-2">5.2.1. Introduction</a></li>
<li><a href="#truenew-java-project">5.2.2. New Java project</a></li>
<li><a href="#truespecifications">5.2.3. Specifications</a></li>
<li><a href="#truewriting-java-code">5.2.4. Writing Java code</a></li>
<li><a href="#truenext-2">5.2.5. Next</a></li>
</ul>
</li>
<li><a href="#truetutorial-3-using-tables">5.3. Tutorial 3: Using tables</a>
<ul class="sectlevel3">
<li><a href="#trueintroduction-3">5.3.1. Introduction</a></li>
<li><a href="#truespecifications-2">5.3.2. Specifications</a></li>
<li><a href="#truenext-3">5.3.3. Next</a></li>
</ul>
</li>
<li><a href="#truetutorial-4-elaborating-the-model-structure-testing-the-intermediate-disturbance-hypothesis">5.4. Tutorial 4: Elaborating the model structure: Testing the Intermediate Disturbance Hypothesis</a>
<ul class="sectlevel3">
<li><a href="#trueintroduction-4">5.4.1. Introduction</a></li>
<li><a href="#truespecifications-3">5.4.2. Specifications</a></li>
<li><a href="#trueuser-interface-2">5.4.3. User interface</a></li>
<li><a href="#truenext-4">5.4.4. Next</a></li>
</ul>
</li>
<li><a href="#truetutorial-5-event-driven-systems-using-the-event-timer">5.5. Tutorial 5: Event driven systems - Using the Event Timer</a>
<ul class="sectlevel3">
<li><a href="#trueintroduction-5">5.5.1. Introduction</a></li>
<li><a href="#truespecifications-4">5.5.2. Specifications</a></li>
<li><a href="#truenext-5">5.5.3. Next</a></li>
</ul>
</li>
<li><a href="#truetutorial-6-event-driven-systems-using-the-event-timer-in-a-spatial-model">5.6. Tutorial 6: Event driven systems - Using the Event Timer in a spatial model</a>
<ul class="sectlevel3">
<li><a href="#trueintroduction-6">5.6.1. Introduction</a></li>
<li><a href="#truespecifications-5">5.6.2. Specifications</a></li>
<li><a href="#truenext-6">5.6.3. Next</a></li>
</ul>
</li>
<li><a href="#truetutorial-7-random-number-generators">5.7. Tutorial 7: Random number generators</a>
<ul class="sectlevel3">
<li><a href="#trueintroduction-7">5.7.1. Introduction</a></li>
<li><a href="#truespecifications-6">5.7.2. Specifications</a></li>
<li><a href="#truesimulation">5.7.3. Simulation</a></li>
<li><a href="#truenext-7">5.7.4. Next</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#truebibliography">Bibliography</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>by <strong>Jacques Gignoux</strong>, <strong>Ian D. Davies</strong> &amp; <strong>Shayne R. Flint</strong></p>
</div>
<div class="paragraph">
<p>Version: <strong>1.7</strong> (2 June 2021)</p>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="truepurpose-and-motivation"><a class="anchor" href="#truepurpose-and-motivation"></a>1. Purpose and motivation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="truewhy-another-simulation-environment-for-ecology"><a class="anchor" href="#truewhy-another-simulation-environment-for-ecology"></a>1.1. Why another simulation environment for ecology?</h3>
<div class="paragraph">
<p><em>“Though the organisms may claim our primary interest, when we are trying to think fundamentally we cannot separate them from their special environment, with which they form
one physical system”</em> A. G. <a href="#Tansley1935">Tanlsey (1935)</a>.</p>
</div>
<div class="paragraph">
<p>Ecosystems, as first proposed by Arthur <a href="#Tansley1935">Tansley (1935)</a>, have both physical and biological aspects. They comprise not only energy and chemical stocks and flows but also living things that are born, reproduce and die, exhibiting particular behaviours over the course of their existence. They are made from and return to the physical world, are part of it and at the same time, constitute a domain where terms such as reproduction, social interaction, communication and life cycle have meaning.</p>
</div>
<div class="paragraph">
<p>To this day, reconciling these two aspects, where the physical is articulated in SI units and the biological in descriptive terms (e. g. heterotroph, shade-tolerant, obligate seeder), remains a key problem in ecosystem studies: How does an energy flux translate into a number of living individuals or in a higher biodiversity? How might a particular reproduction strategy affect river hydrology and the regional water budget (e. g. the beaver)? How do social interactions affect the frequency of hurricanes (e. g. climate change)?
<strong>3Worlds</strong> aims at providing <em>a tool for building simulations that couple the physical and biological aspects of ecosystems</em>.</p>
</div>
<div class="paragraph">
<p>It is our view that existing tools focus predominantly on one or other of these aspects. For example, dynamic models based on differential equations and can only represent reproduction and growth using metaphors for continuous physical quantities (e.g. matrix population models). Multi-agent systems (MAS), on the other hand, model social interactions well but pose difficulties in balancing mass or energy budgets.</p>
</div>
<div class="paragraph">
<p>In addition to this physical and biological duality, ecosystems are '<em>multi-scale</em>' (cf. an extensive discussion on
this topic and other questions related to the ecosystem concept in <a href="#Gignoux2011">Gignoux et al. 2011</a>). Tansley&#8217;s ecosystem definition
applies equally well to the whole biosphere as to a single bacteria in a drop of water. Currently, there is no
software enabling one to consider ecosystems at such different spatial and temporal scales within the same
conceptual framework. A second aim of <strong>3Worlds</strong> is to fill this gap. If the ecosystem concept is robust enough, and
we believe it is given its success in ecology and its adoption in other scientific fields, then it should be possible
to design a conceptually sound and consistent computing framework to deal with a multiplicity of scales.</p>
</div>
<div class="paragraph">
<p>However, changing the scale of a model is not just a matter of changing spatio-temporal resolution.
It also involves the level of detail of the representations used in the model, something which has been formalized
in <em>abstraction theory</em> (<a href="#Zucker2003">Zucker 2003</a>): the more detailed a model, the less abstract it is. The question arises then as to what level of detail should we model our system to capture its important behaviour? How does changing scale (in this
 broadest sense) effect model outcomes? There can be no general answer to this question beyond trial and error. This makes the possibility
 to test and compare different representations of the same system at different scales an essential feature of
 any software dealing with ecosystems. <strong>3Worlds</strong> provides <em>great flexibility in ecosystem representation</em>
 enabling one to represent <em>any</em> ecosystem at <em>any</em> spatial and temporal scale with <em>any</em> level of detail&#8201;&#8212;&#8201;all this being determined by
 the researcher in accordance with the purpose of their study. The researcher has full control on the detailed biological functions
and variables relevant to their study.</p>
</div>
<div class="paragraph">
<p>How is this flexibility compatible with the strong conceptual backbone? <strong>3Worlds</strong> uses <em>aspect-oriented thinking (AOT)</em> (<a href="#Flint2006">Flint 2006</a>), a method to build complex systems (e.g.
software) from independent areas of knowledge. We have designed an <em>archetype</em> of what we believe constitutes an
ecosystem&#8201;&#8212;&#8201;a recursive and multi-scale system of interacting entities. We use an implementation of AOT to ensure
that any user-defined representation of an ecosystem complies with the archetype. This guarantees that, despite a
great freedom left to the modeller, their model will always be compatible with the 3Worlds software. The great
benefit of this is that while we believe it’s possible to construct any type of
model within this archetype, imposing specification constraints greatly assists in model comparison: why should
two models, ostensibly constructed for the same purpose, differ in their outputs? How does a change in temporal
or spatial scale affect projections?  How does adding or removing sub-systems change model projections?
<em>Models developed in <strong>3Worlds</strong> are always comparable</em>,  unlike many large model intercomparison exercises where the models are independently developed without reference to any common structuring principals.</p>
</div>
<div class="paragraph">
<p>The ecosystem is a recursive concept (<a href="#Gignoux2001">Gignoux et al. 2011</a>): ecosystems can be nested. Parts of an ecosystem can
be studied as ecosystems themselves. We use the concept of a hierarchical system, formalized as a graph (<a href="#Gignoux2017">Gignoux et
al. 2017</a>) to implement this idea. In <strong>3Worlds</strong>, <em>the modelled ecosystem is a graph</em> where nodes represent relevant
entities: individuals, populations, climate, soil, area, &#8230;&#8203;; and edges represent relations between these entities.
These relations can be of any kind, including a hierarchical relation describing the complex nesting of sub-systems.
This provides an elegant solution to the apparent complexity of ecosystems: it allows for various types of <em>emergence</em>,
enables the comparison of system structures and simulation trajectories, and can represent virtually anything
an ecological modeller can conceive of.</p>
</div>
<div class="paragraph">
<p><strong>3Worlds</strong> builds upon more than thirty years of experience of its developers in ecosystem and complex system modelling and simulation. Over this time, we have reached the conclusion that: (1) robust concepts
are fundamental for building sound software; (2) some problems, that appear over and over again in the life of a
simulation modeller, often have well-established solutions, sometimes in other scientific fields; and (3) complex
systems are more easily managed and understood when designed within a sound framework.</p>
</div>
<div class="paragraph">
<p>Many of the ideas we use are already available, it&#8217;s just a matter of making them work together, and <strong>3Worlds</strong> is our best attempt to do so!</p>
</div>
</div>
<div class="sect2">
<h3 id="truedesign-concepts"><a class="anchor" href="#truedesign-concepts"></a>1.2. Design Concepts</h3>
<div class="paragraph">
<p>3Worlds is based on a few concepts and techniques that have a very broad application and harnesses them to fit the needs of ecosystem modelling.</p>
</div>
<div class="sect3">
<h4 id="trueindividual-based-models"><a class="anchor" href="#trueindividual-based-models"></a>1.2.1. Individual based models</h4>
<div class="paragraph">
<p>Fundamentally, <strong>3Worlds</strong> is designed as a framework for <em>individual-based models</em> (IBMs: <a href="#Grimm2005">Grimm &amp; Railsback 2005</a>). IBMs, like multi-agent systems (MASs: <a href="#Bousquet2004">Bousquet &amp; Lepage 2004</a>), assume that some important properties of complex systems (like ecosystems and human societies) cannot be understood without representing the detailed behaviour of every individual in the system. In an IBM, a list of 'individuals' (called 'agents' in MASs) is kept in memory, and their interactions through various functions yield the dynamics of the whole system over time. Individuals can come and go, which means that their list is constantly changing in size.</p>
</div>
<div class="paragraph">
<p>3Worlds simulates a <em>system</em> made of interacting <em>system components</em>, which are equivalent to the individuals or agents of IBMs and MASs. If required by a simple application, the 3Worlds <em>system</em> can be reduced to zero components, just as in any system dynamics application; but this is not the use 3Worlds has been designed for, and other more specialised software may be more adapted for this use case.</p>
</div>
</div>
<div class="sect3">
<h4 id="truethe-complex-system-as-a-dynamic-graph"><a class="anchor" href="#truethe-complex-system-as-a-dynamic-graph"></a>1.2.2. The complex system as a dynamic graph</h4>
<div class="paragraph">
<p>Ecosystems are commonly considered as <em>complex systems</em>, without much agreement on what this concept means. Complex systems are usually assumed to possess <em>emergent properties</em>; again, with little agreement on what this means. We argued in <a href="#Gignoux2017">Gignoux et al. (2017)</a> that the only common feature of all definitions of emergence is that emergence can only appear in systems with a 'macro-state' and 'micro-states'. We called such systems <em>hierarchical systems</em> and assumed that they can be ideally represented with a <em>dynamic graph</em>.</p>
</div>
<div id="fig-what-is-a-graph" class="imageblock left text-center thumb">
<div class="content">
<img src="../source/purposeIMG/graph.svg" alt="graph">
</div>
<div class="title">Figure 1. A mathematical graph, showing both the usual <br/> mathematical terms and the vocabulary used in 3Worlds. <br/> The incidence function defines edges between nodes. Edges <br/>can be directed (with arrows) or undirected.</div>
</div>
<div class="paragraph">
<p>According to <a href="https://en.wikipedia.org/wiki/Graph_theory">graph theory</a>, a <em>graph</em> is a mathematical construct comprising a set of <em>nodes</em>, a set of <em>edges</em> linking these nodes defined in an <em>incidence function</em> (<a href="#fig-what-is-a-graph">Figure 1</a>). A <em>dynamic</em> graph (<a href="#Harary1997">Harary &amp; Gupta 1997</a>) is a graph where these three components (the sets of nodes, edges, and the incidence function) can change over time.</p>
</div>
<div class="paragraph">
<p>With the addition of <em>descriptors</em> (e.g. numbers with a specific meaning: <a href="#fig-graph-descriptors">Figure 2</a>) to nodes and edges, we can use the graph nodes as the individuals of our IBM, and the graph edges give a concrete existence to the interactions between those nodes. If we define <em>functions</em> that can modify nodes and edges and their descriptors, the graph becomes dynamic. A <strong>3Worlds</strong> simulation runs a dynamic graph where nodes, edges, descriptors, functions can be adapted to the user&#8217;s particular application. Nodes are called <em>system components</em>, edges <em>system relations</em>, and descriptors <em>properties</em>.</p>
</div>
<div id="fig-graph-descriptors" class="imageblock text-center thumb">
<div class="content">
<img src="../source/purposeIMG/graph-with-descriptors.svg" alt="graph with descriptors" width="80%">
</div>
<div class="title">Figure 2. An example of graph descriptors (redrawn from <a href="#Gignoux2017">Gignoux et al. 2017</a>).</div>
</div>
</div>
<div class="sect3">
<h4 id="truecategories"><a class="anchor" href="#truecategories"></a>1.2.3. Categories</h4>
<div class="paragraph">
<p>In an IBM, every individual differs from all others. But it is common practice to assume that some groups of individuals share some things in common. This is the essence of modelling: finding commonalities within an ocean of particular cases. We use the concept of <em>category</em> to group system components that 'look like each other' in some way. Categories are used to express how alike and how different certain groups of components are from each other.</p>
</div>
<div class="paragraph">
<p>In a dynamic graph, categories are used to specify common descriptors to groups of components (e.g. a plant species average growth rate, an animal cohort survival rate, &#8230;&#8203;) and functions that operate on a group of components of the same category. They are also used to specify which <em>type of relation</em> is possible between components of different categories.</p>
</div>
<div class="paragraph">
<p>This category concept is similar in many ways to the class concept used in the <a href="http://uml.org/what-is-uml.htm">UML</a> language and in  <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">object oriented programming</a>. Categories can be nested, and can be exclusive of each other or not, that is, something can belong to one category of a set of caterories but not others within the same set e.g you can be <em>ephemeral</em> or <em>persistant</em> but not both. They are central to the organisation and execution of a simulation in <strong>3Worlds</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="truetime-with-simultaneous-events"><a class="anchor" href="#truetime-with-simultaneous-events"></a>1.2.4. Time with simultaneous events</h4>
<div id="fig-3w-main-loop" class="imageblock right text-center thumb">
<div class="content">
<img src="../source/purposeIMG/state-change-loop.svg" alt="state change loop" width="500">
</div>
<div class="title">Figure 3. The time model of 3Worlds. The overall dynamics of a system is <br/> computed as X(t+dt) = f(X(t)) where X represents the state of all system <br/> components, t is time and f is the function (or rather, the set of functions) <br/> used to compute the change over the time interval dt.</div>
</div>
<div class="paragraph">
<p>Because ecosystems have both biological and physical characteristics, they not only deal with individuals and populations of living organisms, but also with fluxes of matter and energy. To properly compute a mass or energy balance typical of physical questions, we need a time model that insures that all system components are modified synchronously - otherwise, leaks in mass and energy budgets may occur (<a href="#fig-3w-main-loop">Figure 3</a>). This is where IBMs differ somewhat from MASs in their most common current implementations: MASs emphasize the <em>autonomy</em> of agents by allowing them to modify their state immediately. In other words, MASs assume that no two events occurring in a simulation can be simultaneous, while mass/energy balance requires simultaneity of events. 3Worlds assumes that simultaneous events are the default, but by using particular time models it is possible to relax this constraint.</p>
</div>
<div class="paragraph">
<p>Given the diversity of topics subject to ecological modelling, ecological processes span many orders of magnitude in their rate of action. Demographic models often use a yearly time step, while ecophysiological models may use daily time steps and physiological models may run with time steps of a second. In <strong>3Worlds</strong>, time steps span the whole scale of time units relevant to ecology, i.e. from milliseconds to millenia. Standard Gregorian calendar time can also be used. <strong>3Worlds</strong> provides three types of <em>time model</em> that can be used in interaction: '<em>clock</em>' models using a constant time step, <em>event-driven </em>time models where time events trigger computations that can generate further events in the future, and <em>scenarios</em> where the list of events determines when computations are to be made.</p>
</div>
</div>
<div class="sect3">
<h4 id="truecausality"><a class="anchor" href="#truecausality"></a>1.2.5. Causality</h4>
<div class="paragraph">
<p>When designing a model in practice, it appears that some computations can or must be made 'in parallel' while others must be made sequentially. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>before computing how much carbon a plant allocates to its roots or to its stems, one has to know how much carbon was gained from photosynthesis: within a time step, photosynthesis must be computed before allocation.</p>
</li>
</ul>
</div>
<div id="fig-3w-causal-loop" class="imageblock left">
<div class="content">
<img src="../source/purposeIMG/causal-loop.svg" alt="causal loop" width="400">
</div>
<div class="title">Figure 4. The causal loop within the time loop of 3Worlds. <br/>Within a time step, computations are ordered by causal <br/> dependency and processed accordingly. Intermediate state <br/>and graph structure changes follow each causal step.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>before computing how much nitrogen an animal gets from its food according to its digesting system, one has to know how much food was ingested: food intake must be computed before digestion outcome.</p>
</li>
<li>
<p>water runoff in a water catchment is triggered by rainfall.</p>
</li>
<li>
<p>to compute competition for a shared resource, one has first to compute how much resource is available, how much demand there is for this resource by the organisms having an access to it, and then which share they will get based on some rule. Resource availability must be computed before demand and demand before uptake.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these examples, 'A must be computed before B' must be understood as 'A is the cause of B'. This 'before' does not refer to time scale: no matter at what scale we measure, think, or compute, a cause must be computed before its effect. It would be nonsense to compute things in another way.</p>
</div>
<div class="paragraph">
<p>In other words, the order of computations in a simulator does not only depend on time ordering, but also on the logic of causality implied by modelling choices.</p>
</div>
<div class="paragraph">
<p>This need for some ordering of computations within a time grain is important and was identified as such in implementations (<a href="#Quesnel2009">Quesnel et al. 2009</a>) of versatile simulation timing tools such as <a href="https://fr.wikipedia.org/wiki/Discrete_Event_System_Specification">DEVS</a> (<a href="#Zeigler2000">Zeigler et al. 2000</a>). In 3Worlds, the elementary time step of <a href="#truetime-with-simultaneous-events">Section 1.2.4</a> is sub-divided into <em>causal</em> steps, enabling to proceed to computations in a meaningful order, and with intermediate update of state and graph structure (<a href="#fig-3w-causal-loop">Figure 4</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="truespace-as-a-mediator-for-interactions"><a class="anchor" href="#truespace-as-a-mediator-for-interactions"></a>1.2.6. Space as a mediator for interactions</h4>
<div class="paragraph">
<p>IBMs are often 'spatialized', which means they include some representation of the physical space in which organisms of an ecosystem interact. We argued in <a href="#Gignoux2011">Gignoux et al. (2011)</a> that space is not a requirement of the ecosystem definition, but rather an optional feature. Besides the usual 3-dimensional space, we called the place where organisms interact in an ecosystem the <em>arena</em>, i.e. the place where things happen and where a public (of ecological modellers) is watching them. This does not mean an Euclidian (or any other kind of) space must be associated with the ecosystem representation. Using a dynamic graph is sufficient.</p>
</div>
<div class="paragraph">
<p>However, it is often the case that explicitly considering space in a model is necessary for computing ecological interactions. In most ecological process models, there are actually implicit assumptions about space and how it affects organism interactions. For example, seed dispersal in plants is easily computed in a 2-dimensional space where the location of seeds depends on that of parent plants and some simple distance law; water flow in a catchment relies on a 2-dimensional space plus an elevation of ground surface to some x and y resolution; competition between individual trees in a forest assume a vertical distribution of leaves depicted with varying degrees of detail.</p>
</div>
<div class="paragraph">
<p>Following <a href="#Gignoux2011">Gignoux et al. (2011)</a>, we optionally provide predefined spatial representations to include in a simulator. Different spaces can be used within a single simulator, depending on the needs of the process computations. They are associated with optimal search algorithms (e.g. Kd-trees) that speed up the search of components with which to form dynamic relations.</p>
</div>
</div>
<div class="sect3">
<h4 id="truemodelling-made-easy"><a class="anchor" href="#truemodelling-made-easy"></a>1.2.7. Modelling made easy</h4>
<div class="paragraph">
<p>The community of ecological scientists has been developing an impressively large number of models, yet most of them are poorly designed in terms of programming, as ecologists are not necessarily software engineers. Ecosystem simulators are among the most complex programs (<a href="#Coquillard1997">Coquillard &amp; Hill 1997</a>). They require high programming skills and constitute a huge investment in time, which makes their production slow and hazardous. As a result, once built, they tend to be used beyond their initial domain of application (e.g. the overuse and abuse of the CENTURY model: <a href="#Parton1988">Parton et al. 1988</a>), issues of provenance and repeatability are rarely addressed, shedding some doubt on the discipline as a whole.</p>
</div>
<div class="paragraph">
<p>With <strong>3Worlds</strong>, we wanted to provide a simulation platform for ecosystem modelling using state-of-the-art concepts and algorithms, and sound programming techniques (e.g. systematic code testing, separated concerns), so that ecological modellers can concentrate on the ecological part of the problem and forget about the computer science part. We used <em>automatic code generation</em> to ensure that researchers need only edit one code file to build a simulator for their particular model. We used a <em>graph editor</em> to build the configuration and organise the data required for a particular study. In <strong>3Worlds</strong> therefore, an ecosystem model only requires two files: a specification file organised as a graph, and a computer code file where all relevant ecological processes are written. None of this prevents the modeller from using software libraries, either their own or from a third party, to extend their coding capabilities.</p>
</div>
<div class="paragraph">
<p>When designing a model, it is important to get quick visual feedback system behaviour when one changes equations or their implementation. <strong>3Worlds</strong> comes with a library of user-interface objects (graphs, maps, time series) that can be freely assembled to adapt outputs to the needs of the researcher.</p>
</div>
</div>
<div class="sect3">
<h4 id="truemodel-comparison-graphs-can-be-compared"><a class="anchor" href="#truemodel-comparison-graphs-can-be-compared"></a>1.2.8. Model comparison: graphs can be compared</h4>
<div class="paragraph">
<p>Climate change modelling relies on 19 major general circulation models (GCMs) all based on the same equations. When run with identical datasets (initial data plus forcings), they all yield different results. This is expected given the size of their code, but what is troubling is that nobody is able to trace within the code where the differences come from  (<a href="#Lim2009">Lim &amp; Roderick 2009</a>). This problem arises again and again in the modelling literature (e.g. <a href="#Melilo1995">Melilo et al. 1995</a>; <a href="#Roxburgh2004">Roxburgh et al. 2004</a>). The ultimate reason for this impossibility is that all the knowledge invested into these huge models is represented in computer code, which are very difficult to compare for any but the simplest of models.</p>
</div>
<div class="paragraph">
<p><strong>3Worlds</strong> is an attempt to solve this issue <em>for the future</em> (there is nothing we can do for past model code). If models are developed within the standard framework of <strong>3Worlds</strong>, the only thing that needs to be compared among models is their specification file (a graph) and their code file - hundreds to thousands of lines, not more. Everything else is equal. In theory this should facilitate model comparison.</p>
</div>
</div>
<div class="sect3">
<h4 id="trueproblem-upscaling"><a class="anchor" href="#trueproblem-upscaling"></a>1.2.9. Problem upscaling</h4>
<div class="paragraph">
<p>Developing a simulator is only a small part of the ecological modelling exercise: once the simulator is ready, it is used as a real ecosystem in <em>simulation experiments</em>. Designing and running such experiments is a very important part of the job - if not the most important, as it is the one which gives insight and publishable results.</p>
</div>
<div class="paragraph">
<p>IBMs are often stochastic, as population rates translate into probabilities at the individual level: e.g., the code has to decide which individuals to delete to satisfy a mortality rate of 10%. This is usually based on drawing random numbers. As a result, every simulation is different even when using identical parameters, and an asymptotic behaviour of the system can only be obtained by running multiple simulations. Fortunately, this is easily parallelized with modern computers.</p>
</div>
<div class="paragraph">
<p>3Worlds is interfaced with <a href="https://openmole.org/">OpenMole</a>  to provide access to big computing power. Through OpenMole, big simulation experiments can be deployed on networks of computers, grids, or supercomputers.</p>
</div>
</div>
<div class="sect3">
<h4 id="trueportability-and-performance"><a class="anchor" href="#trueportability-and-performance"></a>1.2.10. Portability and performance</h4>
<div class="paragraph">
<p><strong>3Worlds</strong> is written in Java to ensure portability between all operating systems. Its code has been carefully optimised, although generality inevitably comes with some performance cost.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="truegetting-started-download-and-installation"><a class="anchor" href="#truegetting-started-download-and-installation"></a>2. Getting started - download and installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="truebasics-what-you-must-know-before-starting"><a class="anchor" href="#truebasics-what-you-must-know-before-starting"></a>2.1. Basics - what you must know before starting</h3>
<div class="paragraph">
<p>3Worlds is an application designed to develop and launch simulations of ecosystems.
It is highly versatile and can simulate any kind of ecosystem using any kind of mathematical logic.</p>
</div>
<div class="paragraph">
<p>The application and use of 3Worlds to a particular ecosystem for a particular study case is called a <em>model</em>&#8201;&#8212;&#8201;or, more precisely a <em>simulation</em> model.
The model must first be specified and developed (this involves writing some code in the java programming language) before it can be executed for a particular case study.
This execution is called a <em>simulation experiment</em>.</p>
</div>
<div class="paragraph">
<p>3Worlds comprises two main applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ModelMaker</code>, to configure a model;</p>
</li>
<li>
<p><code>ModelRunner</code>, to run the model.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Creating a model involves creating a configuration with <code>ModelMaker</code> and developing some associated Java code to specify details particular to your model.
To do this, you must use the <a href="https://www.eclipse.org/downloads/">Eclipse</a> programming software (freeware). Later versions of 3Worlds may support other packages, but at the time of writing, 3Worlds will only work with <a href="https://www.eclipse.org/downloads/">eclipse</a>.</p>
</div>
<div class="paragraph">
<p><code>ModelMaker</code> will generate Java code for data structures specific to a model (based on the configuration file you have developed) and <em>template</em> java code for each process you have defined. These process templates are where you enter programming code to implement your model. You only need to write  code for your processes and for model initialisation. All else is managed by 3Worlds.</p>
</div>
<div class="paragraph">
<p>3Worlds is written in <a href="https://en.wikipedia.org/wiki/Java_(programming_language)">java</a>, which makes it OS-independent. It can be run on MacOS, Linux or Windows computers.</p>
</div>
</div>
<div class="sect2">
<h3 id="trueprerequisites"><a class="anchor" href="#trueprerequisites"></a>2.2. Prerequisites</h3>
<div class="paragraph">
<p>You will need the following software installed on your computer before installing 3Worlds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java JDK (<strong>J</strong>ava <strong>D</strong>evelopment <strong>K</strong>it), version 11 or greater (<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html">Oracle</a> or <a href="http://openjdk.java.net/">open</a> version)</p>
</li>
<li>
<p>Java fx (graphical user interface library for java: <a href="http://www.oracle.com/technetwork/java/javase/overview/javafx-overview-2158620.html">Oracle</a> or <a href="http://openjdk.java.net/projects/openjfx/">open</a> version)</p>
</li>
<li>
<p>an <a href="https://www.eclipse.org/downloads/">Eclipse</a> Java development environment and add the  <a href="https://www.eclipse.org/efxclipse/install.html">e(fx)clipse plugin</a> required for Javafx</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="truerunning-modelmaker"><a class="anchor" href="#truerunning-modelmaker"></a>2.3. Running ModelMaker</h3>
<div class="paragraph">
<p>This assumes you have downloaded <code>3w.zip</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unzip <code>3w.zip</code> in your user home directory (important), keeping the internal directory tree. This will extract a file <code>modelMaker.jar</code> and a <code>.3w</code> directory containing more jar files.</p>
</li>
<li>
<p>Double-click on <code>modelMaker.jar</code>. This should launch the ModelMaker application.</p>
</li>
<li>
<p>If this doesn&#8217;t work, open a terminal and type <code>java -jar modelMaker.jar</code>. This should launch the ModelMaker application.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This way of launching 3Worlds is sensitive to the relative location of <code>modelMaker.jar</code> and the other jars that are in the <code>.3w</code> directory, ie <code>modelMaker.jar</code> <strong>must</strong> be exactly one directory above <code>.3w</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To remove this constraint, you can bypass <code>modelMaker.jar</code> by directly launching it from the jars contained in <code>.3w</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">java -cp .3w/tw-dep.jar au.edu.anu.twuifx.mm.MMmain</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is preferable to run the software from a terminal window. This way, any errors that may arise will be displayed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
to develop your model-specific code, you will need to setup a Java development environment as shown in  <a href="#truesetting-up-a-java-development-environment-for-the-user-code">Section 2.4</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truesetting-up-a-java-development-environment-for-the-user-code"><a class="anchor" href="#truesetting-up-a-java-development-environment-for-the-user-code"></a>2.4. Setting up a Java development environment for the user code</h3>
<div class="sect3">
<h4 id="truesetting-up-the-eclipse-integrated-development-environment-ide-for-3worlds"><a class="anchor" href="#truesetting-up-the-eclipse-integrated-development-environment-ide-for-3worlds"></a>2.4.1. Setting up the Eclipse Integrated Development Environment (IDE) for 3Worlds</h4>
<div class="paragraph">
<p>This assumes you have downloaded <code>tw-dep.jar</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If not yet done, install <a href="https://www.eclipse.org/downloads/">Eclipse</a> (don&#8217;t forget <a href="https://www.eclipse.org/efxclipse/install.html">e(fx)clipse</a>!)</p>
</li>
<li>
<p>Create at <em>workspace</em> (a working directory for Eclipse - Eclipse will ask for it when launched). e.g., <em>&lt;my_workspace&gt;</em></p>
</li>
<li>
<p>Within Eclipse, create a <em>project</em>:</p>
<div class="ulist">
<ul>
<li>
<p>Select menu <code>File &#8594; New &#8594; Java project</code>; this opens a dialog box</p>
</li>
<li>
<p>In the dialog box, type a project name (e.g. <em>&lt;my_project&gt;</em>)</p>
</li>
<li>
<p>Click the <code>Finish</code> button</p>
</li>
</ul>
</div>
</li>
<li>
<p>Import 3Worlds dependencies:</p>
<div class="ulist">
<ul>
<li>
<p>Select menu <code>Project &#8594; Properties</code>; this opens a dialog box</p>
</li>
<li>
<p>In the dialog box, select <code>Java Build Path</code></p>
</li>
<li>
<p>Select the <code>Libraries</code> tab</p>
</li>
<li>
<p>Select <code>ClassPath</code></p>
</li>
<li>
<p>Click on the <code>Add external JARs&#8230;&#8203;</code> button; this open a file selection dialog box</p>
</li>
<li>
<p>In the file selection dialog box, browse and select <code>tw-dep.jar</code></p>
</li>
<li>
<p>Click the <code>Apply and Close</code> button</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="truerunning-modelmaker-from-eclipse"><a class="anchor" href="#truerunning-modelmaker-from-eclipse"></a>2.4.2. Running ModelMaker from Eclipse</h4>
<div class="paragraph">
<p>ModelMaker can be run from Eclipse or as a standalone application since it is included in the <code>tw-dep.jar</code> library required to develop the user code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <code>package explorer</code> window, expand the <code>Referenced libraries</code> entry</p>
</li>
<li>
<p>Right-click on the <code>tw-dep.jar</code> entry, select <code>Run as &#8594; Java Application</code>. This opens a dialog box</p>
</li>
<li>
<p>In the dialog box, type <em>Main</em></p>
</li>
<li>
<p>In the list of matching items, select <code>Main - au.edu.anu.twuifx.MMmain</code> and click <code>OK</code></p>
</li>
<li>
<p>If warning errors appear, click <code>Proceed</code>. This launches the ModelMaker application</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="truelinking-user-code-with-model-configuration"><a class="anchor" href="#truelinking-user-code-with-model-configuration"></a>2.4.3. Linking user code with model configuration</h4>
<div class="paragraph">
<p>This requires the following actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In ModelMaker,</p>
<div class="ulist">
<ul>
<li>
<p>create or open a <em>3Worlds</em> project (<code>Projects</code> entry of the main menu)</p>
</li>
<li>
<p>select <code>Preferences &#8594; Java Project &#8594; Connect&#8230;&#8203;</code>. This opens a dialog box with a file selector</p>
</li>
<li>
<p>select the root directory of the <em>Eclipse</em> project as created above (e.g. <em>&lt;my_workspace&gt;</em>/<em>&lt;my_project&gt;</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation tells <code>ModelMaker</code> to generate its code into the user java project.
When you want to edit your code in eclipse, you must first <strong>refresh</strong> the eclipse project:</p>
</div>
</li>
<li>
<p>In Eclipse,</p>
<div class="ulist">
<ul>
<li>
<p>select the project name at the very top of the <code>package explorer</code> window</p>
</li>
<li>
<p>right-click on it and select <code>Refresh</code></p>
</li>
<li>
<p>or, alternatively: press the <strong>F5</strong> key</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You don&#8217;t <strong>have</strong> to do this. We provide it as a facility if you want to run ModelMaker from eclipse rather than directly for some reason of your own.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="truedebugging-and-testing-user-code"><a class="anchor" href="#truedebugging-and-testing-user-code"></a>2.4.4. Debugging and testing user code</h4>
<div class="paragraph">
<p>The user code, first generated by <code>ModelMaker</code> and further edited by the user, can be run using <code>UserCodeRunner.java</code>. This class can be found in the <code>default</code> src directory and was created when linking this project with the 3Worlds project (cf above).
It requires three command line arguments (we assume that you know how to setup and run a <code>Run Configuration</code> in Eclipse):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance number (more about this later); leave this at '0' for now.</p>
</li>
<li>
<p>the name of the directory of the 3Worlds project as created by <code>ModelMaker</code> (e.g. <em>project_test_model9_2019-09-05-08-50-20-458</em>). This project directory is located under the <code>.3w</code> directory automatically created by <code>ModelMaker</code> as its working directory</p>
</li>
<li>
<p>some optional settings to switch on debugging logs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this, the user code should be executed as a test simulation by <code>UserCodeRunner</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Further edits and modifications of the configuration can be made in <code>ModelMaker</code>, but don&#8217;t forget to keep the Eclipse project content synchronized with the ModelMaker project by refreshing the Eclipse project as often as necessary.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="trueconfiguration-reference-creating-and-editing-a-model-with-modelmaker"><a class="anchor" href="#trueconfiguration-reference-creating-and-editing-a-model-with-modelmaker"></a>3. Configuration reference: creating and editing a model with ModelMaker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="truegeneral-concepts-structure-of-a-3worlds-configuration"><a class="anchor" href="#truegeneral-concepts-structure-of-a-3worlds-configuration"></a>3.1. General concepts: structure of a 3Worlds configuration</h3>
<div class="sect3">
<h4 id="truea-tree-structure"><a class="anchor" href="#truea-tree-structure"></a>3.1.1. A tree structure&#8230;&#8203;</h4>
<div class="paragraph">
<p>The configuration of a 3Worlds <em>simulation experiment</em> is organised as a tree (<a href="#fig-configuration-tree">Figure 5</a>). Each tree <em>node</em> specifies a subset of the parameters of the whole configuration. Each <em>node</em> has <em>child nodes</em> linked through a <em>tree edge</em>, so that large pieces of configuration can be broken down into the relevant details. At each level of this hierarchy, <em>properties</em> can be attached to <em>nodes</em>.</p>
</div>
<div class="paragraph">
<p><em>Nodes</em> have a <em>label</em> and a <em>name</em> that are displayed in the <code>ModelMaker</code> interface as <code>label:name</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>label</em> specifies what role this particular <em>node</em> plays in the whole configuration. For example, the <em>node</em> labelled <code>experiment</code> is used to configure a <em>simulation experiment</em>.</p>
</li>
<li>
<p>The <em>name</em> is used to differentiate <em>nodes</em>. It must be unique over the whole configuration tree. By default, <code>ModelMaker</code> generates unique names (by adding a number to the name if replicates are found).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>root node</em> of a configuration is always labelled <code>3worlds</code>.</p>
</div>
<div id="fig-configuration-tree" class="imageblock text-center thumb">
<div class="content">
<img src="../source/configuration-structureIMG/dsl-tree3.svg" alt="dsl tree3">
</div>
<div class="title">Figure 5. Tree structure of a simulation experiment configuration in 3Worlds</div>
</div>
<div class="paragraph">
<p>The configuration tree is stored in a file in a specially designed text format, ending with the extension <code>.ugt</code> or <code>.twg</code>. Such files are produced by <code>ModelMaker</code> and can then be exchanged and imported into <code>ModelMaker</code> via the <code>Projects &#8594; Import&#8230;&#8203;</code> menu entry. Their format is human-readable, but they must <strong>never</strong> be edited with another software than <code>ModelMaker</code> - <strong>the risk is to corrupt all your configuration</strong> and be unable to run it (or even edit it with <code>ModelMaker</code> again).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>NEVER</strong> edit the 3worlds configuration <code>.ugt</code> file 'by hand'! You may make it unreadable to <code>ModelMaker</code> and lose all your work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each node in the configuration has a particular meaning for <code>ModelRunner</code>: the configuration must comply with certain rules and constraints, the first one being the particular set of <em>nodes</em> that have been designed and appear on <a href="#fig-configuration-tree">Figure 5</a>. The detailed meaning of all <em>nodes</em> and their <em>properties</em> is described in <a href="#trueconfiguration-options-reference">Section 3.3</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="truewith-cross-links"><a class="anchor" href="#truewith-cross-links"></a>3.1.2. &#8230;&#8203;with cross-links</h4>
<div class="paragraph">
<p>Actually, the 3Worlds configuration is not strictly hierarchical (<a href="#fig-configuration-tree2">Figure 6</a>): according to their role in <code>ModelRunner</code>, some configuration <em>nodes</em> need to gather information from other parts of the configuration tree. This is done by allowing for some cross-reference <em>edges</em> to be defined, that overlay with the strict hierarchical structure of the tree. As a result of these cross links, the whole configuration is a <em>graph</em> rather than a tree.</p>
</div>
<div id="fig-configuration-tree2" class="imageblock text-center thumb">
<div class="content">
<img src="../source/configuration-structureIMG/dsl-tree3links.svg" alt="dsl tree3links">
</div>
<div class="title">Figure 6. Tree structure of a simulation experiment configuration in 3Worlds, showing the cross-links between tree nodes (NB: not all cross-links are drawn)</div>
</div>
<div class="paragraph">
<p><em>Edges</em> representing cross links have a <em>label</em>, <em>name</em>, and may have <em>properties</em> just as <em>nodes</em> do. The detailed meaning of all cross-reference <em>edges</em> and their <em>properties</em> is described in <a href="#trueconfiguration-options-reference">Section 3.3</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="truewhat-modelmaker-does-for-you"><a class="anchor" href="#truewhat-modelmaker-does-for-you"></a>3.1.3. What ModelMaker does for you</h4>
<div class="paragraph">
<p><code>ModelMaker</code> knows the details of the configuration constraints. It facilitates the design of a configuration by only letting you add the <em>nodes</em>, <em>edges</em> and <em>properties</em> that will produce a valid, runnable configuration file. During the configuration building process, it constantly checks the validity of the graph and reports any errors or missing parts in its <code>log</code> panel. <code>ModelMaker</code> is far more than a nice visual editor producing a graph: a configuration graph produced with <code>ModelMaker</code> is <strong>guaranteed</strong> to run with <code>ModelRunner</code> because of all these internal consistency and validity checks.</p>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="trueusing-modelmaker-software-interface-and-functioning"><a class="anchor" href="#trueusing-modelmaker-software-interface-and-functioning"></a>3.2. Using ModelMaker: software interface and functioning</h3>
<div class="paragraph">
<p><em>ModelMaker</em> has the traditional main menu bar, a variety of mouse/keyboard operations and three regions for the construction of the model specifications graph (<a href="#fig-modelmaker">Figure 7</a>):</p>
</div>
<div id="fig-modelmaker" class="imageblock text-center">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-modelmaker.png" alt="fig modelmaker">
</div>
<div class="title">Figure 7. The appearance of <em>ModelMaker</em> displaying an example project.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-hand side: <strong>Graph display</strong> window and associated tool bar for graph construction.</p>
</li>
<li>
<p>Top left: <strong>Property editors</strong> for node and edge properties.</p>
</li>
<li>
<p>Bottom left: <strong>Message pane</strong> to display actions that are required to ensure the specifications are valid.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The main window title is the currently open project and any linked Java project associated with it (<strong>&lt;3Worlds project name&gt;(&lt;date&gt;) &lt;o-o-o&gt; &lt;Java project name&gt;</strong>). Whenever the specifications are edited, an asterisk is prefixed to the window title and cleared upon saving.</p>
</div>
<div class="sect3">
<h4 id="truemain-menu"><a class="anchor" href="#truemain-menu"></a>3.2.1. Main menu</h4>
<div class="sect4">
<h5 id="trueproject"><a class="anchor" href="#trueproject"></a>Project</h5>
<div class="sect5">
<h6 id="truenew"><a class="anchor" href="#truenew"></a>New</h6>
<div id="fig-menu-new" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-menu-new.png" alt="fig menu new">
</div>
<div class="title">Figure 8. Options for creating a new project.</div>
</div>
<div class="paragraph">
<p>Creates a new project from either a library of <strong>Templates</strong>, <strong>Tutorials</strong>, <strong>Model library</strong> or <strong>Test cases</strong> (<a href="#fig-menu-new">Figure 8</a>). You will be prompted for a unique name for the project. The first letter of this name must be upper case as it will eventually be used as the name of a Java class when the project successfully compiles.  A sub-directory with the name and creation date will be created under <code>.3w</code>.
Once created, the project name and its creation date appear in the window title and the graph root node name is that entered at the prompt. <em>ModelMaker</em> will automatically compile the project and list any actions required in the <strong>message pane</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="trueopen"><a class="anchor" href="#trueopen"></a>Open</h6>
<div id="fig-menu-open" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-menu-open.png" alt="fig menu open">
</div>
<div class="title">Figure 9. The Open project menu choice.</div>
</div>
<div class="paragraph">
<p>Opens any project currently in the <code>.3w</code> directory (<a href="#fig-menu-open">Figure 9</a>). Projects are listed in alphabetical order.</p>
</div>
</div>
<div class="sect5">
<h6 id="trueimport"><a class="anchor" href="#trueimport"></a>Import</h6>
<div class="paragraph">
<p>Imports a tree-graph file from disk (*.utg). Imports are only possible if the tree-graph has a single root. You will be prompted for a unique name for the import.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tree-graphs with more than one root cannot be imported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="truesave"><a class="anchor" href="#truesave"></a>Save</h6>
<div class="paragraph">
<p>Saves the configuration graph and its associated layout file (<code>.layout.utg</code>) to disk.</p>
</div>
</div>
<div class="sect5">
<h6 id="truesave-as"><a class="anchor" href="#truesave-as"></a>Save as</h6>
<div class="paragraph">
<p>Saves the project under a new name in a new directory within <code>.3w</code>. If the project was linked to a Java project, the new project will maintain this link and generate a new Java file with this name.</p>
</div>
</div>
<div class="sect5">
<h6 id="trueexit"><a class="anchor" href="#trueexit"></a>Exit</h6>
<div class="paragraph">
<p>Exits <em>ModelMaker</em> after a prompting to save any unsaved work. On exiting, a project specific preferences file is saved  automatically (<code>MM.xml</code>), recording the current appearance of <em>ModelMaker</em>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="trueedit"><a class="anchor" href="#trueedit"></a>Edit</h5>
<div class="paragraph">
<p>The Edit menu provides the Undo/Redo options (<a href="#fig-menu-edit">Figure 10</a>). All graph editor operations are able to be undo or redone except property edits. The undo/redo system creates temporary history files during a session. These are deleted when the project is closed.</p>
</div>
<div id="fig-menu-edit" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-menu-edit.png" alt="fig menu edit">
</div>
<div class="title">Figure 10. The edit <br/> menu choice.</div>
</div>
</div>
<div class="sect4">
<h5 id="trueide"><a class="anchor" href="#trueide"></a>IDE</h5>
<div class="sect5">
<h6 id="trueimport-snippets"><a class="anchor" href="#trueimport-snippets"></a>Import snippets</h6>
<div class="paragraph">
<p>Enabled when a project is linked to a Java project. This option imports method code from Java into any <code>snippet</code> nodes in the specifications (<code>Function</code> and <code>InitFunction</code> and the <code>importSnippet</code> property of the specification root node. NOTE: currently, importing code containing double quotes is not supported.</p>
</div>
</div>
<div class="sect5">
<h6 id="trueclear-snippets"><a class="anchor" href="#trueclear-snippets"></a>Clear snippets</h6>
<div class="paragraph">
<p>Clears the Java code in the configuration&#8217;s <code>functionSnippet`and `importSnippet</code> properties. Functions requiring return values will have default return values added.</p>
</div>
</div>
<div class="sect5">
<h6 id="truelink-to-ide"><a class="anchor" href="#truelink-to-ide"></a>Link to IDE</h6>
<div class="paragraph">
<p>Allows connecting to or disconnecting from an external Java project via in an Integrated Development Environment. When connecting to a Java project, the java project must have imported <code>.3w/tw-dep.jar</code> as an external jar to its class path (<a href="#truesetting-up-the-eclipse-integrated-development-environment-ide-for-3worlds">Section 2.4.1</a>). Upon first connecting to a Java project, a Java class called <code>UserCodeRunner.java</code> is added to the default package. Use this as a main class to debug your model code. If the specifications are valid, additional Java classes are created. One of these has the same name as the 3Worlds project. Edit this file in an Integrated Development Environment (IDE) to begin developing your model. At the time of writing, only the <em>Eclipse</em> IDE is supported for this purpose (<a href="#truesetting-up-a-java-development-environment-for-the-user-code">Section 2.4</a>).</p>
</div>
<div class="paragraph">
<p>If the creation times of Java source files and their associated class files become inconsistent, a message to this effect will appear in the <strong>message pane</strong>. In such cases, refresh or clean the Java project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To compile models, the Java Development Kit (JDK)  must be installed on your computer (<a href="#trueprerequisites">Section 2.2</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use 'Refresh` in the IDE to keep <em>ModelMaker</em> and the Java project synchronized.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truehelp"><a class="anchor" href="#truehelp"></a>Help</h5>
<div class="sect5">
<h6 id="trueabout-modelmaker"><a class="anchor" href="#trueabout-modelmaker"></a>About ModelMaker</h6>
<div class="paragraph">
<p>A dialog with a succinct description of the purpose of <em>ModelMaker</em>. If you&#8217;re using <em>ModelMaker</em> for the first time, it&#8217;s a good idea to at least read this overview.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truegraph-display"><a class="anchor" href="#truegraph-display"></a>3.2.2. Graph display</h4>
<div class="paragraph">
<p>Construction of the model specification graph takes place in the <strong>Graph display</strong> window by adding or removing nodes and edges (<em>cross-links</em>). Above the graph display is a tool bar to enable various display options (<a href="#fig-graph-display-window">Figure 11</a>).</p>
</div>
<div id="fig-graph-display-window" class="imageblock text-center">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-graph-display-window.png" alt="fig graph display window">
</div>
<div class="title">Figure 11. The Graph display window and tool bar. The graph is both a Tree graph and a directed network graph. The tree graph is shown with green parent-child edges. The directed network graph is shown with red, named edges.</div>
</div>
<div class="paragraph">
<p>The graph is both a tree graph (with a single root) and a directed network graph. The tree structure is shown with green parent-child edges with a thickened end at the child node. The directed network graph is shown with red, named edges with a thickened end at the 'end node'.</p>
</div>
<div class="paragraph">
<p>Node colours are based on a schema that, for the most part,  colours all nodes within a sub-tree the same. The colours are not editable.</p>
</div>
<div class="sect4">
<h5 id="truetool-bar"><a class="anchor" href="#truetool-bar"></a>Tool bar</h5>
<div id="fig-tool-bar" class="imageblock text-center">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-tool-bar.png" alt="fig tool bar">
</div>
<div class="title">Figure 12. Tool bar options for managing the graph display.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Layout selection: The four radio buttons (<strong>L1, L2, L3, L4</strong>) select one of four layout algorithms:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>L1</strong> - ordered tree. The nodes are listed vertically in alphabetical order.</p>
</li>
<li>
<p><strong>L2</strong> - radial tree. The radius decreases as the path distance from the root node increases.</p>
</li>
<li>
<p><strong>L3</strong> - radial tree. The radius remains constant.</p>
</li>
<li>
<p><strong>L4</strong> - spring graph. A force directed layout. Parent-child edges (green) and treated in the same way as <em>cross-links</em> (red).</p>
</li>
</ol>
</div>
</li>
<li>
<p>Layout options</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>L</strong>: Applies the current layout options.</p>
</li>
<li>
<p><strong>X</strong>: Toggles the <em>cross-links</em>.</p>
</li>
<li>
<p><strong>&lt;</strong>: Toggles the parent-child edges.</p>
</li>
<li>
<p><strong>&gt;|</strong>: Moves any isolated nodes to the right-hand side of the window.</p>
</li>
<li>
<p><strong>Current layout root</strong>: The name of the node used for the display root of the graph. The default is the black 3worlds root node. This can be changed by right-clicking on any node while holding down the <code>Ctrl</code> key. The display root node is also indicated by a black circle. This option only applies to tree layouts.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Miscellaneous</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Path len.</strong>: Sets the path length when the <em>show local graph</em> display mode is activated (by moving the mouse over a node while holding down the <code>Shift</code> key).</p>
</li>
<li>
<p><strong>Jitter</strong>: Sets the amount of random displacement of a node when applying a layout. This is useful to separate text and/or lines drawn over each other.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Text options:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Node text</strong>: Display the node label and name or any combination of the two including no text.</p>
</li>
<li>
<p><strong>Edge text</strong>: Display the edge label and name or any combination of the two including no text.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Element size</strong>: Increases or decreases the size of all nodes, edges and text in the display.</p>
</li>
<li>
<p><strong>Animate</strong>: When checked, changes to the shape of the graph by either collapsing/expanding sub-trees or applying a layout function are animated. Switch this off for large graphs - the animation routine can quickly become over-loaded and the resulting animation jumpy.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truekeyboard-and-mouse-functions"><a class="anchor" href="#truekeyboard-and-mouse-functions"></a>Keyboard and mouse functions</h5>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Pan</strong>: Drag the mouse anywhere other than on a node to pan the graph drawing surface. This assumes the display size is larger than the window.</p>
</li>
<li>
<p><strong>Drag node</strong>: Left-click on any node to change its position. Nodes are shown in red when the mouse passes over them.</p>
</li>
<li>
<p><strong>Show local graph</strong>: Hold down the <code>Shift</code> key while moving the mouse over a node. The <em>path length</em> for this feature is set in the tool bar.</p>
</li>
<li>
<p><strong>Show node properties</strong>: Right-click on any node to display its properties in the <em>Selected properties</em> property editor.</p>
</li>
<li>
<p><strong>Zoom</strong>: Hold down the <code>Ctrl</code> key while moving the mouse wheel to zoom in and out of the display.</p>
</li>
<li>
<p><strong>Pop-up edit menu</strong>: Right-click on any node to see the edit options available for that node.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truepop-up-edit-options"><a class="anchor" href="#truepop-up-edit-options"></a>Pop-up edit options</h5>
<div class="paragraph">
<p>This menu is the principle way in which the specification graph is constructed (<a href="#fig-popup">Figure 13</a>). Note that the <code>predefined:*catoregories*</code> sub-tree cannot be edited except for any 'in-edges' that may be allowed from outside this sub-tree.</p>
</div>
<div id="fig-popup" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-popup.png" alt="fig popup">
</div>
<div class="title">Figure 13. The pop-up menu. <br/> Available options depend <br/> on the node selected.</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>New node</strong>: Displays a list of valid node labels that can be children of this node.</p>
</li>
<li>
<p><strong>New edge</strong>: Displays a list of valid edges (<em>cross-links</em>) from this node to another existing node.</p>
</li>
<li>
<p><strong>New child edge</strong>: Displays a list of (parentless) nodes that can be valid children of this node.</p>
</li>
<li>
<p><strong>Expand sub-tree</strong>: Displays a list of sub-trees that can be expanded from this node. After expanding, any properties of these nodes and edges will appear in the property editor.</p>
</li>
<li>
<p><strong>Collapse sub-tree</strong>: Displays a list of sub-trees that can be collapsed from this node. After collapsing, any properties of these nodes and edges will be removed from the property editor.</p>
</li>
<li>
<p><strong>Delete node</strong>: Deletes this node. Note that the <code>3Worlds</code> root node cannot be deleted.</p>
</li>
<li>
<p><strong>Delete edge</strong>: Displays a list of 'out-edges' from this node that can be deleted.</p>
</li>
<li>
<p><strong>Delete child edge</strong>: Displays a list of child nodes that can be orphaned. Note that the specifications are not valid until all child nodes have parents.</p>
</li>
<li>
<p><strong>Optional properties</strong>: Displays a dialog with any optional properties that can be added or removed from this node.</p>
</li>
<li>
<p><strong>Rename node</strong>: Changes the node name to some other unqiue name. Note that the name of the root node cannot be changed.</p>
</li>
<li>
<p><strong>Rename edge</strong>: Displays a list of 'out-edges' whose name can be changed to some other unqiue name.</p>
</li>
<li>
<p><strong>Import sub-tree</strong>: Displays a list of valid child node labels that can form the root of a sub-tree read from file.</p>
</li>
<li>
<p><strong>Export sub-tree</strong>: Displays a list of the current child nodes of this node that can be exported to file as a sub-tree.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueproperty-editors"><a class="anchor" href="#trueproperty-editors"></a>3.2.3. Property editors</h4>
<div id="fig-properties-all" class="imageblock left text-left thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-properties-all.png" alt="fig properties all">
</div>
<div class="title">Figure 14. Property editor showing <br/> properties listed by name.</div>
</div>
<div id="fig-properties-selected" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-properties-selected.png" alt="fig properties selected">
</div>
<div class="title">Figure 15. Property editor showing only <br/> properties of a selected node (here a <code>TimeLine</code>).</div>
</div>
<div class="paragraph">
<p>There are two property editors available on separate tabs: one (<em>Properties</em>) displays all <em>editable</em> properties of the currently displayed nodes and edges (<a href="#fig-properties-all">Figure 14</a>); and a second (<em>Selected properties</em>) shows <em>all</em> properties of a selected node (left-click on any node: <a href="#fig-properties-selected">Figure 15</a>).</p>
</div>
<div id="fig-properties-category" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-properties-category.png" alt="fig properties category">
</div>
<div class="title">Figure 16. Property editor showing <br/> properties listed by category.</div>
</div>
<div class="paragraph">
<p>The <em>Properties</em> editor has two buttons; one to display properties by category (<a href="#fig-properties-category">Figure 16</a>; in this case this means by sub-tree) and the other to display properties by name (<a href="#fig-properties-all">Figure 14</a>). There is also a search field that can be used to show only those properties that match the search text.</p>
</div>
<div class="paragraph">
<p>Properties are only shown for nodes that are currently visible (expanded) in the graph.</p>
</div>
</div>
<div class="sect3">
<h4 id="truemessage-pane"><a class="anchor" href="#truemessage-pane"></a>3.2.4. Message pane</h4>
<div class="paragraph">
<p>The <strong>message pane</strong> displays information about what is required to make the model specifications valid. It grows and shrinks during construction depending on the state of the graph. Information is presented in three levels of detail: action, details and debug (<a href="#fig-msg-formats">Figure 17</a>). Generally, the 'action' level is all that is required.</p>
</div>
<div id="fig-msg-formats" class="imageblock text-center thumb">
<div class="content">
<img src="../source/using-modelmakerIMG/fig-msg-formats.png" alt="fig msg formats">
</div>
<div class="title">Figure 17. Message pane displaying three different message formats.</div>
</div>
<div class="paragraph">
<p>Messages are displayed in alphabetical order of the Action text no matter what the display level. At the bottom of the <strong>message pane</strong> are two buttons described at the end of this section.</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Action</strong>: This level indicates what action must be taken for the specifications to comply with the 3Worlds archetype. Its format is: a) the message category (usually <strong>[Node]</strong>, <strong>[Edge]</strong> or <strong>[Property]</strong>); b) the target (the label:name of a node or edge or a property name) and the action message (<a href="#fig-msg-formats">Figure 17</a>).</p>
</li>
<li>
<p><strong>Details</strong>: This level shows the action message and the specification constraint that is unsatisfied. The information provided varies with the message but in general includes (<a href="#fig-msg-formats">Figure 17</a>):</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>Message number. As noted, the message order remains consistant no matter the display option.</p>
</li>
<li>
<p>The action message: usually in the form of "Do this or that".</p>
</li>
<li>
<p>The specification constraint: usually in the form of "Expected this but found that".</p>
</li>
<li>
<p>The Java class of the query issuing the message.</p>
</li>
<li>
<p>The node in the 3Worlds archetype that defines the application of this query class.</p>
</li>
<li>
<p>The target element (node, edge, property or some other item class)</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Debug</strong>: This level shows all information available for this message including a detailed description of the target and archetype elements. It is rarely informative unless you are a contributor to the development of 3Worlds (<a href="#fig-msg-formats">Figure 17</a>).</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="trueverify-and-deploy"><a class="anchor" href="#trueverify-and-deploy"></a>Verify and Deploy</h5>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>Verify</strong>: Verifies that the specification graph conforms with the archetype and compiles the Java code. This process takes place in the background any time the graph is edited. Therefore, there is rarely any need to click the compile button.</p>
</li>
<li>
<p><strong>Deploy</strong>: This button is enabled (traffic light green) whenever the <strong>message pane</strong> is clear. When clicked, <em>ModelRunner</em> is launched to run the model with the specified experiment design.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="trueconfiguration-options-reference"><a class="anchor" href="#trueconfiguration-options-reference"></a>3.3. Configuration options: reference</h3>
<div class="paragraph">
<p>In this section,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>node and edge labels are indicated in <code><strong>bold</strong></code></p>
</li>
<li>
<p>text in triangular brackets (<code>&lt;&gt;</code>) mean a user-defined value is expected; the text usually specifies what kind of value is expected (e.g. <code>&lt;<em>name</em>&gt;</code> for a name, <code>&lt;<em>int</em>&gt;</code> for an integer number, etc.). If the text is required, it will be <span class="underline">underlined</span>, otherwise it is optional</p>
</li>
<li>
<p>a <em>multiplicity</em> in curly braces {} tells how many times the item may appear in a configuration:</p>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
{1}
</td>
<td class="hdlist2">
<p>exactly one item is required</p>
</td>
</tr>
<tr>
<td class="hdlist1">
{0..1}
</td>
<td class="hdlist2">
<p>the item is optional, i.e. one or zero is required</p>
</td>
</tr>
<tr>
<td class="hdlist1">
{1..*}
</td>
<td class="hdlist2">
<p>one to many items are required</p>
</td>
</tr>
<tr>
<td class="hdlist1">
{0..*}
</td>
<td class="hdlist2">
<p>any number of items is possible</p>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>levels in the tree hierarchy are indicated by slashes <code>/</code>.</p>
</li>
<li>
<p>a column <code>:</code> separates a node label from its name.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="truethe-3worlds-node"><a class="anchor" href="#truethe-3worlds-node"></a>3.3.1. The <em>3Worlds</em> node</h4>
<div class="paragraph">
<p><code>/<strong>3worlds</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node is the root of any 3Worlds configuration file (<a href="#fig-root-example">Figure 18</a>). The name will appear in <code>ModelMaker</code>'s main window title, in the <strong>project directory name</strong> and in the <strong>configuration graph file</strong>. The name is requested and set when creating a new project (<code>Projects&gt;New</code> menu entry in <code>ModelMaker</code>).</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>3worlds</code></p>
</div>
<div id="fig-root-example" class="imageblock right text-center thumb">
<div class="content">
<img src="../source/configuration-referenceIMG/example-root.png" alt="example root" width="400">
</div>
<div class="title">Figure 18. The base tree of any 3Worlds configuration</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>authors</code>
</td>
<td class="hdlist2">
<p>The list of this project author names.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>contacts</code>
</td>
<td class="hdlist2">
<p>The list of the author contacts (e.g. e-mail addresses), in the same order as the author names (1-1 match).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precis</code>
</td>
<td class="hdlist2">
<p>A short description of the model contained in this project.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>publication</code>
</td>
<td class="hdlist2">
<p>A list of bibliographic references in relation with the project.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>built-by</code>
</td>
<td class="hdlist2">
<p>The user name under which this project was constructed and saved, together with the date of saving. This property is automatically set by ModelMaker.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>version</code>
</td>
<td class="hdlist2">
<p>A user-defined version identifier for this project.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All these properties appear in the about box of <code>ModelRunner</code> and are saved in the ODD file describing the model.</p>
</div>
</div>
<div class="sect3">
<h4 id="truethe-system-node"><a class="anchor" href="#truethe-system-node"></a>3.3.2. The <em>system</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>system</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains all the ecological concepts used to define a simulation model: what entities are modelled, what biological processes apply to them, at what time step they should run. The name is used to differentiate models as a simulation experiment may involve more than one model.</p>
</div>
<div class="paragraph">
<p>A 3Worlds ecosystem is constructed as a population of 'biological entities', called <em>system components</em>, which establish interactions called <em>system relations</em>. Components and relations have <em>variables</em> that may change value over time, according to various <em>ecological processes</em> attached to components. In other words, an ecosystem is represented as a <em>dynamic graph</em> which changes state and structure over time. To reflect this, <code><strong>system</strong></code> has two sub-trees called <code><strong>structure</strong></code> and <code><strong>dynamics</strong></code>.</p>
</div>
<div class="paragraph">
<p>For very simple models, where the modelled system is not further subdivided into components, the structure sub-tree is not required. In this case,the system node will be used as a unique 'component' describing the system (cf tutorial: <a href="#TODO">logistic</a>).</p>
</div>
<div class="paragraph">
<p><em>Cross-links</em> for <code>system</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>belongsTo &#8594; category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells to which categories the system node belongs. The categories must not belong to the same category set. If there are nested categories, membership is inherited.The categories targets of these links must be specific to the system, i.e. no <code>componentType</code>, <code>groupType</code> or <code>lifeCycleType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*arena*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*arena*</code> is required in all models (<a href="#truethe-predefined-sub-tree">Section 3.3.8</a>). The arena is 'the place where things happen', i.e. it describes the part of the system where components interact. If no components are modelled, then it is the system.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*atomic*|*assemblage*</code> {1}</dt>
<dd>
<p>This link to either the predefined category <code>*atomic*</code> or <code>*assemblage*</code> is required in all models. Only if the system is very simple (no components, no groups, no life cycles) should <code>*atomic*</code> be selected. It means the system has no further subdivision. In any other case (i.e. as long as there is a structure sub-tree), the system should be an <code>*assemblage*</code>. Assemblages have three automatic variables: the system size (number of components) <code>count</code>, the number of new components added during last time step <code>nAdded</code>, and the number of components deleted during the last time step <code>nRemoved</code>.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*permanent*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*permanent*</code> is required in all models. It specifies that the system is going to stay forever (permanent) during a simulation.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="truethe-systemstructure-node"><a class="anchor" href="#truethe-systemstructure-node"></a>3.3.3. The <em>system/structure</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/system/<strong>structure</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains the description of the system component and relation types. It is based on the concept of <em>category</em>. A category is a set of components with an identical description, e.g. the same set of state variables or the same growth function.</p>
</div>
<div class="sect4">
<h5 id="truethe-category-and-related-concepts-specification-of-groups-of-entities"><a class="anchor" href="#truethe-category-and-related-concepts-specification-of-groups-of-entities"></a>The <em>category</em> and related concepts: specification of groups of entities</h5>
<div class="paragraph">
<p>3Worlds uses these concepts to specify and generate the ecological entities manipulated during a simulations.</p>
</div>
<div class="sect5">
<h6 id="truecategory"><a class="anchor" href="#truecategory"></a>Category</h6>
<div class="paragraph">
<p><code>&#8230;&#8203;/categorySet/<strong>category</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>A <code><strong>category</strong></code> is simply a name attached to a set of objects sharing common properties (<a href="#truecategories">Section 1.2.3</a>). These common properties are descriptors (<a href="#truethe-complex-system-as-a-dynamic-graph">Section 1.2.2</a>), and dynamic behaviours (or <em>processes</em>). Categories, grouped into <code><strong>categorySet</strong></code>s, constitute a user-defined <em>classification</em> of <em>system component types</em> relevant for a particular model.</p>
</div>
<div class="paragraph">
<p>Descriptors consist in <em>drivers</em>, <em>decorators</em>, <em>constants</em> and <em>automatic variables</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>drivers</em></dt>
<dd>
<p>are <em>independent</em> variables (numbers, text, logical values) that characterize the state of a system component at an instant in time (<em>e.g.</em> biomass, age, sex, social status&#8230;&#8203;). They will vary during a simulation. 'Independent' means that these variables cannot be computed from each other within a simulation step, they also depend on their previous step values. For example, if some category is described by drivers <em>age</em> and <em>biomass</em>, neither of them can be computed from the other: <em>age</em> is computed from its previous value by adding the time step duration; <em>biomass</em> is computed in some other way probably involving its previous value. The values of drivers are carried over from a simulation step to the next, i.e. they <em>drive</em> the dynamics of the system.</p>
</dd>
<dt class="hdlist1"><em>decorators</em></dt>
<dd>
<p>are <em>dependent</em> variables that are computed from drivers and other decorators within a simulation step. For example, <em>leaf area</em> could be computed as some constant times <em>biomass</em>: its value is completely determined by the value of <em>biomass</em>. As such, decorators are not independent from the drivers and are used only for convenience in computations or output display. They are not carried over from a simulation step to the next, they are always automatically reset to zero at the end of each step.</p>
</dd>
<dt class="hdlist1"><em>constants</em></dt>
<dd>
<p>are values (numbers, text, logical values) that do not change during a simulation. For example, <em>sex</em> or <em>number of legs</em> are not going to change during the lifetime of animal. They are set at birth and never changed after.</p>
</dd>
<dt class="hdlist1"><em>automatic variables</em></dt>
<dd>
<p>are values internally managed by 3Worlds and only available as read-only values for computation. For components representing individuals, these are <em>age</em> and <em>birth date</em>. For components representing populations, these are <em>number of individualls</em>, <em>number of births</em>, <em>number of deaths</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The exact data structures for descriptors are specified under the <code>dataDefinition</code> node (<a href="#truethe-datadefinition-node">Section 3.3.5</a>) and linked to the category through the following:</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>category</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>drivers &#8594; record:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dt class="hdlist1"><code>decorators &#8594; record:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dt class="hdlist1"><code>constants &#8594; record:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>These links tell which data structure in the <code>dataDefinition</code> node (<a href="#truethe-datadefinition-node">Section 3.3.5</a>) is used to store  <em>drivers</em>, <em>decorators</em>  and <em>constants</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Automatic variables</em> do not need to be specified - because they are automatic.</p>
</div>
<div class="paragraph">
<p>A category may be defined with no drivers, decorators or constants.</p>
</div>
<div class="paragraph">
<p>There are <em>predefined categories</em> in 3Worlds under the node <code>/3worlds/<strong>predefined</strong></code> (<a href="#truethe-predefined-sub-tree">Section 3.3.8</a>), used to specify particular components of the system. They will be explained in time.</p>
</div>
</div>
<div class="sect5">
<h6 id="truecategoryset"><a class="anchor" href="#truecategoryset"></a>CategorySet</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>categorySet</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>Some categories must be exclusive of each other: for example, an ecological entity is either a plant or an animal, but can&#8217;t be both. For this reason, <em>exclusive</em> categories are grouped into <code><strong>categorySets</strong></code>. A <code>categorySet</code> is <em>a set of <strong>mutually exclusive</strong> categories</em>. Categories can be nested, by simply defining a <code>categorySet</code> as a child of a <code>category</code>:</p>
</div>
<div class="paragraph">
<p><code>&#8230;&#8203;/category/<strong>categorySet</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
</div>
<div class="sect5">
<h6 id="truerelationtype"><a class="anchor" href="#truerelationtype"></a>RelationType</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>relationType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <code><strong>relationType</strong></code> is just a name representing a meaningful link between two kinds of categories. It is specified by giving it a name and cross-linking it to the relevant categories with <code>fromCategory</code> and <code>toCategory</code> cross-links. Note that a <code>relationType</code> can link more than one 'from' categories to more than one 'to' categories if required. <code>RelationType</code>s are used to implement specific processes acting on ecological entities (for example, a predation process).</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>relationType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fromCategory &#8594; category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells which categories are at the start of the relation.</p>
</dd>
<dt class="hdlist1"><code>toCategory &#8594; category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells which categories are at the end of the relation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>relationType</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>lifespan</code>
</td>
<td class="hdlist2">
<p>This property specifies if this type of relation will stay attached to its <code>systemComponents</code> during all their life, or may get created and deleted during their lifespan.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>permanent</code>
</td>
<td class="hdlist2">
<p>relation stays as long as both its ends stay (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ephemeral</code>
</td>
<td class="hdlist2">
<p>relations are created during a simulation by the means of a  <code>relateTo</code> function, and kept or deleted by means of a <code>maintainRelation</code> decision function. If no <code>maintainRelation</code> function is provided, then the relation only lasts for one simulation step.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="trueexample-a-category-tree"><a class="anchor" href="#trueexample-a-category-tree"></a>Example: a category tree</h6>
<div class="paragraph">
<p>On this diagram (generated with <code>ModelMaker</code>), hierarchical links are in green and cross-links are in red.</p>
</div>
<div id="fig-category-example" class="imageblock text-center thumb">
<div class="content">
<img src="../source/configuration-ecosystem-structureIMG/example-category.png" alt="example category">
</div>
<div class="title">Figure 19. Example of a configuration with category sets, categories and relations</div>
</div>
<div class="paragraph">
<p>In this example, a <em>plant</em> can be a <em>C3 tree</em> but cannot be simultaneously a <em>grass</em> and a <em>forb</em>. Similarly, an <em>animal</em> cannot be both <em>herbivore</em> and <em>carnivore</em>. The <em>predation</em> relation links an <em>animal</em> of any kind (the prey) to a <em>carnivore</em> (its predator). A member of category <em>plant</em> will have two driver variables, <em>height</em> and <em>leaf area</em>. A member of category <em>tree</em> will have three driver variables, <em>height</em>, <em>leaf area</em> and <em>DBH</em>, as it inherits all the properties of the <em>plant</em> category in which it is nested.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truethe-specification-of-ecological-entities-system-components"><a class="anchor" href="#truethe-specification-of-ecological-entities-system-components"></a>The specification of ecological entities: <em>system components</em></h5>
<div class="sect5">
<h6 id="truesystem-component"><a class="anchor" href="#truesystem-component"></a>System component</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>componentType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>3Worlds simulates a <em>system</em> made of <em>system components</em>. These are the things which are instantiated at run time, hold descriptors, and are dynamically changed over the time course of a simulation. When setting up a simulation, one must attach <em>categories</em> to <em>system components</em>. The rules prevailing to build up category hierarchies mean that a system can belong to a number of non-exclusive categories, as long as the exclusion and nesting rules are respected. For example, we could define a system as belonging to the <em>plant</em> and <em>tree</em> categories, but not to the <em>animal</em> and <em>tree</em> categories.</p>
</div>
<div class="paragraph">
<p><em>Cross-links</em> for <code>componentType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>belongsTo &#8594; category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells to which categories a system component type belongs. The categories must not belong to the same category set. If there are nested categories, membership is inherited (e.g. in the previous example, belonging to the <em>C3</em> category automatically implies the system component is also a <em>plant</em>).The categories targets of these links must be specific to component types, i.e. no <code>groupType</code> or <code>lifeCycleType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*component*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*component*</code> is required in all models.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*atomic*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*atomic*</code> is required in all models. It means that a component has no further subdivisions.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*ephemeral*|*permanent*</code> {1}</dt>
<dd>
<p>This link to either of the predefined category <code>*ephemeral*</code> or <code>*permanent*</code> is required in all models. It specifies if components of this <code>componentType</code> are going to stay forever (permanent) or can be created and deleted (ephemeral) during a simulation. Ephemeral components have two automatic variables, <code>birthDate</code> and <code>age</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="truecomponent-group"><a class="anchor" href="#truecomponent-group"></a>Component group</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>groupType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Sometimes it makes sense to group components of a given <code>componentType</code> into <em>groups</em>; the best example of this in ecology is the species. Animals of different species may be described by the same descriptors, but nevertheless they will only reproduce within their species. Typically, animals of a species would share some constants, like plumage coloration, average body size, main diet etc. The <code><strong>groupType</strong></code> node is meant to fullfil this use case.</p>
</div>
<div class="paragraph">
<p>To make a <code>componentType</code> belong to a <code>groupType</code>, you just need to declare it as a child of the <code>groupType</code>:</p>
</div>
<div class="paragraph">
<p><code>&#8230;&#8203;/groupType/<strong>componentType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><em>Cross-links</em> for <code>componentType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>belongsTo &#8594; category:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells to which categories a system component type belongs. The categories must not belong to the same category set. If there are nested categories, membership is inherited. The categories targets of these links must be specific to groups, i.e. no <code>componentType</code> or <code>lifeCycleType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*group*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*group*</code> is required in all models.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*assemblage*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*assemblage*</code> is required in all models. It means that a group is a population of components. Assemblages have three automatic variables: the group size (number of components) <code>count</code>, the number of new components added during last time step <code>nAdded</code>, and the number of components deleted during the last time step <code>nRemoved</code>.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*permanent*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*permanent*</code> is required in all models. It means that groups will stay forever in the system, even if all components of this groups are gone.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="truelife-cycle"><a class="anchor" href="#truelife-cycle"></a>Life cycle</h6>
<div class="paragraph">
<p><code>/3worlds/system/structure/<strong>lifeCycleType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>As <em>system component</em>s are designed to represent&#8201;&#8212;&#8201;among other things&#8201;&#8212;&#8201;individual organisms, they are able to create other system components at runtime, or to transform themselves into a system component of another category assemblage. These abilities are captured in a <code><strong>lifeCycle</strong></code>, which describes the possible creations and transitions of system components of a given category set into another.</p>
</div>
<div class="paragraph">
<p>Since <code>components</code> belong to <code>categories</code>, different types of system components represented by different state variables, subject to different ecological processes, can coexist in a simulation. It may occur in a particular model that one wishes to represent a transition between, e.g. development stages: think for example of a caterpillar turning into a butterfly. There are chances that you don&#8217;t want to describe the caterpillar with the same variables and behaviours as the adult butterfly. The operation of transforming a system component from a selection of categories to another is called <em>recruitment</em>. Computationally, it means that the simulator must keep track of the system component&#8217;s identity and age in the first stage and carry these properties on to the new system component of the second stage, and call an appropriate function to transform state variables of the first stage into the new one.</p>
</div>
<div class="paragraph">
<p><em>Reproduction</em> is the second process by which system components of a given group of categories may produce other system components belonging to possibly different categories.</p>
</div>
<div class="paragraph">
<p>A specification of a life cycle requires:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a <code>categorySet</code> in which the categories represent the various stages of the life cycle;</p>
</li>
<li>
<p>at least one <code>groupType</code> definition per <code>category</code> of the above <code>categorySet</code>;</p>
</li>
<li>
<p><code>recruit</code> and <code>produce</code> nodes linking categories within the above <code>categorySet</code> to describe possible recruitment and reproduction transitions;</p>
</li>
<li>
<p>optionnally, <code>categories</code> can be linked to a <code>lifeCycle</code> if one wants to attach descriptors to the life cycle.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To define a <code>groupType</code> within the context of a <code>lifeCycleType</code>, simply make it a child node of the lifeCycleType:</p>
</div>
<div class="paragraph">
<p><code>&#8230;&#8203;/lifeCycleType/<strong>groupType</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>lifeCycle</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>appliesTo &#8594; categorySet:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This links indicates which categories define the stages of the life cycle. <code>recruit</code> or <code>produce</code> nodes can only link categories of this set.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>These links enable to attach descriptors to a <code>lifeCycle</code>, if needed by some ecological processes. The categories targets of these links must be specific to life cycles, i.e. no <code>componentType</code> or <code>groupType</code> should refer (<code>belongTo</code> cross-link) to any of them.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*life cycle*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*life cycle*</code> is required in all models.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*assemblage*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*assemblage*</code> is required in all models. It means that a life cycle is a population of components. Assemblages have three automatic variables: size (number of components) <code>count</code>, the number of new components added during last time step <code>nAdded</code>, and the number of components deleted during the last time step <code>nRemoved</code>.</p>
</dd>
<dt class="hdlist1"><code>belongsTo &#8594; category:*permanent*</code> {1}</dt>
<dd>
<p>This link to the predefined category <code>*permanent*</code> is required in all models. It means that life cycles will stay forever in the system.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="truerecruitment"><a class="anchor" href="#truerecruitment"></a>Recruitment</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/lifeCycle/<strong>recruit</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node specifies that two categories of the life cycle <code>categorySet</code> are linked by a <em>recruitment</em> process.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>recruit</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fromCategory &#8594; category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is getting changed by the recruitment.</p>
</dd>
<dt class="hdlist1"><code>toCategory &#8594; category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is the result of the recruitment.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
multiple targets are possible from the same category, i.e. a component of a category may recruit to different categories. E.g., a bee larva can recruit to a worker or a queen.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>effectedBy &#8594; process:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which ecological process is used to compute the recruitment. This process must implement exactly one  <a href="#truefunction"><code>ChangeCategoryDecision</code></a> function.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="truereproduction"><a class="anchor" href="#truereproduction"></a>Reproduction</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/lifeCycle/<strong>produce</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node specifies that two categories of the life cycle <code>categorySet</code> are linked by a <em>reproduction</em> process.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>produce</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fromCategory &#8594; category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is producing new system components.</p>
</dd>
<dt class="hdlist1"><code>toCategory &#8594; category:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which system component type is the result of the reproduction.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
multiple targets are possible from the same category, i.e. a component of a category may produce components of different categories. E.g., a tree can produce seedlings through sexual reproduction and root suckers through vegetative reproduction.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>effectedBy &#8594; process:&lt;<em>name</em>&gt;</code> {1}</dt>
<dd>
<p>This link tells which ecological process is used to compute the production of new system components. This process must implement exactly one  <a href="#truefunction"><code>CreateOtherDecision</code></a> function.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="trueexample-of-a-life-cycle-specification"><a class="anchor" href="#trueexample-of-a-life-cycle-specification"></a>Example of a life cycle specification</h6>
<div class="paragraph">
<p>This life cycle:</p>
</div>
<div id="fig-life-cycle-example" class="imageblock text-center thumb">
<div class="content">
<img src="../source/configuration-ecosystem-structureIMG/example-life-cycle.svg" alt="example life cycle" width="400">
</div>
<div class="title">Figure 20. Example of a life cycle</div>
</div>
<div class="paragraph">
<p>is specified with this graph:</p>
</div>
<div id="fig-life-cycle-config-example" class="imageblock text-center thumb">
<div class="content">
<img src="../source/configuration-ecosystem-structureIMG/example-life-cycle.png" alt="example life cycle" width="800">
</div>
<div class="title">Figure 21. Example of a life cycle configuration</div>
</div>
<div class="paragraph">
<p>The life cycle has two categories, <em>seedling</em> and <em>adult</em>, and three transitions: a <em>recruit</em> transition called <em>recruitment</em>, effected by the function <em>Recruit</em>, and two <em>produce</em> transitions, effected by the functions <em>Seed</em> and <em>Sprout</em>.</p>
</div>
<div id="system-howto" class="sidebarblock">
<div class="content">
<div class="title">How is the simulated system implemented?</div>
<div class="paragraph">
<p>Internally, system <em>component</em>s (= ecological entities) are instances of the same class, <code>SystemComponent</code>. They are stored in a hierarchy of nested <em>container</em>s that represent logical groupings of components based on categories: all components of a container belong to the same categories, in order to facilitate their processing by the user-defined function (remember that a <code>Process</code> also applies to some categories).</p>
</div>
<div class="paragraph">
<p>The nesting of containers is based on the <code>System</code> &gt; <code>LifeCycle</code> &gt; <code>Group</code> &gt; <code>Component</code> <code>-Type</code> hierarchy decided by the user. To each container is associated a single particular component instance that represents this container&#8230;&#8203; as one more <em>component</em> of the system. It is called the container&#8217;s <em>avatar</em>. Since containers are, by construct, populations of components, they have natural descriptors such as the number of components they contain, and the number of additions and deletions of components during the last simulator iteration. These are stored in the avatar as <em>automatic variables</em> (<a href="#truecategory">Section 3.3.3.1.1</a>), as specified by the predefined <code>*assemblage*</code> category (<a href="#truethe-predefined-sub-tree">Section 3.3.8</a>) which must be associated to all containers.</p>
</div>
<div class="paragraph">
<p>At the top of the container hierarchy is the <em>arena</em>, which contains everything else and matches the <code>System</code> node. The arena is always present and unique. In a full complexity 3Worlds system, the <em>arena</em> container has <em>life cycle</em> sub-containers, each of which can have <em>group</em> sub-containers wich ultimately contain the <em>components</em>. Of course this can be simplified: if there are no life cycles or groups defined in a model, these containers will not exist in the simulator and the container hierarchy will be simplified. Possibly to the simplest simulated system in 3Worlds, made of only the arena.</p>
</div>
<div class="paragraph">
<p>A <code>LifeCycleType</code>, <code>GroupType</code>, or <code>ComponentType</code> does not represent just one life cycle / group / component, but a <em>class</em> of those defined by their categories. As all classes, there can be many instances of these at runtime. When initialising a simulation with data (<a href="#truethe-setup-of-an-initial-state-for-a-simulation">Section 3.3.3.4</a>), it is possible, and important, to define names that will be used to uniquely identify e.g., various groups as instances of the same <code>GroupType</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truethe-representation-of-space"><a class="anchor" href="#truethe-representation-of-space"></a>The representation of space</h5>
<div class="paragraph">
<p>Sometimes modellers want an explicit representation of space for their model. 3Worlds provides a <a href="#true3worlds-library-of-spaces">library</a> of different spaces for this need.
Technically, space could just be treated as a component related to other components through particular relations. But since many optimal algorithms have been coded to handle particular aspects of space in relation to other entities, we use space as a kind of container for system components optimized for various operations such as searches for partners for establishing relations (see <a href="#trueprocess">process</a>).</p>
</div>
<div class="sect5">
<h6 id="truespace-and-spatial-indexing"><a class="anchor" href="#truespace-and-spatial-indexing"></a>Space and spatial indexing</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/<strong>space</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This defines a space, i.e. a container where system components can be located by their <em>spatial coordinates</em> and where distances can be computed. More than one space can coexist in 3Worlds, applying to possibly different types of components and processes. Spaces can be of 1 to 3 dimensions (this is set by choosing a space type).</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>space</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>The type of spatial representation</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>continuousFlatSurface</code>
</td>
<td class="hdlist2">
<p>a flat plan with continuous coordinates (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>squareGrid</code>
</td>
<td class="hdlist2">
<p>a flat square 2D grid for e.g. cellular automata</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>topographicSurface</code>
</td>
<td class="hdlist2">
<p>a topographic plan with elevations <strong>(not yet implemented)</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>linearNetwork</code>
</td>
<td class="hdlist2">
<p>a graph of connected segments for e.g., hydrologic networks  <strong>(not yet implemented)</strong></p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>borderType</code>
</td>
<td class="hdlist2">
<p>The space border behaviour</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>wrap</code>
</td>
<td class="hdlist2">
<p>a soft teletransporting border which sends objects crossing it to the other side of the space (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>reflection</code>
</td>
<td class="hdlist2">
<p>a hard border on which objects bounce back if they try to escape</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sticky</code>
</td>
<td class="hdlist2">
<p>a hard border on which objects stick if they try to escape</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>oblivion</code>
</td>
<td class="hdlist2">
<p>a soft border into oblivion – objects that cross it disappear into nothingness</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>infinite</code>
</td>
<td class="hdlist2">
<p>no border – space extends following object movements</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>edgeEffects</code>
</td>
<td class="hdlist2">
<p>The most common edge effect corrections</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>periodic</code>
</td>
<td class="hdlist2">
<p>wrap-around in all dimensions, i.e. leaving objects enter through the other end (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>reflective</code>
</td>
<td class="hdlist2">
<p>all borders are reflective, i.e. objects bounce on borders as on rubber walls</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>island</code>
</td>
<td class="hdlist2">
<p>a space with oblivious borders in all directions, i.e. leaving objects are lost forever</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>unbounded</code>
</td>
<td class="hdlist2">
<p>an infinite space adapting to location of items</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bounded</code>
</td>
<td class="hdlist2">
<p>a space with sticky borders in all directions, i.e. objects that bump into the border stay there</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>tubular</code>
</td>
<td class="hdlist2">
<p>wrap around borders in the first dimension, sticky borders in all other dimensions</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>custom</code>
</td>
<td class="hdlist2">
<p>user-specified border properties – provide a borderType property</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>Spatial resolution (in space units). Two locations are considered identical if their distance is below this value.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>units</code>
</td>
<td class="hdlist2">
<p>The measurement unit for distances and coordinates in this space</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>guardAreaWidth</code>
</td>
<td class="hdlist2">
<p>The width of a guard area around the space used to define an observation window</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>observationWindow</code>
</td>
<td class="hdlist2">
<p>A rectangle defining which part of the space is visible</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>space</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>coordinate &#8594; space:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link tells which descriptors are used as coordinates to locate system components in this space. This link has a required property <code>rank</code> which tells to which dimension of space a coordinate refers to. For example, you may set to 1 the rank of the <em>x</em> field and to 2 the rank of the <em>y</em> field if you want your 2D space coordinates to be <em>x</em> and <em>y</em>, in this order.</p>
</dd>
<dt class="hdlist1"><code>useRNG &#8594; rng:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>Points to the <a href="#truerandom-number-channels">random number generator channel</a> to use with this space (e.g., to generate random locations). If unset, the default random number channel is used.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="true3worlds-library-of-spaces"><a class="anchor" href="#true3worlds-library-of-spaces"></a>3Worlds library of spaces</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>FlatSurface</code>: This is a 2 dimensional, continuous space with rectangular limits. Internally, it is coupled to a Quadtree (ref) to optimise the search of nearby points when establishing relations (<code>relateToDecision</code> function).</p>
<div class="paragraph">
<p><em>Additional properties for space type</em> <code>FlatSurface</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>x-limits</code>
</td>
<td class="hdlist2">
<p>An <code>Interval</code> representing the minimum and maximum values of the x (first) dimension.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>y-limits</code>
</td>
<td class="hdlist2">
<p>An <code>Interval</code> representing the minimum and maximum values of the y (second) dimension.</p>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>SquareGrid</code>: This is a 2 dimensional, discrete space with rectangular limits and square cells. The locations are only known at the cell level, which helps optimize searches for nearby locations.</p>
<div class="paragraph">
<p><em>Additional properties for space type</em> <code>SquareGrid</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>cellSize</code>
</td>
<td class="hdlist2">
<p>The length of the side of the (square) cells in space units</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>x-nCells</code>
</td>
<td class="hdlist2">
<p>The number of cells in the x (first) dimension.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>y-nCells</code>
</td>
<td class="hdlist2">
<p>The number of cells in the y (second) dimension.</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="trueshapes-and-topology"><a class="anchor" href="#trueshapes-and-topology"></a>Shapes and topology</h6>
<div class="paragraph">
<p><strong>This part is still under construction.</strong></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truethe-setup-of-an-initial-state-for-a-simulation"><a class="anchor" href="#truethe-setup-of-an-initial-state-for-a-simulation"></a>The setup of an initial state for a simulation</h5>
<div class="paragraph">
<p>To run a simulation, an initial population of system component, group, life cycle, and system <em>instances</em> must be constructed from their respective <em>types</em> (e.g. <code>groupType</code>, <code>componentType</code>, etc.). They constitute the <em>initial state</em> of a simulation. The initial state is kept in memory by the simulator, and is re-loaded at every simulator reset prior to a new simulation run. To set descriptor values in initial instances, two methods are possible: through the use of a specific <a href="#truefunction"><em>function</em></a> (<code>setInitialState</code>), or through external data files listed as <a href="#trueinputs-datasource"><em>data sources</em></a>.</p>
</div>
<div class="sect5">
<h6 id="truecomponent"><a class="anchor" href="#truecomponent"></a>Component</h6>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/componentType/<strong>component</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Use this node to instantiate components of a given <code>componentType</code>.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>component</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>nInstances</code>
</td>
<td class="hdlist2">
<p>Number of instances to create. If not set, the default behaviour is to create only one instance of this component. Otherwise, <code>nInstances</code> components are created, all with identical descriptors - unless a <code>setInitialState</code> function is used that can use random numbers to differentiate instances.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>component</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>instanceOf &#8594; group:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>This link tells to which <code>group</code> these component instances belong. It is required if <code>groupTypes</code> have been defined in the model, optional otherwise. This property is ignored if a <code>loadFrom</code> link (see below) is present.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="truegroup"><a class="anchor" href="#truegroup"></a>Group</h6>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/groupType/<strong>group</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Use this node to instantiate a group of components. Use groups to set properties that are shared by a set of component instances, e.g. a species name or group-level constants.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>group</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>groupOf &#8594; componentType:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>If no <code>component</code> node is defined for this group, this link is required to specify which <code>componentType</code> should be used for instantiation of components of this group. In any other case it is not required. You can view this as a replacement for the <code>instanceOf</code> link above: either must be present for a group, but not both.</p>
</dd>
<dt class="hdlist1"><code>cycle &#8594; lifeCycle:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>This link tells in which <code>lifeCycle</code> instance this group is involved. The <code>groupType</code> of this <code>group</code> must be compatible with the <code>lifeCycleType</code> category requirements.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="truelife-cycle-2"><a class="anchor" href="#truelife-cycle-2"></a>Life cycle</h6>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/lifeCycleType/<strong>lifeCycle</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p>Use this node to instantiate a life cycle applying to a set of groups.</p>
</div>
</div>
<div class="sect5">
<h6 id="truesetting-decriptor-values"><a class="anchor" href="#truesetting-decriptor-values"></a>Setting decriptor values</h6>
<div class="paragraph">
<p>A first method to set descriptor values is to define a <code>setInitialState</code> function as a child of the <code>componentType</code>, <code>groupType</code>, <code>lifeCycleType</code> or <code>system</code> nodes. Such functions are only called once, at the beginning of a simulation, to setup the <em>initial state</em> of a model. In a <code>setInitialState</code> function, only drivers and constants can be set (it is the only place where constants can be set).</p>
</div>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/componentType/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/groupType/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/lifeCycleType/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/system/<strong>initFunction</strong>:&lt;<em>name</em>&gt;</code></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>initFunction</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>The type of function used: only <a href="#truefunction"><code>setInitialState</code></a> is possible.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>initFunction</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>useRNG &#8594; rng:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>Points to the <a href="#truerandom-number-channels">random number generator channel</a> to use in this function. If unset, the default random number channel is used.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A second method to set descriptor values is to import data from an external source. This is done by defining a  <a href="#trueinputs-datasource"><code>dataSource</code></a> and linking a <code>component</code>, <code>group</code>, <code>lifeCycle</code> or <code>system</code> to it:</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>component</code>, <code>group</code>, <code>lifeCycle</code>, and <code>system</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>loadFrom &#8594; dataSource:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>This link tells where to read the initial values of the descriptors from.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truethe-systemdynamics-node"><a class="anchor" href="#truethe-systemdynamics-node"></a>3.3.4. The <em>system/dynamics</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/system/<strong>dynamics</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains the description of the processes that will change the state of the system and create its dynamics. It is based on the concepts of <em>time model</em>, <em>ecological process</em>, and <em>life cycle</em>. Internally, the <code><strong>dynamics</strong></code> node is the <em>simulator</em>, i.e. the object which, when kicked to do so, will make all the computations necessary to run a simulation.</p>
</div>
<div class="sect4">
<h5 id="truethe-representation-of-time"><a class="anchor" href="#truethe-representation-of-time"></a>The representation of time</h5>
<div class="paragraph">
<p>Simulation is about mimicking the dynamics of a real system. Here, dynamics is specified by attaching particular behaviours (called <a href="#trueprocess">processes</a>) to either  <a href="#truecategory">categories</a> or <a href="#truerelationtype">relation types</a>. Processes may act at a different rhythm or rate in nature, so we need to have a great flexibility in the way time is represented.</p>
</div>
<div class="sect5">
<h6 id="truetime-line"><a class="anchor" href="#truetime-line"></a>Time line</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/<strong>timeLine</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>Every simulator has a reference <em>time line</em>. Since different ecological processes may run according to different time models, they must refer to a common time frame for interaction to be possible among them. A <code><strong>timeLine</strong></code> defines what kind of time scale and time units can be used in a simulation. In 3Worlds, time is always discrete in the end, so that the selected values of time scale and time unit define the time <em>grain</em> of the simulation, i.e. the duration below which events are considered simultaneous. Internally, the <code>ModelRunner</code> uses integers to represent time, with 1 = one time grain.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>timeLine</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>scale</code>
</td>
<td class="hdlist2">
<p>This property specifies the type of time scale to use. The usual time units pose many problems, because years, months, weeks and days are not integer multiples of each other. The option is either to use a real calendar time scale – but this is not needed in most simulation studies – or to use approximations which enable year, months, weeks and days to be integer multiples of each other (e.g. an easy approximation is to assume 30-day months, but this means years must be only 360-day long). This property proposes a set of such simplified, compatible sets of units, denoted as time scales.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>ARBITRARY</code>
</td>
<td class="hdlist2">
<p>arbitrary time units with no predefined name (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>GREGORIAN</code>
</td>
<td class="hdlist2">
<p>real calendar time</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_365D</code>
</td>
<td class="hdlist2">
<p>365-days years, no weeks, no months</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_13M</code>
</td>
<td class="hdlist2">
<p>28-days months, 13-months/52-weeks years</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>WMY</code>
</td>
<td class="hdlist2">
<p>28-days months, 12-months/48-weeks years</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH_30D</code>
</td>
<td class="hdlist2">
<p>30-days months, weeks replaced by 15-days fortnights</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_366D</code>
</td>
<td class="hdlist2">
<p>366-days year, months replaced by 61-days bi-months</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>LONG_TIMES</code>
</td>
<td class="hdlist2">
<p>long time units only (month or longer), calendar-compatible</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SHORT_TIMES</code>
</td>
<td class="hdlist2">
<p>short time units only (week or shorter), calendar-compatible</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONO_UNIT</code>
</td>
<td class="hdlist2">
<p>single time unit, calendar-compatible</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>shortestTimeUnit</code>
</td>
<td class="hdlist2">
<p>The shortest time unit used in this model. Note that the time scale constraints the time units compatible with each other for this property.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>UNSPECIFIED</code>
</td>
<td class="hdlist2">
<p>an arbitrary time unit (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MICROSECOND</code>
</td>
<td class="hdlist2">
<p>microsecond</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MILLISECOND</code>
</td>
<td class="hdlist2">
<p>millisecond = 1000 microseconds</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SECOND</code>
</td>
<td class="hdlist2">
<p>second = 1000 milliseconds</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MINUTE</code>
</td>
<td class="hdlist2">
<p>minute = 60 seconds</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HOUR</code>
</td>
<td class="hdlist2">
<p>hour = 60 minutes</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>DAY</code>
</td>
<td class="hdlist2">
<p>day = 24 hours</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>WEEK</code>
</td>
<td class="hdlist2">
<p>week = 7 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>FORTNIGHT_15</code>
</td>
<td class="hdlist2">
<p>French-style fortnight = 15 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH_28</code>
</td>
<td class="hdlist2">
<p>month = 4 weeks of 7 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH_30</code>
</td>
<td class="hdlist2">
<p>month = 30 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MONTH</code>
</td>
<td class="hdlist2">
<p>calendar month (= 1/12 of a calendar year), <em>i.e.</em> approx. 30,44 days, but with irregular durations (28,29, 30 or 31 days)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>BIMONTH_61</code>
</td>
<td class="hdlist2">
<p>2 months = 61 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_336</code>
</td>
<td class="hdlist2">
<p>year = 12 months of 4 weeks of 7 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_360</code>
</td>
<td class="hdlist2">
<p>year = 12 months of 30 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_364</code>
</td>
<td class="hdlist2">
<p>year = 52 weeks of 7 days = 13 months of 28 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_365</code>
</td>
<td class="hdlist2">
<p>year = 365 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR</code>
</td>
<td class="hdlist2">
<p>calendar year, <em>i.e.</em> approx. 365.25 days, but with irregular durations (365 or 366 days)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>YEAR_366</code>
</td>
<td class="hdlist2">
<p>year = 6 bimonths of 61 days</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>DECADE</code>
</td>
<td class="hdlist2">
<p>decade = 10 years</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>CENTURY</code>
</td>
<td class="hdlist2">
<p>century = 10 decades</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MILLENNIUM</code>
</td>
<td class="hdlist2">
<p>millennium = 10 centuries</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>longestTimeUnit</code>
</td>
<td class="hdlist2">
<p>The longest time unit used in this model. <em>cf.</em> <code>shortestTimeUnit</code> for valid values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>timeOrigin</code>
</td>
<td class="hdlist2">
<p>The value of time at simulation start, either as a long (number of <code>shortestTimeUnit</code>) or as a date; 0 by default.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="truetimers"><a class="anchor" href="#truetimers"></a>Timers</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/timeLine/<strong>timer</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>Ecological processes may be run following different times. A timer is a particular way of representing time in the simulator. Timers may differ in parameters, like e.g. two timers using different time steps; but they can also be radically different in their logic: e.g. clock-like ticking vs. event-driven simulation.</p>
</div>
<div id="timer-howto" class="sidebarblock">
<div class="content">
<div class="title">How do timers work?</div>
<div class="paragraph">
<p>Internally, each timer is an instance of the class <code>Timer</code>, which is able to return the next time where computation must be made according to its own logic. Every iteration of 3Worlds starts with the simulator asking all timers for their next time, then keeping all of those with the next time closest to last time, and executing them <em>in unpredictable order</em>. 3Worlds uses long integers to measure time internally, which means that simultaneous events are possible (times may be strictly equal). The finest time interval is given by <code>TimeLine.shortestTimeUnit</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>timer</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>the type of <code>timer</code> to use.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>ClockTimer</code>
</td>
<td class="hdlist2">
<p>Time is incremented by a constant amount <em>dt</em>. This is commonly used to simulate regular processes like growth.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>EventTimer</code>
</td>
<td class="hdlist2">
<p>Model dynamics generates <em>events</em> and computes the date in the future at which they are going to occur. This is commonly used to generate irregular processes like fire occurrence.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ScenarioTimer</code>
</td>
<td class="hdlist2">
<p><strong>Not yet implemented</strong>.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = ClockTimer</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>timeUnit</code>
</td>
<td class="hdlist2">
<p>the base time unit used by this timer. <em>cf.</em> <code>timeLine.shortestTimeUnit</code> for the valid values of this property</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>nTimeUnits</code>
</td>
<td class="hdlist2">
<p>the number of base time units in the time unit of this model (<em>e.g.</em>, a model may have a 2 year time unit)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dt</code>
</td>
<td class="hdlist2">
<p>The constant time increment used in this <code>ClockTimer</code>, expressed as an integer number of <code>timer</code> base unit (=<code>timer.nTimeUnits</code> × <code>timer.timeUnit</code>). For example, if the <code>timer</code> has <code>timeUnit</code> = <code>DAY</code> and <code>nTimeUnits</code> = 3, <code>dt</code> is expressed in units of 3 days (e.g. <code>dt</code> = 2 means the time increment is 6 days).</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
if calendar time is used (<code>timeLine.scale</code> = <code>GREGORIAN</code>), then <code>dt</code> will sometimes not be constant (e.g. if <code>dt</code> = 2 <code>MONTH</code>, <code>dt</code> will vary in duration between 59 and 62 days according to the exact date).
</td>
</tr>
</table>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>offset</code>
</td>
<td class="hdlist2">
<p>In some cases it is desirable to offset a <code>ClockTimer</code> relative to another one running at the same time step, for example to be certain of their order of execution or to simulate cyclic phenomena (e.g. seasons). The timer will start after <code>offset</code> × <code>timeUnit</code> units, where <code>offset</code> is a fraction between 0.0 and 1.0.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional cross-links when</em> <code>class = EventTimer</code></p>
</div>
<div class="paragraph">
<p>An <code>EventTimer</code> maintains a queue of time events that gets populated by user-defined ecological <a href="#truefunction">functions</a>. This way, future events depend on the dynamics of the system. Functions that can populate an event queue will have an <code>EventQueue</code> argument in their heading, usable to create future time events. Events must set a time in the future, i.e. their time must be larger than current time. Event times are always expressed in <code>Timeline.shortestTimeUnit</code>s in an <code>EventTimer</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fedBy &#8594; initFunction:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link is used to set the first event of an <code>EventTimer</code> at simulation start, hence from an <a href="#truesetting-decriptor-values"><code>initFunction</code></a>. Without this initial event, the timer will never start. More than one event can be created here.</p>
</dd>
<dt class="hdlist1"><code>fedBy &#8594; function:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>These links indicate which functions can populate the event queue with time events. Multiple events can be created here.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="truesimulation-stopping-condition"><a class="anchor" href="#truesimulation-stopping-condition"></a>Simulation stopping condition</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/<strong>stoppingCondition</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A simulation may be run indefinitely (interactively), but in big simulation experiment it is useful to automatically stop the simulations according to some criterion. Besides the simplest stopping condition, reaching a maximal time value, 3Worlds provides many other possibilities to stop a simulation (e.g. based on a population size, on a variable passing a threshold value, etc.).</p>
</div>
<div class="paragraph">
<p>When no stopping condition is defined, the simulation will run indefinitely.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>stoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>The type of stopping condition to use</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>SimpleStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a maximal time value is reached.</p>
</dd>
<dt class="hdlist1"><code>ValueStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a variable in a reference system component reaches a given value.</p>
</dd>
<dt class="hdlist1"><code>InRangeStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a variable in a reference system gets within the given range.</p>
</dd>
<dt class="hdlist1"><code>OutRangeStoppingCondition</code></dt>
<dd>
<p>Simulation stops when a variable in a reference system gets out of the given range.</p>
</dd>
<dt class="hdlist1"><code>MultipleOrStoppingCondition</code></dt>
<dd>
<p>Compound stopping condition: simulation stops when <em>any</em> of the elementary stopping conditions within this multiple condition&#8217;s list is true.</p>
</dd>
<dt class="hdlist1"><code>MultipleAndStoppingCondition</code></dt>
<dd>
<p>Compound stopping condition: simulation stops when <em>all</em> of the elementary stopping conditions within this multiple condition&#8217;s list are true.</p>
</dd>
</dl>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = SimpleStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>duration</code>
</td>
<td class="hdlist2">
<p>The duration of the simulation beyond time line <code>timeOrigin</code>, in time line <code>shortestTimeUnits</code>.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional cross-links when</em> <code>class = ValueStoppingCondition</code>, <code>InRangeStoppingCondition</code>,  <code>OutRangeStoppingCondition</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>stopSystem &#8594; component:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>The system component in which some variable will be checked to stop the simulation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = ValueStoppingCondition</code>, <code>InRangeStoppingCondition</code>,  <code>OutRangeStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>stopVariable</code>
</td>
<td class="hdlist2">
<p>The name of the variable in <code>stopSystem</code> which values are used to decide to stop the simulation.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = ValueStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>stopValue</code>
</td>
<td class="hdlist2">
<p>The value of <code>stopVariable</code> at which to stop the simulation.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>class = InRangeStoppingCondition</code>, <code>OutRangeStoppingCondition</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>upper</code>
</td>
<td class="hdlist2">
<p>The upper value of the <code>stopVariable</code> range. Only <code>double</code> values are accepted.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>lower</code>
</td>
<td class="hdlist2">
<p>The lower value of the <code>stopVariable</code> range. Only <code>double</code> values are accepted.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional cross-links when</em> <code>class = MultipleOrStoppingCondition</code>, <code>MultipleAndStoppingCondition</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>condition &#8594; stoppingCondition:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>These links point to the stopping conditions that will be used as elementary stopping conditions by the multiple and/or stopping condition. Use these links to construct complex stopping conditions.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truethe-transformations-of-a-system-component"><a class="anchor" href="#truethe-transformations-of-a-system-component"></a>The transformations of a system component</h5>
<div class="paragraph">
<p>Changes in a <em>system component</em> through time may be of different kinds: changes in <em>state</em>, i.e. in its driver and decorator variables; or more radical changes where the component actually changes <em>category</em>, so becomes represented by a different set of variables. Plus, a component may have an ephemeral life (lifespan property), which means component objects are dynamically created or deleted during a simulation.</p>
</div>
<div class="sect5">
<h6 id="trueprocess"><a class="anchor" href="#trueprocess"></a>Process</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/timeLine/timer/<strong>process</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p><em>Processes</em> are used in 3Worlds to compute change in <a href="#truesystem-component"><em>system components</em></a>. Each process acts on system components of a particular group of <a href="#truecategories">categories</a> and is scheduled by a particular <a href="#truetimers">timer</a>. Processes contain user-defined code that represents ecological processes. This gives 3Worlds its versatility: one can mix in a single model completely different ecological entities (system components of different categories), implement any ecological process depending on user needs, and put them to work on different time scales (times). A <code>process</code> is run according to its parent <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>process</code></p>
</div>
<div class="paragraph">
<p>A process can act on a single system component at a time (called the <em>focal</em> system component), or on a pair of components linked by a relation (called the <em>focal</em> and the <em>other</em> system components). This is specified using the <code>appliesTo</code> cross-link (one at least must be present):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>appliesTo &#8594; category:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>These links indicate the categories of system components that will be acted on by the process.</p>
</dd>
<dt class="hdlist1"><code>appliesTo &#8594; relation:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>This link indicates to which relation type between system component the process applies.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A process <strong>must</strong> apply either to categories (<em>category process</em>) or to a single relation type (<em>relation process</em>), but cannot apply to both.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>dependsOn &#8594; process:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>This link tells that the process must be activated <em>after</em> the processes targeted by the links. Use this link to organize computations when there are dependencies between them.</p>
</dd>
<dt class="hdlist1"><code>inSpace &#8594; space:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>This link indicates that this process will make use of this  <a href="#truethe-representation-of-space">space</a> for its optimisation of neighbour searches. Use this link when you want fast search for candidates to establish a relation, i.e. in association with the <code>relateToDecision</code> function. The required property <code>searchRadius</code> in the <code>inSpace</code> link tells to which <em>maximal</em> distance candidates for establishing a relation must be searched. 3Worlds will only present components at a shorter distance than <code>searchRadius</code> (possibly none) to the <code>relateToDecision</code> function. A value of zero means the algorithm searches for the closest neighbour only (possibly more than one if all exactly at the same distance), whatever its distance to the focal component.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Forgetting to set the value of <code>searchRadius</code> is a common source of unexpected behaviour in spatial models.
</td>
</tr>
</table>
</div>
<div id="process-howto" class="sidebarblock">
<div class="content">
<div class="title">How do processes work?</div>
<div class="paragraph">
<p>Internally, an instance of the <code>Process</code> class implements a '<em>for each</em>' loop on system components during an iteration step, as scheduled by its <code>Timer</code>. The order in which the components are processed in a loop is unpredictable (not fixed, nor random); the only safe assumption is to consider that they are all processed simultaneously.</p>
</div>
<div class="paragraph">
<p>If the process applies to a list of categories, it is a single loop on all components belonging to these categories. This is the <code>ComponentProcess</code> sub-class.</p>
</div>
<div class="paragraph">
<p>If it applies to a relation type, it is either (1) a double loop, possibly optimized by using a space, on components belonging to the 'from' list of categories of the relation type, and components belonging to the 'to' list of categories of the relation type (<code>SearchProcess</code> sub-class); or (2) a single loop on relations instances of its relation type (<code>RelationProcess</code> sub-class).</p>
</div>
<div class="paragraph">
<p>Processes of a same timer are run in any (= unpredictable) order unless explicitly ordered by the use of the <code>dependsOn</code> cross-link.</p>
</div>
<div class="paragraph">
<p>In short: process = (parallel) loop on components within one time step.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="truefunction"><a class="anchor" href="#truefunction"></a>Function</h6>
<div class="paragraph">
<p><code>/3worlds/system/dynamics/timeLine/timer/<strong>function</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1..*}</p>
</div>
<div class="paragraph">
<p>This node is used to specify the details of the computations made in a <code>process</code>. The <code>process</code> defines which system components are going to be activated and at what time in the simulation course; the <code>function</code> defines which computations, in detail, will be applied to the system components of that process. This enables to build complex computations applying to one component (a series of <code>function</code>s within a <code>process</code>) in the context of a particular subset of components (<code>process</code>).</p>
</div>
<div class="paragraph">
<p>There are different types of functions, differing by the way they affect system components and relations. The selection of a function type will trigger the generation in the model java source file of a method having the name specified in the <code>function</code> node name. This method is expected to be edited by the modeller in order to implement her/his favourite version of the ecological process modelled by the function.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The name of a function must be a valid java class name, starting with an uppercase letter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>function</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>This property specifies which kind of biological function will be implemented within the linked <code>Process</code> obect.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>ChangeState</code>
</td>
<td class="hdlist2">
<p>change the state, i.e. the values of the descriptors of a system component (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ChangeCategoryDecision</code>
</td>
<td class="hdlist2">
<p>change category of a system component according to life cycle (has no effect if no life cycle is specified)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>CreateOtherDecision</code>
</td>
<td class="hdlist2">
<p>create another system component, of the same categories if no life cycle is present, otherwise as specified by the life cycle</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>DeleteDecision</code>
</td>
<td class="hdlist2">
<p>delete self</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ChangeOtherState</code>
</td>
<td class="hdlist2">
<p><em>focal</em> changes the state of <em>other</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>RelateToDecision</code>
</td>
<td class="hdlist2">
<p><em>focal</em> establishes a new relation to <em>other</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MaintainRelationDecision</code>
</td>
<td class="hdlist2">
<p>decision to maintain or remove an existing relation</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ChangeRelationState</code>
</td>
<td class="hdlist2">
<p>change the state of a relation, i.e. possibly both the state of <em>focal</em> and <em>other</em> at the same time</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SetInitialState</code>
</td>
<td class="hdlist2">
<p>sets the initial state of a newly created SystemComponent</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SetOtherInitialState</code>
</td>
<td class="hdlist2">
<p>sets the initial state of a newly created SystemComponent given a parent component</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>relateToDecision</code> function has a special status among relation processes as it is used to establish a relation, whereas all other functions for relation processes use an already established relation. As a result, a process parent to a <code>relateToDecision</code> function cannot be parent to any other type of function. For computation efficiency, it is recommended to associate a <a href="#truethe-representation-of-space"><em>space</em></a> to the process parent to a <code>relateToDecision</code> function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>function</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>useRNG &#8594; rng:&lt;<em>name</em>&gt;</code> {0..1}</dt>
<dd>
<p>Points to the <a href="#truerandom-number-channels">random number generator channel</a> to use in this function. If unset, the default random number channel is used.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>function = createOtherDecision</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>relateToProduct</code>
</td>
<td class="hdlist2">
<p>A logical value (<code>false</code> by default) which tells to establish a permanent <code>parentTo</code> relation (defined in the <code>predefined</code> sub-tree: <a href="#truethe-predefined-sub-tree">Section 3.3.8</a>) between a parent component and its offspring created by calling <code>createOtherDecision</code>.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/function/<strong>snippet</strong>:&lt;<em>name</em>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>This node is used in 3Worlds tutorial and test models  to store the java code of functions (in its <code>javaCode</code> property).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
We recommend not to use snippets, or only for simple models, since it may cause problems when the code contained in a snippet contains compile errors, something very easy to achive when, e.g., renaming a field or table. If you use it, do it with caution.
</td>
</tr>
</table>
</div>
<div id="function-howto" class="sidebarblock">
<div class="content">
<div class="title">How do functions work?</div>
<div class="paragraph">
<p>Functions are called within the loop on components of their parent process. The processing order of functions within their process is constant:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a <code>ComponentProcess</code>:</p>
<div class="ulist">
<ul>
<li>
<p>execute all <code>changeState</code> functions</p>
</li>
<li>
<p>then, all <code>deleteDecision</code> functions,</p>
</li>
<li>
<p>then, all <code>createOtherDecision</code> functions,</p>
</li>
<li>
<p>then, all <code>changeCategoryDecision</code> functions,</p>
</li>
<li>
<p>then send data to all <a href="#truedata-tracking">data trackers</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>In a <code>SearchProcess</code>:</p>
<div class="ulist">
<ul>
<li>
<p>execute all <code>relateToDecision</code> functions</p>
</li>
</ul>
</div>
</li>
<li>
<p>In a <code>RelationProcess</code></p>
<div class="ulist">
<ul>
<li>
<p>execute all <code>changeOtherState</code> functions</p>
</li>
<li>
<p>then, all <code>maintainRelationDecision</code> functions,</p>
</li>
<li>
<p>then, all <code>changeRelationState</code> functions</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The order of these computations does not matter for <em>driver</em> descriptors, nor for component creation and deletion, because all the changes are postponed until after the process loop is over. For example, a component may in the same time step reproduce an die. The order may only matter for <em>decorators</em>, which are provided here as a convenience for complex computations.</p>
</div>
<div class="paragraph">
<p>A way to make your model code efficient is to group functions run with the same timer in a single process, so that they are called in a single pass on components instead of many in case you use different processes. This assumes that your functions can be processed in any order without consequences on the outcome - which is not always true. If you need a precise ordering of function calls because, e.g. one of them requires that a decorator variable has been set by another, then you must place your functions in different processes linked by a <code>dependsOn</code> cross-link to tell which is computed first.</p>
</div>
<div class="paragraph">
<p>At the end of all process loops (of all timers activated for the current time step):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>all <em>decorators</em> are set to zero;</p>
</li>
<li>
<p>the values of all <em>drivers</em> are updated (i.e. values computed by functions are stored in a <em>next</em> driver data structure, which now replaces the <em>current</em> driver structure);</p>
</li>
<li>
<p><em>components</em> to be deleted and to be created as decided by <code>-Decision</code> functions, and <em>ephemeral</em> relations to create/delete, are now inserted in the current list of components;</p>
</li>
<li>
<p><em>automatic</em> descriptors (e.g. component age, population numbers) are updated;</p>
</li>
<li>
<p><em>spaces</em> are updated according to changes in the component community;</p>
</li>
<li>
<p><em>permanent</em> relations between components are updated.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="truefunction-consequences"><a class="anchor" href="#truefunction-consequences"></a>Function consequences</h6>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/process/function/<strong>consequence</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Some functions may imply consequences: for example, a decision to delete another system component may be followed by a change in state based on the deleting component&#8217;s state at the time it is deleted. Such functions that are only activated when certain events take place are called <em>consequences</em> and may be specified by a child node to a function. Here also, rules apply:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">function</th>
<th class="tableblock halign-left valign-top">consequence</th>
<th class="tableblock halign-left valign-top">use to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeState</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeRelationState</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeOtherState</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeOtherState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carry over values to another component linked by a <code>returnsTo</code> relation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createOtherDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setOtherInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the initial state of the new component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relateToDecision</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeCategoryDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setOtherInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carry over and compute values from the former component (<em>focal</em>) to the new recruit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maintainRelationDecision</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relateToDecision</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Consequence functions have the same properties and cross-links as functions (cf. above).</p>
</div>
<div id="consequence-howto" class="sidebarblock">
<div class="content">
<div class="title">How do consequence functions work?</div>
<div class="paragraph">
<p>Internally, consequence functions are just functions which are called <em>immediately after</em> their parent function. E.g., in a <code>ComponentProcess</code> loop on <code>deleteDecision</code> functions, each <code>deleteDecision</code> function is immediately followed by a call to its consequence <code>changeOtherState</code> function, if any.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truedata-tracking"><a class="anchor" href="#truedata-tracking"></a>Data tracking</h5>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/process/<strong>dataTracker</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Data trackers are used to get output from a simulation. This output can then be redirected either to graphic windows of <code>ModelRunner</code> or to a data file for later processing with other software. Using a data tracker is similar to what happens in the real world: you set a sensor into the system you want to monitor and wire it to a data logger which translates the signal into human-readable data. There are different kinds of data trackers according to the output format and the sampling method you want to use; and different ways of wiring these trackers to the simulated system and its components.</p>
</div>
<div class="paragraph">
<p>A data tracker will record values of descriptors (except constants) of a sample of system components or groups, or of the system itself and send them to any listener (usually a <a href="#truewidgets">widget</a>) linked to it. The frequency of data sending is determined by the <em>timer</em> of the parent <em>process</em> of the data tracker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A <code>dataTracker</code> node can only be specified in a <em>category process</em>, not in a <em>relation process</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dataTracker</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>samplingMode</code>
</td>
<td class="hdlist2">
<p>This property specifies how to pick system components for data tracking <em>within a group</em>. The data will be either (1) selected for one particular system component within each group, or (2) taken from that group’s own data, if any (e.g. species population size), or (3) aggregated using some statistical method ; all this, depending on the cross-links of the <code>dataTracker</code>. For (1), the default behaviour is that once a system component is selected, it will be tracked until its deletion by the simulator. In all cases, remember that the maximal number of data tracking channels is set by the <code>sampleSize</code> property; this property only tells the software how to fit the data coming from possibly many system components into the requested number of output channels.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>RANDOM</code>
</td>
<td class="hdlist2">
<p>selects system components randomly to constitute the sample (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>FIRST</code>
</td>
<td class="hdlist2">
<p>selects the first system components of their group (as internally stored) to constitute the sample. Notice that components may come in any order and that this order may change unpredictably during a simulation.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>LAST</code>
</td>
<td class="hdlist2">
<p>selects the last system components of their group (as internally stored) to constitute the sample. Notice that components may come in any order and that this order may change unpredictably during a simulation.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sampleSize</code>
</td>
<td class="hdlist2">
<p>How many system components at most will be tracked. Valid values are any positive integer or the keyword <code>ALL</code> to sample all the components of a given group.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>statistics</code>
</td>
<td class="hdlist2">
<p>This property lists transformations of the raw data to compute when a group contains more than one system component.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>mean</code>
</td>
<td class="hdlist2">
<p>mean (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>var</code>
</td>
<td class="hdlist2">
<p>variance</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>se</code>
</td>
<td class="hdlist2">
<p>standard error</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cv</code>
</td>
<td class="hdlist2">
<p>coefficient of variation (%)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sum</code>
</td>
<td class="hdlist2">
<p>sum</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>N</code>
</td>
<td class="hdlist2">
<p>count</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min</code>
</td>
<td class="hdlist2">
<p>minimum</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max</code>
</td>
<td class="hdlist2">
<p>maximum</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>tableStatistics</code>
</td>
<td class="hdlist2">
<p>This property lists transformations of the raw data to compute in case of a table variable. The grouping is determined by the index specification in the track variable list. cf. property <code>statistics</code> for valid values.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>The type of data tracker to use</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>DataTracker0D</code></dt>
<dd>
<p>time series tracker; returns (<em>t</em>, <em>x<sub>1</sub></em>, &#8230;&#8203;, <em>x<sub>n</sub></em>) values (where <em>t</em> is time and <em>x<sub>i</sub></em> the descriptors of interest).</p>
</dd>
<dt class="hdlist1"><code>DataTrackerXY</code></dt>
<dd>
<p>raw tracker; returns (<em>x</em>,<em>y</em>) values at each time step.</p>
</dd>
<dt class="hdlist1"><code>DataTracker2D</code></dt>
<dd>
<p><strong>unimplemented yet</strong></p>
</dd>
</dl>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>dataTracker</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackComponent &#8594; component:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>The <code>dataTracker</code> will track all initial components pointed by these links. If these are <em>permanent</em> components, they will be tracked until the end of the simulation. If they are <em>ephemeral</em>, <strong>they must all belong to the same <em>group</em></strong> and, when they are deleted, they will be replaced by other components of the same <em>group</em> using the sampling strategy defined by the <code>samplingMode</code> and <code>sampleSize</code> properties.</p>
</dd>
<dt class="hdlist1"><code>trackComponent &#8594; group:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>If the categories of the <code>process</code> parent of this <code>dataTracker</code> are the same as those of the <code>groupType</code> parent of the <em>group</em> pointed by this link, then the group data are tracked. If they are the same as the <code>componentType</code> of this group&#8217;s <em>components</em>, the <code>dataTracker</code> will sample the <em>group</em>  for components using the sampling strategy defined by the <code>samplingMode</code> and <code>sampleSize</code> properties.</p>
</dd>
<dt class="hdlist1"><code>trackComponent &#8594; groupType:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>The <code>dataTracker</code> will sample the <em>group type</em> pointed by this link for <em>groups</em> using the sampling strategy defined by the <code>samplingMode</code> and <code>sampleSize</code> properties.</p>
</dd>
<dt class="hdlist1"><code>trackComponent &#8594; system:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>The <code>dataTracker</code> will only track the <em>system</em> data.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The items pointed by all the <code>trackComponent</code> cross-links must belong to categories compatible with the parent <code>process</code> of the <code>dataTracker</code> (<code>process</code> <code>appliesTo</code> cross-links).
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The four <code>trackComponent</code> cross-links types cannot be used together with the same data tracker.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackField &#8594; field:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>The <code>dataTracker</code> will track all fields pointed by these cross-links in all objects (<em>components</em>, <em>groups</em>, or <em>system</em>) it is sampling.</p>
</dd>
<dt class="hdlist1"><code>trackTable &#8594; table:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</dt>
<dd>
<p>The <code>dataTracker</code> will track all tables pointed by these cross-links in all objects (<em>components</em>, <em>groups</em>, or <em>system</em>) it is sampling.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the trackField or trackTable cross-links must be refer to fields or tables present in the categories of the parent <code>process</code> of the <code>dataTracker</code> (<code>process</code> <code>appliesTo</code> cross-links).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>trackField</code> <em>and</em> <code>trackTable</code> <em>cross-links</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>index</code>
</td>
<td class="hdlist2">
<p>A list of <code>String</code>s giving the range of table indices to track. The following rules are used to specify which cells of the table should be picked:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>an index specification for a table is enclosed in square brackets: <code>[]</code>;</p>
</li>
<li>
<p>vertical bars separate dimensions: e.g. <code>[||]</code> refers to a table with three dimensions;</p>
</li>
<li>
<p>a single number is used to specify a single cell in one dimension: e.g. <code>[1||]</code> refers to the cell 1 in dimension 1 (Note: this is the <em>second</em> cell in this dimension as all dimension indices start at 0 = first cell);</p>
</li>
<li>
<p>a list of cells in one dimension is specified using commas: e.g. <code>[1|0,2,7|]</code> refers to the cells 0, 2 and 7 in the second dimension;</p>
</li>
<li>
<p>a range of cells in one dimension is specified using a column: e.g. <code>[1|0,2,7|2:4]</code> refers to the cells 2,3 and 4 in the third dimension;</p>
</li>
<li>
<p>a negative number means that all cells in a dimension must be tracked <em>except</em> this number: e.g. <code>[-1|0,2,7|2:4]</code> indicates that all cells in the first dimension except cell 1 must be tracked.</p>
</li>
<li>
<p>a minus sign in front of a range means that all cells in a dimension must be tracked <em>except</em> this whole range: e.g. <code>[1|0,2,7|-2:4]</code> indicates that all cells in the third dimension except cells 2, 3 and 4 must be tracked.</p>
</li>
<li>
<p>an empty dimension means all cells in this dimension are to be tracked: e.g. <code>[1||2:4]</code> indicates that all cells in the second dimension will be tracked;</p>
</li>
<li>
<p>an empty index string <code>[]</code>, or no index string, means that the whole table (all cells) is to be tracked.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The descriptors may be elaborate <a href="#truethe-descriptor-tree">hierarchical data structure</a> which include a table at some level. For each table in this hierarchy, an index <code>String</code> as described above must be given in the index property, in a comma-separated list, e.g.: [0:2|0],[4,6] means that index [0:2|0] should be used for the top-level table of the descriptor, and index [4,6] for the bottom-level table.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>[TO DO: a few examples]</strong></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truethe-datadefinition-node"><a class="anchor" href="#truethe-datadefinition-node"></a>3.3.5. The <em>dataDefinition</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>dataDefinition</strong></code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree contains the detailed specifications of descriptors used in a model. This information is used by 3Worlds to generate java code for the data structures that will be used in simulations of this particular model. These data structures are then made available to descendants of 3Worlds  <a href="#truefunction">functions</a> that users will edit and modify to describe their particular model.</p>
</div>
<div class="sect4">
<h5 id="truethe-descriptor-tree"><a class="anchor" href="#truethe-descriptor-tree"></a>The descriptor tree</h5>
<div class="paragraph">
<p>Every <a href="#truethe-specification-of-ecological-entities-system-components"><em>system component</em></a> of 3Worlds potentially holds four kinds of  <a href="#truecategory"><em>descriptors</em></a>. Each of these (<em>drivers</em>, <em>decorators</em>, <em>constants</em> and <em>automatic variables</em>) is a <em>tree</em> of two kinds of data structures: <em>records</em> and <em>tables</em>. Records contain <em>fields</em>, i.e. atomic (i.e. not breakable into smaller parts) pieces of data of different types (numbers, character strings, logical values), each field having a name to access its value (i.e. field = (name,value) pair). Tables are multi-dimensional arrays of values of the same atomic type.</p>
</div>
<div class="paragraph">
<p>The data tree is constructed by allowing records to contain tables as fields (but not records), and by allowing tables to contain records all made of the same fields (but not tables) instead of atomic types. This gives end-user modellers great flexibility to organise their data into elaborate structures.</p>
</div>
<div class="sect5">
<h6 id="truerecord"><a class="anchor" href="#truerecord"></a>Record</h6>
<div class="paragraph">
<p><code>/3worlds/dataDefinition/<strong>record</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/table/<strong>record</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <em>record</em> is a data structure made of <em>fields</em> (=(name,value) pairs) or <em>tables</em> that represent the <em>descriptors</em> of a <em>category</em> of <em>components</em>. All descriptor trees must start with a record as their root. The record name will be turned into a java class name by the 3Worlds code generator for use in end-user code. A record may be nested in a <em>table</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A record cannot be empty, i.e. it <strong>must</strong> have at least one child node (field or table), see below.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truefield"><a class="anchor" href="#truefield"></a>Field</h5>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/record/<strong>field</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <em>field</em> is an atomic piece of data accessed by its name within a record.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>field</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>The data type of this field.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>Double</code>
</td>
<td class="hdlist2">
<p>a double precision floating point number (4.9406564584124654 10^-324 to 1.7976931348623157 10^308, symmetric for negative numbers) with 16 significant digits (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Integer</code>
</td>
<td class="hdlist2">
<p>an integer [-2147483648; 2147483647]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Long</code>
</td>
<td class="hdlist2">
<p>a long integer [-9223372036854775808; 9223372036854775807]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Float</code>
</td>
<td class="hdlist2">
<p>a single precision floating point number (1.40239846 10^-45 to 3.40282347 10^38, symmetric for negative numbers) with 8 significant digits</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Boolean</code>
</td>
<td class="hdlist2">
<p>a logical value {true, false}</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>String</code>
</td>
<td class="hdlist2">
<p>a text string</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Short</code>
</td>
<td class="hdlist2">
<p>a short integer [-32768; 32767]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Char</code>
</td>
<td class="hdlist2">
<p>a character value (16-bit Unicode = UTF16, i.e. 65535 different values)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Byte</code>
</td>
<td class="hdlist2">
<p>a very, very short integer [-128 ; 127]</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Object</code>
</td>
<td class="hdlist2">
<p>anything else <strong>TODO: should we keep this? it’s probably useless</strong></p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>description</code>
</td>
<td class="hdlist2">
<p>A long description of the field</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>units</code>
</td>
<td class="hdlist2">
<p>Measurement units of field values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>Precision used for display of field values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>interval</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this field (real number types)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>range</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this field (integer number types)</p>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="truedimensioner"><a class="anchor" href="#truedimensioner"></a>Dimensioner</h6>
<div class="paragraph">
<p><code>/3worlds/dataDefinition/<strong>dimensioner</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A <em>dimensioner</em> is used to define the number of entries in a table.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dimensioner</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>size</code>
</td>
<td class="hdlist2">
<p>The number of table cells in this dimension.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="truetable"><a class="anchor" href="#truetable"></a>Table</h6>
<div class="paragraph">
<p><code>/3worlds/&#8230;&#8203;/record/<strong>table</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>A table is a multi-dimensional data structure containing either atomic data types or <em>records</em>, all of the same type.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>table</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>dataElementType</code>
</td>
<td class="hdlist2">
<p>The data type of the elements of the table. cf property <code>field.type</code> for valid values.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>description</code>
</td>
<td class="hdlist2">
<p>A long description of the table</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>units</code>
</td>
<td class="hdlist2">
<p>Measurement units of table values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>Precision used for display of table values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>interval</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this table (real number types)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>range</code>
</td>
<td class="hdlist2">
<p>Range of possible values for this table (integer number types)</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
These properties are not needed when the table is a table of records (cf. above).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross links for</em> <code>table</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>sizedBy &#8594; dimensioner:&lt;<em>name</em>&gt;</code> {1..*}</dt>
<dd>
<p>This link sets one dimension of a table to be of the length found in the dimensioner <code>size</code> property. The required property <code>rank</code> in the <code>sizedBy</code> edge tells the rank of the dimension. All <code>sizedBy</code> links of a table should have a different rank, in increasing order starting from 0 to the number of dimensions -1.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truerandom-number-channels"><a class="anchor" href="#truerandom-number-channels"></a>Random number channels</h5>
<div class="paragraph">
<p><code>/3worlds/dataDefinition/<strong>rng</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Simulation models make extensive use of random numbers to make decisions on components (e.g. decision to delete a component or to create new ones). 3Worlds defines random number channels, that can be attached to specific <a href="#truefunction">functions</a>. These channels can be held constant by using the same seed in a series of simulations, thus enabling to conduct factorial experiments controlling for a source of random numbers or another.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>rng</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>algorithm</code>
</td>
<td class="hdlist2">
<p>Algorithm used to produce random numbers</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>PCG32</code>
</td>
<td class="hdlist2">
<p>Implementation of a permuted congruential generator with 32-bit output (<a href="https://en.wikipedia.org/wiki/Permuted_congruential_generator">PGC32</a>); fast (56% faster than <code>JAVA</code>) and good quality (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>JAVA</code>
</td>
<td class="hdlist2">
<p>The default Java random number generator of <code>java.util.Random</code>; medium speed, poor quality</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>XSRANDOM</code>
</td>
<td class="hdlist2">
<p>Implementation of a Xorshift random number generator as found <a href="http://demesos.blogspot.com/2011/09/replacing-java-random-generator.html">here</a>; very fast (76% faster than <code>JAVA</code>), medium quality</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>seedSource</code>
</td>
<td class="hdlist2">
<p>How to create the seed of the random number generator</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>PSEUDO</code>
</td>
<td class="hdlist2">
<p>The random number seed is produced from a call to a unique instance of <code>java.util.Random.Random()</code>. It uses time to the nanosecond to produce a ‘very likely to be distinct’ seed (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>NATURAL</code>
</td>
<td class="hdlist2">
<p>The random number seed is taken as an element in a table of 1000 natural random numbers that have been obtained from atmospheric noise. Use the property <code>tableIndex</code> to specify which item in this table should be taken for the seed</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>CONSTANT</code>
</td>
<td class="hdlist2">
<p>The random number seed is a constant (either 0 or 1, depending on the algorithm)</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>resetTime</code>
</td>
<td class="hdlist2">
<p>When to reset the random number channel seed</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>NEVER</code>
</td>
<td class="hdlist2">
<p>The random number seed is never reset after initialisation of the random number channel (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ONRUNSTART</code>
</td>
<td class="hdlist2">
<p>The random number seed is reset to its former value for every simulation run (producing the same series of random numbers for every simulation)</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>tableIndex</code>
</td>
<td class="hdlist2">
<p>Index into an <code>array[0..999]</code> of naturally generated random numbers to act as seeds for resetting</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no random number channel is specified, 3Worlds uses a single default channel with algorithm <code>XSRANDOM</code>, seedSource <code>PSEUDO</code> and resetTime <code>NEVER</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truethe-experiment-node"><a class="anchor" href="#truethe-experiment-node"></a>3.3.6. The <em>experiment</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>experiment</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree describe the experimental design to run using a given <em>model</em> and external data sets. Typically, il will tell <code>ModelRunner</code> how many simulations should be run, possibly varying some parameters of the model according to some plan, where data should be read and saved. The name is used to differentiate simulation experiments in a meaningful way.</p>
</div>
<div class="paragraph">
<p>The default, simplest, simulation experiment is just to run a single simulation of the <em>baseline</em> model.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>experiment</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>nReplicates</code>
</td>
<td class="hdlist2">
<p>The number of times all elementary treatments must be replicated. Use this only if there is an internal source of variation in simulations, like random numbers. Otherwise all simulations will be strictly identical.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>experiment</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>baseLine &#8594; system:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link points to a model setup (<a href="#truethe-system-node">Section 3.3.2</a>) that will be used as a <em>base line</em> simulation. A base line simulation is the equivalent of a control in a real experiment, i.e. a reference case that serves as a basis to which other treatments are compared. Often, the base line is the setup for which data is available to compare simulation outputs to.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="truesimulation-duration"><a class="anchor" href="#truesimulation-duration"></a>Simulation duration</h5>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>timePeriod</strong></code> {0..*}</p>
</div>
<div class="paragraph">
<p>The duration of a particular simulation is specified using a <code>timePeriod</code> node.</p>
</div>
<div class="paragraph">
<p><strong>[TO DO: sort out the conflict between this and the stopping conditions]</strong></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>timePeriod</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>start</code>
</td>
<td class="hdlist2">
<p>The starting time of a simulation in <code>timeLine</code> shortest time units.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>end</code>
</td>
<td class="hdlist2">
<p>The ending time of a simulation in <code>timeLine</code> shortest time units.</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both properties are optional. If none is set, the simulation will start at time 0 and run indefinitely.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>timePeriod</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>stopOn &#8594; stoppingCondition:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..1}</dt>
<dd>
<p>This link tells how to stop the simulation in case no <code>end</code> property is given.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The stopping condition has the priority over the <code>end</code> property.
<strong> TO DO: check this</strong>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="trueexperimental-design"><a class="anchor" href="#trueexperimental-design"></a>Experimental design</h5>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>design</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>An experimental design specifies the method used to perform the simulations, e.g. number of replicate simulations, treatments as changes in parameter values or initial states, etc. An experimental design can be specified by using standard designs, or by passing a design description file.</p>
</div>
<div class="paragraph">
<p>For more information on experimental designs for simulation experiments, we recommend reading the documentation of the R software <em>planor</em> and <em>mtk</em> packages (e.g. these packages could be used to generate design files for use in 3Worlds).</p>
</div>
<div class="paragraph">
<p><strong>[TO DO: OpenMole integration]</strong></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>design</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>This property specifies an experimental design for the simulation experiment. It only provides basic, standard experimental designs. For more elaborate or specialized designs, use an ad-hoc file description of the design (<code>file</code> property, <em>cf.</em> below)</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>singleRun</code>
</td>
<td class="hdlist2">
<p>an experiment consisting of a single simulation run (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>crossFactorial</code>
</td>
<td class="hdlist2">
<p>a cross-factorial experiment based on a limited set of parameter values (factors)</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>file</code>
</td>
<td class="hdlist2">
<p>This property gives the name of an experimental design file <strong>TODO : expand on this description</strong></p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="trueexperimental-treatments"><a class="anchor" href="#trueexperimental-treatments"></a>Experimental treatments</h5>
<div class="sect5">
<h6 id="truetreatments"><a class="anchor" href="#truetreatments"></a>Treatments</h6>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>treatment</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>An experimental treatment records a particular set of parameter values and initial state to run a simulation or a series of replicated simulations. It is the basic block of the experiment, just as in real-world experimentation.</p>
</div>
<div class="paragraph">
<p>Treatements may be specified</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in full detail: this is done by specifying more than one <code>system</code> nodes, each <code>system</code> being used for a different treatment;</p>
</li>
<li>
<p>as (minor) changes relative to the experiment <code>baseLine</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NB: not fully implemented yet</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="truetreatments-as-changes-relative-to-baseline"><a class="anchor" href="#truetreatments-as-changes-relative-to-baseline"></a>Treatments as changes relative to <em>baseLine</em></h6>
<div class="paragraph">
<p><code>/3worlds/experiment/treatment/<strong>modelChange</strong></code> {0..*}</p>
</div>
<div class="paragraph">
<p><strong>NB: not fully implemented yet</strong></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truemanaging-experiment-data"><a class="anchor" href="#truemanaging-experiment-data"></a>Managing experiment data</h5>
<div class="sect5">
<h6 id="trueinputs-datasource"><a class="anchor" href="#trueinputs-datasource"></a>Inputs: <em>dataSource</em></h6>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>dataSource</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node describes a source of data to use to instantiate a model: name of the data source, access method, etc.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dataSource</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>file</code>
</td>
<td class="hdlist2">
<p>A valid data file name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>A data format to use to read that file</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>CsvFileLoader</code>
</td>
<td class="hdlist2">
<p><a href="https://en.wikipedia.org/wiki/Comma-separated_values">comma separated value</a> <code>.csv</code> text file</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>OdfFileLoader</code>
</td>
<td class="hdlist2">
<p><a href="https://en.wikipedia.org/wiki/OpenDocument">OpenDocument</a> <code>.ods</code> spreadsheet</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>subclass = CsvFileLoader</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>separator</code>
</td>
<td class="hdlist2">
<p>the field separator used for this <code>.csv</code> file (default: tabulation <code>"\t"</code>)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>subclass = OdfFileLoader</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>sheet</code>
</td>
<td class="hdlist2">
<p>the name of the spreadsheet to load from this <code>.ods</code> file (different spreadsheets in the same <code>.ods</code> file must be specified as different <code>dataSource</code> nodes). If this property is absent or not set, the first spreadsheet will be loaded.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Additional properties when</em> <code>subclass = CsvFileLoader</code>, <code>OdfFileLoader</code></p>
</div>
<div class="paragraph">
<p><code>.csv</code> and <code>.ods</code> file formats both assume the data come in 2 dimensional tables with cross-references between the tables. Table columns must match parameter and driver field or table names. Table rows must match species, stage or system component instances.</p>
</div>
<div class="paragraph">
<p>The following rules must be respected when preparing the data files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data must not contain any missing value or structural empty cells.</p>
</li>
<li>
<p>Empty lines are permitted (they are skipped).</p>
</li>
<li>
<p>Text data must not be quoted.</p>
</li>
<li>
<p>The first data line of any file or spreadsheet must contain column headers. They must match field names as defined under the <code>dataDefinition</code> node (<a href="#truethe-datadefinition-node">Section 3.3.5</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>[TO DO how to handle data hierarchy - DataLabels. cf file configuration-dataIO.adoc for other properties as this is going to change in reimplementation]</strong></p>
</div>
<div class="paragraph">
<p><em>Additional sub-tree when</em> <code>class = CsvFileLoader</code>, <code>OdfFileLoader</code></p>
</div>
<div class="paragraph">
<p><code>/3worlds/dataIO/dataSource/<strong>read</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node specifies that a particular parameter/driver must be read from the file/spreadsheet. The <em>name</em> property of the <code>read</code> node must match the parameter/driver name to read. By default, when no <code>read</code> node is present, <em>all</em> parameters/drivers found in the file/spreadsheet will be read. Use <code>read</code> nodes to restrict the number of columns to read in a data source.</p>
</div>
<div class="paragraph">
<p><code>/3worlds/dataIO/dataSource/<strong>dim</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node is used when reading data into <a href="#truetable">tables</a>. The node name must be an integer matching the dimension declared in a table under the <code>dataDefinition</code> node. It must then have the following property:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>col</code>
</td>
<td class="hdlist2">
<p>header of the column containing the index values for this dimension.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>dim</code> nodes are present, the index values contained in the dimension columns specified in <code>col</code> are used to fill a table within the same 3Worlds data structure.</p>
</div>
</div>
<div class="sect5">
<h6 id="trueexample-of-a-datasource-specification"><a class="anchor" href="#trueexample-of-a-datasource-specification"></a>Example of a <em>dataSource</em> specification</h6>
<div class="paragraph">
<p><strong>[TO DO: refactor this example when data sources are reimplemented - this example no longer holds]</strong></p>
</div>
<div class="paragraph">
<p>This <code>.csv</code> file:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dim_1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fecundity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mortality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dispersal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">population</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">site</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>with the following specifications:</p>
</div>
<div id="fig-data-source-example" class="imageblock text-center">
<div class="content">
<img src="../source/configuration-experimentIMG/example-data-source.png" alt="example data source">
</div>
<div class="title">Figure 22. Example of a data source configuration.</div>
</div>
<div class="paragraph">
<p>will result in the instantiation of a single parameter set with species='site', stage='population', and data contained in an 10-cell array of records with 3 fields, fecundity, mortality and dispersal.</p>
</div>
<div class="paragraph">
<p>How?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>property <code>idSpecies</code> states that the column labelled 'site' is the species identifier (last column of the csv file).</p>
</li>
<li>
<p>property <code>idStage</code> states that the column labelled 'stage' is the stage identifier (first column of the csv file).</p>
</li>
<li>
<p>since there is no <code>idComponent</code> property, it means this file contains stage parameter data.</p>
</li>
<li>
<p>node <code>dim</code> with <code>name</code>=1 specifies that the data to be read go into a table</p>
</li>
<li>
<p>property <code>col</code> states that the column labelled <code>dim_1</code> contains the indices for dimension 1 of the table.</p>
</li>
<li>
<p>the <code>read</code> nodes specify that the columns labelled 'fecundity', 'dispersal' and 'mortality' are to be read. Notice that these nodes were not required, since the default behaviour would have caused all these columns to be read anyway.</p>
</li>
<li>
<p>finally, the 10 different lines with different table indices (CAUTION: the indices start at 0 for 3Worlds table data structures) will all go into the same parameter set since only one (species name, stage name) pair is given here. Hence only one stage parameter set is instantiated.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="trueoutputs-datasink"><a class="anchor" href="#trueoutputs-datasink"></a>Outputs: <em>dataSink</em></h6>
<div class="paragraph">
<p><code>/3worlds/experiment/<strong>dataSink</strong>:&lt;<span class="underline"><em>name</em></span>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>This node describes a 'sink' where data resulting from simulation output is to be stored for later processing by other software.</p>
</div>
<div class="paragraph">
<p><strong>[Not yet implemented]</strong></p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>dataSink</code></p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>file</code>
</td>
<td class="hdlist2">
<p>A valid data file name</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Cross-links for</em> <code>dataSink</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>source &#8594; dataTracker:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link the origin of the data to save into the sink. Usually, a  <a href="#truedata-tracking">data tracker</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truethe-userinterface-node"><a class="anchor" href="#truethe-userinterface-node"></a>3.3.7. The <em>userInterface</em> node</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>userInterface</strong>:&lt;<em>name</em>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This node and its sub-tree specifies the look of the <code>ModelRunner</code> user interface. <code>ModelRunner</code> is highly configurable and can show many graphs during a simulation run, as help when debugging a new model; or only show a progress bar to improve computing performance when running a big simulation experiment.</p>
</div>
<div id="fig-example-gui" class="imageblock text-center thumb">
<div class="content">
<img src="../source/configuration-guiIMG/example-gui.svg" alt="example gui" width="1000">
</div>
<div class="title">Figure 23. The ModelRunner graphical user interface.</div>
</div>
<div id="fig-example-gui-tree" class="imageblock right text-center thumb">
<div class="content">
<img src="../source/configuration-guiIMG/fig-gui-example-tree.png" alt="fig gui example tree" width="700">
</div>
<div class="title">Figure 24. The configuration sub-tree specifying the GUI of <a href="#fig-example-gui">Figure 23</a>.</div>
</div>
<div class="paragraph">
<p>3Worlds provides a series of <em>widgets</em>, i.e. classes that can manage output from the simulator and either show it graphically or perform some other non-graphic task (e.g. save data to disk). Examples of graphic widgets are: time series or scatter plots, simulation control buttons, progress bars, maps etc&#8230;&#8203; The basic <code>ModelRunner</code> GUI just provides places to place widgets: a <em>top</em>, a <em>bottom</em> and any number of <em>tabs</em>. Any number of widgets can be placed within these (<a href="#fig-example-gui">Figure 23</a>, <a href="#fig-example-gui-tree">Figure 24</a>).</p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
<div class="sect4">
<h5 id="truetop"><a class="anchor" href="#truetop"></a>Top</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>top</strong>:&lt;<em>name</em>&gt;</code> {1}</p>
</div>
<div class="paragraph">
<p>This is a tool bar located at the top just below the menu bar. Widgets placed here will appear beside each other in an order specified in <code>ModelMaker</code> properties (<em>Order</em>). The top is typically a place where small widgets are added that remain accessible no matter where other widgets are placed. Typically a controller or progress widgets are placed here. Checks are made by <code>ModelMaker</code> to ensure only small widgets can be placed here (<a href="#fig-example-gui">Figure 23</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="truebottom"><a class="anchor" href="#truebottom"></a>Bottom</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>bottom</strong>:&lt;<em>name</em>&gt;</code> {0..1}</p>
</div>
<div class="paragraph">
<p>The <em>bottom</em> is a status bar located at the bottom of the main window. It has the same constraints as the <em>top</em>. Widgets such as a progress bar can be placed here if desired (<a href="#fig-example-gui">Figure 23</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="truetabs-and-containers"><a class="anchor" href="#truetabs-and-containers"></a>Tabs and containers</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>tab</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/tab/<strong>container</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/&#8230;&#8203;/container/<strong>container</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>There can be any number of <em>Tabs</em> and each <em>Tab</em> can contain any number of widgets through the use of <em>containers</em>. <em>Tabs</em> are intended for large widgets such as charts and maps. Since only one tab is visible at a time when the model is run, large GUIs can be assembled without the limits imposed by window size (<a href="#fig-example-gui">Figure 23</a>).
<em>Tab</em> contents are structured as a binary tree made of a combination of widgets or containers of widgets. A <em>Tab</em> can have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or two widgets;</p>
</li>
<li>
<p>One widget and one container; or,</p>
</li>
<li>
<p>Two containers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Containers have the same constraints as tabs - i.e. each container can have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or two widgets;</p>
</li>
<li>
<p>One widget and one container; or,</p>
</li>
<li>
<p>Two containers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only widgets can be leaf nodes in this binary tree i.e you can&#8217;t have a container or tab that contains nothing.</p>
</div>
<div class="paragraph">
<p>The widget/container pairs in this binary tree can be arranged vertically or horizontally. This allows all possible arrangements of widgets in the GUI.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>tab</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>orientation</code>
</td>
<td class="hdlist2">
<p>This property specifies the way widgets and containers are placed: side by side or on top of each other</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>horizontal</code>
</td>
<td class="hdlist2">
<p>Display panel is split by a vertical spliter into two panels, first on left and second on right (default value)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>vertical</code>
</td>
<td class="hdlist2">
<p>Display panel is split by a horizontal spliter into two panels, first above second</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>container</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>orientation</code>
</td>
<td class="hdlist2">
<p>This property specifies the way widgets and containers are placed: side by side or on top of each other</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>order</code>
</td>
<td class="hdlist2">
<p>Rank of placement in its container (smaller value: to the left/top; larger: to the right/bottom)</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="trueheadless-ui"><a class="anchor" href="#trueheadless-ui"></a>Headless UI</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/<strong>headless</strong></code> {0..*}</p>
</div>
<div class="paragraph">
<p>If you want to run a simulation unattended, you may not need a GUI at all. Instead, you may want the simulation to begin immediately and use widgets to write data to disk. Such widgets are call <code>headless</code>. All headless widgets are children of the <code>gui:headless:</code> node.</p>
</div>
</div>
<div class="sect4">
<h5 id="truewidgets"><a class="anchor" href="#truewidgets"></a>Widgets</h5>
<div class="paragraph">
<p><code>/3worlds/userInterface/top/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/bottom/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/tab/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/&#8230;&#8203;/container/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p><code>/3worlds/userInterface/headless/<strong>widget</strong>:&lt;<em>name</em>&gt;</code> {0..*}</p>
</div>
<div class="paragraph">
<p>Widgets are the interesting part of the GUI configuration as they provide feedback and control of a simulation. A widget may be added as a child of <code>top</code>, <code>bottom</code>, <code>tab</code>, <code>container</code>  or <code>headless</code>  nodes.</p>
</div>
<div class="paragraph">
<p><em>Properties for</em> <code>widget</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>order</code>
</td>
<td class="hdlist2">
<p>Rank of placement in its container (smaller value: to the left/top; larger: to the right/bottom)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>subclass</code>
</td>
<td class="hdlist2">
<p>A widget class;</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>possible values</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>ControlWidget1</code>
</td>
<td class="hdlist2">
<p>A simple simulator controller with run/pause, step and reset buttons. Add this as a child of a <code>top</code> or <code>bottom</code> node. A GUI definition can only have one controller.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ControlWidget2</code>
</td>
<td class="hdlist2">
<p>As for <code>ControlWidget1</code>, but also displays the time taken to complete each simulation step and the total simulation time. These timings are only accurate when deploying a single simulation. They are not accurate when deploying multiple simulations. Therefore, this widget is best used when developing a model to check its performance. Use <code>ControlWidget1</code> otherwise.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ControlWidget3</code>
</td>
<td class="hdlist2">
<p>As for <code>ControlWidget2</code>, but displays a time series plot of simulation execution time. Add this widget as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ProgressWidget1</code>
</td>
<td class="hdlist2">
<p>A simple display of simulation time (average time if deploying multiple simulations) and stopping condition. Add this widget as a child of a <code>top</code> or <code>bottom</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ProgressWidget2</code>
</td>
<td class="hdlist2">
<p>A bar graph of simulation progress intended for use only when deploying multiple simulations. Add this widget as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ProgressWidget3</code>
</td>
<td class="hdlist2">
<p>As for <code>ProgressWidget2</code> but using a time series chart instead of a bar chart.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>TimeseriesWidget1</code>
</td>
<td class="hdlist2">
<p>A graph of <em>x<sub>i</sub></em> = <em>f</em>(<em>t</em>), where <em>x<sub>i</sub></em> are component descriptors and <em>t</em> is time.  Add as a child of a <code>tab</code> or <code>container</code> node. This widget uses the fast charting library from <a href="https://github.com/GSI-CS-CO/chart-fx">Chartfx</a>. The widget has a number of additional facilites accessed by moving the mouse to the top of the chart display. Here, data can be viewed as a table and exported to file. At the time of writing we have not found this feature very reliable (chartfx version 11.2.6). A better option to save time series data, is to use <code>HLExperimentWidget</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ScatterplotWidget1</code>
</td>
<td class="hdlist2">
<p>A graph of <em>y</em> = <em>f</em>(<em>x</em>) where <em>x</em> and <em>y</em> are two descriptors of a component.  Add as a child of a <code>tab</code> or <code>container</code> node. This widget also uses the fast charting library from <a href="https://github.com/GSI-CS-CO/chart-fx">Chartfx</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SpaceWidget1</code>
</td>
<td class="hdlist2">
<p>A map of a  <a href="#truethe-representation-of-space">space</a>.  Add as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>TableWidget1</code>
</td>
<td class="hdlist2">
<p>A table of number values <em>x<sub>i</sub></em>(<em>t</em>).  Add as a child of a <code>tab</code> or <code>container</code> node. Add as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>MatrixWidget1</code>
</td>
<td class="hdlist2">
<p>A colour display of a 2-dimensional table. Add as a child of a <code>tab</code> or <code>container</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>GraphWidget1</code>
</td>
<td class="hdlist2">
<p>A display of the system graph. Add as a child of a <code>tab</code> or <code>container</code> node.  <strong>not yet implemented</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HLExperimentWidget1</code>
</td>
<td class="hdlist2">
<p>Saves data to file. Add as a child of a <code>headless</code> node. The data written depends on the experiment design. A <code>SingleRun</code> produces a time series of each simulator and an average of replicates. <code>CrossFactorial</code> experiments produce the results of an ANOVA and svg (<strong>TODO</strong>) files of each factor&#8217;s sensitivity. All statistical analysis uses <strong>R</strong>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HLSimpleControlWidget</code>
</td>
<td class="hdlist2">
<p>As <code>ControlWidget1</code>, but for unattended simulations. Add as a child of a <code>headless</code> node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>HLProgressWidget1</code>
</td>
<td class="hdlist2">
<p>Writes simulator progress to the console.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Many widgets have settings which can be adjusted from the <em>Widget</em> menu of <em>ModelRunner</em>. These settings are automatically saved to a preferences file when <em>ModelRunner</em> is closed thus preserving the look and feel of the interface between uses.</p>
</div>
<div class="sect5">
<h6 id="trueadditional-properties-for-widget-sub-classes"><a class="anchor" href="#trueadditional-properties-for-widget-sub-classes"></a>Additional properties for widget sub-classes</h6>
<div class="paragraph">
<p><em>for</em> <code>ProgressWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>refreshRate</code>
</td>
<td class="hdlist2">
<p>(optional) The rate at which this widget updates its display (ms) (<em>default</em> 250 ms). This property is for the purpose of efficiency. Because this widget can display the average progress of a very large number of simulations (e.g 1 million parallel simulations), it would be very inefficient, not to mention uninformative, if the display was updated every time any one of the simulators sent a message.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>for</em> <code>TimeSeriesWidget1</code> <em>and</em> <code>TableWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>nSenders</code>
</td>
<td class="hdlist2">
<p>(optional) The number of parallel simulators to display (<em>default</em> 1). As noted, there can be far too many simulators to reasonably display their output. In such cases, this property limits that number to whatever you think you can handle.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>firstSender</code>
</td>
<td class="hdlist2">
<p>(optional) The lowest sender (simulator id) to display (<em>default</em> 0). Output from simulators is shown for contiguously numbered simulators. This property sets the lowest number from which to display <em>n</em> simulator outputs.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>for</em> <code>TimeSeriesWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>maxAxes</code>
</td>
<td class="hdlist2">
<p>Sets the maximum number of <em>y</em> axes to display on the chart. As this widget can show time series for any number of variables, it is important to assign them to their own axis. However, if you have so too many outputs the chart will be all axes and no data. There, the number of axes can be constrained with this property.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bufferSize</code>
</td>
<td class="hdlist2">
<p>Number of time intervals to plot on the time axis, e.g. a value of 100 will display times 900-1000 when reaching time 1000. That is, what you see is a rolling buffer of data.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>for</em> <code>SpaceWidget1</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>nViews</code>
</td>
<td class="hdlist2">
<p>This widget records data produced from any number of simulators. However, its often unreasonable to view every one of what may be a very large number. However, being able to visually compare independent parallel simulations is useful. This setting allows more than one (at the moment this is unlimited) view. A drop-down list for each view allows you to select which data set to display.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="trueadditional-cross-links-for-widget-sub-classes"><a class="anchor" href="#trueadditional-cross-links-for-widget-sub-classes"></a>Additional cross-links for widget sub-classes</h6>
<div class="paragraph">
<p><em>for</em> <code>ControlWidget2</code>, <code>ControlWidget3</code>, <code>ProgressWidget1</code>  <em>and</em> <code>ProgressWidget2</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackTime &#8594; dynamics:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <em>dynamics</em> system the widget is listening to.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>for</em> <code>TimeSeriesWidget1</code>, <code>TableWidget1</code> <em>and</em>  <code>HLSimpleTimeSeriesWidget</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackSeries &#8594; dataTracker:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <code>dataTracker</code> the widget is listening to.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>for</em> <code>SpaceWidget1</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackSpace &#8594; space:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <code>space</code> the widget is listening to.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>for</em> <code>GraphWidget1</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>trackSystem &#8594; system:&lt;<span class="underline"><em>name</em></span>&gt;</code> {1}</dt>
<dd>
<p>This link identifies the <code>system</code> the widget is listening to</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truethe-predefined-sub-tree"><a class="anchor" href="#truethe-predefined-sub-tree"></a>3.3.8. The <em>predefined</em> sub-tree</h4>
<div class="paragraph">
<p><code>/3worlds/<strong>predefined:*categories</strong>*</code> {1}</p>
</div>
<div class="paragraph">
<p>This sub-tree is not editable. It specifies predefined categories, relation types and automatic variables that are used in any 3Worlds model in assocation with particular objects in the simulator. During the setup of a configuration, ModelMaker will sometimes request you to link some of your nodes to items found in this hierarchy.</p>
</div>
<div class="paragraph">
<p>Predefined categories are grouped in 3 <code>categorySet</code>s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>*systemElements*</code> represent hierarchical levels in the system:</p>
<div class="ulist">
<ul>
<li>
<p><code>*arena*</code> is a category attached to the whole system</p>
</li>
<li>
<p><code>*component*</code> is a category attached to any system component</p>
</li>
<li>
<p><code>*group*</code> is a category attached to any group of system components</p>
</li>
<li>
<p><code>*life cycle*</code> is a category attached to any life cycle</p>
</li>
<li>
<p><code>*relation*</code> is currently not in use</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>*organisation*</code> represent levels of organisation in the system:</p>
<div class="ulist">
<ul>
<li>
<p><code>*atomic*</code>, is a category attached to single, individable (hence <em>atomic</em>), components</p>
</li>
<li>
<p><code>*assemblage*</code> is a category attached to populations of components. Members of this category have the following automatic variables:</p>
<div class="ulist">
<ul>
<li>
<p><code>count</code>, the population size</p>
</li>
<li>
<p><code>nAdded</code>, the number of components added to the population during the last simulation step</p>
</li>
<li>
<p><code>nRemoved</code>, the number of components removed from the population during the last simulation step</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>*atomic*</code> is a category attached to elementary (atomic) components that cannot be further divided</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>*lifespan*</code> represent the lifespan of a component in the system:</p>
<div class="ulist">
<ul>
<li>
<p><code>*permanent*</code>, is a category for components that stay forever</p>
</li>
<li>
<p><code>*ephemeral*</code>, is a category for components that can be created or deleted during a simulation.Members of this category have the following automatic variables:</p>
<div class="ulist">
<ul>
<li>
<p><code>age</code>, the age of the component</p>
</li>
<li>
<p><code>birthDate</code>, the simulation time when this component was created.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two predefined relation types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>*parentTo*: *component* &#8594; *component*</code> may be used to relate a component to its offspring, i.e. it enables to track genealogic links between components (see the <code>CreateOtherDecision</code> <a href="#truefunction">function</a>).</p>
</li>
<li>
<p><code>*returnsTo*: *component* &#8594; *component*</code> is not yet in use.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="truedeveloping-and-testing-model-code"><a class="anchor" href="#truedeveloping-and-testing-model-code"></a>3.4. Developing and testing model code</h3>
<div class="paragraph">
<p>A model of an ecological system in 3Worlds consists in a <em>configuration file</em> constructed with the <code>ModelMaker</code> application (<a href="#trueconfiguration-reference-creating-and-editing-a-model-with-modelmaker">Section 3</a>) and <em>java code files</em> that must be edited by the end-user, here a modeller. Some basic knowledge of <a href="https://en.wikiversity.org/wiki/Java_Programming/Introduction">java</a> is required before going on here.</p>
</div>
<div class="sect3">
<h4 id="truegenerated-code-the-model-main-class"><a class="anchor" href="#truegenerated-code-the-model-main-class"></a>3.4.1. Generated code: the <em>model main class</em></h4>
<div class="paragraph">
<p>During the specification of a model, ModelMaker generates java classes meant to be further edited in order to implement the specific behaviours imagined by the modeller. Among these classes, one is meant to be edited; the others are interface code, that you can see as 'glueing' code between the 3Worlds main code and the user-defined one. The file to be edited is named after the 3Worlds root node of the specification file (<a href="#truethe-3worlds-node">Section 3.3.1</a>): e.g., if your 3Worlds node has the name <code>myModel</code>, the java file to edit will be called <code>MyModel.java</code>. In what follows, we call it the <em>model main class</em>.</p>
</div>
<div id="fig-idhClock-functions" class="imageblock left text- thumb">
<div class="content">
<img src="../source/user-coding-referenceIMG/fig-functions-IDH.png" alt="fig functions IDH" width="700">
</div>
<div class="title">Figure 25. The functions defined in the model of the IDHClock tutorial.</div>
</div>
<div class="paragraph">
<p>This section gives general rules to follow to successfully edit the generated <em>model main class</em> in order for your model to behave as you wish. <a href="#truesetting-up-a-java-development-environment-for-the-user-code">Section 2.4</a> describes how to link your <code>ModelMaker</code> session with an eclipse development environment where you can edit the generated <em>model main class</em>. It is important to read about  <a href="#truefunction">functions</a> before starting writing your code, in order to master all the options you can setup in <code>ModelMaker</code> to specify your function.</p>
</div>
<div class="paragraph">
<p>For each <code>function</code> node of the specification, you will find one static method with the same name in the <em>model main class</em>. For example, the <strong>IDHClock</strong> tutorial (<a href="#truetutorial-4-elaborating-the-model-structure-testing-the-intermediate-disturbance-hypothesis">Section 5.4</a>) specifies 3 functions, 2 initFunctions and 2 data trackers (<a href="#fig-idhClock-functions">Figure 25</a>).</p>
</div>
<div class="paragraph">
<p>This generates a <em>model main class</em> with corresponding methods (code stripped of its javadoc comments):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">package code.sys1;

import static java.lang.Math.*;
import au.edu.anu.rscs.aot.collections.tables.DoubleTable;
import au.edu.anu.twcore.ecosystem.runtime.biology.DecisionFunction;
import java.util.Random;
import code.sys1.generated.*;
// Hey, model developer! You may add your own imports here as needed

public interface IdhClock1 {

	public static void distEffectsComm(
		double t,                             // current time
		double dt,                            // current time step
		int count,                            // whole system autoVar count (#) ϵ[0..*]
		int nAdded,                           // whole system autoVar nAdded (#) ϵ[0..*]
		int nRemoved,                         // whole system autoVar nRemoved (#) ϵ[0..*]
		double freq,                          // focal component constants  ± 0.0 ϵ]-∞,+∞[
		double inten,                         // focal component constants  ± 0.0 ϵ]-∞,+∞[
		DoubleTable other_x,                  // other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[
		DistEffectsComm.OtherDrv otherDrv,    // next drivers for other component
		double other_div,                     // other component decorators  ± 0.0 ϵ]-∞,+∞[
		DistEffectsComm.OtherDec otherDec,    // new decorators for other component
		DoubleTable other_K,                  // other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable other_alpha,              // other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable other_r,                  // other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[
		Random random) {                      // random number generator
	// distEffectsComm ---- Code insert Begin--&gt;
	// distEffectsComm ---- Code insert End----&lt;
	}

	public static boolean distOccurrence(
		double t,                             // current time
		double dt,                            // current time step
		int count,                            // whole system autoVar count (#) ϵ[0..*]
		int nAdded,                           // whole system autoVar nAdded (#) ϵ[0..*]
		int nRemoved,                         // whole system autoVar nRemoved (#) ϵ[0..*]
		double freq,                          // focal component constants  ± 0.0 ϵ]-∞,+∞[
		double inten,                         // focal component constants  ± 0.0 ϵ]-∞,+∞[
		DoubleTable other_x,                  // other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[
		double other_div,                     // other component decorators  ± 0.0 ϵ]-∞,+∞[
		DoubleTable other_K,                  // other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable other_alpha,              // other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable other_r,                  // other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[
		Random random,                        // random number generator
		DecisionFunction decider) {           // decision function
	// distOccurrence ---- Code insert Begin--&gt;
	// distOccurrence ---- Code insert End----&lt;
	}

	public static void initDist(
		double freq,                          // focal component constants  ± 0.0 ϵ]-∞,+∞[
		double inten,                         // focal component constants  ± 0.0 ϵ]-∞,+∞[
		InitDist.FocalCnt focalCnt,           // new constants for focal component
		Random random) {                      // random number generator
	// initDist ---- Code insert Begin--&gt;
	// initDist ---- Code insert End----&lt;
	}

	public static void commGrowth(
		double t,                             // current time
		double dt,                            // current time step
		int count,                            // whole system autoVar count (#) ϵ[0..*]
		int nAdded,                           // whole system autoVar nAdded (#) ϵ[0..*]
		int nRemoved,                         // whole system autoVar nRemoved (#) ϵ[0..*]
		DoubleTable x,                        // focal component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[
		CommGrowth.FocalDrv focalDrv,         // next drivers for focal component
		double div,                           // focal component decorators  ± 0.0 ϵ]-∞,+∞[
		CommGrowth.FocalDec focalDec,         // new decorators for focal component
		DoubleTable K,                        // focal component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable alpha,                    // focal component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable r,                        // focal component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[
		Random random) {                      // random number generator
	// commGrowth ---- Code insert Begin--&gt;
	// commGrowth ---- Code insert End----&lt;
	}

	public static void initComm(
		DoubleTable x,                        // focal component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[
		InitComm.FocalDrv focalDrv,           // next drivers for focal component
		double div,                           // focal component decorators  ± 0.0 ϵ]-∞,+∞[
		DoubleTable K,                        // focal component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable alpha,                    // focal component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[
		DoubleTable r,                        // focal component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[
		InitComm.FocalCnt focalCnt,           // new constants for focal component
		Random random) {                      // random number generator
	// initComm ---- Code insert Begin--&gt;
	// initComm ---- Code insert End----&lt;
	}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, you can see that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the package name <code>code.sys1</code> is constructed from the name of the <code>system</code> node (<a href="#fig-idhClock-functions">Figure 25</a>);</p>
</li>
<li>
<p>the interface name <code>IdhClock1</code> is constructed from the name of the <code>3Worlds</code> node (<a href="#fig-idhClock-functions">Figure 25</a>);</p>
</li>
<li>
<p>each method name is constructed from a matching <code>function</code> or <code>initFunction</code> node (<a href="#fig-idhClock-functions">Figure 25</a>).</p>
</li>
<li>
<p>the argument lists are partly constructed from the <code>categories</code> the <code>process</code> declaring the <code>function</code> applies to;</p>
</li>
<li>
<p>the comments documenting the method arguments are constructed from the <code>field</code> or <code>table</code> node properties (<code>description</code>, <code>precision</code>, <code>interval</code>, <code>units</code>, etc.).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not neglect these metadata: coding errors due to discrepancies in measurement units between equations are frequent and yield wrong computation results that are difficult to trace. Most publicly available model code does not document the units, and hence is not easily re-usable.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When ModelRunner is launched on the IDHClock tutorial model, it will include the generated <code>IdhClock1</code> class and call each of its methods for all system components they are dealing with as specified in the model configuration file.</p>
</div>
<div class="paragraph">
<p>As you can see in this example, the body of each method is empty, only containing two comments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">	// initComm ---- Code insert Begin--&gt;
	// initComm ---- Code insert End----&lt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the <em>code insertion markers</em>. The user-defined code must be inserted between these two lines.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Never remove the <em>code insertion markers</em> as they are used by 3Worlds when using code <a href="#truefunction">snippets</a> (as in all tutorial and test models).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As <em>model main class</em> is a java <em><strong>interface</strong></em>, all data is passed as arguments to its static methods. As you can see in the example above, there may be many arguments. If you look closely, you will see that these arguments match the <em>descriptors</em> that were attached to the <em>categories</em> to which the <em>processes</em> apply. All this information is provided in the <em>model main class</em> as javadoc comments. For example, the javadoc comment of the <code>commGrowth</code> method above produces this output:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../source/user-coding-referenceIMG/fig-javadoc-idhclock.png" alt="fig javadoc idhclock">
</div>
</div>
<div class="paragraph">
<p>This comment recalls the categories to which the <code>commGrowth</code> method applies, which timer it follows and which time units it uses, and any other useful information like precedence between methods as specified by <code>dependsOn</code> cross-links between processes.</p>
</div>
<div class="paragraph">
<p>Finally, the <em>model main class</em> itself has a general javadoc description that gives some information about how to insert useful code into its methods:</p>
</div>
<div class="imageblock text-center thumb">
<div class="content">
<img src="../source/user-coding-referenceIMG/fig-javadoc-idhclock2.png" alt="fig javadoc idhclock2">
</div>
</div>
</div>
<div class="sect3">
<h4 id="truemodel-main-class-method-arguments"><a class="anchor" href="#truemodel-main-class-method-arguments"></a>3.4.2. <em>Model main class</em> method arguments</h4>
<div class="paragraph">
<p>The list of arguments of each method is defined by its <a href="#truefunction">function type</a>, the organisation level to which it applies (system, life cycle, group or component), the categories or relation types it applies to, and the user-defined data structures attached to these. Some arguments are read-only, others are writeable so that computation output can be passed back to the 3Worlds main code.</p>
</div>
<div class="sect4">
<h5 id="trueread-only-arguments"><a class="anchor" href="#trueread-only-arguments"></a>Read-only arguments</h5>
<div class="sect5">
<h6 id="truearguments-present-for-all-functions-and-initfunctions"><a class="anchor" href="#truearguments-present-for-all-functions-and-initfunctions"></a>Arguments present for all <em>functions</em> and <em>initFunctions</em></h6>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>random</code>
</td>
<td class="hdlist2">
<p>The <a href="#truerandom-number-channels">random number generator channel</a> associated to this function. For details of how to use an instance of class <code>java.util.Random</code>, see the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Random.html">javadoc</a> for this class. Most of the time, you will be calling <code>random.nextDouble()</code> which returns a random double value between 0.0 and 1.0.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="truearguments-present-for-all-functions-but-not-for-initfunctions"><a class="anchor" href="#truearguments-present-for-all-functions-but-not-for-initfunctions"></a>Arguments present for all <em>functions</em> but not for <em>initFunctions</em></h6>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>t</code>
</td>
<td class="hdlist2">
<p>the <em>current time</em> passed by the simulator as a double value in units of the <code>timer</code> of the parent <code>process</code> of the <code>function</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dt</code>
</td>
<td class="hdlist2">
<p>the <em>current time step</em>, passed by the simulator as a double value in units of the <code>timer</code> of the parent <code>process</code> of the <code>function</code>.</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
In the case of multiple timers, for <code>ClockTimers</code>, the current time step may be different from the timer&#8217;s <code>dt</code> property because it is the time since last simulator iteration, which may have been triggered by a different timer.
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="truearguments-present-for-all-decision-functions"><a class="anchor" href="#truearguments-present-for-all-decision-functions"></a>Arguments present for all <em>'decision' functions</em></h6>
<div class="paragraph">
<p>'Decision' functions are: <code>ChangeCategoryDecision</code>, <code>DeleteDecision</code>, <code>CreateOtherDecision</code>, <code>RelateToDecision</code> and <code>MaintainRelationDecision</code>. They all return a result that is a decision: a number of components to create (<code>CreateOtherDecision</code>), the name of a category (<code>ChangeCategoryDecision</code>), or a boolean (all others).</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>decider</code>
</td>
<td class="hdlist2">
<p>This argument of class <code>DecisionFunction</code> <strong>[TODO: ref to javadoc]</strong> is provided as a helper for transforming probabilities into decisions. This class comprises only one method <code>decide(&#8230;&#8203;)</code> which given a probability, returns a <code>boolean</code>. More precisely: it returns <code>true</code> with the probability passed as argument, ie <code>decider.decide(0.7)</code> will return <code>true</code> in 7 calls out of 10. It uses the function random number generator (the <code>random</code> argument) to make the decision. Technically, this is the realisation of a <a href="https://en.wikipedia.org/wiki/Bernoulli_distribution">Bernouilli distribution</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>selector</code>
</td>
<td class="hdlist2">
<p>This argument is only present for the <code>ChangeCategoryDecision</code> function type. The <code>SelectionFunction</code> class <strong>[TODO: ref to javadoc]</strong>, of which it is an instance, only has one method <code>select(&#8230;&#8203;)</code> which, given a list of weights <em>w</em>, returns an integer <em>i</em> with probability <em>w</em>[<em>i</em>]/Σ<em><sub>i</sub></em><em>w</em>[<em>j</em>], i.e. a realisation of a single trial of a <a href="https://en.wikipedia.org/wiki/Multinomial_distribution">multinomial distribution</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>recruit</code>
</td>
<td class="hdlist2">
<p>This argument is only present for the <code>ChangeCategoryDecision</code> function type. The <code>RecruitFunction</code> class <strong>[TODO: ref to javadoc]</strong>, of which it is an instance, has one method <code>transition(&#8230;&#8203;)</code> which returns a category name (<code>String</code>), or <code>null</code> if the component does not change category. It&#8217;s argument is either a <code>boolean</code> or an <code>int</code>, typically the result of a call to <code>selector.select(&#8230;&#8203;)</code> or <code>decider.decide(&#8230;&#8203;)</code>. Example of use:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">public static String recruitSeedling(
    double group_recruitRate,
    ...
    Random random,                        // random number generator
    DecisionFunction decider,             // decision function
    SelectionFunction selector,           // selection function
    RecruitFunction recruit) {            // recruitment function

    return recruit.transition(decider.decide(group_recruitRate));
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="truearguments-that-represent-a-component-in-function-types-which-process-applies-to-categories"><a class="anchor" href="#truearguments-that-represent-a-component-in-function-types-which-process-applies-to-categories"></a>Arguments that represent a component in function types which process applies to categories</h6>
<div class="paragraph">
<p>These function types are <code>ChangeCategoryDecision</code>, <code>ChangeState</code>, <code>DeleteDecision</code>, <code>CreateOtherDecision</code>, and <code>SetInitialState</code>.</p>
</div>
<div class="paragraph">
<p>Internally, the system component which is the target of such functions is called <em>focal</em>.</p>
</div>
<div class="paragraph">
<p>The argument list will contain all the fields and tables declared in the root record of the descriptors (drivers, automatic variables, constants and decorators) of the <em>focal</em> component. The argument comments will indicate that these arguments are descriptors of the <em>focal</em> component, as in this example from the <strong>IDHClock</strong> tutorial for a function of type <code>SetInitialState</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">public static void initComm(
    DoubleTable x,                        // focal component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[
    double div,                           // focal component decorators  ± 0.0 ϵ]-∞,+∞[
    DoubleTable K,                        // focal component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[
    DoubleTable alpha,                    // focal component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[
    DoubleTable r,                        // focal component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[
    Random random) {                      // random number generator
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="truearguments-that-represent-the-two-components-of-a-relation-in-function-types-which-process-applies-to-relation-types"><a class="anchor" href="#truearguments-that-represent-the-two-components-of-a-relation-in-function-types-which-process-applies-to-relation-types"></a>Arguments that represent the two components of a relation in function types which process applies to relation types</h6>
<div class="paragraph">
<p>These function types are <code>ChangeOtherState</code>, <code>ChangeRelationState</code>, <code>MaintainRelationDecision</code>, <code>RelateToDecision</code>, and <code>SetOtherInitialState</code>.</p>
</div>
<div class="paragraph">
<p>These functions apply to a pair of components linked by a relation. The first of these components (the one at the 'from' end of the relation) is called <em>focal</em>, as before. The second one (the one at the 'to' end of the relation) is called <em>other</em>.</p>
</div>
<div class="paragraph">
<p>To distinguish the descriptors of <em>other</em> from those of <em>focal</em> (since these might belong to the same categories and hence have the same descriptors), all the descriptors of <em>other</em> are prefixed with 'other_', as in this example from the <strong>IDHClock</strong> tutorial for a function of <code>ChangeOtherState</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">public static void distEffectsComm(
    double t,                             // current time
    double dt,                            // current time step
    double freq,                          // focal component constants  ± 0.0 ϵ]-∞,+∞[
    double inten,                         // focal component constants  ± 0.0 ϵ]-∞,+∞[
    DoubleTable other_x,                  // other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[
    double other_div,                     // other component decorators  ± 0.0 ϵ]-∞,+∞[
    DoubleTable other_K,                  // other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[
    DoubleTable other_alpha,              // other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[
    DoubleTable other_r,                  // other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[
    Random random) {                      // random number generator    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="truearguments-that-represent-the-local-context-of-a-component"><a class="anchor" href="#truearguments-that-represent-the-local-context-of-a-component"></a>Arguments that represent the local context of a component</h6>
<div class="paragraph">
<p>The local context of a component is the part of the system it always sees. The dynamic graph of a simulated system in 3Worlds <strong>always</strong> has:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an object representing the whole system,  called the <em>arena</em> ('the place where things happen': <a href="https://doi.org/10.1007%2Fs10021-011-9466-2">Gignoux et al. 2011</a>). As 3Worlds uses a dynamic graph to represent the whole system (<a href="#truethe-complex-system-as-a-dynamic-graph">Section 1.2.2</a>), this object actually represents the whole graph. It matches the <a href="#truethe-system-node"><em>system</em></a> node in the configuration graph of the <code>.ugt</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And it <strong>may</strong> (0..* multiplicity) have the following other kinds of nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>objects representing the individual entities of the system, which are nodes in the dynamic graph and are just called <a href="#truesystem-components"><em>components</em></a>.</p>
</li>
<li>
<p>objects that represent the common properties of a group of components, which are called <a href="#truecomponent-groups"><em>groups</em></a>.</p>
</li>
<li>
<p>objects that represent the transitions that can occur during the life of a component, and are therefore called <a href="#true-life-cycle"><em>life cycles</em></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These four types of objects may belong to <em>categories</em> and have <em>descriptors</em>, and as a consequence can be passed to <em>functions</em> of a <em>process</em> referencing their categories.</p>
</div>
<div class="paragraph">
<p>With regard to processes and functions, these objects are treated like components, except they cannot establish <em>relations</em>; only true components can. This limits the set of functions compatible with them: groups, life cycles and the arena can only be affected by <code>ChangeState</code>,
<code>SetInitialState</code> and <code>CreateOtherDecision</code> (not life cycles) function types. When these functions apply to the categories of a <code>group</code>, <code>lifeCycle</code> or <code>Arena</code> object, they are treated as components above, i.e. they become the <em>focal</em> 'component' of the user-defined methods.</p>
</div>
<div class="paragraph">
<p>The arena, groups and life cycles play a particular role in the dynamic graph, as indicated by their names. They also have implicit, 'ontological' relations with system components: a component always knows about its group, life cycle, and arena because they describe part of its own behaviour. As such, they are always accessible as arguments in the function calls of any component.</p>
</div>
<div class="paragraph">
<p>Just as for the <em>other</em> component above, the descriptors of arena, life cycles and groups are prefixed when they appear in a method argument list, with a comment giving more information on the argument, as in this example from the <strong>Palms</strong> show-case model for a function of <code>CreateOtherDecision</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">public static double reproduction(
    double t,                             // current time
    double dt,                            // current time step
    int count,                            // whole system autoVar count (#) ϵ[0..*]
    int nAdded,                           // whole system autoVar nAdded (#) ϵ[0..*]
    int nRemoved,                         // whole system autoVar nRemoved (#) ϵ[0..*]
    int lifeCycle_count,                  // focal life cycle autoVar count (#) ϵ[0..*]
    int lifeCycle_nAdded,                 // focal life cycle autoVar nAdded (#) ϵ[0..*]
    int lifeCycle_nRemoved,               // focal life cycle autoVar nRemoved (#) ϵ[0..*]
    int group_count,                      // focal group autoVar count (#) ϵ[0..*]
    int group_nAdded,                     // focal group autoVar nAdded (#) ϵ[0..*]
    int group_nRemoved,                   // focal group autoVar nRemoved (#) ϵ[0..*]
    double group_aGinc,                   // focal group constants adult BudHeight growth coefficient (m yr-1) ± 0.01 ϵ[0.0,+∞[
    double group_aPdead,                  // focal group constants Mortality : int ± 0.01 ϵ[0.0,1.0]
    double group_deadNbLeaves,            // focal group constants Mortality : nbf slope ± 0.01 ϵ[0.0,1.0]
    double group_decay,                   // focal group constants decay ± 0.0 ϵ]-∞,+∞[
    double group_dis,                     // focal group constants dispersal parameter ± 0.001 ϵ[0.0,1.0]
    double group_fec,                     // focal group constants fecundity * # leaves ± 0.1 ϵ[0.0,+∞[
    double group_jPdNNeg,                 // focal group constants Adult P(dN=-1) ± 0.01 ϵ[0.0,1.0]
    double group_remanence,               // focal group constants seedling remanenc (y) ± 0.0 ϵ]-∞,+∞[
    double group_slrec0,                  // focal group constants rect els to sls alive ± 0.01 ϵ[0.0,1.0]
    double group_slrec1,                  // focal group constants rect els to sls dead ± 0.01 ϵ[0.0,1.0]
    double budHt,                         // focal component currentState  ± 0.0 ϵ]-∞,+∞[
    int dead,                             // focal component currentState dead ϵ[MIN_INTEGER..*]
    double nELSeedlings,                  // focal component currentState Nb. EL seedlings ± 0.0 ϵ[0.0,+∞[
    int nleaves,                          // focal component currentState nleaves ϵ[0..*]
    double neighbourhoodIndexAdults,      // focal component decorators neighbourhoodIndexAdults ± 0.01 ϵ]-∞,+∞[
    double neighbourhoodIndexJuveniles,   // focal component decorators neighbourhoodIndexJuveniles ± 0.0 ϵ]-∞,+∞[
    double neighbourhoodIndexMounds,      // focal component decorators neighbourhoodIndexMounds ± 0.0 ϵ]-∞,+∞[
    double neighbourhoodIndexTrees,       // focal component decorators neighbourhoodIndexTrees ± 0.0 ϵ]-∞,+∞[
    boolean sex,                          // focal component constants female?
    double x,                             // focal component constants x spatial coordinate (m) ± 0.1 ϵ[0.0,300.0]
    double y,                             // focal component constants y spatial coordinate (m) ± 0.1 ϵ[0.0,300.0]
    Random random,                        // random number generator
    DecisionFunction decider) {           // decision function
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code generator decides which arguments must be made available to a method based on this hierarchy: <strong>arena &gt; life cycle &gt; group &gt; component</strong>. When the method applies to a component, then all four hierarchical levels are accessible; when it applies to a group, only arena and life cycle descriptors are available, and the group arguments are treated as the <em>focal</em> 'component'.</p>
</div>
</div>
<div class="sect5">
<h6 id="truespace-data"><a class="anchor" href="#truespace-data"></a>Space data</h6>
<div class="paragraph">
<p>When a space is attached to a <a href="#trueprocess">process</a> through a <code>inSpace</code> cross-link, the following argument is added to the method list:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>limits</code>
</td>
<td class="hdlist2">
<p>The limits of the space used with this process. This is an immutable object of class <code>Box</code> <strong>[TO DO: link to javadoc]</strong>. It returns the coordinates of the lower and upper ends of the space in all its dimensions through the <code>limits.lowerBound(int i)</code> and <code>limits.upperBounds(int i)</code> methods, where <code>i</code> is the dimension index.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truewriteable-arguments-and-method-return-values"><a class="anchor" href="#truewriteable-arguments-and-method-return-values"></a>Writeable arguments and method return values</h5>
<div class="paragraph">
<p>User-defined functions are meant to modify the state of the graph, which technically means induce changes in descriptor values and creation/deletion of graph elements, namely components and relations. This cannot be done with read-only arguments.</p>
</div>
<div class="sect5">
<h6 id="truemethod-return-values"><a class="anchor" href="#truemethod-return-values"></a>Method return values</h6>
<div class="paragraph">
<p><a href="#truearguments-present-for-all-decision-functions">Decision functions</a> all have return values that are interpreted as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">function type</th>
<th class="tableblock halign-left valign-top">return type</th>
<th class="tableblock halign-left valign-top">return value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ChangeCategoryDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code> or a new <code>Category</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DeleteDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if <em>focal</em> is to be deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CreateOtherDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the number of new components to create; the decimal part is interpreted as a probability to create an extra component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RelateToDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if <em>other</em> is to be related to <em>focal</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MaintainRelationDecision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the existing relation between <em>focal</em> and <em>other</em> is maintained</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>They all have <a href="#truearguments-present-for-all-decision-functions">read-only helper arguments</a>. Example from the <strong>IDHClock</strong> tutorial for a <code>RelateToDecision</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">public static boolean distOccurrence(
    double t,                             // current time
    double dt,                            // current time step
    ...
    double freq,                          // focal component constants  ± 0.0 ϵ]-∞,+∞[
    ...
    Random random,                        // random number generator
    DecisionFunction decider) {           // decision function
    // distOccurrence ---- Code insert Begin--&gt;
    return decider.decide(1.0/freq);
    // distOccurrence ---- Code insert End----&lt;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="truemethod-writeable-arguments"><a class="anchor" href="#truemethod-writeable-arguments"></a>Method writeable arguments</h6>
<div class="paragraph">
<p>Change/Set-State functions have the following writeable arguments as output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">function type</th>
<th class="tableblock halign-left valign-top">writeable arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>focal</em> constants &amp; drivers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>changeState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>focal</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decorators of <em>arena</em>, <em>life cycle</em> &amp; <em>group</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setOtherInitialState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>other</em> drivers &amp; constants</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>ChangeOtherState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>other</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decorators of <em>arena</em>, <em>life cycle</em>, <em>group</em>, <em>other life cycle</em> &amp; <em>other group</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>ChangeRelationState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>focal</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>other</em> drivers &amp; decorators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decorators of <em>arena</em>, <em>life cycle</em>, <em>group</em>, <em>other life cycle</em> &amp; <em>other group</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These arguments appear in the argument list as specific inner classes instances with self-explained names: <code>focalDrv</code>, <code>focalCnt</code>, <code>focalDec</code>, <code>groupDec</code>, <code>groupCnt</code>, <code>arenaDrv</code>, <code>otherGroupDrv</code>, etc&#8230;&#8203; Each of these arguments will contain the same fields as the original data structure it comes from. Any value set in these arguments will be carried back to the component when the method returns. For example, this is the generated code from the <strong>IDHClock</strong> tutorial for a function of type <code>ChangeOtherState</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">public static void distEffectsComm(
    double t,                             // current time
    double dt,                            // current time step
    int count,                            // whole system autoVar count (#) ϵ[0..*]
    int nAdded,                           // whole system autoVar nAdded (#) ϵ[0..*]
    int nRemoved,                         // whole system autoVar nRemoved (#) ϵ[0..*]
    double freq,                          // focal component constants  ± 0.0 ϵ]-∞,+∞[
    double inten,                         // focal component constants  ± 0.0 ϵ]-∞,+∞[
    DoubleTable other_x,                  // other component drivers population size dim = [40] ± 0.0 ϵ]-∞,+∞[
    DistEffectsComm.OtherDrv otherDrv,    // next drivers for other component
    double other_div,                     // other component decorators  ± 0.0 ϵ]-∞,+∞[
    DistEffectsComm.OtherDec otherDec,    // new decorators for other component
    DoubleTable other_K,                  // other component constants carrying capacity dim = [40] ± 0.0 ϵ]-∞,+∞[
    DoubleTable other_alpha,              // other component constants interspecific competition coefficient dim = [40,40] ± 0.0 ϵ]-∞,+∞[
    DoubleTable other_r,                  // other component constants growth rate dim = [40] ± 0.0 ϵ]-∞,+∞[
    Random random) {                      // random number generator
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the writeable arguments are <code>otherDrv</code> and <code>otherDec</code>. Both of them are of ad-hoc inner classes defined in the generated sub-directory of the eclipse project for <strong>IDHClock</strong> (file <code>DistEffectsComm.java</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="java" class="language-java hljs">public class OtherDec {
    public double div;
}

public class OtherDrv {
    public DoubleTable x;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, to set the <code>div</code> field of the <em>other</em> decorators to 3.2, simply write <code>otherDec.div=3.2;</code> in your method code.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
As you can see above, the writeable arguments are also present as read-only arguments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may also have noticed in the example above that the comment besides <code>otherDec</code> is <code>// <strong>new</strong> decorators for other component</code>, while that besides <code>otherDrv</code> is <code>// <strong>next</strong> drivers for other component</code>. What does this mean? Well, this is just a reminder that decorators and drivers are not handled in the same way by 3Worlds (cf. <a href="#truecategory">categories</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Decorator values</strong> are only valid within a time step and are immediately changed, which means that any method writing a decorator value will change it for all other methods called during the same time step. Hence the '<strong>new</strong>' adjective.</p>
</li>
<li>
<p><strong>Driver values</strong> are carried over to the next time step, and thus are subject to a synchronized modification. To keep all component states consistent, the read-only argument for drivers store the values that were set at the previous time step, i.e. they represent the <em>current</em> state of all components. When a modification of their value is computed, it is stored in the proper writeable argument that will be copied into a separate driver state representing the <em>next</em> state of the component. <em>This makes sure that all components within a time step are viewed by each other in the same, consistent state.</em> It is only after all methods on all components of the current time step have been called that 3Worlds will replace the <em>current</em> driver state with the <em>next</em> driver state. Hence the '<strong>next</strong>' adjective.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Forgetting about the difference of treatment between <em>decorators</em> and <em>drivers</em> can be the source of <strong>major</strong> but difficult to detect computation errors. Always know what you do!
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueusing-space-in-user-code"><a class="anchor" href="#trueusing-space-in-user-code"></a>3.4.3. Using <em>space</em> in user code</h4>
<div class="paragraph">
<p>3Worlds assumes that an ecosystem representation can require a detailed description of zero, one or <em>many</em> <a href="#truethe-representation-of-space">spaces</a> (<a href="https://doi.org/10.1007%2Fs10021-011-9466-2">Gignoux et al. 2011</a>) - depending on the question addressed. It further assumes that a given space is best designed to suit the needs of one particular process, in other words, there is a 1..* relation between a space and various processes (a space can be used by many processes, but a process only uses one space). The relation between a process and a space is specified with the <code>inSpace</code> cross-link (see <a href="#trueprocess">processes</a>).</p>
</div>
<div class="paragraph">
<p>Spaces are used:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>to <em>locate</em> system components and help <em>compute geometric quantities</em> within their space. This is done by passing spatial data as arguments to all functions of a process having an <code>inSpace</code> link to a space (ie the <a href="#truespace-data">limits</a> argument). A component location in its space is given by the value of specific driver or constant descriptors (see <a href="#truespace-and-spatial-indexing">cross-links for space</a>). Any change in these coordinates will result in a movement of the component into this space.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When component coordinates get out of the space limits, the selected <a href="#truespace-and-spatial-indexing"><em>edge effect correction</em></a> rules apply and will either result in the return of the component within space limits or its exclusion from the model. This is done internally by 3Worlds just after the user method call, so that you don&#8217;t need to bother if your computed coordinates get out of range.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>to optimise the search of candidate components to establish a relation with a <code>RelateToDecision</code> function. This is an old computing problem: how to find closest neighbours in a geometric space <em>efficiently</em>? It has been solved long ago by using <a href="https://en.wikipedia.org/wiki/K-d_tree">Kd-trees</a>. Kd-trees are the most efficient algorithms to find nearest neighbours (<em>O(log(n)</em> time). In continuous spaces (cf. <a href="#true3worlds-library-of-spaces">space library</a>), 3Worlds uses Kd-trees to search for closest neighbour first to establish relations. Depending on the property defined in the <code>inSpace</code> cross-link (<code>searchRadius</code> or <code>searchNeighbours</code>) 3Worlds will either present:</p>
<div class="ulist">
<ul>
<li>
<p>the list of all components found within <code>searchRadius</code> space units of the <em>focal</em> component; or</p>
</li>
<li>
<p>the list of the <code>searchNeighbours</code> first closest components found around the <em>focal</em> component;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>...to the <code>RelateToDecisionFunction</code>. In other words, the use of the space will restrict the number of candidates for establishing a relation by looping only on those <em>others</em> which are close enough to <em>focal</em>, using two different search methods.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Whenever you have to search for items to construct relations, associate a space to your process, it will make computations far more efficient.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="trueaccessing-complex-data-structure"><a class="anchor" href="#trueaccessing-complex-data-structure"></a>3.4.4. Accessing complex data structure</h4>
<div class="paragraph">
<p>The code generated by <code>ModelMaker</code> also comprise specific data structure classes for component, group, life cycle and arena descriptors. These classes are put in the <code>generated</code> sub-directory of the project <code>code/&lt;system-name&gt;/</code> directory in the user-defined java project. Have a look at these files (but do not edit them!) to understand how to access data in complex hierarchical structures.</p>
</div>
<div class="paragraph">
<p>In all cases, those data structures have getters and setters for fields and tables that use the name of the field as method name. For example, if <code>x</code> is a field in record <code>B</code>, it will be accessed as <code>B.x()</code> and set with <code>B.x(value)</code>.</p>
</div>
</div>
</div>
<div class="sect2 text-justify">
<h3 id="truefeeding-the-model-with-data"><a class="anchor" href="#truefeeding-the-model-with-data"></a>3.5. Feeding the model with data</h3>
<div class="paragraph">
<p>Simulators usually rely on possibly large data sets to initialise and run a simulation.</p>
</div>
<div class="sect3">
<h4 id="truedata-uses"><a class="anchor" href="#truedata-uses"></a>3.5.1. Data uses</h4>
<div class="paragraph">
<p>According to their use during a simulation, we can classify data into:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Parameters
</td>
<td class="hdlist2">
<p>Values usually visible to a large number of system components that remain constant over a simulation or over the life time of an ephemeral component. These are stored in the <a href="#truethe-systemstructure-node">constants</a> of components, groups, life cycles and the arena.</p>
<div class="paragraph">
<p><em>Examples</em>: the <em>average solar radiation at the top of the canopy</em> for the arena component; the <em>spatial coordinates</em> of a plant; the <em>species name</em> for a group of components.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Initial community
</td>
<td class="hdlist2">
<p>In most cases a simulation must start with a non-empty initial system. This implies that components be instantiated with specific initial values for their <a href="#truethe-systemstructure-node">drivers</a> and proper connections between them.</p>
<div class="paragraph">
<p><em>Examples</em>: an initial forest reconstructed from LIDAR data; a monitored population of marked animals within an area, where each animal has a measured age.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Forcing data
</td>
<td class="hdlist2">
<p>Sometimes a simulation requires that data be fed in during its time course, at some time step, replacing values of a driver that cannot be computed by the model.</p>
<div class="paragraph">
<p><em>Examples</em>: a series of metorological data used to force a fire spread or a vegetation growth model.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="truedata-input-methods"><a class="anchor" href="#truedata-input-methods"></a>3.5.2. Data input methods</h4>
<div class="paragraph">
<p>There are three different ways of feeding <code>ModelRunner</code> with data to start a simulation experiment (cf. <a href="#truethe-setup-of-an-initial-state-for-a-simulation">Section 3.3.3.4</a> for the specification of these):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Entering parameter and initial driver values in the model configuration tree. This is useful only for small quantities of data, with model requiring only a few parameters, or during the initial building/testing file of a model. Typically when one does not want to bother with formatting an input file with two parameter values. This is specified using <code>initialValues</code> nodes.</p>
</li>
<li>
<p>Loading data from an external source, typically, one or more files. This is recommended whenever a large number of initial values and items must be used. This is specified using <code>loadFrom</code> cross-links to <code>dataSource</code> nodes (<a href="#truethe-experiment-node">Section 3.3.6</a>).</p>
</li>
<li>
<p>Using a user-defined initialiser function to set or modify initial values. This complements both points above and enables to compute transformations of initial drivers or constants prior to run the simulation. This is specified using the <code>SetInitialState</code> type (<a href="#truefunction">Section 3.3.4.2.2</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These three methods can be used together within the same model. However, since an initialiser function must be run on an existing instance of a component, it can only be used (i) on the <code>system</code> node, which is always instantiated and unique, or (ii) as a complement to the two other methods which can specify the component instances to create.</p>
</div>
<div class="paragraph">
<p>Data for <em>parameters</em> and <em>initial community</em> are directly used to instantiate components and fill their descriptors with values. <em>Forcing data</em> must be loaded into some initial data structure (probably most often a <code>DoubleTable</code>, cf. <a href="#truetable">Section 3.3.5.2.2</a>, as a constant in the <code>system</code> instance), made accessible to some user-defined function that will read its content as simulation progresses.</p>
</div>
</div>
<div class="sect3">
<h4 id="trueconsistency-of-data-files-with-the-model-component-hierarchy"><a class="anchor" href="#trueconsistency-of-data-files-with-the-model-component-hierarchy"></a>3.5.3. Consistency of data files with the model component hierarchy</h4>
<div class="paragraph">
<p>The simulated system is a hierarchy (<a href="#truethe-specification-of-ecological-entities-system-components">Section 3.3.3.2</a>) with up to 4 levels: arena &gt; life cycle &gt; group &gt; component.
<a href="#system-howto">How is the simulated system implemented?</a></p>
</div>
</div>
<div class="sect3">
<h4 id="truedata-file-formats"><a class="anchor" href="#truedata-file-formats"></a>3.5.4. Data file formats</h4>

</div>
<div class="sect3">
<h4 id="trueimport-data-from-external-sources"><a class="anchor" href="#trueimport-data-from-external-sources"></a>3.5.5. Import data from external sources</h4>

</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="truesimulation-reference-running-a-simulation-experiment-with-modelrunner"><a class="anchor" href="#truesimulation-reference-running-a-simulation-experiment-with-modelrunner"></a>4. Simulation reference: running a simulation experiment with ModelRunner</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="truegeneral-concepts"><a class="anchor" href="#truegeneral-concepts"></a>4.1. General concepts</h3>
<div class="paragraph">
<p><em>ModelRunner</em> can be used with or without a GUI. If using without a GUI, all <code>widget</code> nodes must be specified as children of a <code>headless</code> node. Alternatively, <em>ModelRunner</em> will have a GUI if any <code>widget</code> nodes are children of <code>top</code>, <code>bottom', `tab</code> or <code>container</code> nodes. You can freely mix these two types of widgets.</p>
</div>
<div class="paragraph">
<p>At the time of writing, two major aspects of <em>ModelRunner&#8217;s</em> functionality have not been developed: the ability to change constants during a simulation (i.e to play around with a model while it&#8217;s running) and to save and restart simulations from particular states (e.g create a save a spin-up state from which to start an experiment).</p>
</div>
</div>
<div class="sect2">
<h3 id="trueusing-modelrunner-software-interface-and-functioning"><a class="anchor" href="#trueusing-modelrunner-software-interface-and-functioning"></a>4.2. Using ModelRunner: software interface and functioning</h3>
<div class="paragraph">
<p>The layout of widgets in <em>ModelRunner</em> is determined by the structure and properties of the <code>userInterface</code> sub-tree constructed with <em>ModelMaker</em> (ref to UI sub-tree).</p>
</div>
<div class="paragraph">
<p>The two functioning menu items are <strong>widgets</strong> and <strong>about</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>widgets:: Edit properties of widgets (ref to UI sub-tree). These settings are saved automatically when <em>ModelRunner</em> quits.</p>
</li>
<li>
<p>about:: Information about the experiment design, <em>ModelRunner</em> and provision to create model documentation (ODD).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following widgets have run-time properties, saved automatically by <em>ModelRunner</em> so that its appearance remains as selected between each deployment of the model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TimeseriesWidget</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Legend visible: Toggles the legend display on or off.</p>
</li>
<li>
<p>Legend position: The placement of the legend relative to the chart.</p>
</li>
<li>
<p>Max legend items: The maximum number of items in the legend. This limits the number of items to display when running experiments with a large number of simulators running in parallel.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="truegetting-output-from-a-simulation-experiment"><a class="anchor" href="#truegetting-output-from-a-simulation-experiment"></a>4.3. Getting output from a simulation experiment</h3>
<div class="paragraph">
<p>Outputs from a simulation are detailed in the section on widget properties (ref to UI sub-tree).</p>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="truesample-models-and-tutorials"><a class="anchor" href="#truesample-models-and-tutorials"></a>5. Sample models and tutorials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="truetutorial-1-construct-and-run-a-simulation-for-the-first-time"><a class="anchor" href="#truetutorial-1-construct-and-run-a-simulation-for-the-first-time"></a>5.1. Tutorial 1: Construct and run a simulation for the first time</h3>
<div class="sect3">
<h4 id="trueintroduction"><a class="anchor" href="#trueintroduction"></a>5.1.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial explains the procedure for developing and running a simulation with <em>ModelMaker</em>.
We start by using a simple <a href="https://en.wikipedia.org/wiki/Logistic_map">logistic growth model</a> as a test case and
gradually introduce more capabilities with subsequent tutorials as we explore the full range of modelling features available.</p>
</div>
<div class="paragraph">
<p>In <em>3Worlds</em>, the specification of a simulator is developed by constructing a graph of nodes and edges and
setting their respective properties. The nodes represent elements of interest in the model while the edges show the
relationships between them: the entire graph then constituting the simulator specification.
The simulation can be run as soon as the specification is complete and Java code has been written to define the
behaviour of the functions you have specified.</p>
</div>
<div class="paragraph">
<p>As you construct the graph, <em>ModelMaker</em> is constantly checking and providing feedback on how the specification complies
with the <em>specification archetype</em>. <em>ModelMaker</em> guides you through this process by managing the available options at each
stage in the graph construction and by providing an updated list of tasks requiring attention.</p>
</div>
<div class="paragraph">
<p>While this process greatly accelerates model development, a more important aim is to provide a firm basis for model
comparison. As all models developed with <em>ModelMaker</em> must comply with the <em>specification archetype</em>,
structural differences reduce to a comparision of graphs. That is, while you can construct any model, the design,
being constrained by the <em>specification archetype</em>, will not be arbitrary. Of course, this is not the only difference
between models. The code for each function defined in the specifications will be particular but at least these differences
are encapsulated at specific places in the model implementation.</p>
</div>
<div class="paragraph">
<p>The specification graph is both a tree and a directed graph
(<a href="#truegeneral-concepts-structure-of-a-3worlds-configuration">Section 3.1</a>). Aside from the root, each node has a parent and may have
additional edges between nodes to define particular relationships. We refer to these edges as <em>cross-links</em> to distinguish
them from edges that represent <em>parent-child</em> relationships.</p>
</div>
</div>
<div class="sect3">
<h4 id="trueinstallation"><a class="anchor" href="#trueinstallation"></a>5.1.2. Installation</h4>
<div class="paragraph">
<p>Installing <em>ModelMaker</em> is very simple: create a directory called <code>.3w</code> in your home directory and copy <code>tw-dep.jar</code> to it.
Then copy <code>modelMaker.jar</code> to your home directory. To start <em>modelMaker</em>, open a terminal and type:
<code>java -jar modelMaker.jar</code>. If you receive a message saying "Unable to access jarfile modelMaker.jar", check for misspelling
(including upper-case letters) and that the file is executable using the file manager of your operating system.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To compile your own models, the Java Development Kit (JDK)  must be installed on your computer (<a href="#trueprerequisites">Section 2.2</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="truecreating-a-new-3worlds-project"><a class="anchor" href="#truecreating-a-new-3worlds-project"></a>5.1.3. Creating a new 3Worlds project</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> as above. If you haven&#8217;t read any other <em>3Worlds</em> documentation, reading "About ModelMaker" from the main menu (<code>Help &#8594; About</code>) will provide some preliminary context.</p>
</li>
<li>
<p>Create a new project (<code>Main menu: Projects &#8594; New &#8594; Templates &#8594; Blank</code>)</p>
</li>
<li>
<p>When prompted enter 'Tut1' (first letter upper case). A small graph of ten nodes appears in the graph window.</p>
</li>
</ol>
</div>
<div id="fig-blank-template" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-blank-mm.png" alt="fig blank mm">
</div>
<div class="title">Figure 26. The appearance of <em>ModelMaker</em> after creating a new project from the 'Blank' template.</div>
</div>
<div class="paragraph">
<p>The black node (<code>3worlds:Tut1</code>) is the <em>root</em> of a graph that forms the simulator&#8217;s specification. The other nodes are,
for the most part, colour-coded roots of sub-trees of the graph wherein various aspects of the specification are defined
(<a href="#fig-blank-template">Figure 26</a>, <a href="#trueconfiguration-options-reference">Section 3.3</a>).</p>
</div>
<div class="paragraph">
<p>All nodes are identified by a <em>label:name</em> pair. The <em>label</em> is the type of node, representing its role, while the <em>name</em>
is a unique identifier. A few node types, of which the root node is one, must have names beginning with an upper case
letter. These nodes are used to generate Java classes when the simulation compiles.</p>
</div>
<div class="paragraph">
<p>At this stage you can try out a few basic edit operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Move a node around the graph display by dragging it with the left mouse button;</p>
</li>
<li>
<p>Zoom in and out in the graph display using the mouse wheel while holding down the <code>ctrl</code> key (or equivalent on your
operating system). Zooming is centered on the mouse position;</p>
</li>
<li>
<p>Pan the drawing surface by dragging with the left-mouse button anywhere outside a node (assuming the drawing area is
larger than the display);</p>
</li>
<li>
<p>Change the node and text size with the <em>element size</em> slider in the tool bar;</p>
</li>
<li>
<p>Right-click on a node to display a pop-up menu of edit options for that particular node. It is via these pop-up menus
that the graph is constructed; and,</p>
</li>
<li>
<p>While holding down the <code>shift</code> key, left-click on a node to see just this node and its nearest neighbours. What
constitutes 'nearest' is set by the 'path len.' control in the tool bar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A list of tasks remaining to be completed appears at the bottom-left of the main window (<a href="#fig-blank-template">Figure 26</a>).
This list grows and shrinks as the developing graph is checked against the specification archetype.  A check takes place
in the background every time the graph structure or its properties change.</p>
</div>
<div class="paragraph">
<p>At the top-left of the main window are the two property editors - <em>Properties</em> and <em>Selected Properties</em>
(<a href="#fig-blank-template">Figure 26</a>).  These show properties for the entire graph or for a single selected node
(selected by clicking on the node with the left button) respectively. It&#8217;s here that values are entered for node and
edge properties created in the following steps.</p>
</div>
<div class="paragraph">
<p>At this stage, there are five properties under the section <code>Tut1</code>.  These are properties of the root
node (<code>3worlds:Tut1</code>) intended to provide a limited amount of documentation for this project.
If you click on the root node and then select the <em>Selected Properties</em> editor tab, an additional
non-editable property is shown called &#8216;built-by&#8217;. This property is filled out automatically with your
computer login name and the creation date of the project. Viewing non-editable properties can be useful
at times. These are always shown in the <em>Selected Properties</em> editor but for brevity, not in the
<em>Properties</em> editor. Two icons at the top left of the <em>Properties</em> editor allow you to display properties
by category (by sub-tree) or by name. When this last option is selected, all editable properties are
display in one list.</p>
</div>
<div class="sect4">
<h5 id="truedirectory-structure"><a class="anchor" href="#truedirectory-structure"></a>Directory structure</h5>
<div class="paragraph">
<p>All projects are located within the 3Worlds root directory called <code>.3w</code>. The dot indicates a hidden directory.
To see these files you may need to do what ever is required by your operating system to show hidden files
(<a href="#fig-tut1-dir">Figure 27</a>).</p>
</div>
<div id="fig-tut1-dir" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-tut1-dir.png" alt="fig tut1 dir">
</div>
<div class="title">Figure 27. The initial directory structure <br/> after creating a new project from the 'Blank' <br/> template. Later, after all tasks have been <br/> completed and the model is deployed, another <br/> sub-directory is added for run-time files.</div>
</div>
<div class="paragraph">
<p>The <code>.3w</code> directory contains a Jar file called <code>tw-dep.jar</code> (<a href="#fig-tut1-dir">Figure 27</a>). This file contains all dependent
libraries for <em>3Worlds</em>. It&#8217;s a good idea to keep a backup of this file.</p>
</div>
<div class="paragraph">
<p>Within <code>.3w</code> there is now a sub-directory called something like <code>project_Tut1_2020-06-07-01-47-44-708</code>. Every project
directory begins with the key word <code>project</code>, followed by the name of the project you entered (<code>Tut1</code> in this case)
and the creation date and time. The purpose of naming project directories in this way is to make it almost impossible
to inadvertently overwrite a project.</p>
</div>
<div class="paragraph">
<p>Inside this directory are a number of text files:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>Tut1.utg</code> is the model configuration graph we&#8217;re constructing;</p>
</li>
<li>
<p><code>.layout.utg</code> contains information used to display the graph;</p>
</li>
<li>
<p><code>MM.xml</code> contains the session&#8217;s preference settings.</p>
</li>
<li>
<p><code>__StateA1</code> and sequences of similarly named files are temporary files to support the program&#8217;s undo/redo of editing
operations. These files are created during a session and deleted when the session ends.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All these files are text files and you can open and inspect them with a simple text editor.
However, as they are written by <em>ModelMaker</em> you should <em>avoid editing them directly as this will
likely cause problems for your project</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Editing any project graph files (*.utg) with a text editor is likely to corrupt the project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the other hand, you can delete project directories at any time you wish. If you accidentally
delete the project of a currently open session, it will be recreated automatically by
<em>ModelMaker</em> (apart from the <em>undo-redo</em> history). However, if you delete the entire <code>.3w</code> directory
you will have to restore <code>tw-dep.jar</code> from backup.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truecreating-the-specifications"><a class="anchor" href="#truecreating-the-specifications"></a>5.1.4. Creating the specifications</h4>
<div class="paragraph">
<p>Having created <code>Tut1</code>, the task list shows two actions are required (<a href="#fig-blank-template">Figure 26</a>).
 These tasks can be dealt with in any order but in general, a logical approach is to build
 the specification as follows:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong>data definition</strong>: the data structures required (cf. <a href="#truethe-datadefinition-node">Section 3.3.5</a> for full reference);</p>
</li>
<li>
<p><strong>structure</strong>: define the organisation of components - their roles and relationships (cf. <a href="#truethe-systemstructure-node">Section 3.3.3</a> for full reference).</p>
</li>
<li>
<p><strong>dynamics</strong>: define how the modelled system evolves over time and the parts of the <strong>structure</strong> that dynamic processes apply to (cf. <a href="#truethe-systemdynamics-node">Section 3.3.4</a> for full reference).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For the most part, these tutorials will proceed in this order and leave defining the
simulation&#8217;s <strong>user interface</strong> (<a href="#truethe-userinterface-node">Section 3.3.7</a>) and <strong>experiment</strong> design (<a href="#truethe-experiment-node">Section 3.3.6</a>)
until last. In fact, the Blank template has provided a minimum specification for the <strong>experiment</strong> sub-tree
(a single run of the model) and  the <strong>user interface</strong> (a simulation controller).</p>
</div>
<div class="sect4">
<h5 id="truedata-definition"><a class="anchor" href="#truedata-definition"></a>Data definition</h5>
<div class="paragraph">
<p>The logistic equation we will implement is: <em>x(t+1) = rx(t)(1-x(t))</em>. Though simple, it has interesting chaotic
behaviour for values of <em>r</em> between 3.7 and 4.0. All we need do for the data definition section is to define the
parameter <em>r</em> and the state variable <em>x</em>.</p>
</div>
<div class="paragraph">
<p>From here on and throughout these tutorials, parameters are called <em>constants</em> (data that does not change over the
course of a simulation) and state variables are called <em>drivers</em> (data that drives the simulation from one time to
the next).</p>
</div>
<div class="paragraph">
<p>Note that at this stage, the task list says nothing about adding anything to the <strong>data definition</strong> sub-tree. This is
because it is possible to define a model without data. Nevertheless, once data is defined, various actions will be
required and displayed in the task list to correctly define its use.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on the data definition node (<code>dataDefinition:dDef</code>) (pale red) and select <code>New node &#8594; record</code> from the popup menu. You&#8217;re then prompted for a name. The default name is <code>rec1</code>. Change this to 'cnsts' (constants) and click <code>ok</code>. The mouse pointer immediately becomes a cross-hair: <em>ModelMaker</em> is asking where to place this node. Move to some place within the graph display and left-click the mouse.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can name nodes and edges anything you like but accepting the recommended names and edges will make these tutorials
easier to follow. Note that <em>ModelMaker</em> will prevent naming nodes or edges with duplicate names.</p>
</div>
<div class="paragraph">
<p>All nodes in the configuration graph are children of some parent (apart from the root node). You can only create nodes
by right-clicking on a parent and selecting a child to create from the available options provided by the pop-up menu.
The items in this menu vary according to the possibilities allowed by the <em>specification archetype</em>. This is one way
<em>ModelMaker</em> ensures the developing configuration conforms with the <em>archetype</em>, greatly simplifying an otherwise
complex workflow.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>field</code> node as child of <code>record:cnsts</code>, name it 'r' and when prompted, set its type as <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All <code>fields</code> (and later <code>tables</code>) must be children of some <code>record</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create another <code>record</code> as child of <code>dataDefinition:dDef</code> and name it 'drvs' (drivers).</p>
</li>
<li>
<p>Create a <code>field</code> node as child of <code>record:drvs</code>, name it 'x' and again set the type to <code>Double</code> (<a href="#fig-ddef-subtree">Figure 28</a>).</p>
</li>
</ol>
</div>
<div id="fig-ddef-subtree" class="imageblock left text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-ddef-subtree.png" alt="fig ddef subtree" width="300">
</div>
<div class="title">Figure 28. Defining constant <code>r</code> and driver <code>x</code> <br/> within the data definition sub-tree.</div>
</div>
<div class="paragraph">
<p>Note that the names 'drvs' and 'cnsts' don&#8217;t imply any meaning to the simulation specification - they&#8217;re just names.
Their <em>roles</em> as drivers and constants will be defined later.</p>
</div>
<div class="paragraph">
<p>This is all the data required for this tutorial.  The task list has now grown to four because the roles of this data
remains undefined.</p>
</div>
<div class="paragraph">
<p>You can tidy up the graph display by clicking the <code>L</code> button (re-apply layout) in the tool bar.</p>
</div>
</div>
<div class="sect4">
<h5 id="truestructure"><a class="anchor" href="#truestructure"></a>Structure</h5>
<div class="paragraph">
<p>At this time, the task list displays four actions. Three of these actions relate to the structure of the model. The <code>structure</code> sub-tree
describes how the modelled system is organised into separate <code>components</code> playing particular roles. In an elaborate model, there can be
many <code>components</code> but in the present case, we need only one, and for convenience, the <code>system</code> node can act as this single <code>component</code>
without the necessity of actually creating a <code>component</code> within a <code>structure</code> sub-tree.</p>
</div>
<div class="paragraph">
<p>Here, the component&#8217;s <em>role</em> will be defined as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lifetime: <em>permanent</em>;</p>
</li>
<li>
<p>organisation: <em>atomic</em>;</p>
</li>
<li>
<p>systemElements: <em>arena</em>;</p>
</li>
<li>
<p>Using <em>r</em> as a constant and <em>x</em> as a driver.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The component has a <em>permanent</em> lifespan because it persists throughout the simulation; it&#8217;s  <em>atomic</em> simply because it is a single indivisible component and not an assemblage of sub-components; and, it belongs
to something called the <em>arena</em>. The <em>arena</em> is  a unique top level component - it&#8217;s more or less a global component accessible to all
other components. No matter how many components a model has, exactly one of them must belong to the <em>arena</em> category,</p>
</div>
<div class="paragraph">
<p>While this is complicated for such a simple model, later tutorials will show how this arrangement can be a powerful approach to
structuring any complex hierarchical dynamic system composed of interacting physical and biological components.</p>
</div>
<div class="paragraph">
<p>To create this role, we use nodes of the type <code>categorySet</code> and <code>category</code>. A <code>categorySet</code> is a set of mutually exclusive categories.
By that we mean a <code>component</code> can only be associated with one category of a given categorySet. So for example <em>permanent</em> and <em>ephemeral</em>
are two categories within a set called <em>lifespan</em> and clearly, a component can only be one or the other. Categories and CategorySets are
recursive: a CategorySet contains Categories and Categories can contain CategorySets without limit.</p>
</div>
<div class="paragraph">
<p>Apart from the <code>system</code> node doubling as a <code>component</code>, an additional convenience is provided: a sub-tree of predefined category sets and
categories. We use these nodes to define the role described above. To see this sub-tree:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on the root node and select <code>Collapse &#8594; All</code>.</p>
</li>
<li>
<p>Right-click again on the root node and select <code>Expand &#8594; predefined:*categories*</code>.</p>
</li>
<li>
<p>Re-apply the layout ('<strong>L</strong>' [Alt+L])</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>predefined:*categories*</code> sub-tree is created with every new project (collapsed by default) and is <em>immutable</em> apart from allowing
edges to be added between it and other sub-tree nodes.</p>
</div>
<div class="paragraph">
<p>There are two <code>record</code> nodes within this sub-tree for default handling of average population and ephemeral data. Since the single
component used here will be neither of these we can ignore this section:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Right-click on <code>predefined:*categories*</code> and collapse both the <code>AVPopulation</code> and <code>AVEphemeral</code> sub-trees.</p>
</li>
<li>
<p>Right-click on the root node, expand the <code>system</code> and re-apply the layout.</p>
</li>
</ol>
</div>
<div id="fig-system-role" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-system-role.png" alt="fig system role" width="500">
</div>
<div class="title">Figure 29. The specification of the system component in belonging <br/> to the three categories; <em>permanent</em>, <em>atomic</em> and <em>arena</em>.</div>
</div>
<div class="paragraph">
<p>We are now in a position to define the <em>role</em> of the <code>system</code> node (a.k.a. <code>component</code> in this case). The <code>system</code> node always belongs to
the <code>arena</code> and <code>permanent</code> categories. This has already been done by the 'Blank' template. It just remains to make the system <code>atomic</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Right-click on <code>system:sys1</code> and select <code>New edge &#8594; belongsTo &#8594; category:*atomic*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The system&#8217;s role of belonging to the <em>atomic</em>, <em>permanent</em> and <em>arena</em> categories is indicated by three <em>cross-link</em> edges
(<a href="#fig-system-role">Figure 29</a>). All <em>cross-links</em> are red - thin at the <em>start node</em> and thick at the <em>end node</em>. Unlike parent-child links,
they have names. Generally, the names of <em>cross links</em> are not much use. They can be hidden by selecting the drop-down list <code>E text</code> in
the tool bar, and selecting <code>Role</code>. The relationship can be read as, for example: <code>system:sys1 belongsTo category:*arena*</code>.</p>
</div>
<div id="fig-arena" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-arena.png" alt="fig arena" width="500">
</div>
<div class="title">Figure 30. The specification of the constants and drivers for the <em>arena</em>, <br/> a category to which the only component in this tutorial (aka <br/> <code>system:sys1</code>) belongs.</div>
</div>
<div class="paragraph">
<p>We have yet to relate <code>system:sys1</code> to the driver '<em>x</em>' and the constant '<em>r</em>'.  These are global data and therefore are defined as part
of the <code>arena</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Right-click on <code>category:*arena*</code> and select <code>New edge &#8594; constants &#8594; record:cnsts</code>.</p>
</li>
<li>
<p>Right-click again on <code>category:*arena*</code> and select <code>New edge &#8594; drivers &#8594; record:drvs</code> (<a href="#fig-arena">Figure 30</a>).</p>
<div class="literalblock">
<div class="content">
<pre>There is now one message remaining which refers to the dynamics of the model.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truedynamics"><a class="anchor" href="#truedynamics"></a>Dynamics</h5>
<div class="paragraph">
<p>The <code>dynamics</code> sub-tree specifies how the modelled system will evolve over time. It determines the temporal order of
function calls, their type, the categories they apply to (cf above), the conditions under which the simulation will stop (if any) and what and when data will be tracked
for output.</p>
</div>
<div class="paragraph">
<p>In the present case, the main task is to call the logistic equation a set number of times and present the result from
each iteration to the equation at the next time step.</p>
</div>
<div class="paragraph">
<p>The <code>dynamics</code> sub-tree (lime green) is a child of the <code>system</code> node - the root of the modelled system that defines
both its dynamics and structure. These nodes are already present in the "Blank" template we started with.
The <code>dynamics</code> node is the specification of a type of simulator. There can be many simulators (instances) of this
specification running in parallel depending on the experimental design.</p>
</div>
<div class="paragraph">
<p>A dynamic system must have a single definition of the <a href="#truetime-line">time scale</a>. There are ten different types of
time scale available: all of them define exact sub-divisions of time except for the <code>GREGORIAN</code> scale type which
implements the standard Gregorian calendar. The 'Blank' template has already defined a <code>timeline</code> with an <code>ARBITRARY</code>
time scale which is sufficient for this tutorial.</p>
</div>
<div class="paragraph">
<p>In the task list is an action asking that a <code>timer</code> be added to <code>timeline:tmLn1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <a href="#truetimers"><code>timer</code></a> as a child of <code>timeline</code>. Here an extra prompt appears asking for the class of the timer: {<code>ClockTimer</code>, <code>EventTimer</code>, <code>ScenarioTimer</code>}. Select <code>ClockTimer</code>. This timer class increments time by a constant step during simulation, unless the timeline uses a Gregorian scale in which case irregularities such as leap years are managed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Two new tasks have been added to the task list indicating that <code>dt</code> and <code>nTimeunits</code> must be greater than 1.0.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>In the property editor, locate these two properties (properties of <code>timer:tmr1</code>) and set them to 1.0.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Clock timers use their own time units to count time. The time unit is specified by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>timeUnit</code> property, which defines in which measurement unit time is to be expressed. There are 22 time unit types
available ranging from microseconds to millennia, constrained by the choice of the time scale. The current default
value of <code>UNSPECIFIED</code> is fine for this tutorial, as here, time is just a sequence of steps;</p>
</li>
<li>
<p><code>nTimeUnits</code>, i.e. the number of measurement units per timer unit - for example, a timer could use '2 days' as its
basic time unit. It means that an elementary time tick in this timer represents 2 days, so (time = 11) means 22 days,
etc. It is the finest <em>grain</em> at which time can be measured with this timer. In this tutorial, 1 is fine as we simply
use a sequence of steps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, <code>dt</code> is the number of time <em>grains</em> per time step. Here, 1 will do. This tutorial runs with time steps of 1
unspecified unit, i.e just simple ticks.</p>
</div>
<div class="paragraph">
<p>Note that a model can have any number of <code>timers</code> using any of the available time steps and time units as long as the
time units selected are compatible with the parent <code>timeline</code>. The task messages will indicate if this is not the case.
Because the specification archetype allows for more than one system, it follows there can be many dynamics sub-trees,
each with their own time system.</p>
</div>
<div class="paragraph">
<p>There is currently a task asking that a <code>process</code> be added to <code>timer:tmr1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create a <a href="#trueprocess"><code>process</code></a> node as child of <code>timer:tmr1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This process will opereate on <em>r</em> and <em>x</em> that we defined in the Data definition section. These data are associated with the <em>arena</em> as constants (<em>r</em>) and drivers (<em>x</em>). Therefore <code>process:p1</code> will <code>applyTo</code> the arena.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Right-click on <code>process:p1</code> and select 'New edge &gt; appliesTo &#8594; category:*arena*'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A <code>process</code> defines a set of computations acting on model components driven at the rate of the parent <code>timer</code>.
A component is some unit of simulation. It can be any physical or biological entity represented in the model
that has dynamic behaviour (plants, animals, nutrient pools, lakes, the atmosphere or the rhizosphere etc).</p>
</div>
<div class="paragraph">
<p>Processes can be composed of any number of functions of various types (much more on this later). We need just one
function to implement the logistic equation - a <code>ChangeState</code> function that takes the current state of a component and
calculates the next state.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create a <a href="#truefunction"><code>function</code></a> as a child of <code>process:p1</code>, name it <code>Chaos</code> and select <code>ChangeState</code> as its type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The function type can&#8217;t be changed after creating node, so if you make a mistake, delete and recreate it (<code>Delete</code>
from the pop-up menu or <code>Undo</code> from the main menu).</p>
</div>
<div class="paragraph">
<p><em>ModelMaker</em> can link to an Integrated Development Environment (IDE) such as <em>Eclipse</em>, to write code for these
functions. However, in this tutorial the funcion is only one line of code and we can just associate a code snippet
with the function without the need to link to an IDE. The snippet will be inserted in the function when the simulation
is compiled.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Edit the <code>functionSnippet</code> property of <code>function:Chaos</code>, and enter the following text:
<code>focalDrv.x = r*x*(1-x);</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This line sets the next value of <em>x</em> (<code>focalDrv.x</code>) in terms of the current value of <em>x</em>.</p>
</div>
<div class="paragraph">
<p>Save your work (<code>Ctrl+s</code>) and the task list will be empty indicating the simulation is ready to deploy.</p>
</div>
</div>
<div class="sect4">
<h5 id="truedeployment-launching-modelrunner"><a class="anchor" href="#truedeployment-launching-modelrunner"></a>Deployment: launching <em>ModelRunner</em></h5>
<div class="paragraph">
<p>Before deploying the simulation, it&#8217;s useful to display the overall specifications by hiding the predefined sub-tree and showing the
experiment and user interface sub-trees.</p>
</div>
<div id="fig-deploy1" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-deploy1.png" alt="fig deploy1">
</div>
<div class="title">Figure 31. A view of the specification graph showing principal nodes of interest.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click the root node and select 'Collapse &#8594; predefined:*categories*'.</p>
</li>
<li>
<p>Again, right-click the root node and select 'Expand &#8594; experiment:expt' and 'UserInterface:gui'.</p>
</li>
<li>
<p>Re-apply the layout (<strong>L</strong>) (<a href="#fig-deploy1">Figure 31</a>).</p>
</li>
<li>
<p>Click the <code>Deploy</code> button. <em>ModelMaker</em> now launches <em>ModelRunner</em> to start the run-time application: <em>ModelRunner</em> (cf. <a href="#truesimulation-reference-running-a-simulation-experiment-with-modelrunner">Section 4</a> for a full reference).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At the top of <em>ModelRunner</em> are some control buttons to start, step and stop the simulation. This is the <code>ControlWidget1</code> shown in the
figure above that was included by default in the 'Blank' template. The <em>run</em> button becomes a <em>pause</em> button while running and the <em>stop</em>
button resets the simulator to it&#8217;s starting state.</p>
</div>
<div class="paragraph">
<p>However, as expected, there&#8217;s nothing to see so the next step is to add a time series widget. This is an optional requirement so the
task list didn&#8217;t complain about this.</p>
</div>
<div class="paragraph">
<p>You can move easily between design and execution of the specifications simply by deploying <em>ModelRunner</em>, checking the simulation and
quitting to return to <em>ModelMaker</em>.</p>
</div>
<div class="paragraph">
<p>To add a time series for <em>x</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Quit <em>ModelRunner</em> and return to <em>ModelMaker</em>.</p>
</li>
<li>
<p>Create a <code>tab</code> node from the  <code>userInterface:gui</code> node.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A <code>tab</code> is a container that can contain either widgets or other containers. The task list indicates this now asking that one of these be
added.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Create a <code>widget</code> node from <code>tab:tab1</code>, name it 'srsx' and select <code>TimeSeriesWidget1</code> from the drop-down list.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A new task has been added to the list requiring an edge from this widget to a dataTracker.</p>
</div>
<div class="paragraph">
<p>For this widget to receive values of <em>x</em>, something must post values of <em>x</em> to the widget at the same rate as the <code>Chaos</code> function is
executed. This is the job of a <code>dataTracker</code> and it properly belongs in the <code>dynamics</code> sub-tree.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p1</code> and choose <code>DataTracker0D</code> as it class. This class of data tracker is suitable for scalar data such as <em>x</em>.</p>
</li>
<li>
<p>Create an edge from the <code>dataTracker</code> to <em>x</em> by selecting <code>New edge &#8594; trackField - &gt; field:x</code>.</p>
</li>
<li>
<p>Create an edge from <code>widget:srsx</code> to the new data tracker.</p>
</li>
<li>
<p>Create an edge from <code>dataTracker:trk1</code> to a <code>component</code> i.e in this case <code>system.sys1</code>. A data tracker must not only track some data but also the <code>component</code> that uses this data.</p>
</li>
<li>
<p>Save the graph (<code>Ctrl+s</code>) and click the 'Deploy' button again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The display is still uninteresting because we haven&#8217;t set an initial value for <em>x</em> or parameterised <em>r</em>. This can be done in a number of
ways but for this tutorial we will add an initialisation function and a code snippet.</p>
</div>
<div id="fig-javaCode" class="imageblock left text-center">
<div class="content">
<img src="../source/tutorial1IMG/fig-javaCode.png" alt="fig javaCode">
</div>
<div class="title">Figure 32. Entering Java code snippet for the <code>initFunction</code> (for the <br/> <code>system:sys1</code> component) in the property editor.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Create an <code>initFunction</code> as a child of <code>system:sys1</code>. As <code>system:sys1</code> is the only component in the specifications, it is the node requiring initialisation of <em>x</em> and <em>r</em>.</p>
</li>
<li>
<p>Enter the following two lines in the <code>Init1#javaCode</code> property (<a href="#fig-javaCode">Figure 32</a>):</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>focalDrv.x = 0.001;</code></p>
</li>
<li>
<p><code>focalCnt.r = 3.7;</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you make a typo, the task list will show the details of the compile error.</p>
</div>
</div>
<div class="sect4">
<h5 id="truestopping-conditions"><a class="anchor" href="#truestopping-conditions"></a>Stopping conditions</h5>
<div class="paragraph">
<p>If you examine the graph and all its properties, you may notice that there is no indication as to how long the simulation should run.
This means that when we run it we should expect it to continue indefinitely. You may or may not want this. If your model contains an
unconstrained exponential function, it may eventually crash unless your code takes measures to handle this. You can add a variety of
simple or complicated stopping conditions to the <code>dynamics</code> node. These will be discussed in later tutorials.</p>
</div>
<div class="paragraph">
<p>When we first ran this model it had no output. Now that we have a time series chart, displaying data of unlimited length will make the
<em>ModelRunner</em> fairly unresponsive because the simulator has little to do but the UI must update the graph continuously. Note: the
<code>TimeSeriesWidget1</code> displays data in a rolling buffer. The default buffer size is 1,000 data points.</p>
</div>
<div class="paragraph">
<p>If you press the run button and then the stop or pause button of the controller, it may take a while for the simulator to respond.
So for now, it&#8217;s best to test the simulation with the <code>Step</code> button.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Deploy <em>ModelRunner</em> (saving first if prompted)</p>
</li>
<li>
<p>Click the <code>step</code> button a few times. A time series of zeros is shown.</p>
</li>
<li>
<p>Click the <code>run</code> button twice in rapid succession. The time (x axis) now reads approximately 30,000 or so depending on the speed of your computer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To complete this tutorial, add a simple stopping condition:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Close <em>ModelRunner</em> and return to <em>ModelMaker</em>.</p>
</li>
<li>
<p>Create a <code>stoppingCondition</code> as a child of <code>dynamics:sim1</code>. When prompted, select <code>SimpleStoppingCondition</code> from the drop-down list.</p>
</li>
<li>
<p>Select this new node and in the properties editor, set the value of <code>stCd1#endTime</code> to 100 (<a href="#fig-final-specification">Figure 33</a>).</p>
</li>
<li>
<p>Save, re-deploy and run the simulation. You&#8217;ll now see a time series of the chaos function of 100 time steps (<a href="#fig-tut1-MR">Figure 34</a>).</p>
</li>
</ol>
</div>
<div id="fig-final-specification" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-final-specification.png" alt="fig final specification">
</div>
<div class="title">Figure 33. The specification graph for Tutorial 1.</div>
</div>
<div id="fig-tut1-MR" class="imageblock text-center">
<div class="content">
<img src="../source/tutorial1IMG/fig-tut1-MR.png" alt="fig tut1 MR">
</div>
<div class="title">Figure 34. The appearence of <em>ModelRunner</em> while running Tutorial 1.</div>
</div>
<div class="paragraph">
<p>You can now generate documentation for this model from <em>ModelRunner</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>From <em>ModelRunner</em> select 'About &#8594; Create documentation' from the main menu.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates  an ODD template (Overview, Design concepts and Details) (<code>Tut1.odt</code>, <a href="#fig-ODD1">Figure 35</a>), an established standard for documenting simulation
models. This file can be generated any time from <em>ModelRunner</em>. When you&#8217;re satisfied with the specification, edit this file as
a basis for the complete documenting of the model.  The file can be found in the Tut1 project directory <a href="#fig-dir-post-run">Figure 36</a>:</p>
</div>
<div class="paragraph">
<p><code>~/.3w/project_Tut1_2021-05-07-01-36-13-257/local/runTime/Tut1.odt</code>.</p>
</div>
<div class="paragraph">
<p>Most word processors can read this standard format, native to LibreOffice, including Microsoft Word.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every time this file is created, it will have a number added to its name to prevent overwrites.
</td>
</tr>
</table>
</div>
<div id="fig-ODD1" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-ODD1.png" alt="fig ODD1" width="850">
</div>
<div class="title">Figure 35. A section of the automatically generated documention for Tutorial 1. The text in italics is a quote from <a href="#Grimm2010">Grimm et al. (2010)</a> supplementary material ODD template file with suggestions as to how to write this section of the documentation. This quote is replaced by the <code>precis</code> property of the root node for convenience.</div>
</div>
<div id="fig-dir-post-run" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-dir-post-run.png" alt="fig dir post run" width="313">
</div>
<div class="title">Figure 36. The directory structure after deploying <br/><em>ModelRunner</em> and creating the ODD <br/> documentation.</div>
</div>
<div class="paragraph">
<p>Once the specification has been compiled without errors and deployed and the documentation generated, a number of files will have been created <a href="#fig-dir-post-run">Figure 36</a>:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>local/java/code/</code>: This directory contains the generated Java code. The entire model is contained within the <code>Tut1.java</code> class.</p>
</li>
<li>
<p><code>Tut1.jar</code>: A stand-alone jar of the model that can be run independently of <em>ModelMaker</em> (<a href="#truesimulation-reference-running-a-simulation-experiment-with-modelrunner">Section 4</a>).</p>
</li>
<li>
<p><code>runTime/MR.xml</code>: A preferences file for <em>ModelRunner</em>. These settings are saved whenever <em>ModelRunner</em> quits so it will have the same appearance between successive uses.</p>
</li>
<li>
<p><code>runTime/Tut1.odt</code>: This is the documentation file generated in the previous steps.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truegraph-layouts"><a class="anchor" href="#truegraph-layouts"></a>5.1.5. Graph layouts</h4>
<div class="paragraph">
<p>An aspect of <em>ModelMaker</em> we have only touched on so far, is the graph layout system.</p>
</div>
<div class="paragraph">
<p>While using a graph to construct model specifications has many advantages, you can quickly become lost in a confusion of nodes and edges.
The advantage in presenting the specification as a graph is that the huge number of options possible can be constrained by context.
For example, to have a dynamic <code>process</code>, it makes sense that it&#8217;s associated with a particular <code>timer</code>, that other processes working at
the same rate are associated with the same <code>timer</code> and that all timers are coordinated by the one <code>timeline</code>. The user interface for
problems such as this would be very error-prone if presented say, as a series of dialog boxes.</p>
</div>
<div class="paragraph">
<p><em>ModelMaker</em> has a number of features to help arrange the graph display. Please refer to <a href="#truegraph-display">Section 3.2.2</a>.</p>
</div>
<div class="paragraph">
<p>As an exercise if you wish, try displaying just the nodes with <em>cross-links</em> using the SpringGraph layout (<strong>L4</strong>) (<a href="#fig-links-only">Figure 37</a>). This is a common way to
look at just the <em>cross-link</em> relationships between nodes. Generally, adding a screen capture of this and a second screen capture of
just the relevant <em>parent-child</em> relationships make useful additions to the ODD appendix.</p>
</div>
<div id="fig-links-only" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial1IMG/fig-links-only.png" alt="fig links only">
</div>
<div class="title">Figure 37. A view of the specification graph for Tutorial 1 showing only relevant <em>cross-links</em> using the Spring layout (<strong>L4</strong>).</div>
</div>
<div class="paragraph">
<p>That&#8217;s the end of this tutorial. Recreate this project at any time from the main menu (<code>Project &#8594; New &#8594; Tutorials &#8594; 1 Logistic</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="truenext"><a class="anchor" href="#truenext"></a>5.1.6. Next</h4>
<div class="paragraph">
<p>The next tutorial (Tutorial 2) will demonstrate linking this project to an IDE and adding some Java program code.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truetutorial-2-linking-a-3worlds-project-to-a-integrated-development-environment-ide"><a class="anchor" href="#truetutorial-2-linking-a-3worlds-project-to-a-integrated-development-environment-ide"></a>5.2. Tutorial 2: Linking a <em>3Worlds</em> project to a Integrated Development Environment (IDE)</h3>
<div class="sect3">
<h4 id="trueintroduction-2"><a class="anchor" href="#trueintroduction-2"></a>5.2.1. Introduction</h4>
<div class="paragraph">
<p>The previous tutorial used code snippets to insert Java code into the model specifications. In this tutorial we show how to use an Integrated Development Environment (IDE) to achieve the same end. Generally, the only way to develop any but the simplest of models is to code in a professional IDE such as <a href="https://www.eclipse.org/downloads/"><em>Eclipse</em></a>, <a href="https://www.jetbrains.com/idea/"><em>Intellij</em></a> or <a href="https://netbeans.apache.org/"><em>NetBeans</em></a>. At the time of writing, linking specifications to a Java project has only be tested with the <em>Eclipse</em> IDE.</p>
</div>
</div>
<div class="sect3">
<h4 id="truenew-java-project"><a class="anchor" href="#truenew-java-project"></a>5.2.2. New Java project</h4>
<div class="paragraph">
<p>First create a Java project in <em>Eclipse</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <em>Eclipse</em>, create an new Java project and name it <code>tut2</code> (first letter lower case).</p>
</li>
<li>
<p>Right-click on the new project and select  <code>properties &#8594; Java Build Path</code>.</p>
</li>
<li>
<p>Under the <code>Libraries</code> tab, highlight <code>Classpath</code> and  click the <code>Add External JARs&#8230;&#8203;</code> button to the right.</p>
</li>
<li>
<p>Navigate to the .3w directory and select <code>tw-dep.jar</code>.</p>
</li>
<li>
<p>Click <code>Apply and close</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This installs the <em>3Worlds</em> dependencies for this java project.</p>
</div>
</div>
<div class="sect3">
<h4 id="truespecifications"><a class="anchor" href="#truespecifications"></a>5.2.3. Specifications</h4>
<div class="paragraph">
<p>Now create a <em>3Worlds</em> project using tutorial 1 as a starting point.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From <em>ModelMaker</em> main menu select <code>New &#8594; Tutorials &#8594; 1 Logistic</code> name it <code>Tut2</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next link this project to the Java project created above.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>From the <em>ModelMaker</em> main menu, select <code>Edit &#8594; Java project &#8594; Connect&#8230;&#8203;</code>.</p>
</li>
<li>
<p>Navigate to your <em>Eclipse</em> workspace and select <code>tut2</code>.</p>
</li>
<li>
<p>In the <em>Eclipse</em> Project Explorer view, right-click on <code>tut2</code> and select <code>Refresh</code>.</p>
</li>
<li>
<p>In the <em>Eclipse</em> main menu, select <code>Project - &gt; clean</code>, flag <code>tut2</code> and click <code>OK</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While editing in <em>Eclipse</em>, a task message may appear in <em>ModelMaker</em> from time to time complaining about file dates. If so, make sure your Java files are saved, refreshed and the project clean. The message will disappear when the project is re-complied in <em>ModelMaker</em> using the <em>Verify</em> button in the bottom left-hand corner.</p>
</div>
</div>
<div class="sect3">
<h4 id="truewriting-java-code"><a class="anchor" href="#truewriting-java-code"></a>5.2.4. Writing Java code</h4>
<div id="fig-tut2-java-project" class="imageblock right text-center thumb">
<div class="content">
<img src="../source/tutorial2IMG/fig-tut2-java-project.png" alt="fig tut2 java project">
</div>
<div class="title">Figure 38. The package structure in Eclipse after <br/> linking Tutorial 2 to a Java project.</div>
</div>
<div class="paragraph">
<p>In the <code>src</code> folder of <code>tut2</code>, you&#8217;ll now find a new package called <code>code.sys1</code> and <code>code.sys1.generated</code> (<a href="#fig-tut2-java-project">Figure 38</a>). These have been generated by <em>ModelMaker</em> upon linking. In the <code>code.sys1</code> package is a Java file with the same name as the 3Worlds project: <code>Tut2.java</code>. This single class is where you add all your code. The other classes in the <code>generated</code> package are not intended to be edited. If you do edit these, your edits will be overwritten whenever the specifications are edited in <em>ModelMaker</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open <code>Tut2.java</code> in the <em>Eclipse</em> editor.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Near the bottom of the file are two methods (<a href="#fig-tut2-src">Figure 39</a>): <code>chaos</code> and <code>init1</code>, mapped from the names of the function and initFunction nodes we created in <code>Tut2</code> with <em>ModelMaker</em>. Within the body of these methods are a pair of insertion markers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Code insert Begin-- &gt;</code>; and</p>
</li>
<li>
<p><code>Code insert End---- &lt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code snippet property that was present in the original <code>Logistic</code> model this tutorial derives from has already been add for both the <code>chaos</code> and <code>init</code> methods.</p>
</div>
<div class="paragraph">
<p><code>chaos</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs"> 	focalDrv.x = r*x*(1-x);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>init1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">	focalDrv.x = 0.001;
	focalCnt.r = 3.7;</code></pre>
</div>
</div>
<div id="fig-tut2-src" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial2IMG/fig-tut2-src.png" alt="fig tut2 src">
</div>
<div class="title">Figure 39. The main source code file ('Tut2.java').</div>
</div>
<div class="paragraph">
<p>You can also create other Java classes or import third-party libraries to extend you model code. This will be discussed in later tutorials.
There are two "import" markers at the top of the main source code file. Add any dependencies to third-party or other java classes you use.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When editing the main java source code file, any imports your IDE might make automatically will not appear between the import markers.
Take care to edit these statements to they do appear between the import statements. These imports are in fact a code snippet property found in the specification root node.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because these two methods are mapped to this generated file from the specifications created in <em>ModelMaker</em>, it follows that changes to the specifications may result in changes to these methods. So the question arises, how does <em>ModelMaker</em> manage this without losing the Java code you write?</p>
</div>
<div class="paragraph">
<p>If there have been changes to the number, name or type of <code>function</code> used in the specification, changes to anything in the <code>dataDefinition</code> sub-tree, or changes to the <em>roles</em> of <code>components</code>, <em>ModelMaker</em> will back up your old file as a text file with a unique name (e.g <code>_Tut2_1.txt</code>,<code>_Tut2_2.txt</code> etc&#8230;&#8203;) within the current java package. This way you can copy and paste you code back to the proper place. Otherwise <em>ModelMaker</em> will never overwrite this file.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When working simultaneously with an IDE and  <em>ModelMaker</em>, it is useful to keep the code snippets in <em>ModelMaker</em> up-to-date by re-importing them from time to time [ctrl+I]. If changes made in the specifications by <em>ModelMaker</em> result in a new file being created, code snippets will be carried over to the new file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <em>ModelMaker</em> searches for differences between previous and current versions of this Java file, it will ignore any comments and the code you have added between the insertion markers. Therefore, although you can do as you please with the generated comments, you should take care not to alter the text of the markers themselves.</p>
</div>
<div class="paragraph">
<p>If the task list is empty, you can now execute the specification by deploying them from <em>ModelMaker</em>.</p>
</div>
<div class="paragraph">
<p>Running the simulation directly from <em>ModelMaker</em> is a convenient way to speed up the turn-around time in developing and testing specifications. Once the specifications are stable, you can run your model from a jar: the jar file that is created in your project directory in this case <code>Tut2.jar</code>. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Open a terminal, change to your project directory and enter the following text: <code>java -jar Tut2.jar</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally we discuss how to debug your equations by running your model from the IDE.</p>
</div>
<div class="sect4">
<h5 id="truedebugging-your-code"><a class="anchor" href="#truedebugging-your-code"></a>Debugging your code</h5>
<div class="paragraph">
<p>Once the simulator specification is valid (i.e no tasks in the task list) you can quit <em>ModelMaker</em> and debug your code from the IDE.</p>
</div>
<div class="paragraph">
<p>In the default package of the linked java project (<code>tut2</code>) is a java file called <code>UserCodeRunner.java</code>. This was created the first time you linked the project made with <em>ModelMaker</em> to the Java project. By placing breakpoints in the methods you added to <code>Tut2.java</code> above, you can debug by running from this <code>main</code> class. The correct command-line arguments have already been provided.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truenext-2"><a class="anchor" href="#truenext-2"></a>5.2.5. Next</h4>
<div class="paragraph">
<p>The next tutorial will introduce the use of tables and some additional output <code>widgets</code> to add to the simulator&#8217;s user interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truetutorial-3-using-tables"><a class="anchor" href="#truetutorial-3-using-tables"></a>5.3. Tutorial 3: Using tables</h3>
<div class="sect3">
<h4 id="trueintroduction-3"><a class="anchor" href="#trueintroduction-3"></a>5.3.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial introduces the use of tables in <em>ModelMaker</em> by implementing a multi-species <a href="https://en.wikipedia.org/wiki/Competitive_Lotka%E2%80%93Volterra_equations">competitive Lotka-Volterra equation</a> (CLV).</p>
</div>
<div class="paragraph">
<p>The equation has three <em>constants</em> and one <em>driver</em>; all of which are tables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>constants:</p>
<div class="ulist">
<ul>
<li>
<p><em>K</em>: carrying capacity;</p>
</li>
<li>
<p><em>r</em>: growth rate;</p>
</li>
<li>
<p><em>alpha</em>: inter-specific competition coefficient;</p>
</li>
</ul>
</div>
</li>
<li>
<p>driver:</p>
<div class="ulist">
<ul>
<li>
<p><em>x</em>: population size.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="truespecifications-2"><a class="anchor" href="#truespecifications-2"></a>5.3.2. Specifications</h4>
<div class="paragraph">
<p>Apart from the use of tables and a more elaborate model equation, these specifications are very similar to those of Tutorial 1. <em>ModelMaker</em> provides a library of model templates for common model patterns such this. One of these, the <code>SimpleClock</code> template, has already defined a basic structure, dynamics and a minimal user interface (<a href="#fig-simple-clock-template">[fig-simple-clock-template]</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> and create a new: <code>Projects &#8594; New &#8594; Templates &#8594; 2 SimpleClock</code> and name the project 'Tut3'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="truedata-definition-2"><a class="anchor" href="#truedata-definition-2"></a>Data definition</h5>
<div id="fig-records-tables" class="imageblock right text-center thumb">
<div class="content">
<img src="../source/tutorial3IMG/fig-records-tables.svg" alt="fig records tables" width="400">
</div>
<div class="title">Figure 40. Data is defined through the recursive use of <br/> records and tables. A definition begins with a record. <br/> Leaf nodes of the resulting graph must be either Fields <br/> or Tables that define a standard Java type (element) <br/> such as Double, Integer etc.</div>
</div>
<div class="paragraph">
<p>Data is defined through the recursive use of records and tables: records can contain tables and tables can contain records without limit. Records can also contain fields of any primitive Java type. Tables can also contain Java primitive types as well as user-defined records (<a href="#fig-records-tables">Figure 40</a>). Tables can have any number of dimensions.</p>
</div>
<div class="paragraph">
<p>There is usually more than one way of defining the data for any model. For the CLV, we will use a 2-dimensional table for <em>alpha</em>, a 1-dimensional table for  <em>r</em> and <em>K</em> and another 1-dimensional table for the population <em>x</em> (<a href="#fig-data-definition">Figure 41</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Collapse all sub-trees from the root node and then expand <code>dataDefinition:dDef</code>.</p>
</li>
<li>
<p>Create a <code>table</code> as a child of <code>record:cnsts</code>, name it 'alpha', choose <code>dataElementType</code> and then set its type to <code>Double</code> (the default).</p>
</li>
<li>
<p>Create a second <code>table</code> as child of <code>record:cnsts</code>, name it 'r' and choose <code>dataElementType</code> and then set its type to <code>Double</code>.</p>
</li>
<li>
<p>Create a third <code>table</code> as child of <code>record:cnsts</code>, name it 'K' and choose <code>dataElementType</code> and then set its type to <code>Double</code>.</p>
</li>
<li>
<p>Create a  <code>table</code> as child of <code>record:drvs</code>, name it 'x', choose <code>dataElementType</code> and set its type to <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To complete the definition, we must set the table dimensions and indexing order for the 2-dim table 'alpha'.</p>
</div>
<div class="paragraph">
<p>Only one dimensioner is needed: the number of species. This is done by creating a single <code>dimensioner</code> node to be associated with all these tables.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Create a <code>dimensioner</code> as a child of <code>dataDefinition:dtDef</code> and name it 'nspp' (number of species).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A new task appears in the task list saying the 'size' property must be greater than zero.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Click on <code>dimensioner:nspp</code> and go to the <code>Selected properties</code> tab. Set a value of <code>npp#size</code> to 4 (four species).</p>
</li>
<li>
<p>Right-click on each table node in turn and select <code>New edge &#8594; dimensioner:nspp</code>. Repeat this for <code>table:alpha</code> to get the second dimension.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now set the rank order for the indexing of <code>table:alpha</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Click on <code>table:alpha</code> and examine its properties in the <code>Selected properties</code> editor.</p>
</li>
<li>
<p>Set the value of one of its rank properties to 1 - it doesn&#8217;t matter which.</p>
</li>
</ol>
</div>
<div id="fig-data-definition" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial3IMG/fig-data-definition.png" alt="fig data definition">
</div>
<div class="title">Figure 41. The <code>dataDefinition</code> specifications for Tutorial 3: three tables of one dimension and one of two dimensions ('alpha'). This size of each table is the same so only one <code>dimensioner</code> is required.</div>
</div>
<div id="fig-description-property-option" class="imageblock right text-center">
<div class="content">
<img src="../source/tutorial3IMG/fig-description-property-option.png" alt="fig description property option">
</div>
<div class="title">Figure 42. Adding a <code>description</code> <br/> property to the table 'K'.</div>
</div>
<div class="paragraph">
<p>Finally, add some meta-data to each table. This meta-data assists in documenting your Java source code and ODD documentation. Many nodes have optional properties. One such optional property is <code>description</code> for tables and fields.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Right-click on each of the table nodes and select 'Optional properties' and flag the 'Description` property (<a href="#fig-description-property-option">Figure 42</a>).</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truestructure-2"><a class="anchor" href="#truestructure-2"></a>Structure</h5>
<div class="paragraph">
<p>The <em>SimpleClock1</em> template has already defined the role of <code>system.sys</code> as <em>permanent</em>, <em>atomic</em> and belonging to the <em>arena</em> - the definition of a non-hierarachical model. There is nothing additional needed for this section.</p>
</div>
</div>
<div class="sect4">
<h5 id="truedynamics-2"><a class="anchor" href="#truedynamics-2"></a>Dynamics</h5>
<div class="paragraph">
<p>Although the task list is now empty (i.e. the specifications are now deployable), we have yet to write the model equation and provide some output. We can now rename the function provided by the template to something meaningful in the present context and add a data tracker to follow <em>x</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand the <code>system.sys1</code> sub-tree from the root node and re-apply the layout [Alt+L].</p>
</li>
<li>
<p>Right-click on <code>Function:F1</code>, select <code>Rename node</code> and name it 'Growth'. If the prompt is unresponsive, remember to begin the name with an upper case letter.</p>
</li>
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p1</code> and select <code>DataTrackerD0</code> as the type (the default).</p>
</li>
<li>
<p>Create an edge from the data tracker to <em>x</em>: <code>trackTable &#8594; table:x</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are now two tasks in the list, one about 'indexing' and the other asking which 'component' to track. As with the previous tutorials, the component to track is the <code>system.sys1</code> node.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create the edge <code>trackComponent &#8594; system:sys1</code> from the data tracker node.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As we are using a scalar data tracker (<code>DataTrackerD0</code>) to follow a table, we can specify which elements of the table to track. If we want to track all elements of the table, we need do nothing as a blank entry for the <code>trks#index</code> property assumes this. Indexing is a property of the edge between data tracker and the table. Edge properties appear in the property list of nodes that are at the start of the edge (thin line) - in this case <code>dataTracker:trk1</code>.</p>
</div>
<div class="paragraph">
<p>This indexing will provide four data outputs. Indexing statements can select any number of contiguous or discontiguous table elements. The <a href="#data-tracking">syntax</a> is similar to that found in the <a href="https://www.r-project.org/"><strong>R</strong> statisical software</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="trueuser-interface"><a class="anchor" href="#trueuser-interface"></a>User interface</h5>
<div class="paragraph">
<p>We can now add some additional widgets to the user interface as the template provided only a controller.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hide all nodes and expand the <code>userInterface:gui</code> node.</p>
</li>
<li>
<p>Add a <code>tab</code> as a child of <code>userInterface:gui</code>.</p>
</li>
<li>
<p>Add a <code>widget</code> as a child of <code>tab:tab1</code>, name it 'srsx' and select <code>TimeseriesWidget1</code> as the widget class.</p>
</li>
<li>
<p>Add a second <code>widget</code> as a child of <code>tab:tab1</code>, name it 'tblx' and select <code>TableWidget1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both these widgets are compatible with this data tracker class: the <code>TimeseriesWidget1</code> produces a chart while the <code>TableWidget1</code> displays the data as a continuously updated table. The task list requires these widgets to be connected to a data tracker.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Right-click on each of these widgets in turn and select <code>New edge &#8594; trackSeries &#8594; dataTracker:trks</code>.</p>
</li>
<li>
<p>Set the property <code>tblx#order</code> to '1' to arrange their positions in <em>ModelRunner</em> as srsx on the left (<code>order</code> = 0) and tblx to the right (<code>order</code>=1).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Save the specifications (<code>Ctrl+s</code>) and they&#8217;re now ready to run (<a href="#fig-tree">Figure 43</a>, <a href="#fig-links">Figure 44</a>). The next step is to create a Java project to write the 'Growth' and 'Init1' functions, the latter having been provided by the <code>SimpleClock</code> template we started this tutorial with.</p>
</div>
<div id="fig-tree" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial3IMG/fig-tree.png" alt="fig tree">
</div>
<div class="title">Figure 43. Tree graph of the final specifiation graph for Tutorial 3.</div>
</div>
<div id="fig-links" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial3IMG/fig-links.png" alt="fig links">
</div>
<div class="title">Figure 44. Cross-links of the final specifiation graph for Tutorial 3.</div>
</div>
</div>
<div class="sect4">
<h5 id="truelink-to-a-java-project"><a class="anchor" href="#truelink-to-a-java-project"></a>Link to a Java project</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in Tutorial 2 to create a Java project with <em>Eclipse</em> and name it 'tut3'.</p>
</li>
<li>
<p>Link it to this <em>ModelMaker</em> project.</p>
</li>
<li>
<p>Open <code>Tut3.java</code> in the <em>Eclipse</em> editor and enter the following source code between the relevant insertion markers:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">for (int i = 0; i &lt; r.size(0); i++) {
    focalCnt.r.setByInt(random.nextDouble() * 2.0, i);
	focalCnt.K.setByInt(0.2 + random.nextDouble(), i);
	for (int j = 0; j &lt; alpha.size(1); j++) {
	    if (i == j)
		    focalCnt.alpha.setByInt(1.0, i, j);
		else
		    focalCnt.alpha.setByInt(random.nextDouble(), i, j);
	}
}
for (int i = 0;i&lt;x.size(0); i++)
    focalDrv.x.setByInt(0.2, i);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method simply initialises the equation constants: growth rate (<em>r</em>), carrying capacity (<em>K</em>) and the interspecific competition coefficient (<em>alpha</em>) to random values and the population size (<em>x</em>) to 0.2. Notice that the generated code includes a detailed javadoc that reminds the forgetful user of all the table dimensions, driver and constant units, etc. (<a href="#fig-javaDoc">Figure 45</a>).</p>
</div>
<div class="paragraph">
<p>There is a default random number generator (RNG) available to all functions. In later tutorials we will show how the specifications can factor any number of RNGs into groups. For example, one RNG can be assigned to functions of a particular type such as those effecting reproduction or mortality.</p>
</div>
<div class="paragraph">
<p><em>ModelMaker</em> has two types of RNG classes in addition to the standard Java RNG. These two are faster and produce streams of higher quality than the standard Java RNG. There are also various ways of seeding RNGs to ensure their uniqueness and to help with debugging.</p>
</div>
<div class="paragraph">
<p><code>growth</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">double integrationStep = 0.01;
double[] dxdt = new double[x.size(0)];
for (int i = 0; i &lt; x.size(0); i++) {
    double sum = 0;
	for (int j = 0; j &lt; alpha.size(1); j++)
	    sum += alpha.getByInt(i, j) * x.getByInt(j);
	dxdt[i] = r.getByInt(i) * x.getByInt(i) * (1 - sum / K.getByInt(i));
	}
for (int i = 0; i &lt; dxdt.length; i++)
    focalDrv.x.setByInt(x.getByInt(i) + dxdt[i] * dt * integrationStep, i);</code></pre>
</div>
</div>
<div id="fig-javaDoc" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial3IMG/fig-javaDoc.png" alt="fig javaDoc">
</div>
<div class="title">Figure 45. Example of the generated javaDoc for the <code>growth</code> function of Tutorial 3. The figure assumes correct meta-data has been added to the definitions of <code>K, r, alpha</code> and <code>x</code>.</div>
</div>
<div class="paragraph">
<p>Following a note from 'Tutorial 1', it is a good idea to keep the code snippets in <em>ModelMaker</em> up-to-date with changes in the source code.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>In <em>ModelMaker</em> select <code>Edit &#8594; Import snippets from IDE</code> and save (<code>Ctrl-s</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The model is now ready to run (<a href="#fig-tut3-MR">Figure 46</a>). However, you may want to change the time duration of the simulation from the template default of 100 to 1,000 steps.</p>
</div>
<div id="fig-tut3-MR" class="imageblock text-center">
<div class="content">
<img src="../source/tutorial3IMG/fig-tut3-MR.png" alt="fig tut3 MR">
</div>
<div class="title">Figure 46. <em>ModelRunner</em> executing Tutorial 3. Note that the property <code>tab1#orientation</code> has be set to <code>vertical</code> is this figure. This displays the time series graph above the table.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truenext-3"><a class="anchor" href="#truenext-3"></a>5.3.3. Next</h4>
<div class="paragraph">
<p>The next tutorial elaborates the Lotka-Volterra model by developing the <code>structure</code> sub-tree through the addition of a disturbance component.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truetutorial-4-elaborating-the-model-structure-testing-the-intermediate-disturbance-hypothesis"><a class="anchor" href="#truetutorial-4-elaborating-the-model-structure-testing-the-intermediate-disturbance-hypothesis"></a>5.4. Tutorial 4: Elaborating the model structure: Testing the Intermediate Disturbance Hypothesis</h3>
<div class="sect3">
<h4 id="trueintroduction-4"><a class="anchor" href="#trueintroduction-4"></a>5.4.1. Introduction</h4>
<div class="paragraph">
<p>In this tutorial we add a disturbance to effect a community of species modelled with the competitive Lotka-Volterra equation (CLV) from Tutorial 3. This model could then be used to examine the Intermediate Disturbance Hypothesis (IDH: <a href="#Connell1978">Connell, 1978</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="truespecifications-3"><a class="anchor" href="#truespecifications-3"></a>5.4.2. Specifications</h4>
<div class="paragraph">
<p>Begin this tutorial using the Lotka-Volterra specifications from the <code>Tutorials</code> menu as a starting point.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project from <code>Tutorials &#8594; 2 LotkaVolterra</code> and name it 'Tut4'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As the tutorial title suggests, we will be <em>elaborating</em> the model structure. The Lotka-Volterra model has the simplest of structures: so simple that its <code>System</code> node can be named <code>community</code>. In the model we are developing here, this name would be misleading since we will have not only a 'community' but also a 'disturbance' (i.e. the system node will no longer be 'atomic' but an 'assemblage'). Therefore it will be clearer if we change the name of the system node back to its nondescript default name of <code>sys1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Right-click on <code>system:community</code> and rename 'community' to the default name 'sys1'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="truedata-definition-3"><a class="anchor" href="#truedata-definition-3"></a>Data definition</h5>
<div class="paragraph">
<p>Data can play one of three <em>roles</em> in the <em>3Worlds archetype</em>; as:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><em>constants</em>,</p>
</li>
<li>
<p><em>drivers</em>, or</p>
</li>
<li>
<p><em>decorators</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Thus far we have only made use of data as <em>drivers</em> and <em>constants</em>. The third role, <em>decorators</em>, are values derived in some way from the other two. Importantly, they are re-initialised at the beginning of each time step. We need a species diversity index and this is a good example of a <em>decorator</em> being derived from relative abundance of each species ('x[n]').</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Decorators</em> are re-initialised (zero, false, null etc.) at the start of each time step.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse all nodes except for the <code>dataDefinition</code> sub-tree, hide the <em>cross-links</em> ('<strong>X</strong>'), and re-apply the layout ('<strong>L</strong>').</p>
</li>
<li>
<p>Add a new <code>record</code> as a child of <code>dataDefinition:dDef</code> and name it 'decs'.</p>
</li>
<li>
<p>Add a <code>field</code> as a child of <code>record:decs</code>, name it 'di' (diversity index) of type <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As noted previously, these names are just for clarity: they don&#8217;t impose roles as <em>drivers</em>, <em>constants</em> or <em>decorators</em>. Here, the records are named to indicate their intended roles just for clarity. Their role will later be formally defined by a relationship with a <code>category</code> which we create when building the <code>structure</code> specifications.</p>
</div>
<div class="paragraph">
<p>While building the data definition (<a href="#fig-tut4-data-definition">Figure 47</a>), expect task messages to accumulate until these roles have been defined.</p>
</div>
<div class="paragraph">
<p>We now define some data for the simple disturbance model: frequency and intensity.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Add a new <code>record</code> to <code>dataDefinition:dDef</code> and name it 'distCnsts' (disturbance constants).</p>
</li>
<li>
<p>Add two fields to this record, both of type <code>Double</code> called 'freq' and 'inten' respectively.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The records carried over from the previous tutorial should now be given better names. A trick with the Tree layout functions is that they order children alphabetically. To arrange nodes so that related nodes of a particular role are close together, prefix the name with the same characters - in this case 'dist'. We should also prefix all the data associated with the CLV with 'comm' (community).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tree layout algorithms sort child nodes in alphabetical order. Consider this behaviour when choosing node names.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Rename <code>record:cnsts</code> to <code>record:commCnsts</code>, <code>record:drvs</code> to <code>record:commDrvs</code> and <code>record:decs</code> to <code>record:commDecs</code>.</p>
</li>
<li>
<p>Re-apply the layout and the nodes should now be arranged in a more sensible order.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To display an xy plot of diversity by time since disturbance, we can add a driver to the commDrvs record to record this.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>field</code> of type <code>Double</code> as a child of <code>record:commDrvs</code> and name it 'tsd'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Fill out the meta-data properties with at least the description, range and units if relevant. This information will be incorporated in the comments of the generated Java code (i.e. add the optional property <code>description</code> to the new data nodes: right-click on a node and select 'optional properties').</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Add the following descriptions to the new data definitions properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>freq#description</code>: 'average return time'</p>
</li>
<li>
<p><code>inten#description</code>: '% population decrease'</p>
</li>
<li>
<p><code>di#description</code>: 'Shannon&#8217;s diversity index'</p>
</li>
<li>
<p><code>tsd#description</code>: 'Time since disturbance'</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, change the number of species in the model to a larger value.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Set the value of <code>nspp#size</code> to 40.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For simplicity, we have defined <code>inten</code> as a constant rather than a driver.</p>
</div>
<div id="fig-tut4-data-definition" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial4IMG/fig-tut4-data-definition.png" alt="fig tut4 data definition">
</div>
<div class="title">Figure 47. The data definition sub-tree for Tutorial 4. Tree layout algorithms sort nodes in alphabetical order. Keeping this in mind when naming nodes can help keep your specifications in useful order.</div>
</div>
<div class="paragraph">
<p>That&#8217;s all the data needed for this model. We can now specify the system structure.</p>
</div>
</div>
<div class="sect4">
<h5 id="truestructure-3"><a class="anchor" href="#truestructure-3"></a>Structure</h5>
<div class="paragraph">
<p>Recall from the previous tutorial, that <code>system:sys1</code> is acting as a single component. It&#8217;s <em>role</em> was defined as a permanent, indivisible global component:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><em>permanent</em>;</p>
</li>
<li>
<p><em>atomic</em>;</p>
</li>
<li>
<p>belonging to the <em>arena</em>;</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <em>arena</em> is a special category. One and only one component must belong to this category. Any data associated with it (<em>constants</em>, <em>drivers</em> and <em>decorators</em>) is available to all <code>functions</code>: the data is global. The system (<code>system:sys1</code>) was also being tracked by the data tracker. This relationship was removed above because <em>x</em>, the population being tracked, will now be part of a category related to the community component of the model i.e 'x' will no longer be global data.</p>
</div>
<div class="paragraph">
<p>The <em>role</em> of a <code>component</code> is defined by its <code>componentType</code>. We&#8217;ll need two <code>ComponentTypes</code>; one for the community (the CLV equation) and one for the disturbance. We also need a <code>relationType</code> to define the relationship between the disturbance and the effected community.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on <code>system.sys1</code> and collapse the <code>dynamics:sim</code> sub-tree.</p>
</li>
<li>
<p>Create a <code>structure</code> as child of <code>system:sys1</code>.</p>
</li>
<li>
<p>Create a <code>componentType</code> as a child of <code>structure:struc1</code> and name it 'distType'.</p>
</li>
<li>
<p>Create a <code>component</code> as child of <code>componentType:distType</code> and name it 'dist'.</p>
</li>
<li>
<p>Create a second <code>componentType</code> as child of <code>structure:struc1</code> and name it 'commType'.</p>
</li>
<li>
<p>Create a <code>component</code> as child of <code>componentType:commType</code> and name it 'comm'.</p>
</li>
<li>
<p>Create a <code>relationType</code> as child of <code>structure:struc1</code> and name it 'distEffectComm'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before proceeding to the definition of the <em>roles</em> of these component types, we should redefine the <em>role</em> of <code>system:sys1</code> that we inherited from Tutorial 3 when starting this project.</p>
</div>
<div class="paragraph">
<p>The node <code>system:sys1</code>, in aliasing as a <code>componentType</code>, must now be redefined as an <code>assemblage</code> with no functions or data associated with it - that is, it is no longer <code>atomic</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Right-click on <code>system:sys1</code> and select <code>Delete edge &#8594; belongsTo &#8594; category:*atomic*</code>.</p>
</li>
<li>
<p>Right-click again on <code>system:sys1</code> and select <code>New edge &#8594; belongsTo &#8594; category:*assemblage*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remove the data associated with the <em>arena</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Right-click on the root node (<code>3worlds:Tut4</code>), expand the <code>predefined:*categories*</code> and re-apply the layout.</p>
</li>
<li>
<p>Right-click on <code>category:*arena*</code> and select <code>Delete edge &#8594; drivers &#8594; record:commDrvs</code>.</p>
</li>
<li>
<p>Right-click again on  <code>category:*arena*</code> and select <code>Delete edge &#8594; constants &#8594; record:commCnsts</code>.</p>
</li>
<li>
<p>Right-click on the root node and collapse <code>predefined:*categories*</code> and re-apply the layout [Alt+L].</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The node <code>system:sys</code> is now defined as simply a <em>permanent assemblage</em> belonging to the <em>arena</em>.</p>
</div>
<div class="paragraph">
<p>Now define a <code>categorySet</code> to partition data between the disturbance and community. Category Sets contain mutually exclusive categories: something can belong to one or the other but not both. Since disturbance and community is all there is in this model, this is the 'world' of the model so this seems a reasonable name for this set of categories i.e the 'world' comprises a community and a disturbance category: something can belong to one or other of these but not both.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Create a <code>categorySet</code> as child of <code>structure:struc1</code> and name it 'world'.</p>
</li>
<li>
<p>Create a <code>category</code> as child of <code>categorySet:world</code> and name it 'distCat'.</p>
</li>
<li>
<p>Create another <code>category</code> as child of <code>categorySet:world</code> and name it 'commCat'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Define the data for these new categories.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Right-click on <code>category:commCat</code> and create the following edges:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>drivers &#8594; record:commDrvs</code>.</p>
</li>
<li>
<p><code>constants &#8594; record:commCnsts</code>.</p>
</li>
<li>
<p><code>decorators &#8594; record:commDecs</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Right-click on <code>category:commDist</code> and select <code>New edge &#8594; constants &#8594; record:distCnsts</code>.</p>
</li>
<li>
<p>Expand the <code>dataDefinition:dDef</code> sub-tree, toggle the <em>cross-links</em> to confirm you have done the links as above.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now define the <em>roles</em> of the new component types for the community and disturbance. Both belong to the <em>permanent</em>, <em>atomic</em>, and <em>component</em> categories.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Right-click on <code>componentType:commType</code> and create <code>belongsTo</code> edges to:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>category:*permanent*</code>,</p>
</li>
<li>
<p><code>category:*atomic*</code>,</p>
</li>
<li>
<p><code>category:*component*</code> and</p>
</li>
<li>
<p><code>category:commCat</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Right-click on <code>componentType:distType</code> and create <code>belongsTo</code> edges to:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>category:*permanent*</code>,</p>
</li>
<li>
<p><code>category:*atomic*</code>,</p>
</li>
<li>
<p><code>category:*component*</code> and</p>
</li>
<li>
<p><code>category:distCat</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now define the relation between disturbance and the community.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Right-click on <code>relationType:distEffectComm</code> and create edges:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>fromCategory &#8594; distCat</code>.</p>
</li>
<li>
<p><code>toCategory &#8594; commCat</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, add initialisation functions for the disturbance and community component types:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>Create an <code>initFunction</code> as child of <code>componentType:commType</code> and name it 'InitComm'.</p>
</li>
<li>
<p>Create an <code>initFunction</code> as child of <code>componentType:distType</code> and name it 'InitDist'.</p>
</li>
</ol>
</div>
<div id="fig-tut4-structure" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial4IMG/fig-tut4-structure.png" alt="fig tut4 structure" width="800">
</div>
<div class="title">Figure 48. The structure sub-tree for Tutorial 4. .</div>
</div>
<div class="paragraph">
<p>That&#8217;s all that is required in this section. To finish up, we now need to connect various sub-trees of the graph to each other. Foremost among these is to associate processes with the new structure (<a href="#fig-tut4-structure">Figure 48</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="truedynamics-3"><a class="anchor" href="#truedynamics-3"></a>Dynamics</h5>
<div class="paragraph">
<p>In this section we add two additional functions: one to initiate a disturbance and a second to apply the disturbance to the community.</p>
</div>
<div class="paragraph">
<p>Before proceeding, some explanations are required to make sense of the following steps. Ignoring <code>dataTrackers</code> for the moment, a <code>process</code> can have one or more <code>functions</code>. However, the relationships (<em>cross_links</em>) between the model&#8217;s dynamics, data and structure are defined at the level of <code>processes</code> not <code>functions</code>. If we don&#8217;t care what order the functions are called in, and they all apply to the same data and structural elements, then we need only one process to contain all the functions. However, this is not the case here. The three functions: community growth, disturbance occurrence, and disturbance effects, must have access to different data, components and component relationships. Specifically, whether or not a disturbance is to occur depends only on disturbance data (in this model). Also order is important: it must come before disturbance effects are applied to the community. The disturbance effects applies to a relationship: that of the disturbance and the community. The growth of the community only depends on community data (the Lotka-Volterra equation). In addition, we make the decision (in this model) that the disturbance can only occur after the growth of the community, mimicking a late growing season disturbance.</p>
</div>
<div class="paragraph">
<p>For clarity, we will prefix the names of <code>processes</code> in such a way that the layout algorithm will place them in execution order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse the <code>dataDefinition</code> sub-tree and expand <code>system:sys1</code>.</p>
</li>
<li>
<p>Create a <code>process</code> as child of <code>timer:clock1</code> and name it 'p1DistOcc`.</p>
</li>
<li>
<p>Create a <code>function</code> as child of <code>process:p1DistOcc</code> and name it 'DistOcc' and set its type as <code>RelateToDecision</code>.</p>
</li>
<li>
<p>Create a second <code>process</code> as child of <code>timer:clock1</code> and name it 'p3DistEffectComm'.</p>
</li>
<li>
<p>Create a <code>function</code> as child of <code>process:p3DistEffectComm</code>, name it 'DistEffectComm' and set its type to <code>ChangeOtherState</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The name the growth process and function should now be changed to something more appropriate:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Rename <code>process:p1</code> to <code>process:p2CommGrowth</code>.</p>
</li>
<li>
<p>Rename <code>function:Growth</code> to <code>function:CommGrowth</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The function <code>function:CommGrowth</code> will perform the same task as it did in the previous tutorial: calculate the next state of <em>x</em> from its current state. At the same time we can calculate the diversity index and increment a counter to record the time since the last disturbance.</p>
</div>
<div class="paragraph">
<p>The function <code>function:DistOcc</code>, a <code>RelateToDecision</code> function, will decide if a disturbance is to occur. If it returns <em>true</em>, a relation will be formed between the, yet to be specified, disturbance and community categories.</p>
</div>
<div class="paragraph">
<p>If a disturbance occurs, <code>function:DistEffectComm</code> will implement the consequences of the disturbance on the community <strong>but at the next time step</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All methods read data at the current time step and write data of the next time step. That is, always be mindful that <em>x[t+1] &#8592; f(x[t])</em>. In code, <em>x[t+1]</em> is <code>focalDrv.x</code> and <em>x[t]</em> is just <em>x</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a reminder of this ordering, we have prefixed the process that creates the temporary (ephemeral) relation between disturbance and the community with 'p1' so that the layout (if using a <em>Tree</em> layout) will display processes in a sensible order.</p>
</div>
<div class="paragraph">
<p>First, show the <em>cross-links</em> and set <code>process:p2DistEffectComm</code> to depend on <code>process:p1DistOcc</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Show the <em>cross-links</em> (<strong>X</strong>).</p>
</li>
<li>
<p>Right-click on <code>process:p2DistEffectComm</code> and select <code>New edge &#8594; dependsOn &#8594; process:p1DistOcc</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To force the disturbance effects to take place <em>after</em> the community growth (i.e. a late growing season disturbance), make <code>process:p2DistEffectComm</code> depend on <code>p2CommGrowth</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Right-click on <code>process:p3DistEffectComm</code> and select <code>New edge &#8594; dependsOn &#8594; process:p2CommGrowth</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After re-applying the layout (assuming a Tree layout is in use), it&#8217;s clear why these process names were prefixed by p1, p2 and p3.</p>
</div>
<div class="paragraph">
<p>At this time, <code>dataTracker:trk1</code> is set to track the component <code>system.sys1</code>. There will be no global data to track in this model as there was in the previous Lotki-Volterra so we should remove this edge.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Right-click on <code>dataTracker:trk</code> and select <code>Delete edge &#8594; trackComponent &#8594;system.sys1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, because there will be no global data in this model, <code>system:sys</code> will not need an initialisation function. Therefore we can delete this node.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Right-click on <code>initFunction:Init1</code> and select 'Delete node'.</p>
</li>
</ol>
</div>
<div id="fig-tut4-dynamics" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial4IMG/fig-tut4-dynamics.png" alt="fig tut4 dynamics">
</div>
<div class="title">Figure 49. The system dynamics sub-tree for Tutorial 4. .</div>
</div>
<div class="paragraph">
<p>That&#8217;s all that&#8217;s required in this section (<a href="#fig-tut4-dynamics">Figure 49</a>). The task list indicates that the new processes must belong to some categories. To do that we need to move on to the structure of the specifications.</p>
</div>
</div>
<div class="sect4">
<h5 id="truerelations-between-sub-trees"><a class="anchor" href="#truerelations-between-sub-trees"></a>Relations between sub-trees</h5>
<div class="paragraph">
<p>Currently, <code>process:p3CommGrowth</code> is applied to <code>category:*arena*</code>. We want re-apply this process to <code>category:commCat</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand <code>dynamics:sim1</code> from <code>system:sys1</code>.</p>
</li>
<li>
<p>Expand <code>predefined:*categories*</code> from the root node and re-apply the layout.</p>
</li>
<li>
<p>Show <em>cross-links</em> (<strong>X</strong>).</p>
</li>
<li>
<p>Delete the <code>appliesTo</code> edge between <code>process:p3CommGrowth</code> and <code>category:*arena*</code> and re-apply it by creating an <code>appliesTo</code> edge to <code>category:commCat</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The task list now has two tasks asking to connect both disturbance processes to either a <code>category</code> or a <code>relationType</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create <code>appliesTo</code> edges from both <code>process:p2DistEffects</code> and <code>process:p1DistOccurrence</code> to <code>relationType:distEffectComm</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note here that we expect this relation between the disturbance and the community to be reset every time step depending on whether or not <code>DistOccur</code> is true. That is, the relationship is ephemeral. This is achieved by setting the <code>lifespan</code> property of the <code>relationType:distEffectComm</code> to <code>ephemeral</code> (the default is <code>permanent</code>).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Change the property <code>distEffectComm#lifespan</code> to <code>ephemeral</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The simulation can now be run but, of course, we have yet to add code to the various functions. Here, we&#8217;ll just add code snippets but if you prefer, you can create a java project and add the code there instead (<a href="#truetutorial-2-linking-a-3worlds-project-to-a-integrated-development-environment-ide">Section 5.2</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="truejava-code"><a class="anchor" href="#truejava-code"></a>Java code</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy and paste the code below to all the relevant <code>functionSnippet</code> properties. A convenient way to do this is to enter "func" into the search field in the <em>All properties</em> property editor and edit each in turn. Note: click the 'By Name' button at the top-left of the editor, otherwise the search function will only show properties containing 'func' within a property category. If you received compile error messages, check that you have pasted into the property of the correct function:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>function:InitComm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">double initFreq = 1.0 / x.size();
focalDrv.x.fillWith(initFreq);
for (int i = 0; i &lt; r.size(0); i++) {
	focalCnt.r.setByInt(random.nextDouble(), i);
	focalCnt.K.setByInt(5.0 + initFreq + random.nextDouble(), i);
	for (int j = 0; j &lt; alpha.size(1); j++) {
		if (i == j)
			focalCnt.alpha.setByInt(1.0, i, j);
		else
			focalCnt.alpha.setByInt(max(0.0001, random.nextDouble()), i, j);
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:InitDist</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">focalCnt.freq = 5 + random.nextInt(50);
focalCnt.inten = random.nextDouble()*100;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:CommGrowth</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">// growth
double[] dxdt = new double[x.size(0)];
for (int i = 0; i &lt; x.size(0); i++) {
	double sum = 0;
	for (int j = 0; j &lt; alpha.size(1); j++)
		sum += alpha.getByInt(i, j) * x.getByInt(j);
	dxdt[i] = r.getByInt(i) * x.getByInt(i) * (1 - sum / K.getByInt(i));
}
for (int i = 0; i &lt; dxdt.length; i++)
	focalDrv.x.setByInt(Math.max(x.getByInt(i) + dxdt[i] * dt, 0.0), i);

// compute diversity
double xtot = 0.0;
for (int i = 0; i &lt; focalDrv.x.size(0); i++)
	xtot += focalDrv.x.getByInt(i);

focalDec.di=0.0;
for (int i = 0; i &lt; focalDrv.x.size(0); i++)
	if (focalDrv.x.getByInt(i) &gt; 0.0)
		focalDec.di -= (focalDrv.x.getByInt(i) / xtot) * log(focalDrv.x.getByInt(i) / xtot);

// increment 'time since disturbance'
// use focalDrv.tsd not tsd as the order of calling of this method and DistEffectsComm could be altered
focalDrv.tsd = focalDrv.tsd +1;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:DistOcc</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">if (random.nextDouble() &lt; 1.0 / freq)
	return true;
else
    return false;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>function:DistEffectsComm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">for (int i = 0; i &lt; other_x.size(); i++)
    if (other_x.getByInt(i) &gt; other_K.getByInt(i) * inten / 100000.0) {
	    otherDrv.x.setByInt(otherDrv.x.getByInt(i) * other_K.getByInt(i) * inten / 100000.0, i);
		// reset time since disturbance
		otherDrv.tsd = 0;
	}
// compute diversity
double xtot = 0.0;
for (int i = 0; i &lt; other_x.size(0); i++)
    xtot += other_x.getByInt(i);
otherDec.di = 0.0;
    for (int i = 0; i &lt; other_x.size(0); i++)
		if (other_x.getByInt(i) &gt; 0.0)
			otherDec.di -= (otherDrv.x.getByInt(i) / xtot) * log(otherDrv.x.getByInt(i) / xtot);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueuser-interface-2"><a class="anchor" href="#trueuser-interface-2"></a>5.4.3. User interface</h4>
<div class="paragraph">
<p>We now need to modify the user interface, provided courtesy of the previous model (<a href="#truetutorial-3-using-tables">Section 5.3</a>), to display <code>di</code> and <code>tsd</code>.
We are simulating 40 species so their abundance (<code>x[n]</code>) is best placed in a separate time series chart and <code>di</code> in another. In addition, we need an xy plot of <code>di</code> by <code>tsd</code>.
For this we need two additional <code>dataTrackers</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For clarity, rename <code>dataTracker:trk1</code> to <code>dataTracker:trkx</code>.</p>
</li>
<li>
<p>Create another <code>dataTracker</code>, as a child of <code>process:p2CommGrowth</code>, name it 'trkdi' and select <code>DataTrackerD0</code> to follow this scalar value.</p>
</li>
<li>
<p>Right-click on <code>dataTracker:trkdi</code> and select <code>Add edge &#8594; trackField &#8594; field:di</code>.</p>
</li>
<li>
<p>Right-click again on <code>dataTracker:trkdi</code> and select <code>Add edge &#8594; trackComponent &#8594; component:comm</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now create a data tracker for <code>di</code> and <code>tsd</code> as an xy pair.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create another <code>dataTracker</code>, as a child of <code>process:p2CommGrowth</code>, name it 'trkditds' and select <code>DataTrackerXY</code>.</p>
</li>
<li>
<p>Right-click on <code>dataTracker:trkditsd</code> and select <code>Add edge &#8594; trackField &#8594; field:di</code>.</p>
</li>
<li>
<p>Right-click on <code>dataTracker:trkditsd</code> and select <code>Add edge &#8594; trackField &#8594; field:tsd</code>.</p>
</li>
<li>
<p>Right-click again on <code>dataTracker:trkditsd</code> and select <code>Add edge &#8594; trackComponent &#8594; component:comm</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now create the widgets to listen to these data trackers. First we delete the table widget inherited from the previous tutorial and then add time series and scatter plot widgets.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Collapse all sub-trees and expand the <code>userInterface</code> sub-tree.</p>
</li>
<li>
<p>Right-click on <code>widget:population table</code> and select <code>Delete node</code>.</p>
</li>
<li>
<p>Create a new <code>container</code> as a child of <code>tab:tab1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>Containers</code> form a binary tree of <code>widgets</code>. Each <code>container</code> can contain one or two <code>widgets</code> or one or two <code>containers</code> or a combination of both with a limit of two.
These binary trees must end in a <code>widget</code> as a leaf node (i.e. you can&#8217;t have empty <code>containers</code>).  The <code>tab</code> node also behaves as a <code>container</code> and the same rules apply.
However, you can have as many <code>tabs</code> but of course only one tab is visible at a time in the <em>ModelRunner</em> interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Add a <code>widget</code> as a child of <code>container:cont1</code>, name it 'srsdi' and select <code>TimeseriesWidget1</code> as its class.</p>
</li>
<li>
<p>Add another <code>widget</code> as a  child of <code>container:cont1</code>, name it 'diversity time since dist'  or something similar, and select <code>ScatterPlotWidget1</code> as its class.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Set these <code>widgets</code> to track the appropriate <code>dataTrackers</code> (<a href="#fig-tut4-user-interface">Figure 50</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>From <code>widget:srsdi</code>, add a <code>trackSeries</code> edge to <code>dataTracker:trkdi</code>.</p>
</li>
<li>
<p>From <code>widget:diversity time since dist</code>, add a <code>trackSeries</code> edge to <code>dataTracker:trktsddi</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All that remains now is to arrange the widgets in the <em>ModelRunner</em> interface. Between each pair of widgets/containers is a divider which can be moved as required (<a href="#fig-tut4-modelrunner">Figure 51</a>). You can specify the pairs to be divided horizontally or vertically and the order of the pairs (left/right or top/bottom).</p>
</div>
<div id="fig-tut4-user-interface" class="imageblock text-center thumb">
<div class="content">
<img src="../source/tutorial4IMG/fig-tut4-user-interface.png" alt="fig tut4 user interface" width="700">
</div>
<div class="title">Figure 50. The user-interface sub-tree for Tutorial 4. .</div>
</div>
<div id="fig-tut4-modelrunner" class="imageblock text-center">
<div class="content">
<img src="../source/tutorial4IMG/fig-tut4-modelrunner.png" alt="fig tut4 modelrunner">
</div>
<div class="title">Figure 51. Running Tutorial 4.</div>
</div>
<div id="fig-tut4-user-interface-properties" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial4IMG/fig-tut4-user-interface-properties.png" alt="fig tut4 user interface properties">
</div>
<div class="title">Figure 52. User-interface properties for <br/>Tutorial 4.</div>
</div>
<div id="fig-tut4-xyplot-dlg" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial4IMG/fig-tut4-xyplot-dlg.png" alt="fig tut4 xyplot dlg">
</div>
<div class="title">Figure 53. Scatter plot properties <br/>editor in ModelRunner.</div>
</div>
<div class="paragraph">
<p>The axis order of the xy plot 'diversity time since dist` can be set using the appropriate dialog from the widget menu in <em>ModelRunner</em> (<a href="#fig-tut4-xyplot-dlg">Figure 53</a>).</p>
</div>
<div class="paragraph">
<p>The arrangement of widgets in the <code>tab</code> binary sub-tree is controlled by the <code>order</code> and <code>orientation</code> properties (<a href="#fig-tut4-user-interface-properties">Figure 52</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="truenext-4"><a class="anchor" href="#truenext-4"></a>5.4.4. Next</h4>
<div class="paragraph">
<p>The next tutorial introduces the event timer to simulator episodic systems such as pulse germination or irregular disturbance regimes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truetutorial-5-event-driven-systems-using-the-event-timer"><a class="anchor" href="#truetutorial-5-event-driven-systems-using-the-event-timer"></a>5.5. Tutorial 5: Event driven systems - Using the Event Timer</h3>
<div class="sect3">
<h4 id="trueintroduction-5"><a class="anchor" href="#trueintroduction-5"></a>5.5.1. Introduction</h4>
<div class="paragraph">
<p>Many processes in nature are episodic and can be triggered when some other process reaches a particular state. For example, in arid environments, organisms may reproduce en masse when a rain event occurs; an epidemic may break out when a population reaches a certain density or; smouldering fire may spread if weather conditions cross some threshold.</p>
</div>
<div class="paragraph">
<p>The previous tutorials have used a clock timer to drive the simulation dynamics. In essence, a clock timer simply issues regular time events autonomously, at intervals determined by its properties – its time step.
An event timer, on the other hand, is not autonomous. It drives its child processes through events posted to it by other processes.</p>
</div>
<div class="paragraph">
<p>In this tutorial we mimic the dynamics of an episodic system with an <a href="https://en.wikipedia.org/wiki/Agent-based_model#In_biology">Individual-based Model</a> (IBM). We use an event timer to drive pulse creation of entities and a clock timer for their deletion. Here, we refer to the 'entities' as 'items' so as not to be distracted by ecological details.</p>
</div>
</div>
<div class="sect3">
<h4 id="truespecifications-4"><a class="anchor" href="#truespecifications-4"></a>5.5.2. Specifications</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> and create a new project from the <code>SimpleClock1</code> template and name the project 'Tut5'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="truedata-definition-4"><a class="anchor" href="#truedata-definition-4"></a>Data definition</h5>
<div class="paragraph">
<p>Three fields are required: a deletion rate, pulse rate and a ceiling to provide a limit to item creation. These will be global constants (<a href="#fig-tut5-data-definition">Figure 54</a>).</p>
</div>
<div id="fig-tut5-data-definition" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial5IMG/fig-tut5-data-definition.png" alt="fig tut5 data definition" width="400">
</div>
<div class="title">Figure 54. Data definition specifications.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Collapse all sub-trees from the root node and then expand <code>dataDefinition:dDef</code>.</p>
</li>
<li>
<p>Delete <code>record:drvs</code>. There are no drivers needed.</p>
</li>
<li>
<p>Rename <code>record:cnsts</code> to 'glbCnsts'.</p>
</li>
<li>
<p>Create three <code>field</code> nodes as children of <code>record:glbCnsts</code>, name them 'ceiling', 'deleteRate' and 'pulseRate' - all of type <code>Double</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truestructure-4"><a class="anchor" href="#truestructure-4"></a>Structure</h5>
<div class="paragraph">
<p>We need 2 component types for this model: the system (which already exists i.e. <code>system:sys</code>) and the 'item' component type which we&#8217;ve yet to define (<a href="#fig-tut5-structure">Figure 55</a>). These have a hierarchical relationship: the system is an assemblage of 'items'. However, <code>system:sys1</code> currently belongs to the <em>atomic</em> category. This must be changed to the <em>assemblage</em> category to signify this hierarchical structure.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse the <code>dataDefinition</code> sub-tree and expand the <code>system</code> sub-tree.</p>
</li>
<li>
<p>From <code>system:sys1</code>, collapse the <code>dynamics</code> sub-tree.</p>
</li>
<li>
<p>Select the <code>system.sys1</code> node and delete the edge to <code>category:*atomic*</code>.</p>
</li>
<li>
<p>From the same node, create a <code>belongsTo</code> edge to <code>category:*assemblage*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An 'itemType' will be a component type with a role defined as belonging to the <em>ephemeral</em>, <em>atomic</em>, <em>component</em> and <em>item</em> categories. It&#8217;s <em>ephemeral</em> because it can be created and destroyed; it&#8217;s <em>atomic</em> because it has no sub-components; it&#8217;s a <em>component</em> because it is a sub-component of a larger system and it&#8217;s a <em>item</em> because processes that apply to it must reference a category unique to it. All these categories already exist in the <code>predefined:*categories*</code> sub-tree except for the 'item' category which we must create.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create a <code>structure</code> node as a child of <code>system.sys1</code> to begin building the model structure sub-tree.</p>
</li>
<li>
<p>Create a <code>categorySet</code> node as a child of <code>structure:struc1</code> and name it 'itemSet'.</p>
</li>
<li>
<p>Create a <code>category</code> node as a child of <code>categorySet:itemSet</code> and name it 'itemCat'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We now build the item component.</p>
</div>
<div id="fig-tut5-structure" class="imageblock left text-center thumb">
<div class="content">
<img src="../source/tutorial5IMG/fig-tut5-structure.png" alt="fig tut5 structure" width="500">
</div>
<div class="title">Figure 55. Model structure specifications.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>componentType</code> as a child of <code>structure:struc1</code> and name it 'itemType'.</p>
</li>
<li>
<p>Create a <code>component</code> as a child of <code>componentType:itemType</code> and name it 'item'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We now define the <em>role</em> of <code>itemType</code> by specifying the categories it belongs to.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Create 4 <code>belongsTo</code> edges from <code>componentType:itemType</code> to <code>category:*ephemeral*</code>, <code>category:*atomic*</code>, <code>category:*component*</code> and <code>category:itemCat</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message now appears suggesting two ways we can create an initial number of items: by the addition of an optional property (<code>nInstances</code>) or loading from a file. For this tutorial we will just add the optional property.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Right-click on <code>component:item</code> and select <em>optional properties</em> from the popup menu. Check the <code>nInstances</code> box.</p>
</li>
<li>
<p>In the properties editor, set the value of <code>nInstances</code> to 100.</p>
</li>
<li>
<p>Before ending this section, rename <code>initFunction:init1</code> to 'SysInit'.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truedynamics-4"><a class="anchor" href="#truedynamics-4"></a>Dynamics</h5>
<div class="paragraph">
<p>The <code>SimpleClock1</code> template we started with contains a clock timer (<code>timer:clock1</code>) which we can use to call the delete function to remove items at a regular rate. Later we add <code>eventTimers</code> to implement the episodic dynamics. It will make the following steps clearer if we rename two nodes first (<a href="#fig-tut5-dynamics">Figure 56</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collapse all sub-trees from the root node and then expand <code>system:sys1</code>.</p>
</li>
<li>
<p>From <code>system:sys1</code>, collapse all sub-trees and then expand <code>dynamics:sim</code> and re-apply the layout [Alt+L].</p>
</li>
<li>
<p>Rename <code>timer:clock1</code> to <code>timer:t3Clock</code>.</p>
</li>
<li>
<p>Rename <code>process:p1</code> to <code>process:p3</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We need a <code>deleteDecision</code> function associated with this process rather than the current <code>ChangeState</code> function.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Delete node <code>function:F1</code>.</p>
</li>
<li>
<p>Create a <code>function</code> node as a child of <code>process:p3</code>, name it 'DeleteItem' and select <code>deleteDecision</code> as its type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>process:p3</code> is currently applied to the <code>arena</code> category. This edge was present from the template we started with. We must reassign this to apply <code>p3</code> to <code>category:itemCat</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Select <code>process:p3</code> and delete the edge to the arena category and create an <code>appliesTo</code> edget to <code>category:itemCat</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We now need an event timer to drive 'item' creation events.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create a <code>timer</code> node as a child of <code>timeline:tmLn</code>, name it 't2Event' and select <code>EventTimer</code> as its type.</p>
</li>
<li>
<p>Create a <code>process</code> node as child of <code>timer:t2Event</code> and name it 'p2'.</p>
</li>
<li>
<p>Add an <code>appliesTo</code> edge from <code>process:p2</code> to <code>category:itemCat</code>.</p>
</li>
<li>
<p>Create a <code>function</code> node as child of <code>process:p2</code>, name it 'Nitems' and select <code>CreateOtherDecision</code> as its type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This function returns a floating point number that will be the number of items to create <em>for each existing item</em>. The fractional part is rounded probabilistically to give a discrete value.</p>
</div>
<div class="paragraph">
<p>A new message has now appeared asking that <code>timer:t2Event</code> have an edge to a <code>function</code> or <code>initFunction</code>. Every event timer must have at least one function that feeds events to it (specified by a <code>fedBy</code> edge). Therefore, we need a third function to generate these events.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Create a <code>timer</code> node as a child of <code>timeline:tmLn</code>, name it 't1Event' and select <code>EventTimer</code> as its type.</p>
</li>
<li>
<p>Create a <code>process</code> node as child of <code>timer:t1Event</code> and name it 'p1'.</p>
</li>
<li>
<p>Create a <code>function</code> node as child of <code>process:p1</code>, name it 'Pulse' and select <code>ChangeState</code> as its type.</p>
</li>
<li>
<p>Add an <code>appliesTo</code> edge from <code>process:p1</code> to <code>category:*arena*</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This function operates at a global level (the arena) not at the level of individual items as does <code>function:Nitems</code>. It&#8217;s job is to send an event to <code>timer:t2Event</code> that will cause <code>function:Nitems</code> to be called in a loop on all existing items. The function <code>function:Pulse</code> will also post a future event to call itself so the system will run indefinitely. However, since <code>function:Pulse</code> is also driven by an <code>eventTimer</code> we will get into an infinite regress unless we somehow feed at least one event to <code>timer:t1Event</code>. To do this we just add a <code>fedBy</code> edge to an <code>initFunction</code>.</p>
</div>
<div class="paragraph">
<p>To do all this, we must add 3 <code>fedBy</code> edges: one from <code>function:Pulse</code> to drive item creation; one from <code>function:Pulse</code> to <code>timer:t1Event</code> to drive pulse creation; and a third from <code>initFunction:SysInit</code> to start the chain of events.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Add an <code>fedBy</code> edge from <code>timer:t1Event</code> to <code>initFunction:SysInit</code>. SysInit will post a first event to begin the process.</p>
</li>
<li>
<p>Add another <code>fedBy</code> edge from <code>timer:t1Event</code> to <code>function:Pulse</code>. Pulse will continue calls to itself at some random time.</p>
</li>
<li>
<p>Add a third <code>fedBy</code> edge this time from <code>timer:t2Event</code> to <code>function:Pulse</code>. Pulse will also generate the item creation events.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There can be any number of event timers in a specification and each timer can be driven by any number of functions posting events at any time in 'present' or future. This design allows specifying very complex causal chains.</p>
</div>
<div class="paragraph">
<p>The template we began with includes a <code>stoppingCondition</code>. This is not needed as we can allow the simulation continue indefinitely for now.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Select <code>stoppingCondition:stCd1</code> (a child of <code>dynamics:sim1</code>) and delete it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next step is to record the number of 'items' at the end of the time step for display. A state variable already exists for this purpose in the <code>predefined:*categories*</code> sub-tree called <code>count</code>. To make use of this we must add another <code>process</code> with a <code>dataTracker</code> child.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Create a <code>process</code> as a child of <code>timer:t3clock</code> and name it 'p4'.</p>
</li>
<li>
<p>Add an <code>appliesTo</code> edge from <code>process:p4</code> to <code>category:*assemblage*</code>. This category is associated with <code>record:AVPopualation</code> that contains the <code>count</code> field.</p>
</li>
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p4</code>.</p>
</li>
<li>
<p>From the dataTracker, add two edges: one a <code>trackField</code> edge to <code>field:count</code> and the second a <code>trackComponent</code> edge to  <code>system:sys</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now add <code>dependsOn</code> edges between some of the processes to set their order of execution.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Right-click on <code>process:p4</code> and create a <code>dependsOn</code> edge to <code>process:p3</code>. This ensures <code>count</code> is recorded as the last step.</p>
</li>
<li>
<p>Right-click on <code>process:p3</code> and create a <code>dependsOn</code> edge to <code>process:p2</code>. This ensures <code>function:Delete</code> always occurs after <code>function:Nitems</code> should they occur simultaneously.</p>
</li>
</ol>
</div>
<div id="fig-tut5-dynamics" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial5IMG/fig-tut5-dynamics.png" alt="fig tut5 dynamics" width="800">
</div>
<div class="title">Figure 56. Model dynamics specification.</div>
</div>
</div>
<div class="sect4">
<h5 id="truecoding"><a class="anchor" href="#truecoding"></a>Coding</h5>
<div class="paragraph">
<p>We now add the program code to all <code>functionSnippet</code> properties for all the functions we have created.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the <code>system</code> sub-tree is fully expanded. To do this <em>Collapse sub-tree &gt; All</em> from <code>system:sys</code> node and then select <em>Expand sub-tree &gt; All</em> from the same node.</p>
</li>
<li>
<p>In the <code>Properties</code> editor, select the 'By name' button in the top-left corner and type 'func' in the search bar. All 4 <code>functionSnippet</code> properties should now be listed.</p>
</li>
<li>
<p>Edit <code>SysInit#functionSnippet</code>, and enter the following text:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">        // Set values of global constants
        focalCnt.deleteRate = 0.01;
        focalCnt.pulseRate = 0.002;
        focalCnt.ceiling = 5000.0;
        // post event to the pulse time to kick start it. After this it posts events to itself.
        t1Event.postTimeEvent(1);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Edit <code>Pulse#functionSnippet</code> and enter:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">        // post a 'item' creation event for this time
        t2Event.postTimeEvent(t);
        // schedule a call to this method at some future time
        t1Event.postTimeEvent(t + random.nextInt((int)(1.0/pulseRate)) + 1);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Edit <code>Nitems#functionSnippet</code> and enter:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>        // limit the recuitment rate of items to the ceiling
        double rate = (ceiling-count)/(double)count;
        return rate;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Edit <code>Delete#functionSnippet</code> and enter:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>        // return the deleteRate probabilistically converted to true or false
        return decider.decide(deleteRate);</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="trueuser-interface-3"><a class="anchor" href="#trueuser-interface-3"></a>User Interface</h5>
<div class="paragraph">
<p>The template we are using has only provided a control widget (<code>widget:ctrl</code>) to run the model.
To see some output we will add a widget to display a time series of <code>count</code> (<a href="#fig-tut5-user-interface">Figure 57</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>tab</code> as a child of <code>userInterface:gui</code>.</p>
</li>
<li>
<p>Create a <code>widget</code> as a child of <code>tab:tab1</code> and name it <code>Number of items</code> and select <code>TimeSeriesWidget1</code> as its type.</p>
</li>
<li>
<p>Add a <code>trackSeries</code> edge from this widget to <code>dataTracker:trk1</code>.</p>
</li>
<li>
<p>Run the simulator (Deploy [Alt+D]).</p>
</li>
</ol>
</div>
<div id="fig-tut5-user-interface" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial5IMG/fig-tut5-user-interface.png" alt="fig tut5 user interface" width="600">
</div>
<div class="title">Figure 57. User interface specifications.</div>
</div>
<div class="paragraph">
<p>The simulator runs indefinitely (assuming you have deleted the <code>stoppingCondition</code> node) with exponentially declining numbers and a creation pulses up to 500 time steps apart (<a href="#fig-tut5-modelRunner">Figure 58</a>).</p>
</div>
<div id="fig-tut5-modelRunner" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial5IMG/fig-tut5-modelRunner.png" alt="fig tut5 modelRunner">
</div>
<div class="title">Figure 58. Running Tutorial 5.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truenext-5"><a class="anchor" href="#truenext-5"></a>5.5.3. Next</h4>
<div class="paragraph">
<p>The next tutorial introduces spatial models by modifying this model to display 'items' in a 2-dimensional continuous surface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truetutorial-6-event-driven-systems-using-the-event-timer-in-a-spatial-model"><a class="anchor" href="#truetutorial-6-event-driven-systems-using-the-event-timer-in-a-spatial-model"></a>5.6. Tutorial 6: Event driven systems - Using the Event Timer in a spatial model</h3>
<div class="sect3">
<h4 id="trueintroduction-6"><a class="anchor" href="#trueintroduction-6"></a>5.6.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial introduces 2-dimensional space by converting Tutorial 5 to a spatial model.</p>
</div>
</div>
<div class="sect3">
<h4 id="truespecifications-5"><a class="anchor" href="#truespecifications-5"></a>5.6.2. Specifications</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start <em>ModelMaker</em> and create a new project from <code>Tutorials &#8594; Event timer 1</code> and name it 'Tut6'.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="truedata-definition-5"><a class="anchor" href="#truedata-definition-5"></a>Data definition</h5>
<div id="fig-tut6-data-definition" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial6IMG/fig-tut6-data-definition.png" alt="fig tut6 data definition" width="500">
</div>
<div class="title">Figure 59. Data definition specifications.</div>
</div>
<div class="paragraph">
<p>We must first specify x,y coordinates for 'items' - the modelled entity (<a href="#fig-tut6-data-definition">Figure 59</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>record</code> as a child of <code>dataDefinition:dDef</code> and name it 'itemDrvs'.</p>
</li>
<li>
<p>Add 2 fields to this record named 'x' and 'y' of type <code>Double</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message appears indicating this new record must be associated with a <code>category</code>. This is done in the next section.</p>
</div>
</div>
<div class="sect4">
<h5 id="truestructure-5"><a class="anchor" href="#truestructure-5"></a>Structure</h5>
<div class="paragraph">
<p>In the <strong>structure</strong> sub-tree we specify the type of space to use and associate it, and the <code>category:itemCat</code>, with the <em>xy</em> coordinates specified above (<a href="#fig-tut6-structure">Figure 60</a>). We can also set the initial values of the coordinates at start up time.</p>
</div>
<div id="fig-tut6-structure" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial6IMG/fig-tut6-structure.png" alt="fig tut6 structure" width="550">
</div>
<div class="title">Figure 60. Model structure specifications.</div>
</div>
<div class="paragraph">
<p>Associate the item drivers with the item category.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click on <code>category:itemCat</code> and create an edge to the <em>xy</em> coordinates by selecting <code>New edge &#8594; drivers &#8594; record:itemDrvs</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Create the space and set its properties.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>space</code> node as a child of <code>structure:struc1</code> and select <code>ContinuousFlatSurface</code> as its type.</p>
</li>
<li>
<p>Right-click on <code>space:space</code> and create a new edge to <code>coordinate &#8594; field:x</code> and name it 'x1'.</p>
</li>
<li>
<p>Repeat the above but select <code>coordinate &#8594; field:y</code> and name it 'y1'.</p>
</li>
<li>
<p>In the properties editor for <code>space:space1</code>, set <code>y1#rank</code> to 1 and <code>space1#precision</code> to 0.01.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Set the dimensions of the space to 1,000 by 1,000 meters.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Set the properties of <code>space1#x-limits</code> and <code>space1#y-limits</code> to 0 to 1000 inclusive.</p>
</li>
<li>
<p>Add the optional property <code>units</code> to <code>space:space1</code> and set its value to 'm' (meters). This is just for documentation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Create a function to set initial values (the <em>xy</em> coordinates) for the 100 items (a property of <code>component:item</code>) at start up.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Create an <code>initFunction</code> as a child of <code>componentType:itemType</code> and name it 'ItemInit'.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truedynamics-5"><a class="anchor" href="#truedynamics-5"></a>Dynamics</h5>
<div class="paragraph">
<p>When new items are created by <code>process:Nitems</code> we need a function to set <em>xy</em> coordinates of the newly created 'items'. This is a 'consequence' function. Consequence functions are children of other functions rather than a process (<a href="#fig-tut6-dynamics">Figure 61</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>function</code> as a child of <code>function:Nitems</code>, name it 'MakeItem' and select <code>setOtherInitialState</code> as its type.</p>
</li>
</ol>
</div>
<div id="fig-tut6-dynamics" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial6IMG/fig-tut6-dynamics.png" alt="fig tut6 dynamics" width="800">
</div>
<div class="title">Figure 61. Model dynamics specifications.</div>
</div>
</div>
<div class="sect4">
<h5 id="truecoding-2"><a class="anchor" href="#truecoding-2"></a>Coding</h5>
<div class="paragraph">
<p>We now add some Java code to set values for the <em>xy</em> coordinates. We will just set random values for the state up items and set values in newly created items to be clumped near their parent item.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following code to the <code>ItemInit#functionSnippet</code> property:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">        // place dots in random locations (assuming these are the dimensions of the map)
        focalDrv.x = random.nextDouble() * 1000;
        focalDrv.y = random.nextDouble() * 1000;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Add the following code to the <code>MakeItem#functionSnippet</code> property:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="Java" class="language-Java hljs">       // place dot randomly near 'parent' dot.
       double distance = -50.0 * Math.log(1 - random.nextDouble());
       double direction = random.nextDouble() * (2 * Math.PI);
       otherDrv.x = x + distance * Math.cos(direction);
       otherDrv.y = y + distance * Math.sin(direction);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="trueuser-interface-4"><a class="anchor" href="#trueuser-interface-4"></a>User Interface</h5>
<div class="paragraph">
<p>Add a widget to view the items in space (<a href="#fig-tut6-user-interface">Figure 62</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>widget</code> as a child to <code>tab:tab</code>, name it 'Item landscape' and select <code>SpaceWidget1</code> as its type.</p>
</li>
<li>
<p>Add a <code>trackSpace</code> edge from <code>widget:Item landscape</code> to <code>space:space</code> (<code>trackSpace &#8594; space:space1</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Arrange the two widget horizontally (the default) - time series first.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click on <code>widget:Item landscape</code> and in the <em>Selected properties</em> editor, set <code>Item landscape#order</code> to 1.</p>
</li>
</ol>
</div>
<div id="fig-tut6-user-interface" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial6IMG/fig-tut6-User-Interface.png" alt="fig tut6 User Interface" width="600">
</div>
<div class="title">Figure 62. Simulator&#8217;s user-interface specifications showing cross-links to nodes in <br/> the structure and dynamics sub-trees.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Deploy the simulation [Alt+D] (<a href="#fig-tut6-modelRunner">Figure 63</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Information about <code>SpaceWidget1</code> can be found at <a href="#truewidgets">Section 3.3.7.5</a>.</p>
</div>
<div id="fig-tut6-modelRunner" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial6IMG/fig-tut6-ModelRunner.png" alt="fig tut6 ModelRunner">
</div>
<div class="title">Figure 63. Running Tutorial 6.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truenext-6"><a class="anchor" href="#truenext-6"></a>5.6.3. Next</h4>
<div class="paragraph">
<p>The next tutorial will explain how to implement and use random numbers in models that require stochasticity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truetutorial-7-random-number-generators"><a class="anchor" href="#truetutorial-7-random-number-generators"></a>5.7. Tutorial 7: Random number generators</h3>
<div class="sect3">
<h4 id="trueintroduction-7"><a class="anchor" href="#trueintroduction-7"></a>5.7.1. Introduction</h4>
<div class="paragraph">
<p>This tutorial introduces the use of <a href="https://en.wikipedia.org/wiki/Random_number_generation">random number generators</a> (RNG).</p>
</div>
<div class="paragraph">
<p>3Worlds provides for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A single default RNG</p>
</li>
<li>
<p>Any number of independent RNGs;</p>
</li>
<li>
<p>Three different RNG algorithms;</p>
</li>
<li>
<p>Management for seeding the RNGs; and,</p>
</li>
<li>
<p>Assignment of RNGs to particular <code>Functions</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="truea-single-default-rng"><a class="anchor" href="#truea-single-default-rng"></a>A single default RNG</h5>
<div class="paragraph">
<p>In many cases, management of random number generation is not required. For this reason, a single default RNG (PCG32) is available to all functions and can be used by the modeller in their code. Which RNG is available and how it is managed is defined in the model&#8217;s specifications using <em>ModelMaker</em>. These choices are transparent to the model so no coding effort is required by the modeller to utilise the various features.</p>
</div>
</div>
<div class="sect4">
<h5 id="trueany-number-of-independent-rngs"><a class="anchor" href="#trueany-number-of-independent-rngs"></a>Any number of independent RNGs</h5>
<div class="paragraph">
<p>You can create any number of independent RNGs and apply them individually or to groups of <code>Functions</code>. For example, you could assign an RNG to all functions that apply to reproduction and another to all functions that concern landscape dynamics.</p>
</div>
</div>
<div class="sect4">
<h5 id="truethree-different-rng-algorithms"><a class="anchor" href="#truethree-different-rng-algorithms"></a>Three different RNG algorithms</h5>
<div class="paragraph">
<p>Three RNG algorithms are available: the standard Java RNG, Pcg32 (<a href="https://www.pcg-random.org/pdf/hmc-cs-2014-0905.pdf">Permuted Congruential Generator</a>) and XSRandom (<a href="http://demesos.blogspot.com/2011/09/replacing-java-random-generator.html">XorShift</a>). Two important properties of RNGs are their quality (the degree to which they cannot be predicted better than by a random chance) and the computer resources required to produce them (memory and speed). Both Pcg32 and XSRandom are much faster (50% and 75% respectively) and of higher quality than the native Java RNG. Pcg32 is of higher quality than XSRandom (the default).</p>
</div>
</div>
<div class="sect4">
<h5 id="truemanagement-for-seeding-the-rngs"><a class="anchor" href="#truemanagement-for-seeding-the-rngs"></a>Management for seeding the RNGs</h5>
<div class="paragraph">
<p>For the purpose of debugging and experimental design it is often necessary to manage the RNG seeds.</p>
</div>
<div class="paragraph">
<p>There are two ways to set the source of the RNG seed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>TABLE</strong>: From <a href="https://www.random.org/">a table of 1,000 independently generated random number seeds</a>; and,</p>
</li>
<li>
<p><strong>RANDOM</strong>: From a randomly generated seed using current time to the nano second.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, the seed can be set at the time of model instantiation (<strong>NEVER</strong>) or upon every reset of the simulation (<strong>ONMODELSTART</strong>).
Using the <strong>RANDOM</strong> option means there is a new seed created at every instantiation. This option is here just so you don&#8217;t need to delete all the random number generators from the specifications - it effectively switches off reproducible RNG streams.</p>
</div>
<div class="paragraph">
<p>In this tutorial, we build a model with two functions to generate random numbers from two independent streams.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truespecifications-6"><a class="anchor" href="#truespecifications-6"></a>5.7.2. Specifications</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project starting from the <code>SimpleClock</code> template.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="truedata-definition-6"><a class="anchor" href="#truedata-definition-6"></a>Data definition</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete the node <code>record:cnsts</code></p>
</li>
<li>
<p>Create two <code>field</code> nodes as children of <code>record:drvs</code> accept their default names ('fld1', 'fld2') and use the default type of <code>Double</code>.</p>
</li>
<li>
<p>Create two <code>rng</code> nodes as children of <code>dataDefinition:dDef</code> and accept their default names ('gen1', gen2').</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truestructure-6"><a class="anchor" href="#truestructure-6"></a>Structure</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete node <code>initFunction:init1</code>: it&#8217;s no needed for this tutorial.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="truedynamics-6"><a class="anchor" href="#truedynamics-6"></a>Dynamics</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>Function</code> as child of <code>process:p1</code> accept the default name ('F2") and select <code>ChangeState</code> as the type.</p>
</li>
<li>
<p>Add the following code to <code>F1#functionSnippet</code> property: 'focalDrv.fld1 = random.nextDouble();'.</p>
</li>
<li>
<p>Add the following code to <code>F2#functionSnippet</code> property: 'focalDrv.fld2 = random.nextDouble();'.</p>
</li>
<li>
<p>Create a <code>useRNG</code> edge from <code>function:F1</code> to <code>rng:gen1</code>.</p>
</li>
<li>
<p>Create a <code>useRNG</code> edge from <code>function:F2</code> to <code>rng:gen2</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now the value of 'fld1' is set by the random number generator 'gen1' and the value of 'fld2' by 'gen2'.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create a <code>dataTracker</code> as a child of <code>process:p1</code> and select <code>DataTrackerD0</code> as its type.</p>
</li>
<li>
<p>Create two <code>trackField</code> edges from <code>dataTracker:trk1</code> to <code>field:fld`</code> and <code>field:fld2</code> respectively.</p>
</li>
<li>
<p>Create a <code>trackComponent</code> edge from <code>dataTracker:trk1</code> to <code>system.sys1</code>.</p>
</li>
</ol>
</div>
<div id="fig-tut7-Config" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial7IMG/fig-tut7-Config.png" alt="fig tut7 Config" width="700">
</div>
<div class="title">Figure 64. Essential elements of the configuration for tutorial 7.</div>
</div>
</div>
<div class="sect4">
<h5 id="trueuser-interface-5"><a class="anchor" href="#trueuser-interface-5"></a>User interface</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>tab</code> node as a child of <code>userInterface:gui</code>.</p>
</li>
<li>
<p>Create a <code>widget</code> node as a child of <code>tab:tab1</code> and select <code>TimeseriesWidget1</code> as its type.</p>
</li>
<li>
<p>Create a <code>trackSeries</code> edge from <code>widget:wgt1</code> to <code>dataTracker:trk1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the configuration is finished (<a href="#fig-tut7-Config">Figure 64</a>), deploy the simulator.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truesimulation"><a class="anchor" href="#truesimulation"></a>5.7.3. Simulation</h4>
<div class="paragraph">
<p>When the simulator is run, two independent random number series  (<a href="#fig-tut7-ModelRunner">Figure 66</a>) are produced. If this is not the case, check that the code snippets (steps 2 &amp; 3 in <em>Dynamics</em> above) are correct and that <code>function:F1</code> sets the value of <code>fld1</code> and <code>function:F2</code> sets the value of <code>fld2</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Re-run the simulator a few times to ensure a different series is produced each time</p>
</li>
</ol>
</div>
<div id="fig-tut7-rng-properties" class="imageblock right text-left thumb">
<div class="content">
<img src="../source/tutorial7IMG/fig-tut7-rng-properties.png" alt="fig tut7 rng properties">
</div>
<div class="title">Figure 65. Displaying just the properties of <br/> the random number generators.</div>
</div>
<div class="paragraph">
<p>We will now hold the random number series constant.
To see all the relevant RNG properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Select the <em>Properties</em> tab in <em>ModelMaker</em> and click the <em>by name</em> button (top left).</p>
</li>
<li>
<p>Enter 'gen' in the search field. Now only properties of nodes <code>gen1</code> and <code>gen2</code> are displayed (<a href="#fig-tut7-rng-properties">Figure 65</a>).</p>
</li>
<li>
<p>Set properties <code>gen1#seedSource</code> and <code>gen2#seedSource</code> to <strong>TABLE</strong> and re-run the simulator.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both series are now identical as they are set by the same seed (index 0 of the table of seeds). Of course if you change the RNG algorithm to one of the other algorithms, different streams will result.</p>
</div>
<div id="fig-tut7-ModelRunner" class="imageblock text-left thumb">
<div class="content">
<img src="../source/tutorial7IMG/fig-tut7-ModelRunner.png" alt="fig tut7 ModelRunner" width="700">
</div>
<div class="title">Figure 66. Independent and dependent random number streams.</div>
</div>
</div>
<div class="sect3">
<h4 id="truenext-7"><a class="anchor" href="#truenext-7"></a>5.7.4. Next</h4>
<div class="paragraph">
<p><strong>TODO</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 text-justify">
<h2 id="truebibliography"><a class="anchor" href="#truebibliography"></a>Bibliography</h2>
<div class="sectionbody">
<div id="Bousquet2004" class="paragraph">
<p>Bousquet, F., &amp; Le Page, C. (2004). Multi-agent simulations and ecosystem management: a review. <em>Ecological Modelling</em>, 176:313–332. <a href="https://doi.org/10.1016/j.ecolmodel.2004.01.011" class="bare">https://doi.org/10.1016/j.ecolmodel.2004.01.011</a></p>
</div>
<div id="Connell1978" class="paragraph">
<p>Connell, J.H. (1978). Diversity in tropical rain forests and coral reefs - high diversity of trees and corals is maintained only in a nonequilibrium state. <em>Science</em> 199:1302–1310</p>
</div>
<div id="Coquillard1997" class="paragraph">
<p>Coquillard, P., &amp; Hill, D. (1997). <em>Modélisation et simulation d’écosystèmes. Des modèles déterministes aux simulations à événements discrets</em>. Masson, Paris.</p>
</div>
<div id="Flint2006" class="paragraph">
<p>Flint, S. R. (2006). <em>Aspect-Oriented Thinking - An approach to bridging the disciplinary divides</em>. PhD, Australian National University.</p>
</div>
<div id="Gignoux2011" class="paragraph">
<p>Gignoux, J., I.D. Davies, S.R. Flint, &amp; J.D. Zucker (2011). The Ecosystem in Practice: Interest and
Problems of an Old Definition for Constructing Ecological Models. <em>Ecosystems</em> 14: 1039‑54. <a href="https://doi.org/10.1007/s10021-011-9466-2" class="bare">https://doi.org/10.1007/s10021-011-9466-2</a>.</p>
</div>
<div id="Gignoux2017" class="paragraph">
<p>Gignoux, J., G. Chérel, I.D. Davies, S.R. Flint, &amp; E. Lateltin (2017). Emergence and Complex Systems: The
Contribution of Dynamic Graph Theory. <em>Ecological Complexity</em> 31: 34‑49. <a href="https://doi.org/10.1016/j.ecocom.2017.02.006" class="bare">https://doi.org/10.1016/j.ecocom.2017.02.006</a>.</p>
</div>
<div id="Grimm2005" class="paragraph">
<p>Grimm, V., &amp; Railsback, S. (2005). <em>Individual-based modelling and ecology</em>. Princeton University Press.</p>
</div>
<div id="Grimm2010" class="paragraph">
<p>Grimm V, Berger U, DeAngelis DL, Polhill JG, Giske J, Railsback SF (2010) The ODD protocol: A review and first update. <em>Ecological Modelling</em> 221:2760–2768.</p>
</div>
<div id="Harary1997" class="paragraph">
<p>Harary, F., &amp; Gupta, G. (1997). Dynamic graph models. <em>Mathematical and Computer Modelling</em>, 25(7), 79–87. <a href="https://doi.org/10.1016/S0895-7177(97)00050-2" class="bare">https://doi.org/10.1016/S0895-7177(97)00050-2</a></p>
</div>
<div id="Lim2009" class="paragraph">
<p>Lim, W. H., &amp; Roderick, M. L. (2009). <em>An atlas of the global water cycle based on the IPCC AR4 climate models.</em> ANU E Press.</p>
</div>
<div id="Melilo1995" class="paragraph">
<p>Melilo, J. M., Borchers, J., Chaney, J., Fisher, H., Fox, S., Haxeltine, A., Janetos, A., Kicklighter, D. C., Kittel, T. G. F., McGuire, A. D., McKeown, R., Neilson, R., Nemani, R., Ojima, D. S., Painter, T., Pan, Y., Parton, W. J., Pierce, L., Pitelka, L., … Woodward, F. I. (1995). Vegetation/ecosystem modeling and analysis project: comparing biogeography and biogeochemistry models in a continental-scale study of terrestrial ecosystem responses to climate change and CO<sub>2</sub> doubling. <em>Global Biogeochemical Cycles</em>, 9(4), 407–437.</p>
</div>
<div id="Parton1988" class="paragraph">
<p>Parton, W., Stewart, J., &amp; Cole, C. (1988). Dynamics of C,N, P and S in grassland soils: a model. <em>Biogeochemistry</em>, 5, 109–131.</p>
</div>
<div id="Quesnel2009" class="paragraph">
<p>Quesnel G, Duboz R, Ramat E (2009). The Virtual Laboratory Environment - An operational framework for multi-modelling, simulation and analysis of complex dynamical systems. <em>Simulation Modelling Practice and Theory</em> 17:641–653.</p>
</div>
<div id="Roxburgh2004" class="paragraph">
<p>Roxburgh, S. H., Barrett, D. J., Berry, S. L., Carter, J. O., Davies, I. D., Gifford, R. M., Kirschbaum, M. U. E., McBeth, B. P., Noble, I. R., Parton, W. G., Raupach, M. R., &amp; Roderick, M. L. (2004). A critical overview of model estimates of net primary productivity for the Australian continent. <em>Functional Plant Biology</em>, 31(11), 1043–1059.</p>
</div>
<div id="Tansley1935" class="paragraph">
<p>Tansley, A G. (1935). The use and abuse of vegetational concepts and terms. <em>Ecology</em> 16: 284‑307.</p>
</div>
<div id="Zeigler2000" class="paragraph">
<p>Zeigler B, Kim TG, Praehofer H (2000) <em>Theory of Modeling and Simulation : integrating discrete event and continuous complex dynamic systems</em>. Academic Press</p>
</div>
<div id="Zucker2003" class="paragraph">
<p>Zucker, J.D. (2003). A Grounded Theory of Abstraction in Artificial Intelligence. <em>Philosophical Transactions of
the Royal Society B: Biological Sciences</em> 358: 1293‑1309. <a href="https://doi.org/10.1098/rstb.2003.1308" class="bare">https://doi.org/10.1098/rstb.2003.1308</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.7<br>
Last updated 2022-02-03 17:26:24 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>