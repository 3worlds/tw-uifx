
// DEPRECATED 27/4/2021

===== Specifying data structures

The versatility of 3Worlds resides in the possibility to _generate_ any relevant data structure: based on simple specifications described here, `ModelMaker` will generate java classes implementing the data structures that will be interfaced with user-written code describing ecological processes.

Under the <<truethe-em-ecology-em-node,`ecology`>> node, we have seen that ecological entities could be grouped into <<truecategory,`categories`>> organized in <<truepartition,`partitions`>> of exclusive categories, and that hierarchies of partitions within categories could be designed.

3Worlds proposes two kinds of data structures: _records_ and _tables_, that can be organized hierarchically.

NOTE: The top-level data structure must be a _record_

====== Record

`/3worlds/codeSource/*record*:<[underline]##__name__##>` {0..*}

`.../table/*record*:<[underline]##__name__##>` {0..1}

A _record_ is a set of `(name,value)` pairs where the values are accessed by their name. Values may be of different types (e.g. numbers, character strings, tables...).
_Records_ may contain _fields_ or _tables_ or both (see below), but no _records_.

====== Table

`/3worlds/codeSource/record/*table*:<[underline]##__name__##>` {0..*}

A _table_ is a set of values all of the same type, accessible by an _index_. 3Worlds tables can be multidimensional, i.e. can have many indexes. _Tables_ may contain elements of the same types as _fields_, or _records_ (see below), but no _tables_.


_Cross-links for_ `table`:

`dim -> dimensioner:<[underline]##__name__##>` {1..*}::
This link tells how many entries a table has in this dimension. A table _must_ have at least one dimensioner.

include::ArchetypeDoc-table.adoc[]

NOTE: The `dataElementType` property can be ommited if a `record` sub-node is provided.

====== Field

`.../record/*field*:<[underline]##__name__##>` {0..*}

A _field_ specifies a single value with a name to access it.

_Properties for_ `field`:

[horizontal]
`dataElementType`:: The data type of the field. 
+
****
_possible values_: as in <<truetable,`table.dataElementType`>>
****

====== Dimensioner

`/3worlds/codeSource/*dimensioner*:<[underline]##__name__##>` {0..*}

A _dimensioner_ is a constant integer number used to set the size of a _table_ data structure.

_Properties for_ `dimensioner`:

[horizontal]
`dim`:: The number of entries of the table in this dimension (integer in range [1;2147483647]). 

====== Example: specifying nested data structures

On this diagram (generated with `ModelMaker`), hierarchical links are in green and cross-links are in black.

[#fig-data-structure-example]
.Example of a configuration with nested data structures
image::example-data-structures.png[align="center"]

The data structure tree of this figure, once linked to a category tree and to system components, will generate the following code:

----
TODO: put generated code here
----

===== Specifying user-defined code

The versatility of 3Worlds resides in the possibility to implement any relevant ecological process to describe ecosystem dynamics. System components that constitute the simulated system have their state variables modified during the course of a simulation by ecological processes. These processes perform different kinds of actions on system components, but all of them can (and actually should) be customized to implement the particularities of any model.

Whereas in the <<trueecology,ecology>> node we specified the _conceptual_ links between categories, system components and processes, here we can specify the _technical_ part of process implementation. Based on these specifications, `ModelMaker` will generate java source files for _template function classes_ into a user-specified directory (preferably a java project: cf. <<truesetting-up-a-java-development-environment-for-the-user-code,java project for user code>>). Users can then edit these files to their needs, and they will be compiled and linked to the simulator by `ModelMaker`.

====== Function

`/3worlds/codeSource/*functionSpec*:<[underline]##__name__##>` {0..*}

The `functionSpec` node is used to selecct a particular type of function to attach to a process. _Functions_ differ by the way they act on system components: 

* some only modify the state variables of a system component
* others make decisions on system components: 
** delete a system component 
** create new system components
** transform into another system component type
** establish or maintain a relation to another system component

This is specified by means of the `type` property.

include::ArchetypeDoc-functionSpec.adoc[]

The code template generated by `ModelMaker` will differ based on this property.

*TODO* explain in detail the difference between the code templates

====== Code snippet

*This is deprecated and should not be used anymore (???)* 

====== Initialiser

`/3worlds/codeSource/*initialiserSpec*:<[underline]##__name__##>` {0..*}

This node specifies a particular type of function that is only called once, at the beginning of a simulation, to set initial values or perform initial computation on a model's _parameters_. It is the only place where parameters can be modified programmatically.


